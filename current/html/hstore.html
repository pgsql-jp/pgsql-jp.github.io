<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>F.16. hstore</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="fuzzystrmatch.html" title="F.15. fuzzystrmatch" /><link rel="next" href="intagg.html" title="F.17. intagg" /><meta name="viewport" content="width=device-width,initial-scale=1.0" /></head><body id="docContent" class="container-fluid col-10"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="4" align="center"><a accesskey="h" href="index.html">PostgreSQL 13.1文書</a></th></tr><tr><td width="10%" align="left"></td><td width="10%" align="left"></td><td width="60%" align="center"><a href="contrib.html" title="付録F 追加で提供されるモジュール">付録F 追加で提供されるモジュール</a></td><td width="20%" align="right"><div class="actions"><a class="issue" title="github" href="https://github.com/pgsql-jp/jpug-doc/issues/new?title=version 13.1 &#10;                      hstore.html">誤訳等の報告
                    </a></div></td></tr><tr><td width="10%" align="left"><a accesskey="p" href="fuzzystrmatch.html" title="F.15. fuzzystrmatch">前へ</a> </td><td width="10%" align="left"><a accesskey="u" href="contrib.html" title="付録F 追加で提供されるモジュール">上へ</a></td><td width="60%" align="center">F.16. hstore</td><td width="20%" align="right"> <a accesskey="n" href="intagg.html" title="F.17. intagg">次へ</a></td></tr></table><hr /></div><div class="sect1" id="HSTORE"><div class="titlepage"><div><div><h2 class="title" style="clear: both">F.16. hstore</h2></div></div></div><a id="id-1.11.7.25.2" class="indexterm"></a><p>
<span class="original">
  This module implements the &lt;type&gt;hstore&lt;/type&gt; data type for storing sets of
  key/value pairs within a single &lt;productname&gt;PostgreSQL&lt;/productname&gt; value.
  This can be useful in various scenarios, such as rows with many attributes
  that are rarely examined, or semi-structured data.  Keys and values are
  simply text strings.
</span>
本モジュールはキー、値の組み合わせの集合を単一の<span class="productname">PostgreSQL</span>値に格納するための<code class="type">hstore</code>データ型を実装します。
あまり厳密に検査されない属性を多く持つ行や半構造化データなど、多くの状況で有用になる可能性があります。
キーと値は単純なテキスト文字列です。
 </p><p>
  This module is considered <span class="quote">「<span class="quote">trusted</span>」</span>, that is, it can be
  installed by non-superusers who have <code class="literal">CREATE</code> privilege
  on the current database.
 </p><div class="sect2" id="id-1.11.7.25.5"><div class="titlepage"><div><div><h3 class="title">F.16.1. <code class="type">hstore</code>の外部表現</h3></div></div></div><span class="original">
  &lt;title&gt;&lt;type&gt;hstore&lt;/type&gt; External Representation&lt;/title&gt;
</span><p>

<span class="original">
   The text representation of an &lt;type&gt;hstore&lt;/type&gt;, used for input and output,
   includes zero or more &lt;replaceable&gt;key&lt;/replaceable&gt; &lt;literal&gt;=&amp;gt;&lt;/literal&gt;
   &lt;replaceable&gt;value&lt;/replaceable&gt; pairs separated by commas. Some examples:
</span>
入力および出力で使用される<code class="type">hstore</code>値のテキスト表現はカンマで区切られた、ゼロ以上の<em class="replaceable"><code>key</code></em> <code class="literal">=&gt;</code> <em class="replaceable"><code>value</code></em>という組み合わせを含みます。
以下に例を示します。

</p><pre class="synopsis">
k =&gt; v
foo =&gt; bar, baz =&gt; whatever
"1-a" =&gt; "anything at all"
</pre><p>

<span class="original">
   The order of the pairs is not significant (and may not be reproduced on
   output). Whitespace between pairs or around the &lt;literal&gt;=&amp;gt;&lt;/literal&gt; sign is
   ignored. Double-quote keys and values that include whitespace, commas,
   &lt;literal&gt;=&lt;/literal&gt;s or &lt;literal&gt;&amp;gt;&lt;/literal&gt;s. To include a double quote or a
   backslash in a key or value, escape it with a backslash.
</span>
組み合わせの順序は重要ではありません（出力時に再現されないこともあります）。
組み合わせ間や<code class="literal">=&gt;</code>記号の前後の空白文字は無視されます。
キーや値が空白文字、カンマ、<code class="literal">=</code>、<code class="literal">&gt;</code>を含む場合は二重引用符でくくります。
キーや値に二重引用符やバックスラッシュを含めるには、バックスラッシュでエスケープしてください。
  </p><p>
<span class="original">
   Each key in an &lt;type&gt;hstore&lt;/type&gt; is unique. If you declare an &lt;type&gt;hstore&lt;/type&gt;
   with duplicate keys, only one will be stored in the &lt;type&gt;hstore&lt;/type&gt; and
   there is no guarantee as to which will be kept:
</span>
<code class="type">hstore</code>内の各キーは一意です。
重複するキーを持つ<code class="type">hstore</code>を宣言すると、<code class="type">hstore</code>には1つしか保存されません。
またどちらが残るかは保証されません。

</p><pre class="programlisting">
SELECT 'a=&gt;1,a=&gt;2'::hstore;
  hstore
----------
 "a"=&gt;"1"
</pre><p>
  </p><p>
<span class="original">
   A value (but not a key) can be an SQL &lt;literal&gt;NULL&lt;/literal&gt;. For example:
</span>
値はSQLの<code class="literal">NULL</code>を取ることができます（キーは不可）。
以下に例を示します。

</p><pre class="programlisting">
key =&gt; NULL
</pre><p>

<span class="original">
   The &lt;literal&gt;NULL&lt;/literal&gt; keyword is case-insensitive. Double-quote the
   &lt;literal&gt;NULL&lt;/literal&gt; to treat it as the ordinary string &lt;quote&gt;NULL&lt;/quote&gt;.
</span>
<code class="literal">NULL</code>キーワードは大文字小文字の区別をしません。
<code class="literal">null</code>を普通の文字列<span class="quote">「<span class="quote">NULL</span>」</span>として扱うためには二重引用符でくくってください。
  </p><div class="note"><h3 class="title">注記</h3><p>
<span class="original">
   Keep in mind that the &lt;type&gt;hstore&lt;/type&gt; text format, when used for input,
   applies &lt;emphasis&gt;before&lt;/emphasis&gt; any required quoting or escaping. If you are
   passing an &lt;type&gt;hstore&lt;/type&gt; literal via a parameter, then no additional
   processing is needed. But if you're passing it as a quoted literal
   constant, then any single-quote characters and (depending on the setting of
   the &lt;varname&gt;standard_conforming_strings&lt;/varname&gt; configuration parameter)
   backslash characters need to be escaped correctly. See
   &lt;xref linkend="sql-syntax-strings"/&gt; for more on the handling of string
   constants.
</span>
入力として使用される場合<code class="type">hstore</code>テキスト書式は、<span class="emphasis"><em>前もって</em></span>必要な引用符付けやエスケープ処理を適用することに注意してください。
パラメータとして<code class="type">hstore</code>リテラルを渡す場合、追加処理は必要ありません。
しかし、引用符付けしたリテラル定数として渡す場合には、単一引用符および(<code class="varname">standard_conforming_strings</code>設定パラメータに依存しますが)バックスラッシュ文字をすべて正しくエスケープしなければなりません。
文字列定数の取り扱いについては<a class="xref" href="sql-syntax-lexical.html#SQL-SYNTAX-STRINGS" title="4.1.2.1. 文字列定数">4.1.2.1</a>を参照してください。
  </p></div><p>
<span class="original">
   On output, double quotes always surround keys and values, even when it's
   not strictly necessary.
</span>
出力の場合、厳密に必要がない場合であっても、常にキーと値は二重引用符でくくられます。
  </p></div><div class="sect2" id="id-1.11.7.25.6"><div class="titlepage"><div><div><h3 class="title">F.16.2. <code class="type">hstore</code>の演算子と関数</h3></div></div></div><span class="original">
  &lt;title&gt;&lt;type&gt;hstore&lt;/type&gt; Operators and Functions&lt;/title&gt;
</span><p>
<span class="original">
   The operators provided by the &lt;literal&gt;hstore&lt;/literal&gt; module are
   shown in &lt;xref linkend="hstore-op-table"/&gt;, the functions
   in &lt;xref linkend="hstore-func-table"/&gt;.
</span>
<code class="literal">hstore</code>モジュールで提供される演算子を<a class="xref" href="hstore.html#HSTORE-OP-TABLE" title="表F.7 hstore Operators">表 F.7</a>に、関数を<a class="xref" href="hstore.html#HSTORE-FUNC-TABLE" title="表F.8 hstore Functions">表 F.8</a>に示します。
  </p><div class="table" id="HSTORE-OP-TABLE"><p class="title"><strong>表F.7 <code class="type">hstore</code> Operators</strong></p><div class="table-contents"><table class="table" summary="hstore Operators" border="1"><colgroup><col /></colgroup><thead><tr><th class="func_table_entry"><p class="func_signature">
        Operator
       </p>
       <p>
        Description
       </p>
       <p>
        Example(s)
       </p></th></tr></thead><tbody><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">hstore</code> <code class="literal">-&gt;</code> <code class="type">text</code>
        → <code class="returnvalue">text</code>
       </p>
       <p>
        Returns value associated with given key, or <code class="literal">NULL</code> if
        not present.
       </p>
       <p>
        <code class="literal">'a=&gt;x, b=&gt;y'::hstore -&gt; 'a'</code>
        → <code class="returnvalue">x</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">hstore</code> <code class="literal">-&gt;</code> <code class="type">text[]</code>
        → <code class="returnvalue">text[]</code>
       </p>
       <p>
        Returns values associated with given keys, or <code class="literal">NULL</code>
        if not present.
       </p>
       <p>
        <code class="literal">'a=&gt;x, b=&gt;y, c=&gt;z'::hstore -&gt; ARRAY['c','a']</code>
        → <code class="returnvalue">{"z","x"}</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">hstore</code> <code class="literal">||</code> <code class="type">hstore</code>
        → <code class="returnvalue">hstore</code>
       </p>
       <p>
        Concatenates two <code class="type">hstore</code>s.
       </p>
       <p>
        <code class="literal">'a=&gt;b, c=&gt;d'::hstore || 'c=&gt;x, d=&gt;q'::hstore</code>
        → <code class="returnvalue">"a"=&gt;"b", "c"=&gt;"x", "d"=&gt;"q"</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">hstore</code> <code class="literal">?</code> <code class="type">text</code>
        → <code class="returnvalue">boolean</code>
       </p>
       <p>
        Does <code class="type">hstore</code> contain key?
       </p>
       <p>
        <code class="literal">'a=&gt;1'::hstore ? 'a'</code>
        → <code class="returnvalue">t</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">hstore</code> <code class="literal">?&amp;</code> <code class="type">text[]</code>
        → <code class="returnvalue">boolean</code>
       </p>
       <p>
        Does <code class="type">hstore</code> contain all the specified keys?
       </p>
       <p>
        <code class="literal">'a=&gt;1,b=&gt;2'::hstore ?&amp; ARRAY['a','b']</code>
        → <code class="returnvalue">t</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">hstore</code> <code class="literal">?|</code> <code class="type">text[]</code>
        → <code class="returnvalue">boolean</code>
       </p>
       <p>
        Does <code class="type">hstore</code> contain any of the specified keys?
       </p>
       <p>
        <code class="literal">'a=&gt;1,b=&gt;2'::hstore ?| ARRAY['b','c']</code>
        → <code class="returnvalue">t</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">hstore</code> <code class="literal">@&gt;</code> <code class="type">hstore</code>
        → <code class="returnvalue">boolean</code>
       </p>
       <p>
        Does left operand contain right?
       </p>
       <p>
        <code class="literal">'a=&gt;b, b=&gt;1, c=&gt;NULL'::hstore @&gt; 'b=&gt;1'</code>
        → <code class="returnvalue">t</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">hstore</code> <code class="literal">&lt;@</code> <code class="type">hstore</code>
        → <code class="returnvalue">boolean</code>
       </p>
       <p>
        Is left operand contained in right?
       </p>
       <p>
        <code class="literal">'a=&gt;c'::hstore &lt;@ 'a=&gt;b, b=&gt;1, c=&gt;NULL'</code>
        → <code class="returnvalue">f</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">hstore</code> <code class="literal">-</code> <code class="type">text</code>
        → <code class="returnvalue">hstore</code>
       </p>
       <p>
        Deletes key from left operand.
       </p>
       <p>
        <code class="literal">'a=&gt;1, b=&gt;2, c=&gt;3'::hstore - 'b'::text</code>
        → <code class="returnvalue">"a"=&gt;"1", "c"=&gt;"3"</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">hstore</code> <code class="literal">-</code> <code class="type">text[]</code>
        → <code class="returnvalue">hstore</code>
       </p>
       <p>
        Deletes keys from left operand.
       </p>
       <p>
        <code class="literal">'a=&gt;1, b=&gt;2, c=&gt;3'::hstore - ARRAY['a','b']</code>
        → <code class="returnvalue">"c"=&gt;"3"</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">hstore</code> <code class="literal">-</code> <code class="type">hstore</code>
        → <code class="returnvalue">hstore</code>
       </p>
       <p>
        Deletes pairs from left operand that match pairs in the right operand.
       </p>
       <p>
        <code class="literal">'a=&gt;1, b=&gt;2, c=&gt;3'::hstore - 'a=&gt;4, b=&gt;2'::hstore</code>
        → <code class="returnvalue">"a"=&gt;"1", "c"=&gt;"3"</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="type">anyelement</code> <code class="literal">#=</code> <code class="type">hstore</code>
        → <code class="returnvalue">anyelement</code>
       </p>
       <p>
        Replaces fields in the left operand (which must be a composite type)
        with matching values from <code class="type">hstore</code>.
       </p>
       <p>
        <code class="literal">ROW(1,3) #= 'f1=&gt;11'::hstore</code>
        → <code class="returnvalue">(11,3)</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="literal">%%</code> <code class="type">hstore</code>
        → <code class="returnvalue">text[]</code>
       </p>
       <p>
        Converts <code class="type">hstore</code> to an array of alternating keys and
        values.
       </p>
       <p>
        <code class="literal">%% 'a=&gt;foo, b=&gt;bar'::hstore</code>
        → <code class="returnvalue">{a,foo,b,bar}</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="literal">%#</code> <code class="type">hstore</code>
        → <code class="returnvalue">text[]</code>
       </p>
       <p>
        Converts <code class="type">hstore</code> to a two-dimensional key/value array.
       </p>
       <p>
        <code class="literal">%# 'a=&gt;foo, b=&gt;bar'::hstore</code>
        → <code class="returnvalue">{{a,foo},{b,bar}}</code>
       </p></td></tr></tbody></table></div></div><br class="table-break" /><div class="note"><h3 class="title">注記</h3><p>
<span class="original">
   Prior to PostgreSQL 8.2, the containment operators &lt;literal&gt;@&amp;gt;&lt;/literal&gt;
   and &lt;literal&gt;&amp;lt;@&lt;/literal&gt; were called &lt;literal&gt;@&lt;/literal&gt; and &lt;literal&gt;~&lt;/literal&gt;,
   respectively. These names are still available, but are deprecated and will
   eventually be removed. Notice that the old names are reversed from the
   convention formerly followed by the core geometric data types!
</span>
PostgreSQL 8.2より前では、包含演算子<code class="literal">@&gt;</code>と<code class="literal">&lt;@</code>はそれぞれ<code class="literal">@</code>と<code class="literal">~</code>と呼ばれていました。
これらの名前はまだ利用できますが、廃止予定であり、最終的にはなくなります。
古い名前がコアの幾何データ型が従う規約と反対であることに注意してください。
   </p></div><div class="table" id="HSTORE-FUNC-TABLE"><p class="title"><strong>表F.8 <code class="type">hstore</code> Functions</strong></p><div class="table-contents"><table class="table" summary="hstore Functions" border="1"><colgroup><col /></colgroup><thead><tr><th class="func_table_entry"><p class="func_signature">
        Function
       </p>
       <p>
        Description
       </p>
       <p>
        Example(s)
       </p></th></tr></thead><tbody><tr><td class="func_table_entry"><p class="func_signature">
        <a id="id-1.11.7.25.6.5.2.2.1.1.1.1" class="indexterm"></a>
        <code class="function">hstore</code> ( <code class="type">record</code> )
        → <code class="returnvalue">hstore</code>
       </p>
       <p>
        Constructs an <code class="type">hstore</code> from a record or row.
       </p>
       <p>
        <code class="literal">hstore(ROW(1,2))</code>
        → <code class="returnvalue">"f1"=&gt;"1", "f2"=&gt;"2"</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="function">hstore</code> ( <code class="type">text[]</code> )
        → <code class="returnvalue">hstore</code>
       </p>
       <p>
        Constructs an <code class="type">hstore</code> from an array, which may be either
        a key/value array, or a two-dimensional array.
       </p>
       <p>
        <code class="literal">hstore(ARRAY['a','1','b','2'])</code>
        → <code class="returnvalue">"a"=&gt;"1", "b"=&gt;"2"</code>
       </p>
       <p>
        <code class="literal">hstore(ARRAY[['c','3'],['d','4']])</code>
        → <code class="returnvalue">"c"=&gt;"3", "d"=&gt;"4"</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="function">hstore</code> ( <code class="type">text[]</code>, <code class="type">text[]</code> )
        → <code class="returnvalue">hstore</code>
       </p>
       <p>
        Constructs an <code class="type">hstore</code> from separate key and value arrays.
       </p>
       <p>
        <code class="literal">hstore(ARRAY['a','b'], ARRAY['1','2'])</code>
        → <code class="returnvalue">"a"=&gt;"1", "b"=&gt;"2"</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="function">hstore</code> ( <code class="type">text</code>, <code class="type">text</code> )
        → <code class="returnvalue">hstore</code>
       </p>
       <p>
        Makes a single-item <code class="type">hstore</code>.
       </p>
       <p>
        <code class="literal">hstore('a', 'b')</code>
        → <code class="returnvalue">"a"=&gt;"b"</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <a id="id-1.11.7.25.6.5.2.2.5.1.1.1" class="indexterm"></a>
        <code class="function">akeys</code> ( <code class="type">hstore</code> )
        → <code class="returnvalue">text[]</code>
       </p>
       <p>
        Extracts an <code class="type">hstore</code>'s keys as an array.
       </p>
       <p>
        <code class="literal">akeys('a=&gt;1,b=&gt;2')</code>
        → <code class="returnvalue">{a,b}</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <a id="id-1.11.7.25.6.5.2.2.6.1.1.1" class="indexterm"></a>
        <code class="function">skeys</code> ( <code class="type">hstore</code> )
        → <code class="returnvalue">setof text</code>
       </p>
       <p>
        Extracts an <code class="type">hstore</code>'s keys as a set.
       </p>
       <p>
        <code class="literal">skeys('a=&gt;1,b=&gt;2')</code>
        → <code class="returnvalue"></code>
</p><pre class="programlisting">
a
b
</pre><p>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <a id="id-1.11.7.25.6.5.2.2.7.1.1.1" class="indexterm"></a>
        <code class="function">avals</code> ( <code class="type">hstore</code> )
        → <code class="returnvalue">text[]</code>
       </p>
       <p>
        Extracts an <code class="type">hstore</code>'s values as an array.
       </p>
       <p>
        <code class="literal">avals('a=&gt;1,b=&gt;2')</code>
        → <code class="returnvalue">{1,2}</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <a id="id-1.11.7.25.6.5.2.2.8.1.1.1" class="indexterm"></a>
        <code class="function">svals</code> ( <code class="type">hstore</code> )
        → <code class="returnvalue">setof text</code>
       </p>
       <p>
        Extracts an <code class="type">hstore</code>'s values as a set.
       </p>
       <p>
        <code class="literal">svals('a=&gt;1,b=&gt;2')</code>
        → <code class="returnvalue"></code>
</p><pre class="programlisting">
1
2
</pre><p>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <a id="id-1.11.7.25.6.5.2.2.9.1.1.1" class="indexterm"></a>
        <code class="function">hstore_to_array</code> ( <code class="type">hstore</code> )
        → <code class="returnvalue">text[]</code>
       </p>
       <p>
        Extracts an <code class="type">hstore</code>'s keys and values as an array of
        alternating keys and values.
       </p>
       <p>
        <code class="literal">hstore_to_array('a=&gt;1,b=&gt;2')</code>
        → <code class="returnvalue">{a,1,b,2}</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <a id="id-1.11.7.25.6.5.2.2.10.1.1.1" class="indexterm"></a>
        <code class="function">hstore_to_matrix</code> ( <code class="type">hstore</code> )
        → <code class="returnvalue">text[]</code>
       </p>
       <p>
        Extracts an <code class="type">hstore</code>'s keys and values as a two-dimensional
        array.
       </p>
       <p>
        <code class="literal">hstore_to_matrix('a=&gt;1,b=&gt;2')</code>
        → <code class="returnvalue">{{a,1},{b,2}}</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <a id="id-1.11.7.25.6.5.2.2.11.1.1.1" class="indexterm"></a>
        <code class="function">hstore_to_json</code> ( <code class="type">hstore</code> )
        → <code class="returnvalue">json</code>
       </p>
       <p>
        Converts an <code class="type">hstore</code> to a <code class="type">json</code> value,
        converting all non-null values to JSON strings.
       </p>
       <p>
        This function is used implicitly when an <code class="type">hstore</code> value is
        cast to <code class="type">json</code>.
       </p>
       <p>
        <code class="literal">hstore_to_json('"a key"=&gt;1, b=&gt;t, c=&gt;null, d=&gt;12345, e=&gt;012345, f=&gt;1.234, g=&gt;2.345e+4')</code>
        → <code class="returnvalue">{"a key": "1", "b": "t", "c": null, "d": "12345", "e": "012345", "f": "1.234", "g": "2.345e+4"}</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <a id="id-1.11.7.25.6.5.2.2.12.1.1.1" class="indexterm"></a>
        <code class="function">hstore_to_jsonb</code> ( <code class="type">hstore</code> )
        → <code class="returnvalue">jsonb</code>
       </p>
       <p>
        Converts an <code class="type">hstore</code> to a <code class="type">jsonb</code> value,
        converting all non-null values to JSON strings.
       </p>
       <p>
        This function is used implicitly when an <code class="type">hstore</code> value is
        cast to <code class="type">jsonb</code>.
       </p>
       <p>
        <code class="literal">hstore_to_jsonb('"a key"=&gt;1, b=&gt;t, c=&gt;null, d=&gt;12345, e=&gt;012345, f=&gt;1.234, g=&gt;2.345e+4')</code>
        → <code class="returnvalue">{"a key": "1", "b": "t", "c": null, "d": "12345", "e": "012345", "f": "1.234", "g": "2.345e+4"}</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <a id="id-1.11.7.25.6.5.2.2.13.1.1.1" class="indexterm"></a>
        <code class="function">hstore_to_json_loose</code> ( <code class="type">hstore</code> )
        → <code class="returnvalue">json</code>
       </p>
       <p>
        Converts an <code class="type">hstore</code> to a <code class="type">json</code> value, but
        attempts to distinguish numerical and Boolean values so they are
        unquoted in the JSON.
       </p>
       <p>
        <code class="literal">hstore_to_json_loose('"a key"=&gt;1, b=&gt;t, c=&gt;null, d=&gt;12345, e=&gt;012345, f=&gt;1.234, g=&gt;2.345e+4')</code>
        → <code class="returnvalue">{"a key": 1, "b": true, "c": null, "d": 12345, "e": "012345", "f": 1.234, "g": 2.345e+4}</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <a id="id-1.11.7.25.6.5.2.2.14.1.1.1" class="indexterm"></a>
        <code class="function">hstore_to_jsonb_loose</code> ( <code class="type">hstore</code> )
        → <code class="returnvalue">jsonb</code>
       </p>
       <p>
        Converts an <code class="type">hstore</code> to a <code class="type">jsonb</code> value, but
        attempts to distinguish numerical and Boolean values so they are
        unquoted in the JSON.
       </p>
       <p>
        <code class="literal">hstore_to_jsonb_loose('"a key"=&gt;1, b=&gt;t, c=&gt;null, d=&gt;12345, e=&gt;012345, f=&gt;1.234, g=&gt;2.345e+4')</code>
        → <code class="returnvalue">{"a key": 1, "b": true, "c": null, "d": 12345, "e": "012345", "f": 1.234, "g": 2.345e+4}</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <a id="id-1.11.7.25.6.5.2.2.15.1.1.1" class="indexterm"></a>
        <code class="function">slice</code> ( <code class="type">hstore</code>, <code class="type">text[]</code> )
        → <code class="returnvalue">hstore</code>
       </p>
       <p>
        Extracts a subset of an <code class="type">hstore</code> containing only the
        specified keys.
       </p>
       <p>
        <code class="literal">slice('a=&gt;1,b=&gt;2,c=&gt;3'::hstore, ARRAY['b','c','x'])</code>
        → <code class="returnvalue">"b"=&gt;"2", "c"=&gt;"3"</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <a id="id-1.11.7.25.6.5.2.2.16.1.1.1" class="indexterm"></a>
        <code class="function">each</code> ( <code class="type">hstore</code> )
        → <code class="returnvalue">setof record</code>
        ( <em class="parameter"><code>key</code></em> <code class="type">text</code>,
        <em class="parameter"><code>value</code></em> <code class="type">text</code> )
       </p>
       <p>
        Extracts an <code class="type">hstore</code>'s keys and values as a set of records.
       </p>
       <p>
        <code class="literal">select * from each('a=&gt;1,b=&gt;2')</code>
        → <code class="returnvalue"></code>
</p><pre class="programlisting">
 key | value
-----+-------
 a   | 1
 b   | 2
</pre><p>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <a id="id-1.11.7.25.6.5.2.2.17.1.1.1" class="indexterm"></a>
        <code class="function">exist</code> ( <code class="type">hstore</code>, <code class="type">text</code> )
        → <code class="returnvalue">boolean</code>
       </p>
       <p>
        Does <code class="type">hstore</code> contain key?
       </p>
       <p>
        <code class="literal">exist('a=&gt;1', 'a')</code>
        → <code class="returnvalue">t</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <a id="id-1.11.7.25.6.5.2.2.18.1.1.1" class="indexterm"></a>
        <code class="function">defined</code> ( <code class="type">hstore</code>, <code class="type">text</code> )
        → <code class="returnvalue">boolean</code>
       </p>
       <p>
        Does <code class="type">hstore</code> contain a non-<code class="literal">NULL</code> value
        for key?
       </p>
       <p>
        <code class="literal">defined('a=&gt;NULL', 'a')</code>
        → <code class="returnvalue">f</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <a id="id-1.11.7.25.6.5.2.2.19.1.1.1" class="indexterm"></a>
        <code class="function">delete</code> ( <code class="type">hstore</code>, <code class="type">text</code> )
        → <code class="returnvalue">hstore</code>
       </p>
       <p>
        Deletes pair with matching key.
       </p>
       <p>
        <code class="literal">delete('a=&gt;1,b=&gt;2', 'b')</code>
        → <code class="returnvalue">"a"=&gt;"1"</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="function">delete</code> ( <code class="type">hstore</code>, <code class="type">text[]</code> )
        → <code class="returnvalue">hstore</code>
       </p>
       <p>
        Deletes pairs with matching keys.
       </p>
       <p>
        <code class="literal">delete('a=&gt;1,b=&gt;2,c=&gt;3', ARRAY['a','b'])</code>
        → <code class="returnvalue">"c"=&gt;"3"</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <code class="function">delete</code> ( <code class="type">hstore</code>, <code class="type">hstore</code> )
        → <code class="returnvalue">hstore</code>
       </p>
       <p>
        Deletes pairs matching those in the second argument.
       </p>
       <p>
        <code class="literal">delete('a=&gt;1,b=&gt;2', 'a=&gt;4,b=&gt;2'::hstore)</code>
        → <code class="returnvalue">"a"=&gt;"1"</code>
       </p></td></tr><tr><td class="func_table_entry"><p class="func_signature">
        <a id="id-1.11.7.25.6.5.2.2.22.1.1.1" class="indexterm"></a>
        <code class="function">populate_record</code> ( <code class="type">anyelement</code>, <code class="type">hstore</code> )
        → <code class="returnvalue">anyelement</code>
       </p>
       <p>
        Replaces fields in the left operand (which must be a composite type)
        with matching values from <code class="type">hstore</code>.
       </p>
       <p>
        <code class="literal">populate_record(ROW(1,2), 'f1=&gt;42'::hstore)</code>
        → <code class="returnvalue">(42,2)</code>
       </p></td></tr></tbody></table></div></div><br class="table-break" /></div><div class="sect2" id="id-1.11.7.25.7"><div class="titlepage"><div><div><h3 class="title">F.16.3. インデックス</h3></div></div></div><span class="original">
  &lt;title&gt;Indexes&lt;/title&gt;
</span><p>
<span class="original">
   &lt;type&gt;hstore&lt;/type&gt; has GiST and GIN index support for the &lt;literal&gt;@&amp;gt;&lt;/literal&gt;,
   &lt;literal&gt;?&lt;/literal&gt;, &lt;literal&gt;?&amp;amp;&lt;/literal&gt; and &lt;literal&gt;?|&lt;/literal&gt; operators. For example:
</span>
<code class="type">hstore</code>は<code class="literal">@&gt;</code>、<code class="literal">?</code>、<code class="literal">?&amp;</code>および<code class="literal">?|</code>演算子向けのGiSTおよびGINインデックスをサポートします。
以下に例を示します。
  </p><pre class="programlisting">
CREATE INDEX hidx ON testhstore USING GIST (h);

CREATE INDEX hidx ON testhstore USING GIN (h);
</pre><p>
   <code class="literal">gist_hstore_ops</code> GiST opclass approximates a set of
   key/value pairs as a bitmap signature.  Its optional integer parameter
   <code class="literal">siglen</code> determines the
   signature length in bytes.  The default length is 16 bytes.
   Valid values of signature length are between 1 and 2024 bytes.  Longer
   signatures lead to a more precise search (scanning a smaller fraction of the index and
   fewer heap pages), at the cost of a larger index.
  </p><p>
   Example of creating such an index with a signature length of 32 bytes:
</p><pre class="programlisting">
CREATE INDEX hidx ON testhstore USING GIST (h gist_hstore_ops(siglen=32));
</pre><p>
  </p><p>
<span class="original">
   &lt;type&gt;hstore&lt;/type&gt; also supports &lt;type&gt;btree&lt;/type&gt; or &lt;type&gt;hash&lt;/type&gt; indexes for
   the &lt;literal&gt;=&lt;/literal&gt; operator. This allows &lt;type&gt;hstore&lt;/type&gt; columns to be
   declared &lt;literal&gt;UNIQUE&lt;/literal&gt;, or to be used in &lt;literal&gt;GROUP BY&lt;/literal&gt;,
   &lt;literal&gt;ORDER BY&lt;/literal&gt; or &lt;literal&gt;DISTINCT&lt;/literal&gt; expressions. The sort ordering
   for &lt;type&gt;hstore&lt;/type&gt; values is not particularly useful, but these indexes
   may be useful for equivalence lookups. Create indexes for &lt;literal&gt;=&lt;/literal&gt;
   comparisons as follows:
</span>
<code class="type">hstore</code>はまた、<code class="literal">=</code>演算子向けに<code class="type">btree</code>または<code class="type">hash</code>インデックスをサポートします。
これにより<code class="type">hstore</code>の列を<code class="literal">UNIQUE</code>と宣言すること、また、<code class="literal">GROUP BY</code>、<code class="literal">ORDER BY</code>、<code class="literal">DISTINCT</code>の式で使用することができます。
<code class="type">hstore</code>値のソート順序付けはあまり有用ではありません。
しかしこれらのインデックスは同値検索の際に有用になるかもしれません。
<code class="literal">=</code>比較用のインデックスを以下のように作成します。
  </p><pre class="programlisting">
CREATE INDEX hidx ON testhstore USING BTREE (h);

CREATE INDEX hidx ON testhstore USING HASH (h);
</pre></div><div class="sect2" id="id-1.11.7.25.8"><div class="titlepage"><div><div><h3 class="title">F.16.4. 例</h3></div></div></div><span class="original">
  &lt;title&gt;Examples&lt;/title&gt;
</span><p>
<span class="original">
   Add a key, or update an existing key with a new value:
</span>
キーを追加、または、既存のキーを新しい値で更新します。
</p><pre class="programlisting">
UPDATE tab SET h = h || hstore('c', '3');
</pre><p>
  </p><p>
<span class="original">
   Delete a key:
</span>
キーを削除します。
</p><pre class="programlisting">
UPDATE tab SET h = delete(h, 'k1');
</pre><p>
  </p><p>
<span class="original">
   Convert a &lt;type&gt;record&lt;/type&gt; to an &lt;type&gt;hstore&lt;/type&gt;:
</span>
<code class="type">record</code>を<code class="type">hstore</code>に変換します。
</p><pre class="programlisting">
CREATE TABLE test (col1 integer, col2 text, col3 text);
INSERT INTO test VALUES (123, 'foo', 'bar');

SELECT hstore(t) FROM test AS t;
                   hstore                    
---------------------------------------------
 "col1"=&gt;"123", "col2"=&gt;"foo", "col3"=&gt;"bar"
(1 row)
</pre><p>
  </p><p>
<span class="original">
   Convert an &lt;type&gt;hstore&lt;/type&gt; to a predefined &lt;type&gt;record&lt;/type&gt; type:
</span>
<code class="type">hstore</code>を事前に定義された<code class="type">record</code>型に変換します。
</p><pre class="programlisting">
CREATE TABLE test (col1 integer, col2 text, col3 text);

SELECT * FROM populate_record(null::test,
                              '"col1"=&gt;"456", "col2"=&gt;"zzz"');
 col1 | col2 | col3 
------+------+------
  456 | zzz  | 
(1 row)
</pre><p>
  </p><p>
<span class="original">
   Modify an existing record using the values from an &lt;type&gt;hstore&lt;/type&gt;:
</span>
<code class="type">hstore</code>の値を使用して既存のレコードを変更します。
</p><pre class="programlisting">
CREATE TABLE test (col1 integer, col2 text, col3 text);
INSERT INTO test VALUES (123, 'foo', 'bar');

SELECT (r).* FROM (SELECT t #= '"col3"=&gt;"baz"' AS r FROM test t) s;
 col1 | col2 | col3 
------+------+------
  123 | foo  | baz
(1 row)
</pre><p>
  </p></div><div class="sect2" id="id-1.11.7.25.9"><div class="titlepage"><div><div><h3 class="title">F.16.5. 統計情報</h3></div></div></div><span class="original">
  &lt;title&gt;Statistics&lt;/title&gt;
</span><p>
<span class="original">
   The &lt;type&gt;hstore&lt;/type&gt; type, because of its intrinsic liberality, could
   contain a lot of different keys. Checking for valid keys is the task of the
   application. The following examples demonstrate several techniques for
   checking keys and obtaining statistics.
</span>
内在する自由度のため、<code class="type">hstore</code>型は異なるキーを多く含むことができます。
有効なキーを検査することはアプリケーション側の作業です。
以下の例では、キー検査および統計情報の入手に関する複数の技法を示します。
  </p><p>
<span class="original">
   Simple example:
</span>
簡単な例を示します。
</p><pre class="programlisting">
SELECT * FROM each('aaa=&gt;bq, b=&gt;NULL, ""=&gt;1');
</pre><p>
  </p><p>
<span class="original">
   Using a table:
</span>
テーブルを使用する例です。
</p><pre class="programlisting">
SELECT (each(h)).key, (each(h)).value INTO stat FROM testhstore;
</pre><p>
  </p><p>
<span class="original">
   Online statistics:
</span>
オンライン統計値です。
</p><pre class="programlisting">
SELECT key, count(*) FROM
  (SELECT (each(h)).key FROM testhstore) AS stat
  GROUP BY key
  ORDER BY count DESC, key;
    key    | count
-----------+-------
 line      |   883
 query     |   207
 pos       |   203
 node      |   202
 space     |   197
 status    |   195
 public    |   194
 title     |   190
 org       |   189
...................
</pre><p>
  </p></div><div class="sect2" id="id-1.11.7.25.10"><div class="titlepage"><div><div><h3 class="title">F.16.6. 互換性</h3></div></div></div><span class="original">
  &lt;title&gt;Compatibility&lt;/title&gt;
</span><p>
<span class="original">
   As of PostgreSQL 9.0, &lt;type&gt;hstore&lt;/type&gt; uses a different internal
   representation than previous versions. This presents no obstacle for
   dump/restore upgrades since the text representation (used in the dump) is
   unchanged.
</span>
PostgreSQL 9.0から<code class="type">hstore</code>の内部表現はこれまでから変更されました。
(ダンプ内で使用される)テキスト表現には変更がありませんので、ダンプ/リストアによる更新の妨げにはなりません。
  </p><p>
<span class="original">
   In the event of a binary upgrade, upward compatibility is maintained by
   having the new code recognize old-format data. This will entail a slight
   performance penalty when processing data that has not yet been modified by
   the new code. It is possible to force an upgrade of all values in a table
   column by doing an &lt;literal&gt;UPDATE&lt;/literal&gt; statement as follows:
</span>
バイナリによる更新の際、新しいコードで古い書式のデータを認識させることにより、上位互換が保持されます。
これには、新しいコードによりまだ変更されていないデータを処理する際に、性能の劣化を多少伴います。
以下のように<code class="literal">UPDATE</code>文を実行することによりテーブル列内のすべての値を強制的に更新することができます。
</p><pre class="programlisting">
UPDATE tablename SET hstorecol = hstorecol || '';
</pre><p>
  </p><p>
<span class="original">
   Another way to do it is:
</span>
上を行う他の方法を以下に示します。
</p><pre class="programlisting">
ALTER TABLE tablename ALTER hstorecol TYPE hstore USING hstorecol || '';
</pre><p>
<span class="original">
   The &lt;command&gt;ALTER TABLE&lt;/command&gt; method requires an exclusive lock on the table,
   but does not result in bloating the table with old row versions.
</span>
<code class="command">ALTER TABLE</code>による方法はテーブルに対して排他ロックを必要とします。
しかし、古いバージョンの行でテーブルが膨張することはありません。
  </p></div><div class="sect2" id="id-1.11.7.25.11"><div class="titlepage"><div><div><h3 class="title">F.16.7. 変換</h3></div></div></div><span class="original">
  &lt;title&gt;Transforms&lt;/title&gt;
</span><p>
<span class="original">
   Additional extensions are available that implement transforms for
   the &lt;type&gt;hstore&lt;/type&gt; type for the languages PL/Perl and PL/Python.  The
   extensions for PL/Perl are called &lt;literal&gt;hstore_plperl&lt;/literal&gt;
   and &lt;literal&gt;hstore_plperlu&lt;/literal&gt;, for trusted and untrusted PL/Perl.
   If you install these transforms and specify them when creating a
   function, &lt;type&gt;hstore&lt;/type&gt; values are mapped to Perl hashes.  The
   extensions for PL/Python are
   called &lt;literal&gt;hstore_plpythonu&lt;/literal&gt;, &lt;literal&gt;hstore_plpython2u&lt;/literal&gt;,
   and &lt;literal&gt;hstore_plpython3u&lt;/literal&gt;
   (see &lt;xref linkend="plpython-python23"/&gt; for the PL/Python naming
   convention).  If you use them, &lt;type&gt;hstore&lt;/type&gt; values are mapped to
   Python dictionaries.
</span>
PL/Perl言語やPL/Python言語向けに<code class="type">hstore</code>型の変換を実装した追加の拡張が入手可能です。
PL/Perl向けの拡張は、信頼されたPL/Perlに対しては<code class="literal">hstore_plperl</code>という名前で、信頼されないものに対しては<code class="literal">hstore_plperlu</code>という名前です。
関数を作成するときにこの変換をインストールして指定していれば、<code class="type">hstore</code>の値はPerlのハッシュにマップされます。
PL/Python向けの拡張は<code class="literal">hstore_plpythonu</code>、<code class="literal">hstore_plpython2u</code>、<code class="literal">hstore_plpython3u</code>という名前です(PL/Pythonの命名規約については<a class="xref" href="plpython-python23.html" title="45.1. Python 2対Python 3">45.1</a>を参照してください)。
この拡張を使うと<code class="type">hstore</code>の値はPythonの辞書型にマップされます。
  </p><div class="caution"><h3 class="title">注意</h3><p>
<span class="original">
    It is strongly recommended that the transform extensions be installed in
    the same schema as &lt;filename&gt;hstore&lt;/filename&gt;.  Otherwise there are
    installation-time security hazards if a transform extension's schema
    contains objects defined by a hostile user.
</span>
変換の拡張は<code class="filename">hstore</code>と同じスキーマにインストールすることを強く勧めます。
さもないと、変換の拡張のスキーマが悪意のあるユーザにより定義されたオブジェクトを含んでいた場合に、インストール時のセキュリティ問題になります。
   </p></div></div><div class="sect2" id="id-1.11.7.25.12"><div class="titlepage"><div><div><h3 class="title">F.16.8. 作者</h3></div></div></div><span class="original">
  &lt;title&gt;Authors&lt;/title&gt;
</span><p>
   Oleg Bartunov <code class="email">&lt;<a class="email" href="mailto:oleg@sai.msu.su">oleg@sai.msu.su</a>&gt;</code>, Moscow, Moscow University, Russia
  </p><p>
   Teodor Sigaev <code class="email">&lt;<a class="email" href="mailto:teodor@sigaev.ru">teodor@sigaev.ru</a>&gt;</code>, Moscow, Delta-Soft Ltd., Russia
  </p><p>
<span class="original">
   Additional enhancements by Andrew Gierth &lt;email&gt;andrew@tao11.riddles.org.uk&lt;/email&gt;,
   United Kingdom
</span>
追加の改良はAndrew Gierth <code class="email">&lt;<a class="email" href="mailto:andrew@tao11.riddles.org.uk">andrew@tao11.riddles.org.uk</a>&gt;</code>,United Kingdomによりなされました。
  </p></div></div><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navfooter"><hr></hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="fuzzystrmatch.html" title="F.15. fuzzystrmatch">前へ</a> </td><td width="20%" align="center"><a accesskey="u" href="contrib.html" title="付録F 追加で提供されるモジュール">上へ</a></td><td width="40%" align="right"> <a accesskey="n" href="intagg.html" title="F.17. intagg">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">F.15. fuzzystrmatch </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="PostgreSQL 13.1文書">ホーム</a></td><td width="40%" align="right" valign="top"> F.17. intagg</td></tr></table></div></body></html>