<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>50.3. OAuth Validator Callbacks</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="prev" href="oauth-validator-init.html" title="50.2. Initialization Functions" /><link rel="next" href="reference.html" title="パート VI. リファレンス" /><meta name="viewport" content="width=device-width,initial-scale=1.0" /></head><body id="docContent" class="container-fluid col-10"><div class="other_version"><a href="https://www.postgresql.jp/document/">バージョンごとのドキュメント一覧</a></div><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="4" align="center"><a accesskey="h" href="index.html">PostgreSQL 18.2文書</a></th></tr><tr><td width="10%" align="left"></td><td width="10%" align="left"></td><td width="60%" align="center"><a href="oauth-validators.html" title="第50章 OAuth Validator Modules">第50章 OAuth Validator Modules</a></td><td width="20%" align="right"><div class="actions"><a class="issue" title="github" href="https://github.com/pgsql-jp/jpug-doc/issues/new?template=bug_report.yml&amp;what-happened=version 18.2 : oauth-validator-callbacks.html">誤訳等の報告
                    </a></div></td></tr><tr><td width="10%" align="left"><a accesskey="p" href="oauth-validator-init.html" title="50.2. Initialization Functions">前へ</a> </td><td width="10%" align="left"><a accesskey="u" href="oauth-validators.html" title="第50章 OAuth Validator Modules">上へ</a></td><td width="60%" align="center">50.3. OAuth Validator Callbacks</td><td width="20%" align="right"> <a accesskey="n" href="reference.html" title="パート VI. リファレンス">次へ</a></td></tr></table><hr /></div><div class="sect1" id="OAUTH-VALIDATOR-CALLBACKS"><div class="titlepage"><div><div><h2 class="title" style="clear: both">50.3. OAuth Validator Callbacks <a href="#OAUTH-VALIDATOR-CALLBACKS" class="id_link">#</a></h2></div></div></div><p>
<span class="original">
   OAuth validator modules implement their functionality by defining a set of
   callbacks. The server will call them as required to process the
   authentication request from the user.
</span>
《機械翻訳》OAuthバリデータモジュールは、一連のコールバックを定義することでその機能を実装する。
サーバは、ユーザからプロセス認証リクエストまで、必要に応じてそれらを呼び出しする。
  </p><div class="sect2" id="OAUTH-VALIDATOR-CALLBACK-STARTUP"><div class="titlepage"><div><div><h3 class="title">50.3.1. Startup Callback <a href="#OAUTH-VALIDATOR-CALLBACK-STARTUP" class="id_link">#</a></h3></div></div></div><p>
<span class="original">
    The &lt;function&gt;startup_cb&lt;/function&gt; callback is executed directly after
    loading the module. This callback can be used to set up local state and
    perform additional initialization if required. If the validator module
    has state it can use &lt;structfield&gt;state-&gt;private_data&lt;/structfield&gt; to
    store it.
</span>
《機械翻訳》<code class="function">startup_cb</code>コールバックは、モジュールのロードの直後に実行されます。
このコールバックは、ローカルの状態を設定し、必要に応じて追加の初期設定を実行するために使用できます。
バリデータモジュールに状態がある場合は、<code class="structfield">state-&gt;private_data</code>それを格納するために使用できます。

</p><pre class="programlisting">
typedef void (*ValidatorStartupCB) (ValidatorModuleState *state);
</pre><p>
   </p></div><div class="sect2" id="OAUTH-VALIDATOR-CALLBACK-VALIDATE"><div class="titlepage"><div><div><h3 class="title">50.3.2. Validate Callback <a href="#OAUTH-VALIDATOR-CALLBACK-VALIDATE" class="id_link">#</a></h3></div></div></div><p>
<span class="original">
    The &lt;function&gt;validate_cb&lt;/function&gt; callback is executed during the OAuth
    exchange when a user attempts to authenticate using OAuth.  Any state set in
    previous calls will be available in &lt;structfield&gt;state-&gt;private_data&lt;/structfield&gt;.
</span>
《機械翻訳》<code class="function">validate_cb</code>コールバックは、ユーザがOAuthを使用して認証しようとするときに、OAuth交換中に実行される。
以前の呼び出しで設定された状態は、<code class="structfield">state-&gt;private_data</code>で使用できる。

</p><pre class="programlisting">
typedef bool (*ValidatorValidateCB) (const ValidatorModuleState *state,
                                     const char *token, const char *role,
                                     ValidatorModuleResult *result);
</pre><p>

<span class="original">
    &lt;replaceable&gt;token&lt;/replaceable&gt; will contain the bearer token to validate.
    &lt;application&gt;PostgreSQL&lt;/application&gt; has ensured that the token is well-formed syntactically, but no
    other validation has been performed.  &lt;replaceable&gt;role&lt;/replaceable&gt; will
    contain the role the user has requested to log in as.  The callback must
    set output parameters in the &lt;literal&gt;result&lt;/literal&gt; struct, which is
    defined as below:
</span>
《機械翻訳》<em class="replaceable"><code>トークン</code></em>には、検証対象のベアラトークンが含まれます。
<span class="application">PostgreSQL</span>では、トークンが構文的に整形式であることが確認されましたが、他のバリデーションは実行されていません。
<em class="replaceable"><code>ロール</code></em>には、ユーザがログに要求したロールがとして含まれます。
コールバックは<code class="literal">result</code>構造体に出力パラメータを設定する必要があります。
これは次のように定義されます。

</p><pre class="programlisting">
typedef struct ValidatorModuleResult
{
    bool        authorized;
    char       *authn_id;
} ValidatorModuleResult;
</pre><p>

<span class="original">
    The connection will only proceed if the module sets
    &lt;structfield&gt;result-&gt;authorized&lt;/structfield&gt; to &lt;literal&gt;true&lt;/literal&gt;.  To
    authenticate the user, the authenticated user name (as determined using the
    token) shall be palloc'd and returned in the &lt;structfield&gt;result-&gt;authn_id&lt;/structfield&gt;
    field.  Alternatively, &lt;structfield&gt;result-&gt;authn_id&lt;/structfield&gt; may be set to
    NULL if the token is valid but the associated user identity cannot be
    determined.
</span>
《機械翻訳》モジュールが<code class="literal">true</code> result-&gt;認証済に設定された場合のみ、コネクションが続行されます。
ユーザを認証するために、認証されたユーザ名前は<code class="structfield">result-&gt;authn_id</code>トークンを使用して決定されたようにpallocされ、フィールドで返される必要があります。
または、<code class="structfield">result-&gt;authn_id</code>トークンが有効であるが、関連付けられたユーザIDを決定できない場合は、NULLに設定される場合があります。
<code class="structfield"></code>
   </p><p>
<span class="original">
    A validator may return &lt;literal&gt;false&lt;/literal&gt; to signal an internal error,
    in which case any result parameters are ignored and the connection fails.
    Otherwise the validator should return &lt;literal&gt;true&lt;/literal&gt; to indicate
    that it has processed the token and made an authorization decision.
</span>
《機械翻訳》バリデータは、内部エラーを結果<code class="literal">false</code>シグナルに対してすることができます。
この場合、ケースではすべての結果パラメータが無視され、コネクションは失敗します。
そうでない場合、バリデータは結果<code class="literal">true</code>トークンを処理し、許可決定を行ったことを示すする必要があります。
   </p><p>
<span class="original">
    The behavior after &lt;function&gt;validate_cb&lt;/function&gt; returns depends on the
    specific HBA setup.  Normally, the &lt;structfield&gt;result-&gt;authn_id&lt;/structfield&gt; user
    name must exactly match the role that the user is logging in as.  (This
    behavior may be modified with a usermap.)  But when authenticating against
    an HBA rule with &lt;literal&gt;delegate_ident_mapping&lt;/literal&gt; turned on,
    &lt;productname&gt;PostgreSQL&lt;/productname&gt; will not perform any checks on the value of
    &lt;structfield&gt;result-&gt;authn_id&lt;/structfield&gt; at all; in this case it is up to the
    validator to ensure that the token carries enough privileges for the user to
    log in under the indicated &lt;replaceable&gt;role&lt;/replaceable&gt;.
</span>
《機械翻訳》<code class="function">validate_cb</code> returnsの後の動作は、特定のHBAセットアップによって異なります。
通常、<code class="structfield">result-&gt;authn_id</code>ユーザ名前は、ユーザがロギングとしているロールを正確にマッチする必要があります。
（この動作はユーザマップで変更できます。）
しかし、<code class="literal">delegate_ident_mapping</code>オンでHBAルールに対して認証する場合、<span class="productname">PostgreSQL</span>は<code class="structfield">result-&gt;authn_id</code>の値をまったくチェックしません。
このケースでは、トークンが指示された<em class="replaceable"><code>role</code></em>の下でユーザがログに対して十分な権限を持つかどうかは、バリデータから保証に委ねられます。
   </p></div><div class="sect2" id="OAUTH-VALIDATOR-CALLBACK-SHUTDOWN"><div class="titlepage"><div><div><h3 class="title">50.3.3. Shutdown Callback <a href="#OAUTH-VALIDATOR-CALLBACK-SHUTDOWN" class="id_link">#</a></h3></div></div></div><p>
<span class="original">
    The &lt;function&gt;shutdown_cb&lt;/function&gt; callback is executed when the backend
    process associated with the connection exits. If the validator module has
    any allocated state, this callback should free it to avoid resource leaks.
</span>
《機械翻訳》<code class="function">shutdown_cb</code>コールバックは、コネクションに関連付けられたバックエンドプロセスが終了するときに実行されます。
バリデータモジュールに割り当てられた状態がある場合、このコールバックはリソースリークを回避するためにフリーする必要があります。
</p><pre class="programlisting">
typedef void (*ValidatorShutdownCB) (ValidatorModuleState *state);
</pre><p>
   </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="oauth-validator-init.html" title="50.2. Initialization Functions">前へ</a> </td><td width="20%" align="center"><a accesskey="u" href="oauth-validators.html" title="第50章 OAuth Validator Modules">上へ</a></td><td width="40%" align="right"> <a accesskey="n" href="reference.html" title="パート VI. リファレンス">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">50.2. Initialization Functions </td><td width="20%" align="center"><a accesskey="h" href="index.html" title="PostgreSQL 18.2文書">ホーム</a></td><td width="40%" align="right" valign="top"> パート VI. リファレンス</td></tr></table></div></body></html>