<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>43.2. PL/Tcl関数と引数</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="pltcl-overview.html" title="43.1. 概要" /><link rel="next" href="pltcl-data.html" title="43.3. PL/Tclにおけるデータの値" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">43.2. PL/Tcl関数と引数</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="pltcl-overview.html" title="43.1. 概要">前へ</a> </td><td width="10%" align="left"><a accesskey="u" href="pltcl.html" title="第43章 PL/Tcl - Tcl手続き言語">上へ</a></td><th width="60%" align="center">第43章 PL/Tcl - Tcl手続き言語</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.0文書">ホーム</a></td><td width="10%" align="right"> <a accesskey="n" href="pltcl-data.html" title="43.3. PL/Tclにおけるデータの値">次へ</a></td></tr></table><hr></hr></div><div class="sect1" id="pltcl-functions"><div class="titlepage"><div><div><h2 class="title" style="clear: both">43.2. PL/Tcl関数と引数</h2></div></div></div><!--
    <title>PL/Tcl Functions and Arguments</title>
--><p><!--
     To create a function in the <application>PL/Tcl</> language, use
     the standard <xref linkend="sql-createfunction"> syntax:
--><span class="application">PL/Tcl</span>言語で関数を作成するには、以下の標準的な<a class="xref" href="sql-createfunction.html" title="CREATE FUNCTION"><span class="refentrytitle">CREATE FUNCTION</span></a>構文を使用してください。

</p><pre class="programlisting">CREATE FUNCTION <em class="replaceable"><code>funcname</code></em> (<em class="replaceable"><code>argument-types</code></em>) RETURNS <em class="replaceable"><code>return-type</code></em> AS $$<!--
    # PL/Tcl function body
-->
    # PL/Tcl関数本体
$$ LANGUAGE pltcl;</pre><p>
<!--
     <application>PL/TclU</> is the same, except that the language has to be specified as
     <literal>pltclu</>.
-->
<span class="application">PL/TclU</span>でも、言語に<code class="literal">pltclu</code>を指定しなければならない点以外は同様です。
    </p><p><!--
     The body of the function is simply a piece of Tcl script.
     When the function is called, the argument values are passed to the
     Tcl script as variables named <literal>1</literal>
     ... <literal><replaceable>n</replaceable></literal>.  The result is
     returned from the Tcl code in the usual way, with
     a <literal>return</literal> statement.
-->関数本体は、単なる小さなTclスクリプトです。
関数が呼び出された時、引数の値はTclスクリプトに<code class="literal">$1</code> ... <code class="literal">$<em class="replaceable"><code>n</code></em></code>という変数として渡されます。
結果は通常通り<code class="literal">return</code>文を使用してTclのコードから返されます。
    </p><p><!--
     For example, a function
     returning the greater of two integer values could be defined as:
-->例えば、2つの整数のうち大きな方を返す関数は以下のように定義できます。

</p><pre class="programlisting">CREATE FUNCTION tcl_max(integer, integer) RETURNS integer AS $$
    if {$1 &gt; $2} {return $1}
    return $2
$$ LANGUAGE pltcl STRICT;</pre><p>
<!--
     Note the clause <literal>STRICT</>, which saves us from
     having to think about null input values: if a null value is passed, the
     function will not be called at all, but will just return a null
     result automatically.
-->
<code class="literal">STRICT</code>句に注意してください。
これによりプログラマは、入力にNULL値が与えられた場合を検討する手間を省くことができます。
NULLが渡された場合、関数はまったく呼び出されず、単にNULLという結果が自動的に返されます。
    </p><p><!--
     In a nonstrict function,
     if the actual value of an argument is null, the corresponding
     <literal>$<replaceable>n</replaceable></literal> variable will be set to an empty string.
     To detect whether a particular argument is null, use the function
     <literal>argisnull</>.  For example, suppose that we wanted <function>tcl_max</function>
     with one null and one nonnull argument to return the nonnull
     argument, rather than null:
-->厳密（strict）でない関数では、引数の実際の値がNULLである場合、対応する<code class="literal">$<em class="replaceable"><code>n</code></em></code>変数は空文字列に設定されます。
ある引数がNULLかどうかを検出するためには、<code class="literal">argisnull</code>関数を使用してください。
例えば、引数の片方がNULL、もう片方が非NULLであって、NULLではなく、非NULLの引数の方を返す<code class="function">tcl_max</code>を考えると、以下のようになります。

</p><pre class="programlisting">CREATE FUNCTION tcl_max(integer, integer) RETURNS integer AS $$
    if {[argisnull 1]} {
        if {[argisnull 2]} { return_null }
        return $2
    }
    if {[argisnull 2]} { return $1 }
    if {$1 &gt; $2} {return $1}
    return $2
$$ LANGUAGE pltcl;</pre><p>
    </p><p><!--
     As shown above,
     to return a null value from a PL/Tcl function, execute
     <literal>return_null</literal>.  This can be done whether the
     function is strict or not.
-->上で示した通り、NULL値をPL/Tcl関数から返すためには、<code class="literal">return_null</code>を実行してください。
これは、関数が厳密かどうかに関係なく、実行することができます。
    </p><p><!--
     Composite-type arguments are passed to the function as Tcl
     arrays.  The element names of the array are the attribute names
     of the composite type. If an attribute in the passed row has the
     null value, it will not appear in the array. Here is an example:
-->複合型の引数は、Tcl配列として関数に渡されます。
配列の要素名は複合型の属性名です。
渡された行の属性がNULL値の場合、その属性は配列内には現れません。
以下に例を示します。

</p><pre class="programlisting">CREATE TABLE employee (
    name text,
    salary integer,
    age integer
);

CREATE FUNCTION overpaid(employee) RETURNS boolean AS $$
    if {200000.0 &lt; $1(salary)} {
        return "t"
    }
    if {$1(age) &lt; 30 &amp;&amp; 100000.0 &lt; $1(salary)} {
        return "t"
    }
    return "f"
$$ LANGUAGE pltcl;</pre><p>
    </p><p>     PL/Tcl functions can return composite-type results, too.  To do this,
     the Tcl code must return a list of column name/value pairs matching
     the expected result type.  Any column names omitted from the list
     are returned as nulls, and an error is raised if there are unexpected
     column names.  Here is an example:

</p><pre class="programlisting">CREATE FUNCTION square_cube(in int, out squared int, out cubed int) AS $$
    return [list squared [expr {$1 * $1}] cubed [expr {$1 * $1 * $1}]]
$$ LANGUAGE pltcl;</pre><p>
    </p><div class="tip"><h3 class="title">ヒント</h3><p>      The result list can be made from an array representation of the
      desired tuple with the <code class="literal">array get</code> Tcl command.  For example:

</p><pre class="programlisting">CREATE FUNCTION raise_pay(employee, delta int) RETURNS employee AS $$
    set 1(salary) [expr {$1(salary) + $2}]
    return [array get 1]
$$ LANGUAGE pltcl;</pre><p>
     </p></div><p>     PL/Tcl functions can return sets.  To do this, the Tcl code should
     call <code class="function">return_next</code> once per row to be returned,
     passing either the appropriate value when returning a scalar type,
     or a list of column name/value pairs when returning a composite type.
     Here is an example returning a scalar type:

</p><pre class="programlisting">CREATE FUNCTION sequence(int, int) RETURNS SETOF int AS $$
    for {set i $1} {$i &lt; $2} {incr i} {
        return_next $i
    }
$$ LANGUAGE pltcl;</pre><p>

     and here is one returning a composite type:

</p><pre class="programlisting">CREATE FUNCTION table_of_squares(int, int) RETURNS TABLE (x int, x2 int) AS $$
    for {set i $1} {$i &lt; $2} {incr i} {
        return_next [list x $i x2 [expr {$i * $i}]]
    }
$$ LANGUAGE pltcl;</pre><p>
    </p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="pltcl-overview.html">前へ</a> </td><td width="20%" align="center"><a accesskey="u" href="pltcl.html">上へ</a></td><td width="40%" align="right"> <a accesskey="n" href="pltcl-data.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">43.1. 概要 </td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top"> 43.3. PL/Tclにおけるデータの値</td></tr></table></div></body></html>