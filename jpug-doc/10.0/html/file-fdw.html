<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>F.15. file_fdw</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="earthdistance.html" title="F.14. earthdistance" /><link rel="next" href="fuzzystrmatch.html" title="F.16. fuzzystrmatch" /><meta name="viewport" content="width=device-width,initial-scale=1.0" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="4" align="center"><a accesskey="h" href="index.html">PostgreSQL 10.0文書</a></th></tr><tr><td width="10%" align="left"></td><td width="10%" align="left"></td><td width="60%" align="center"><a href="contrib.html" title="付録F 追加で提供されるモジュール">付録F 追加で提供されるモジュール</a></td><td width="20%" align="right"><div class="actions"><a class="issue" title="github" href="https://github.com/pgsql-jp/jpug-doc/issues/new?title=version 10.0 &#10;                      file-fdw.html">誤訳等の報告
                    </a></div></td></tr><tr><td width="10%" align="left"><a accesskey="p" href="earthdistance.html" title="F.14. earthdistance">前へ</a> </td><td width="10%" align="left"><a accesskey="u" href="contrib.html" title="付録F 追加で提供されるモジュール">上へ</a></td><td width="60%" align="center">F.15. file_fdw</td><td width="20%" align="right"> <a accesskey="n" href="fuzzystrmatch.html" title="F.16. fuzzystrmatch">次へ</a></td></tr></table><hr /></div><div class="sect1" id="file-fdw"><div class="titlepage"><div><div><h2 class="title" style="clear: both">F.15. file_fdw</h2></div></div></div><a id="idm45355083644592" class="indexterm"></a><p><span class="original">
  The &lt;filename&gt;file_fdw&lt;/&gt; module provides the foreign-data wrapper
  &lt;function&gt;file_fdw&lt;/function&gt;, which can be used to access data
  files in the server's file system, or to execute programs on the server
  and read their output.  The data file or program output must be in a format
  that can be read by &lt;command&gt;COPY FROM&lt;/command&gt;;
  see &lt;xref linkend="sql-copy"&gt; for details.
  Access to data files is currently read-only.
</span><code class="filename">file_fdw</code>モジュールは、サーバのファイルシステムにあるデータファイルにアクセスするのに使用できる外部データラッパ<code class="function">file_fdw</code>を提供します。
データファイルは<code class="command">COPY FROM</code>で読むことのできるフォーマットでなければなりません。
詳細は <a class="xref" href="sql-copy.html" title="COPY"><span class="refentrytitle">COPY</span></a> を参照してください。
そのようなデータへのアクセスは現時点では読み取り専用です。
 </p><p><span class="original">
  A foreign table created using this wrapper can have the following options:
</span>このラッパーで作成された外部テーブルには以下のオプションを設定することができます。
 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">filename</code></span></dt><dd><p>     Specifies the file to be read.  Must be an absolute path name.
     Either <code class="literal">filename</code> or <code class="literal">program</code> must be
     specified, but not both.
    </p></dd><dt><span class="term"><code class="literal">program</code></span></dt><dd><p>     Specifies the command to be executed.  The standard output of this
     command will be read as though <code class="command">COPY FROM PROGRAM</code> were used.
     Either <code class="literal">program</code> or <code class="literal">filename</code> must be
     specified, but not both.
    </p></dd><dt><span class="term"><code class="literal">format</code></span></dt><dd><p><span class="original">
     Specifies the data format,
     the same as &lt;command&gt;COPY&lt;/&gt;'s &lt;literal&gt;FORMAT&lt;/literal&gt; option.
</span>ファイルフォーマットを指定するもので、<code class="command">COPY</code>の<code class="literal">FORMAT</code>オプションと同じです。
    </p></dd><dt><span class="term"><code class="literal">header</code></span></dt><dd><p><span class="original">
     Specifies whether the data has a header line,
     the same as &lt;command&gt;COPY&lt;/&gt;'s &lt;literal&gt;HEADER&lt;/literal&gt; option.
</span>ファイルがヘッダ行を持つか指定するもので、<code class="command">COPY</code>の<code class="literal">HEADER</code>オプションと同じです。
    </p></dd><dt><span class="term"><code class="literal">delimiter</code></span></dt><dd><p><span class="original">
     Specifies the data delimiter character,
     the same as &lt;command&gt;COPY&lt;/&gt;'s &lt;literal&gt;DELIMITER&lt;/literal&gt; option.
</span>ファイルのデリミタ文字を指定するもので、<code class="command">COPY</code>の<code class="literal">DELIMITER</code>オプションと同じです。
    </p></dd><dt><span class="term"><code class="literal">quote</code></span></dt><dd><p><span class="original">
     Specifies the data quote character,
     the same as &lt;command&gt;COPY&lt;/&gt;'s &lt;literal&gt;QUOTE&lt;/literal&gt; option.
</span>ファイルの引用符文字を指定するもので、<code class="command">COPY</code>の<code class="literal">QUOTE</code>オプションと同じです。
    </p></dd><dt><span class="term"><code class="literal">escape</code></span></dt><dd><p><span class="original">
     Specifies the data escape character,
     the same as &lt;command&gt;COPY&lt;/&gt;'s &lt;literal&gt;ESCAPE&lt;/literal&gt; option.
</span>ファイルのエスケープ文字を指定するもので、<code class="command">COPY</code>の<code class="literal">ESCAPE</code>オプションと同じです。
    </p></dd><dt><span class="term"><code class="literal">null</code></span></dt><dd><p><span class="original">
     Specifies the data null string,
     the same as &lt;command&gt;COPY&lt;/&gt;'s &lt;literal&gt;NULL&lt;/literal&gt; option.
</span>ファイルのnull文字列を指定するもので、<code class="command">COPY</code>の<code class="literal">NULL</code>オプションと同じです。
    </p></dd><dt><span class="term"><code class="literal">encoding</code></span></dt><dd><p><span class="original">
     Specifies the data encoding,
     the same as &lt;command&gt;COPY&lt;/&gt;'s &lt;literal&gt;ENCODING&lt;/literal&gt; option.
</span>ファイルのエンコーディングを指定するもので、<code class="command">COPY</code>の<code class="literal">ENCODING</code>オプションと同じです。
    </p></dd></dl></div><p><span class="original">
  Note that while &lt;command&gt;COPY&lt;/&gt; allows options such as &lt;literal&gt;HEADER&lt;/&gt;
  to be specified without a corresponding value, the foreign table option
  syntax requires a value to be present in all cases.  To activate
  &lt;command&gt;COPY&lt;/&gt; options typically written without a value, you can pass
  the value TRUE, since all such options are Booleans.
</span><code class="command">COPY</code>ではOIDSやHEADERといったオプションを対応する値なしで指定できるのに対して、外部データラッパの構文では全ての場合において値を指定する必要がある点に注意してください。
通常値なしで指定される<code class="command">COPY</code>オプションを有効にするには、代わりにTRUEを渡すことができます。
 </p><p><span class="original">
  A column of a foreign table created using this wrapper can have the
  following options:
</span>このラッパーを使って作られた外部テーブルのカラムは、以下のオプションを持つことができます。
 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">force_not_null</code></span></dt><dd><p><span class="original">
     This is a Boolean option.  If true, it specifies that values of the
     column should not be matched against the null string (that is, the
     table-level &lt;literal&gt;null&lt;/literal&gt; option).  This has the same effect
     as listing the column in &lt;command&gt;COPY&lt;/&gt;'s
     &lt;literal&gt;FORCE_NOT_NULL&lt;/literal&gt; option.
</span>これはbooleanオプションです。
真の場合は、このカラムの値はヌル値文字列(これはファイルレベルの<code class="literal">null</code>オプションです)と比較されません。
これは、<code class="command">COPY</code>の<code class="literal">FORCE_NOT_NULL</code>オプションに列名を指定するのと同じ効果があります。
    </p></dd><dt><span class="term"><code class="literal">force_null</code></span></dt><dd><p><span class="original">
     This is a Boolean option.  If true, it specifies that values of the
     column which match the null string are returned as &lt;literal&gt;NULL&lt;/&gt;
     even if the value is quoted. Without this option, only unquoted
     values matching the null string are returned as &lt;literal&gt;NULL&lt;/&gt;.
     This has the same effect  as listing the column in
     &lt;command&gt;COPY&lt;/&gt;'s &lt;literal&gt;FORCE_NULL&lt;/literal&gt; option.
</span>これはbooleanオプションです。
真の場合、ヌル値文字列と一致するこのカラムの値は、たとえ引用符で括られていたとしても<code class="literal">NULL</code>と返されます。
このオプションがなければ、ヌル値文字列と一致する引用符で括られていない値のみが<code class="literal">NULL</code>と返されます。
これは、<code class="command">COPY</code>の<code class="literal">FORCE_NULL</code>オプションに列名を指定するのと同じ効果があります。
    </p></dd></dl></div><p><span class="original">
  &lt;command&gt;COPY&lt;/&gt;'s &lt;literal&gt;OIDS&lt;/literal&gt; and
  &lt;literal&gt;FORCE_QUOTE&lt;/literal&gt; options are currently not supported by
  &lt;literal&gt;file_fdw&lt;/&gt;.
</span><code class="command">COPY</code>の<code class="literal">OIDS</code>、<code class="literal">FORCE_QUOTE</code>の各オプションは<code class="literal">file_fdw</code>では現在サポートされていません。
 </p><p><span class="original">
  These options can only be specified for a foreign table or its columns, not
  in the options of the &lt;literal&gt;file_fdw&lt;/&gt; foreign-data wrapper, nor in the
  options of a server or user mapping using the wrapper.
</span>これらのオプションは外部テーブルまたはその列にのみ指定可能で、<code class="literal">file_fdw</code>外部データラッパやそれを使用するサーバ、ユーザマッピングのオプションには指定できません。
 </p><p><span class="original">
  Changing table-level options requires superuser privileges, for security
  reasons: only a superuser should be able to control which file is read
  or which program is run.  In principle non-superusers could be allowed to
  change the other options, but that's not supported at present.
</span>どのファイルから読み込むかを決定できるのはスーパーユーザーのみでなければならない、というセキュリティ上の理由から、テーブルレベルのオプションを変更するにはスーパーユーザ権限が必要です。
原則としては非スーパーユーザはその他のオプションを変更することを許されてもよいのですが、現時点ではサポートされていません。
 </p><p>  When specifying the <code class="literal">program</code> option, keep in mind that the option
  string is executed by the shell.  If you need to pass any arguments to the
  command that come from an untrusted source, you must be careful to strip or
  escape any characters that might have special meaning to the shell.
  For security reasons, it is best to use a fixed command string, or at least
  avoid passing any user input in it.
 </p><p><span class="original">
  For a foreign table using &lt;literal&gt;file_fdw&lt;/&gt;, &lt;command&gt;EXPLAIN&lt;/&gt; shows
  the name of the file to be read or program to be run.
  For a file, unless &lt;literal&gt;COSTS OFF&lt;/&gt; is
  specified, the file size (in bytes) is shown as well.
</span><code class="literal">file_fdw</code>を使用する外部テーブルでは、<code class="command">EXPLAIN</code>は読み込むファイルの名前を表示します。
<code class="literal">COSTS OFF</code>が指定されない場合は(バイト単位の)ファイルサイズも表示されます。
 </p><div class="example" id="idm45355083588432"><p class="title"><strong>例F.1 PostgreSQL CSV ログ用の外部テーブル作成</strong></p><div class="example-contents"><span class="original">
 &lt;title id="csvlog-fdw"&gt;Create a Foreign Table for PostgreSQL CSV Logs&lt;/title&gt;
</span><p><span class="original">
   One of the obvious uses for &lt;literal&gt;file_fdw&lt;/&gt; is to make
   the PostgreSQL activity log available as a table for querying.  To
   do this, first you must be logging to a CSV file, which here we
   will call &lt;literal&gt;pglog.csv&lt;/&gt;.  First, install &lt;literal&gt;file_fdw&lt;/&gt;
   as an extension:
</span><code class="literal">file_fdw</code>の明確な用途の一つはPostgreSQLの活動ログをテーブルとして検索できるようにすることです。
これを実現するには、ここでは<code class="literal">pglog.csv</code>と呼ぶCSVファイルにログを記録している必要があります。
まず、<code class="literal">file_fdw</code>をエクステンションとしてインストールします。
  </p><pre class="programlisting">CREATE EXTENSION file_fdw;</pre><p><span class="original">
   Then create a foreign server:
</span>続いて外部サーバを作成します。

</p><pre class="programlisting">CREATE SERVER pglog FOREIGN DATA WRAPPER file_fdw;</pre><p>
  </p><p><span class="original">
   Now you are ready to create the foreign data table.  Using the
   &lt;command&gt;CREATE FOREIGN TABLE&lt;/&gt; command, you will need to define
   the columns for the table, the CSV file name, and its format:
</span>これで外部テーブルを作成する準備ができました。
<code class="command">CREATE FOREIGN TABLE</code>コマンドを使って、テーブルのカラム、CSVファイル名とそのフォーマットを定義する必要があるでしょう。

</p><pre class="programlisting">CREATE FOREIGN TABLE pglog (
  log_time timestamp(3) with time zone,
  user_name text,
  database_name text,
  process_id integer,
  connection_from text,
  session_id text,
  session_line_num bigint,
  command_tag text,
  session_start_time timestamp with time zone,
  virtual_transaction_id text,
  transaction_id bigint,
  error_severity text,
  sql_state_code text,
  message text,
  detail text,
  hint text,
  internal_query text,
  internal_query_pos integer,
  context text,
  query text,
  query_pos integer,
  location text,
  application_name text
) SERVER pglog
OPTIONS ( filename '/home/josh/data/log/pglog.csv', format 'csv' );</pre><p>
  </p><p><span class="original">
   That's it &amp;mdash; now you can query your log directly. In production, of
   course, you would need to define some way to deal with log rotation.
</span>これで全てです—もうあなたはログに直接検索を実行することができます。
実運用においては、もちろん何らかの方法でログを切り替える必要があるでしょう。
  </p></div></div><br class="example-break" /></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="earthdistance.html">前へ</a> </td><td width="20%" align="center"><a accesskey="u" href="contrib.html">上へ</a></td><td width="40%" align="right"> <a accesskey="n" href="fuzzystrmatch.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">F.14. earthdistance </td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top"> F.16. fuzzystrmatch</td></tr></table></div></body></html>