<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>第45章 サーバプログラミングインタフェース</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="PostgreSQL 9.6.0文書" /><link rel="up" href="server-programming.html" title="パート V. サーバプログラミング" /><link rel="prev" href="plpython-envar.html" title="44.10. 環境変数" /><link rel="next" href="spi-interface.html" title="45.1. インタフェース関数" /><link rel="copyright" href="legalnotice.html" title="法的告知" /><meta name="viewport" content="width=device-width,initial-scale=1.0" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><td width="20%" align="left" colspan="2"></td><th width="60%" align="center"><a accesskey="h" href="index.html">PostgreSQL 9.6.0文書</a></th><td width="20%" align="right"><div class="actions"><a class="issue" href="https://github.com/pgsql-jp/jpug-doc/issues/new?title=version 9.6.0 spi.html">誤訳等の報告</a></div></td></tr><tr><td width="10%" align="left" valign="top"><a accesskey="p" href="plpython-envar.html">前へ</a> </td><td width="10%" align="left" valign="top"><a accesskey="u" href="server-programming.html">上へ</a></td><td width="60%" align="center">第45章 サーバプログラミングインタフェース</td><td width="20%" align="right" valign="top"> <a accesskey="n" href="spi-interface.html">次へ</a></td></tr></table><hr /></div><div class="chapter" id="spi"><div class="titlepage"><div><div><h2 class="title">第45章 サーバプログラミングインタフェース</h2></div></div></div><div class="toc"><p><strong>目次</strong></p><dl class="toc"><dt><span class="sect1"><a href="spi-interface.html">45.1. インタフェース関数</a></span></dt><dd><dl><dt><span class="refentrytitle"><a href="spi-spi-connect.html">SPI_connect</a></span><span class="refpurpose"> — SPIマネージャにプロシージャを接続する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-finish.html">SPI_finish</a></span><span class="refpurpose"> — プロシージャをSPIマネージャから切断する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-push.html">SPI_push</a></span><span class="refpurpose"> — 再帰的にSPIを使用できるようにSPIスタックをプッシュする</span></dt><dt><span class="refentrytitle"><a href="spi-spi-pop.html">SPI_pop</a></span><span class="refpurpose"> — 再帰的なSPIの使用から復帰できるようにSPIスタックをポップする</span></dt><dt><span class="refentrytitle"><a href="spi-spi-execute.html">SPI_execute</a></span><span class="refpurpose"> — コマンドを実行する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-exec.html">SPI_exec</a></span><span class="refpurpose"> — 読み書きコマンドを実行する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-execute-with-args.html">SPI_execute_with_args</a></span><span class="refpurpose"> — 行外のパラメータを持つコマンドを実行する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-prepare.html">SPI_prepare</a></span><span class="refpurpose"> — 文を準備する。文の実行はまだ行わない</span></dt><dt><span class="refentrytitle"><a href="spi-spi-prepare-cursor.html">SPI_prepare_cursor</a></span><span class="refpurpose"> — 文を準備する。まだ実行は行わない</span></dt><dt><span class="refentrytitle"><a href="spi-spi-prepare-params.html">SPI_prepare_params</a></span><span class="refpurpose"> — 文を準備する。まだ実行は行わない</span></dt><dt><span class="refentrytitle"><a href="spi-spi-getargcount.html">SPI_getargcount</a></span><span class="refpurpose"> — <code class="function">SPI_prepare</code>により準備した文に必要とされる引数の数を返す
  </span></dt><dt><span class="refentrytitle"><a href="spi-spi-getargtypeid.html">SPI_getargtypeid</a></span><span class="refpurpose"> — <code class="function">SPI_prepare</code>で準備された文で指定される引数のデータ型のOIDを返す
  </span></dt><dt><span class="refentrytitle"><a href="spi-spi-is-cursor-plan.html">SPI_is_cursor_plan</a></span><span class="refpurpose"> — <code class="function">SPI_prepare</code>で準備された文が<code class="function">SPI_cursor_open</code>で使用できる場合に<code class="symbol">true</code>を返す
  </span></dt><dt><span class="refentrytitle"><a href="spi-spi-execute-plan.html">SPI_execute_plan</a></span><span class="refpurpose"> — <code class="function">SPI_prepare</code>で準備された文を実行する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-execute-plan-with-paramlist.html">SPI_execute_plan_with_paramlist</a></span><span class="refpurpose"> — <code class="function">SPI_prepare</code>で準備された文を実行する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-execp.html">SPI_execp</a></span><span class="refpurpose"> — 読み書きモードで文を実行する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-cursor-open.html">SPI_cursor_open</a></span><span class="refpurpose"> — <code class="function">SPI_prepare</code>で作成された文を使用したカーソルを設定する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-cursor-open-with-args.html">SPI_cursor_open_with_args</a></span><span class="refpurpose"> — 問い合わせとパラメータを使ってカーソルを設定する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-cursor-open-with-paramlist.html">SPI_cursor_open_with_paramlist</a></span><span class="refpurpose"> — パラメータを使ってカーソルを設定する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-cursor-find.html">SPI_cursor_find</a></span><span class="refpurpose"> — 既存のカーソルを名前で検索する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-cursor-fetch.html">SPI_cursor_fetch</a></span><span class="refpurpose"> — カーソルから数行を取り出す</span></dt><dt><span class="refentrytitle"><a href="spi-spi-cursor-move.html">SPI_cursor_move</a></span><span class="refpurpose"> — カーソルを移動する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-scroll-cursor-fetch.html">SPI_scroll_cursor_fetch</a></span><span class="refpurpose"> — カーソルから一部の行を取り出す</span></dt><dt><span class="refentrytitle"><a href="spi-spi-scroll-cursor-move.html">SPI_scroll_cursor_move</a></span><span class="refpurpose"> — カーソルを移動する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-cursor-close.html">SPI_cursor_close</a></span><span class="refpurpose"> — カーソルを閉じる</span></dt><dt><span class="refentrytitle"><a href="spi-spi-keepplan.html">SPI_keepplan</a></span><span class="refpurpose"> — 準備済み文を保持する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-saveplan.html">SPI_saveplan</a></span><span class="refpurpose"> — 準備済み文を保存する</span></dt></dl></dd><dt><span class="sect1"><a href="spi-interface-support.html">45.2. インタフェースサポート関数</a></span></dt><dd><dl><dt><span class="refentrytitle"><a href="spi-spi-fname.html">SPI_fname</a></span><span class="refpurpose"> — 指定した列番号に対する列名を決定する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-fnumber.html">SPI_fnumber</a></span><span class="refpurpose"> — 指定した列名から列番号を決定する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-getvalue.html">SPI_getvalue</a></span><span class="refpurpose"> — 指定された列の文字列値を返す</span></dt><dt><span class="refentrytitle"><a href="spi-spi-getbinval.html">SPI_getbinval</a></span><span class="refpurpose"> — 指定した列のバイナリ値を返す</span></dt><dt><span class="refentrytitle"><a href="spi-spi-gettype.html">SPI_gettype</a></span><span class="refpurpose"> — 指定された列のデータ型名を返す</span></dt><dt><span class="refentrytitle"><a href="spi-spi-gettypeid.html">SPI_gettypeid</a></span><span class="refpurpose"> — 指定された列のデータ型の<acronym class="acronym">OID</acronym>を返す</span></dt><dt><span class="refentrytitle"><a href="spi-spi-getrelname.html">SPI_getrelname</a></span><span class="refpurpose"> — 指定されたリレーションの名前を返す</span></dt><dt><span class="refentrytitle"><a href="spi-spi-getnspname.html">SPI_getnspname</a></span><span class="refpurpose"> — 指定されたリレーションの名前空間を返す。</span></dt></dl></dd><dt><span class="sect1"><a href="spi-memory.html">45.3. メモリ管理</a></span></dt><dd><dl><dt><span class="refentrytitle"><a href="spi-spi-palloc.html">SPI_palloc</a></span><span class="refpurpose"> — 上位エクゼキュータコンテキスト内にメモリを割り当てる</span></dt><dt><span class="refentrytitle"><a href="spi-realloc.html">SPI_repalloc</a></span><span class="refpurpose"> — 上位エクゼキュータコンテキスト内にメモリを再割り当てる</span></dt><dt><span class="refentrytitle"><a href="spi-spi-pfree.html">SPI_pfree</a></span><span class="refpurpose"> — 上位エクゼキュータコンテキスト内のメモリを解放する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-copytuple.html">SPI_copytuple</a></span><span class="refpurpose"> — 上位エクゼキュータ内に行のコピーを作成する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-returntuple.html">SPI_returntuple</a></span><span class="refpurpose"> — Datumとしてタプルを返す準備をする</span></dt><dt><span class="refentrytitle"><a href="spi-spi-modifytuple.html">SPI_modifytuple</a></span><span class="refpurpose"> — 与えられた行の選択フィールドを置き換えた行を作成する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-freetuple.html">SPI_freetuple</a></span><span class="refpurpose"> — 上位エクゼキュータコンテキスト内に割り当てられた行を解放する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-freetupletable.html">SPI_freetuptable</a></span><span class="refpurpose"> — <code class="function">SPI_execute</code>や類似の関数によって生成された行セットを解放する</span></dt><dt><span class="refentrytitle"><a href="spi-spi-freeplan.html">SPI_freeplan</a></span><span class="refpurpose"> — 以前に保存した準備済み文を解放する</span></dt></dl></dd><dt><span class="sect1"><a href="spi-visibility.html">45.4. データ変更の可視性</a></span></dt><dt><span class="sect1"><a href="spi-examples.html">45.5. 例</a></span></dt></dl></div><span class="original">
 &lt;title&gt;Server Programming Interface&lt;/title&gt;
</span><a id="idp95316064" class="indexterm"></a><p><span class="original">
  The &lt;firstterm&gt;Server Programming Interface&lt;/firstterm&gt;
  (&lt;acronym&gt;SPI&lt;/acronym&gt;) gives writers of user-defined
  &lt;acronym&gt;C&lt;/acronym&gt; functions the ability to run
  &lt;acronym&gt;SQL&lt;/acronym&gt; commands inside their functions.
  &lt;acronym&gt;SPI&lt;/acronym&gt; is a set of
  interface functions to simplify access to the parser, planner,
  and executor. &lt;acronym&gt;SPI&lt;/acronym&gt; also does some
  memory management.
</span><em class="firstterm">サーバプログラミングインタフェース</em>（<acronym class="acronym">SPI</acronym>）は、ユーザ定義の<acronym class="acronym">C</acronym>関数から<acronym class="acronym">SQL</acronym>問い合わせを実行する機能をユーザに提供します。
<acronym class="acronym">SPI</acronym>はパーサ、プランナ、エクゼキュータへのアクセスを単純化したインタフェース関数の集合です。
また、<acronym class="acronym">SPI</acronym>は多少のメモリ管理を行います。
 </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">注記</h3><p><span class="original">
   The available procedural languages provide various means to
   execute SQL commands from procedures.  Most of these facilities are
   based on SPI, so this documentation might be of use for users
   of those languages as well.
</span>利用可能な手続き言語は、プロシージャからSQLコマンドを実行するための各種手段を提供します。
これらのほとんどは、SPIを基にしていますので、この文書はこれらの言語のユーザにとっても有用な場合があります。
  </p></div><p><span class="original">
  To avoid misunderstanding we'll use the term &lt;quote&gt;function&lt;/quote&gt;
  when we speak of &lt;acronym&gt;SPI&lt;/acronym&gt; interface functions and
  &lt;quote&gt;procedure&lt;/quote&gt; for a user-defined C-function that is
  using &lt;acronym&gt;SPI&lt;/acronym&gt;.
</span>誤解を防ぐために、これ以降、<span class="quote">「<span class="quote">関数</span>」</span>を<acronym class="acronym">SPI</acronym>インタフェース関数の意味で、<span class="quote">「<span class="quote">プロシージャ</span>」</span>を<acronym class="acronym">SPI</acronym>を呼び出すユーザ定義のC関数の意味で使うことにします。
 </p><p><span class="original">
  Note that if a command invoked via SPI fails, then control will not be
  returned to your procedure.  Rather, the
  transaction or subtransaction in which your procedure executes will be
  rolled back.  (This might seem surprising given that the SPI functions mostly
  have documented error-return conventions.  Those conventions only apply
  for errors detected within the SPI functions themselves, however.)
  It is possible to recover control after an error by establishing your own
  subtransaction surrounding SPI calls that might fail.  This is not currently
  documented because the mechanisms required are still in flux.
</span>コマンドがSPIの失敗を起こした場合、その制御はプロシージャには戻らないことに注意してください。
それどころか、プロシージャを実行していたトランザクションもしくは副トランザクションはロールバックされます
（これはSPI関数のほとんどでエラーを返す規約があることから奇妙に思われるかもしれません。
しかし、こうした規約はSPI関数自身でエラーを検知した時にのみ適用されるものです）。
失敗する可能性があるSPI呼び出しを囲む副トランザクションを独自に用意することで、エラーの後の制御を戻すことができます。
要求される機構がまだ流動的であるため、これはまだ文書化されていません。
 </p><p><span class="original">
  &lt;acronym&gt;SPI&lt;/acronym&gt; functions return a nonnegative result on
  success (either via a returned integer value or in the global
  variable &lt;varname&gt;SPI_result&lt;/varname&gt;, as described below).  On
  error, a negative result or &lt;symbol&gt;NULL&lt;/symbol&gt; will be returned.
</span><acronym class="acronym">SPI</acronym>関数は成功時に非負の結果を（戻り値、もしくは後述の<code class="varname">SPI_result</code>グローバル変数の中に）返します。
エラー時、負の結果もしくは<code class="symbol">NULL</code>を返します。
 </p><p><span class="original">
  Source code files that use SPI must include the header file
  &lt;filename&gt;executor/spi.h&lt;/filename&gt;.
</span>SPIを使用するソースコードファイルでは<code class="filename">executor/spi.h</code>ヘッダファイルをincludeしなければなりません。
 </p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="plpython-envar.html">前へ</a> </td><td width="20%" align="center"><a accesskey="u" href="server-programming.html">上へ</a></td><td width="40%" align="right"> <a accesskey="n" href="spi-interface.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">44.10. 環境変数 </td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top"> 45.1. インタフェース関数</td></tr></table></div></body></html>