<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>19.6. レプリケーション</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@lists.postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="runtime-config-wal.html" title="19.5. ログ先行書き込み（WAL）" /><link rel="next" href="runtime-config-query.html" title="19.7. 問い合わせ計画" /><meta name="viewport" content="width=device-width,initial-scale=1.0" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="4" align="center"><a accesskey="h" href="index.html">PostgreSQL 12.3文書</a></th></tr><tr><td width="10%" align="left"></td><td width="10%" align="left"></td><td width="60%" align="center"><a href="runtime-config.html" title="第19章 サーバの設定">第19章 サーバの設定</a></td><td width="20%" align="right"></td></tr><tr><td width="10%" align="left"><a accesskey="p" href="runtime-config-wal.html" title="19.5. ログ先行書き込み（WAL）">前へ</a> </td><td width="10%" align="left"><a accesskey="u" href="runtime-config.html" title="第19章 サーバの設定">上へ</a></td><td width="60%" align="center">19.6. レプリケーション</td><td width="20%" align="right"> <a accesskey="n" href="runtime-config-query.html" title="19.7. 問い合わせ計画">次へ</a></td></tr></table><hr /></div><div class="sect1" id="RUNTIME-CONFIG-REPLICATION"><div class="titlepage"><div><div><h2 class="title" style="clear: both">19.6. レプリケーション</h2></div></div></div><!--
    <title>Replication</title>
--><p>
<!--
     These settings control the behavior of the built-in
     <firstterm>streaming replication</firstterm> feature (see
     <xref linkend="streaming-replication"/>).  Servers will be either a
     master or a standby server.  Masters can send data, while standbys
     are always receivers of replicated data.  When cascading replication
     (see <xref linkend="cascading-replication"/>) is used, standby servers
     can also be senders, as well as receivers.
     Parameters are mainly for sending and standby servers, though some
     parameters have meaning only on the master server.  Settings may vary
     across the cluster without problems if that is required.
-->
これらの設定は組み込みの<em class="firstterm">ストリーミングレプリケーション</em>機能の動作を制御します（<a class="xref" href="warm-standby.html#STREAMING-REPLICATION" title="26.2.5. ストリーミングレプリケーション">26.2.5</a>を参照ください）。
サーバ群のサーバはマスターかスタンバイのいずれかです。マスターはデータを送出する一方、複数のスタンバイは複製されたデータを常に受け取ります。カスケードレプリケーション（<a class="xref" href="warm-standby.html#CASCADING-REPLICATION" title="26.2.7. カスケードレプリケーション">26.2.7</a>を参照）が使用されている場合、スタンバイサーバ群は受け取り手でもあり、送り手でもあります。
パラメータは主として送出サーバとスタンバイサーバ用ですが、いくつかのパラメータはマスターサーバのみに効力を発します。
必要とあればクラスタに渡って問題なく設定を変化させることができます。
    </p><div class="sect2" id="RUNTIME-CONFIG-REPLICATION-SENDER"><div class="titlepage"><div><div><h3 class="title">19.6.1. 送出サーバ群</h3></div></div></div><!--
     <title>Sending Servers</title>
--><p>
     <!--
      These parameters can be set on any server that is
      to send replication data to one or more standby servers.
      The master is always a sending server, so these parameters must
      always be set on the master.
      The role and meaning of these parameters does not change after a
      standby becomes the master.
      -->
      これらのパラメータはレプリケーションデータを１つ、またはそれ以上複数のスタンバイサーバに送るいかなるサーバ上で設定することができます。マスターは常に送出サーバであるため、パラメータは常にマスター上に設定されなければなりません。これらのパラメータの役割と意味はスタンバイが後にマスターに昇格しても変わりません。
     </p><div class="variablelist"><dl class="variablelist"><dt id="GUC-MAX-WAL-SENDERS"><span class="term"><code class="varname">max_wal_senders</code> (<code class="type">integer</code>)
       <a id="id-1.6.6.9.3.3.1.1.3" class="indexterm"></a>
       </span></dt><dd><p>
<!--
        Specifies the maximum number of concurrent connections from standby
        servers or streaming base backup clients (i.e., the maximum number of
        simultaneously running WAL sender processes). The default is
        <literal>10</literal>.  The value <literal>0</literal> means
        replication is disabled.  Abrupt streaming client disconnection might
        leave an orphaned connection slot behind until a timeout is reached,
        so this parameter should be set slightly higher than the maximum
        number of expected clients so disconnected clients can immediately
        reconnect.  This parameter can only be set at server start.  Also,
        <varname>wal_level</varname> must be set to
        <literal>replica</literal> or higher to allow connections from standby
        servers.
-->
複数のスタンバイサーバあるいは、ストリーミングを使ったベースバックアップクライアントからの同時接続を受ける接続最大値を設定します（つまり、同時に稼動するWAL送信プロセスの最大値です）。
デフォルトは<code class="literal">10</code>です。
<code class="literal">0</code>ならば、レプリケーションは無効であるという意味になります。
ストリーミングクライアントの突然の切断により、タイムアウトになるまで親のない接続スロットが残ることがあります。
ですから、このパラメータは想定されるクライアント数の最大値よりも少し大きめにして、切断されたクライアントが直ちに再接続できるようにした方が良いでしょう。
このパラメータはサーバ起動時のみ設定可能です。
また、スタンバイサーバからの接続を許可するには、<code class="varname">wal_level</code>を<code class="literal">replica</code>以上に設定しておかなければなりません。
       </p><p>
<!--
         When running a standby server, you must set this parameter to the
         same or higher value than on the master server. Otherwise, queries
         will not be allowed in the standby server.
-->
スタンバイサーバを実行する際は、このパラメータをマスタサーバと同じか高い値にしなければなりません。
さもなければ、スタンバイサーバでクエリを実行できなくなります。
        </p></dd><dt id="GUC-MAX-REPLICATION-SLOTS"><span class="term"><code class="varname">max_replication_slots</code> (<code class="type">integer</code>)
       <a id="id-1.6.6.9.3.3.2.1.3" class="indexterm"></a>
       </span></dt><dd><p>
<!--
         Specifies the maximum number of replication slots
         (see <xref linkend="streaming-replication-slots"/>) that the server
         can support. The default is 10.  This parameter can only be set at
         server start.
         Setting it to a lower value than the number of currently
         existing replication slots will prevent the server from starting.
         Also, <varname>wal_level</varname> must be set
         to <literal>replica</literal> or higher to allow replication slots to
         be used.
-->
サーバが使用できるレプリケーションスロット(<a class="xref" href="warm-standby.html#STREAMING-REPLICATION-SLOTS" title="26.2.6. レプリケーションスロット">26.2.6</a>参照)の最大数を指定します。
デフォルトは10です。
このパラメータはサーバ起動時のみ設定可能です。
現在存在しているレプリケーションスロットの数よりも少ない値を設定すると、サーバは起動しません。
また、レプリケーションスロットが使用できるためには、<code class="varname">wal_level</code>を<code class="literal">replica</code>以上に設定しなければなりません。
        </p></dd><dt id="GUC-WAL-KEEP-SEGMENTS"><span class="term"><code class="varname">wal_keep_segments</code> (<code class="type">integer</code>)
       <a id="id-1.6.6.9.3.3.3.1.3" class="indexterm"></a>
       </span></dt><dd><p>
       <!--
        Specifies the minimum number of past log file segments kept in the
        <filename>pg_wal</filename>
        directory, in case a standby server needs to fetch them for streaming
        replication. Each segment is normally 16 megabytes. If a standby
        server connected to the sending server falls behind by more than
        <varname>wal_keep_segments</varname> segments, the sending server might remove
        a WAL segment still needed by the standby, in which case the
        replication connection will be terminated.  Downstream connections
        will also eventually fail as a result.  (However, the standby
        server can recover by fetching the segment from archive, if WAL
        archiving is in use.)
       -->
ストリーミングレプリケーションにおいて、スタンバイサーバが過去のファイルセグメントを取得する必要がある場合に備え、<code class="filename">pg_wal</code>ディレクトリに保持しておくファイルセグメント数の最小値を指定します。
それぞれのセグメントは通常16メガバイトです。
もし送出サーバに接続しているスタンバイサーバが<code class="varname">wal_keep_segments</code>セグメントを越えて遅延した場合、送出サーバはスタンバイサーバが今後とも必要とするWALセグメントを削除する可能性があります。
この場合、レプリケーション接続は終了させられます。結果として下流に対する接続も結局は終了されることがあります。（しかし、WALアーカイブが使用されていれば、スタンバイサーバはアーカイブからセグメントを取り出し、復旧することができます。）
       </p><p>
       <!--
        This sets only the minimum number of segments retained in
        <filename>pg_wal</filename>; the system might need to retain more segments
        for WAL archival or to recover from a checkpoint. If
        <varname>wal_keep_segments</varname> is zero (the default), the system
        doesn't keep any extra segments for standby purposes, so the number
        of old WAL segments available to standby servers is a function of
        the location of the previous checkpoint and status of WAL
        archiving.
        This parameter can only be set in the
        <filename>postgresql.conf</filename> file or on the server command line.
       -->
<code class="filename">pg_wal</code>に保持され続けるセグメントの最小値のみを設定します。
システムはWALアーカイブのため、またはチェックポイントからの復旧のため、より多くのセグメント保持が必要となることがあります。
もし<code class="varname">wal_keep_segments</code>が（デフォルトの）ゼロの場合、システムはスタンバイサーバのために追加セグメントを保持することはしません。
従って、スタンバイサーバが使用できる古いWALセグメントの数は、直前のチェックポイントの場所とWALアーカイブの状況によって算出されます。
このパラメータは、<code class="filename">postgresql.conf</code>ファイル、もしくはサーバコマンドラインでのみ設定可能です。
       </p></dd><dt id="GUC-WAL-INIT-ZERO"><span class="term"><code class="varname">wal_init_zero</code> (<code class="type">boolean</code>)
      <a id="id-1.6.6.9.3.3.4.1.3" class="indexterm"></a>
      </span></dt><dd><p>
<!--
        If set to <literal>on</literal> (the default), this option causes new
        WAL files to be filled with zeroes.  On some file systems, this ensures
        that space is allocated before we need to write WAL records.  However,
        <firstterm>Copy-On-Write</firstterm> (COW) file systems may not benefit
        from this technique, so the option is given to skip the unnecessary
        work.  If set to <literal>off</literal>, only the final byte is written
        when the file is created so that it has the expected size.
-->
このオプションが<code class="literal">on</code>（デフォルト）に設定されると、新しいWALファイルはゼロで初期化されます。
システムによっては、このことによってWALレコードを書く必要が出てくる前にスペースが割り当てられることを保証します。
しかし、<em class="firstterm">Copy-On-Write</em> (COW)ファイルシステムではこの技術は利点がないかもしれず、このオプションはスキップできるようになっています。
<code class="literal">off</code>に設定すると、ファイルを作る時に期待する大きさになるように最後のバイトだけが書かれます。
       </p></dd><dt id="GUC-WAL-RECYCLE"><span class="term"><code class="varname">wal_recycle</code> (<code class="type">boolean</code>)
      <a id="id-1.6.6.9.3.3.5.1.3" class="indexterm"></a>
      </span></dt><dd><p>
<!--
        If set to <literal>on</literal> (the default), this option causes WAL
        files to be recycled by renaming them, avoiding the need to create new
        ones.  On COW file systems, it may be faster to create new ones, so the
        option is given to disable this behavior.
-->
このオプションが<code class="literal">on</code>（デフォルト）に設定されると、新しくファイルを作るのを避けるために、名前を変えてWALファイルが再利用されます。
COWファイルシステムでは、新しいファイルを作るほうが速いかも知れないので、この挙動を無効にできるようにオプションとなっています。
       </p></dd><dt id="GUC-WAL-SENDER-TIMEOUT"><span class="term"><code class="varname">wal_sender_timeout</code> (<code class="type">integer</code>)
      <a id="id-1.6.6.9.3.3.6.1.3" class="indexterm"></a>
      </span></dt><dd><p>
<!--
        Terminate replication connections that are inactive for longer
        than this amount of time. This is useful for
        the sending server to detect a standby crash or network outage.
        If this value is specified without units, it is taken as milliseconds.
        The default value is 60 seconds.
        A value of zero disables the timeout mechanism.
-->
指定された時間より長く非活動であるレプリケーション接続を停止します。
スタンバイサーバのクラッシュ、またはネットワークの停止を送出サーバが検出することにこれが役立ちます。
この値が単位なしで指定された場合は、ミリ秒単位であるとみなします。
デフォルトの値は60秒です。
値ゼロはこのタイムアウト機能を無効にします。
       </p><p>
<!--
        With a cluster distributed across multiple geographic
        locations, using different values per location brings more flexibility
        in the cluster management. A smaller value is useful for faster
        failure detection with a standby having a low-latency network
        connection, and a larger value helps in judging better the health
        of a standby if located on a remote location, with a high-latency
        network connection.
-->
地理的に複数の場所に分散したクラスタでは、場所によって異なる値を使うことでクラスタ管理がより柔軟にできるようになります。
より小さな値は低遅延ネットワーク接続上のスタンバイの障害検知をより高速にするのに役立ちます。
遅延の大きなネットワーク接続に設置されたスタンバイの健全性の判断にはより大きな値が助けになるでしょう。
       </p></dd><dt id="GUC-TRACK-COMMIT-TIMESTAMP"><span class="term"><code class="varname">track_commit_timestamp</code> (<code class="type">boolean</code>)
      <a id="id-1.6.6.9.3.3.7.1.3" class="indexterm"></a>
      </span></dt><dd><p>
<!--
        Record commit time of transactions. This parameter
        can only be set in <filename>postgresql.conf</filename> file or on the server
        command line. The default value is <literal>off</literal>.
-->
トランザクションのコミットタイムを記録します。
このパラメータは、<code class="filename">postgresql.conf</code>ファイル、もしくはサーバコマンドラインでのみ設定可能です。
デフォルトは<code class="literal">off</code>です。
       </p></dd></dl></div></div><div class="sect2" id="RUNTIME-CONFIG-REPLICATION-MASTER"><div class="titlepage"><div><div><h3 class="title">19.6.2. マスターサーバ</h3></div></div></div><!--
     <title>Master Server</title>
     --><p>
      <!--
      These parameters can be set on the master/primary server that is
      to send replication data to one or more standby servers.
      Note that in addition to these parameters,
      <xref linkend="guc-wal-level"/> must be set appropriately on the master
      server, and optionally WAL archiving can be enabled as
      well (see <xref linkend="runtime-config-wal-archiving"/>).
      The values of these parameters on standby servers are irrelevant,
      although you may wish to set them there in preparation for the
      possibility of a standby becoming the master.
      -->
      これらのパラメータはレプリケーションデータを１つ、またはそれ以上複数のスタンバイサーバに送るマスター/プライマリサーバ上で設定することができます。
      これらパラメータに加え、<a class="xref" href="runtime-config-wal.html#GUC-WAL-LEVEL">wal_level</a>はマスターサーバ上で適切に設定される必要があり、オプションとしてWALアーカイブを有効にしてもかまいません（<a class="xref" href="runtime-config-wal.html#RUNTIME-CONFIG-WAL-ARCHIVING" title="19.5.3. アーカイビング">19.5.3</a>を参照してください）。
      スタンバイサーバがマスターサーバになるかもしれない状況に備え、それらのパラメータをスタンバイサーバで設定したいと考えたとしても、スタンバイサーバ上でのパラメータの値は意味をなしません。
     </p><div class="variablelist"><dl class="variablelist"><dt id="GUC-SYNCHRONOUS-STANDBY-NAMES"><span class="term"><code class="varname">synchronous_standby_names</code> (<code class="type">string</code>)
      <a id="id-1.6.6.9.4.3.1.1.3" class="indexterm"></a>
      </span></dt><dd><p>
<!--
        Specifies a list of standby servers that can support
        <firstterm>synchronous replication</firstterm>, as described in
        <xref linkend="synchronous-replication"/>.
        There will be one or more active synchronous standbys;
        transactions waiting for commit will be allowed to proceed after
        these standby servers confirm receipt of their data.
        The synchronous standbys will be those whose names appear
        in this list, and
        that are both currently connected and streaming data in real-time
        (as shown by a state of <literal>streaming</literal> in the <link
        linkend="pg-stat-replication-view"><literal>pg_stat_replication</literal></link>
        view).
        Specifying more than one synchronous standby can allow for very high
        availability and protection against data loss.
       </para>
       -->
<a class="xref" href="warm-standby.html#SYNCHRONOUS-REPLICATION" title="26.2.8. 同期レプリケーション">26.2.8</a>で説明されているように、<em class="firstterm">同期レプリケーション</em>をサポート可能なスタンバイサーバのリストを指定します。
活動中の同期スタンバイサーバは1つまたはそれ以上です。
コミットを待機しているトランザクションは、このスタンバイサーバがそのデータの受信を確認してから処理の継続が許可されます。
同期スタンバイサーバはこのリストに名前が挙げられていており、現時点で接続され、そしてデータをリアルタイムでストリーミングしているものです（<a class="link" href="monitoring-stats.html#PG-STAT-REPLICATION-VIEW" title="表27.5 pg_stat_replicationビュー"><code class="literal">pg_stat_replication</code></a> ビューにおいて<code class="literal">streaming</code>状態として示されています）。
このリストの後の方に記載されているその他のスタンバイサーバは潜在的に同期スタンバイサーバになることを示しています。
二つ以上の同期スタンバイサーバ名を指定することで、かなりの高可用性とデータ損失に対する保護が得られます。
       </p><p>
<!--
        The name of a standby server for this purpose is the
        <varname>application_name</varname> setting of the standby, as set in the
        standby's connection information.  In case of a physical replication
        standby, this should be set in the <varname>primary_conninfo</varname>
        setting; the default is the setting of <xref linkend="guc-cluster-name"/>
        if set, else <literal>walreceiver</literal>.
        For logical replication, this can be set in the connection
        information of the subscription, and it defaults to the
        subscription name.  For other replication stream consumers,
        consult their documentation.
-->
この目的のためのスタンバイサーバ名は、スタンバイの接続情報で指定された、スタンバイの<code class="varname">application_name</code>設定です。
物理レプリケーションスタンバイでは、<code class="varname">primary_conninfo</code>設定です。
デフォルトは<a class="xref" href="runtime-config-logging.html#GUC-CLUSTER-NAME">cluster_name</a>の設定で、さもなければ<code class="literal">walreceiver</code>です。
論理レプリケーションでは、サブスクリプションの接続情報で設定でき、デフォルトはサブスクリプション名です。
それ以外のレプリケーションストリームコンシューマーについては、それぞれのドキュメントをご覧ください。
       </p><p>
<!--
        This parameter specifies a list of standby servers using
        either of the following syntaxes:
-->
このパラメータは、以下の構文のいずれかを用いてスタンバイサーバのリストを指定します。
</p><pre class="synopsis">
[FIRST] <em class="replaceable"><code>num_sync</code></em> ( <em class="replaceable"><code>standby_name</code></em> [, ...] )
ANY <em class="replaceable"><code>num_sync</code></em> ( <em class="replaceable"><code>standby_name</code></em> [, ...] )
<em class="replaceable"><code>standby_name</code></em> [, ...]
</pre><p>
<!--
        where <replaceable class="parameter">num_sync</replaceable> is
        the number of synchronous standbys that transactions need to
        wait for replies from,
        and <replaceable class="parameter">standby_name</replaceable>
        is the name of a standby server.
        <literal>FIRST</literal> and <literal>ANY</literal> specify the method to choose
        synchronous standbys from the listed servers.
-->
ここで、<em class="replaceable"><code>num_sync</code></em>は、トランザクションが応答を待機する必要のある同期スタンバイの数です。
<em class="replaceable"><code>standby_name</code></em>は、スタンバイサーバの名前です。
<code class="literal">FIRST</code>と<code class="literal">ANY</code>は、リスト中のサーバーから同期スタンバイを選ぶ方法を指定します。
       </p><p>
<!--
        The keyword <literal>FIRST</literal>, coupled with
        <replaceable class="parameter">num_sync</replaceable>, specifies a
        priority-based synchronous replication and makes transaction commits
        wait until their WAL records are replicated to
        <replaceable class="parameter">num_sync</replaceable> synchronous
        standbys chosen based on their priorities. For example, a setting of
        <literal>FIRST 3 (s1, s2, s3, s4)</literal> will cause each commit to wait for
        replies from three higher-priority standbys chosen from standby servers
        <literal>s1</literal>, <literal>s2</literal>, <literal>s3</literal> and <literal>s4</literal>.
        The standbys whose names appear earlier in the list are given higher
        priority and will be considered as synchronous. Other standby servers
        appearing later in this list represent potential synchronous standbys.
        If any of the current synchronous standbys disconnects for whatever
        reason, it will be replaced immediately with the next-highest-priority
        standby. The keyword <literal>FIRST</literal> is optional.
-->
キーワード<code class="literal">FIRST</code>を<em class="replaceable"><code>num_sync</code></em>と組み合わせると、優先度に基づく同期レプリケーションを指定し、優先度に基づいて選ばれた<em class="replaceable"><code>num_sync</code></em>個の同期スタンバイにWALレコードがレプリケーションされるまで、トランザクションのコミットは待機します。
たとえば<code class="literal">FIRST 3 (s1, s2, s3, s4)</code>とすると、<code class="literal">s1</code>、<code class="literal">s2</code>、<code class="literal">s3</code>、<code class="literal">s4</code>の中から選ばれた優先順位の高い3つのスタンバイサーバが応答を返すまでコミットは待機します。
リストの中で前の方に名前が出現するスタンバイには高い優先度が与えられ、同期と見なされます。
それ以外のリストの中で後の方に名前が上がっているスタンバイサーバーは、潜在的な同期スタンバイであることを表しています。
どんな理由であれ、現在の同期スタンバイが切断されると、次に高い優先度を持つスタンバイに直ちに取って代わられます。
キーワード<code class="literal">FIRST</code>はオプションです。
       </p><p>
<!--
        The keyword <literal>ANY</literal>, coupled with
        <replaceable class="parameter">num_sync</replaceable>, specifies a
        quorum-based synchronous replication and makes transaction commits
        wait until their WAL records are replicated to <emphasis>at least</emphasis>
        <replaceable class="parameter">num_sync</replaceable> listed standbys.
        For example, a setting of <literal>ANY 3 (s1, s2, s3, s4)</literal> will cause
        each commit to proceed as soon as at least any three standbys of
        <literal>s1</literal>, <literal>s2</literal>, <literal>s3</literal> and <literal>s4</literal>
        reply.
-->
キーワード<code class="literal">ANY</code>を<em class="replaceable"><code>num_sync</code></em>と組み合わせると、クォーラムに基づく同期レプリケーションを指定し、列挙されたスタンバイのうち<span class="emphasis"><em>少なくとも</em></span><em class="replaceable"><code>num_sync</code></em>個の同期スタンバイにWALレコードがレプリケーションされるまで、トランザクションのコミットを待たせます。
たとえば<code class="literal">ANY 3 (s1, s2, s3, s4)</code>とすると、<code class="literal">s1</code>、<code class="literal">s2</code>、<code class="literal">s3</code>、<code class="literal">s4</code>のうちの少なくとも3つが応答を返した時点でコミットが進行します。
       </p><p>
<!--
        <literal>FIRST</literal> and <literal>ANY</literal> are case-insensitive. If these
        keywords are used as the name of a standby server,
        its <replaceable class="parameter">standby_name</replaceable> must
        be double-quoted.
-->
<code class="literal">FIRST</code>と<code class="literal">ANY</code>は、大文字小文字を区別しません。
もしこれらのキーワードをスタンバイサーバの名前に使う場合は、<em class="replaceable"><code>standby_name</code></em>は二重引用符で囲わなければなりません。
       </p><p>
<!--
        The third syntax was used before <productname>PostgreSQL</productname>
        version 9.6 and is still supported. It's the same as the first syntax
        with <literal>FIRST</literal> and
        <replaceable class="parameter">num_sync</replaceable> equal to 1.
        For example, <literal>FIRST 1 (s1, s2)</literal> and <literal>s1, s2</literal> have
        the same meaning: either <literal>s1</literal> or <literal>s2</literal> is chosen
        as a synchronous standby.
-->
3番目の構文は、<span class="productname">PostgreSQL</span>9.6よりも前のバージョンで用いられていたもので、依然としてサポートされています。
最初の構文で、<code class="literal">FIRST</code>、<em class="replaceable"><code>num_sync</code></em>を1とした時と同じです。
たとえば、<code class="literal">FIRST 1 (s1, s2)</code>と<code class="literal">s1, s2</code>は同じ意味です。
<code class="literal">s1</code>か<code class="literal">s2</code>が同期スタンバイとして選ばれます。
       </p><p>
<!--
        The special entry <literal>*</literal> matches any standby name.
-->
特別なエントリ<code class="literal">*</code>は、すべてのスタンバイ名に一致します。
       </p><p>
<!--
        There is no mechanism to enforce uniqueness of standby names.  In case
        of duplicates one of the matching standbys will be considered as
        higher priority, though exactly which one is indeterminate.
-->
スタンバイの一意性を強要する仕組みはありません。
重複があった場合、一致したスタンバイは優先順位が高いと見なされますが、どれが選ばれるかは非決定的です。
       </p><div class="note"><h3 class="title">注記</h3><p>
<!--
         Each <replaceable class="parameter">standby_name</replaceable>
         should have the form of a valid SQL identifier, unless it
         is <literal>*</literal>.  You can use double-quoting if necessary.  But note
         that <replaceable class="parameter">standby_name</replaceable>s are
         compared to standby application names case-insensitively, whether
         double-quoted or not.
-->
各々の<em class="replaceable"><code>standby_name</code></em>は、<code class="literal">*</code>である場合を除き、SQL識別子の形式を取らなければなりません。
二重引用符を用いることもできます。
しかし、二重引用符の有無に関わらず、<em class="replaceable"><code>standby_name</code></em>とスタンバイのアプリケーション名の比較は、大文字小文字の区別なしに行われることに注意してください。
        </p></div><p>
       <!--
        If no synchronous standby names are specified here, then synchronous
        replication is not enabled and transaction commits will not wait for
        replication.  This is the default configuration.  Even when
        synchronous replication is enabled, individual transactions can be
        configured not to wait for replication by setting the
        <xref linkend="guc-synchronous-commit"/> parameter to
        <literal>local</literal> or <literal>off</literal>.
       -->
       ここに同期スタンバイ名が指定されていない場合、同期レプリケーションは有効とはならず、トランザクションコミットはレプリケーションを待機しません。これがデフォルトの設定です。同期レプリケーションが有効であっても、<a class="xref" href="runtime-config-wal.html#GUC-SYNCHRONOUS-COMMIT">synchronous_commit</a>パラメータを<code class="literal">local</code> または <code class="literal">off</code>に設定することにより、個別のトランザクションをレプリケーションに対して待機しないように設定できます。
       </p><p>
       <!--
        This parameter can only be set in the <filename>postgresql.conf</filename>
        file or on the server command line.
       -->
       このパラメータは、<code class="filename">postgresql.conf</code>ファイル、もしくはサーバコマンドラインでのみ設定可能です。
       </p></dd><dt id="GUC-VACUUM-DEFER-CLEANUP-AGE"><span class="term"><code class="varname">vacuum_defer_cleanup_age</code> (<code class="type">integer</code>)
      <a id="id-1.6.6.9.4.3.2.1.3" class="indexterm"></a>
      </span></dt><dd><p>
       <!--
        Specifies the number of transactions by which <command>VACUUM</command> and
        <acronym>HOT</acronym> updates will defer cleanup of dead row versions. The
        default is zero transactions, meaning that dead row versions can be
        removed as soon as possible, that is, as soon as they are no longer
        visible to any open transaction.  You may wish to set this to a
        non-zero value on a primary server that is supporting hot standby
        servers, as described in <xref linkend="hot-standby"/>.  This allows
        more time for queries on the standby to complete without incurring
        conflicts due to early cleanup of rows.  However, since the value
        is measured in terms of number of write transactions occurring on the
        primary server, it is difficult to predict just how much additional
        grace time will be made available to standby queries.
        This parameter can only be set in the <filename>postgresql.conf</filename>
        file or on the server command line.
       -->
<code class="command">VACUUM</code> および <acronym class="acronym">HOT</acronym>更新が不要行バージョンの回収を決めるのを延期するトランザクションの数を指定します。
デフォルトはゼロトランザクションで、つまり、開いている全てのトランザクションから不可視になった不要行バージョンは速やかに削除されうることを意味します。
<a class="xref" href="hot-standby.html" title="26.5. ホットスタンバイ">26.5</a>に記載されているように、ホットスタンバイサーバをサポートしている場合、プライマリサーバ上で非ゼロ値に設定したい場合があります。
そうすることで、スタンバイ上での問い合わせが、行の早期回収によるコンフリクトを被ることなく完了するように時間を与えます。
しかし、値はプライマリーサーバ上で発生している書き込みトランザクションの観点から計測されるため、スタンバイの問い合わせにたいして猶予時間がどのくらい有効となるかは予測できません。
このパラメータは、<code class="filename">postgresql.conf</code>ファイル、もしくはサーバコマンドラインでのみ設定可能です。
       </p><p>
       <!--
        You should also consider setting <varname>hot_standby_feedback</varname>
        on standby server(s) as an alternative to using this parameter.
       -->
このパラメータを使う代わりにスタンバイサーバ上に <code class="varname">hot_standby_feedback</code>の設定を考慮する必要もあります。
       </p><p>
<!--
        This does not prevent cleanup of dead rows which have reached the age
        specified by <varname>old_snapshot_threshold</varname>.
-->
<code class="varname">old_snapshot_threshold</code>で指定された年齢に達した無効行のクリーンアップを妨げることはありません。
       </p></dd></dl></div></div><div class="sect2" id="RUNTIME-CONFIG-REPLICATION-STANDBY"><div class="titlepage"><div><div><h3 class="title">19.6.3. スタンバイサーバ</h3></div></div></div><!--
     <title>Standby Servers</title>
    --><p>
     <!--
      These settings control the behavior of a standby server that is
      to receive replication data.  Their values on the master server
      are irrelevant.
      -->
      これらの設定はレプリケーションデータを受け取るスタンバイサーバの動作を管理します。
      マスターサーバ上のこれらの値は無意味です。
     </p><div class="variablelist"><dl class="variablelist"><dt id="GUC-PRIMARY-CONNINFO"><span class="term"><code class="varname">primary_conninfo</code> (<code class="type">string</code>)
        <a id="id-1.6.6.9.5.3.1.1.3" class="indexterm"></a>
        </span></dt><dd><p>
<!--
          Specifies a connection string to be used for the standby server
          to connect with a sending server. This string is in the format
          described in <xref linkend="libpq-connstring"/>. If any option is
          unspecified in this string, then the corresponding environment
          variable (see <xref linkend="libpq-envars"/>) is checked. If the
          environment variable is not set either, then
          defaults are used.
-->
スタンバイサーバが送信サーバに接続するための接続文字列を指定します。
この文字列は、<a class="xref" href="libpq-connect.html#LIBPQ-CONNSTRING" title="33.1.1. 接続文字列">33.1.1</a>で説明されている書式で記述されます。
この文字列に何のオプションも指定されていない場合、これに対応する環境変数 (<a class="xref" href="libpq-envars.html" title="33.14. 環境変数">33.14</a> 参照) が確認されます。
環境変数も設定されていなければデフォルトの値が使われます。
         </p><p>
<!--
          The connection string should specify the host name (or address)
          of the sending server, as well as the port number if it is not
          the same as the standby server's default.
          Also specify a user name corresponding to a suitably-privileged role
          on the sending server (see
          <xref linkend="streaming-replication-authentication"/>).
          A password needs to be provided too, if the sender demands password
          authentication.  It can be provided in the
          <varname>primary_conninfo</varname> string, or in a separate
          <filename>~/.pgpass</filename> file on the standby server (use
          <literal>replication</literal> as the database name).
          Do not specify a database name in the
          <varname>primary_conninfo</varname> string.
-->
接続文字列では、プライマリサーバのホスト名（またはアドレス）、スタンバイサーバのデフォルトと異なるのであればポート番号も指定する必要があります。
また、送信サーバ上で適切な権限を保有するロールのユーザを指定しなければなりません (<a class="xref" href="warm-standby.html#STREAMING-REPLICATION-AUTHENTICATION" title="26.2.5.1. 認証">26.2.5.1</a> 参照)。
送信サーバが要求するのであれば、パスワードも記述される必要があります。
パスワードは <code class="varname">primary_conninfo</code>に記述することもできますし、スタンバイサーバ上の分離されたファイル<code class="filename">~/.pgpass</code>に記述することもできます (データベース名には <code class="literal">replication</code> を使います)。
<code class="varname">primary_conninfo</code>文字列の中には、データベース名を指定しないでください。
         </p><p>
<!--
          This parameter can only be set at server start.
          This setting has no effect if the server is not in standby mode.
-->
このパラメータはサーバ起動時のみ設定可能です。
サーバがスタンバイモードでなければこの設定は無効となります。
         </p></dd><dt id="GUC-PRIMARY-SLOT-NAME"><span class="term"><code class="varname">primary_slot_name</code> (<code class="type">string</code>)
        <a id="id-1.6.6.9.5.3.2.1.3" class="indexterm"></a>
        </span></dt><dd><p>
<!--
          Optionally specifies an existing replication slot to be used when
          connecting to the sending server via streaming replication to control
          resource removal on the upstream node
          (see <xref linkend="streaming-replication-slots"/>).
          This parameter can only be set at server start.
          This setting has no effect if <varname>primary_conninfo</varname> is not
          set.
-->
上流ノードのリソース削除を制御するためにストリーミングレプリケーション経由でプライマリに接続した場合、既存のレプリケーションスロットを使うように、必要に応じて指定します（<a class="xref" href="warm-standby.html#STREAMING-REPLICATION-SLOTS" title="26.2.6. レプリケーションスロット">26.2.6</a>を参照）。
このパラメータはサーバ起動時のみ設定可能です。
<code class="varname">primary_conninfo</code>が設定されていない場合、この設定は無効です。
         </p></dd><dt id="GUC-PROMOTE-TRIGGER-FILE"><span class="term"><code class="varname">promote_trigger_file</code> (<code class="type">string</code>)
        <a id="id-1.6.6.9.5.3.3.1.3" class="indexterm"></a>
        </span></dt><dd><p>
<!--
          Specifies a trigger file whose presence ends recovery in the
          standby.  Even if this value is not set, you can still promote
          the standby using <command>pg_ctl promote</command> or calling
          <function>pg_promote</function>.
          This parameter can only be set in the <filename>postgresql.conf</filename>
          file or on the server command line.
-->
スタンバイサーバにおいて、リカバリの完了を示すトリガファイルを指定します。
この値が設定されていなくても、<code class="command">pg_ctl promote</code>あるいは<code class="function">pg_promote</code>を使ってスタンバイサーバを昇格させることができます。
このパラメータは、<code class="filename">postgresql.conf</code>ファイル、もしくはサーバコマンドラインでのみ設定可能です。
         </p></dd><dt id="GUC-HOT-STANDBY"><span class="term"><code class="varname">hot_standby</code> (<code class="type">boolean</code>)
      <a id="id-1.6.6.9.5.3.4.1.3" class="indexterm"></a>
      </span></dt><dd><p>
       <!--
        Specifies whether or not you can connect and run queries during
        recovery, as described in <xref linkend="hot-standby"/>.
        The default value is <literal>on</literal>.
        This parameter can only be set at server start. It only has effect
        during archive recovery or in standby mode.
       -->
       <a class="xref" href="hot-standby.html" title="26.5. ホットスタンバイ">26.5</a>に記載されている通り、リカバリの最中に接続し、そして問い合わせを実行できるか否かを設定します。デフォルト値は<code class="literal">on</code>です。
       このパラメータはサーバ起動時のみ設定可能です。これは、アーカイブリカバリ期間、又はスタンバイモードにある場合にのみ効果をもたらします。
       </p></dd><dt id="GUC-MAX-STANDBY-ARCHIVE-DELAY"><span class="term"><code class="varname">max_standby_archive_delay</code> (<code class="type">integer</code>)
      <a id="id-1.6.6.9.5.3.5.1.3" class="indexterm"></a>
      </span></dt><dd><p>
       <!--
        When Hot Standby is active, this parameter determines how long the
        standby server should wait before canceling standby queries that
        conflict with about-to-be-applied WAL entries, as described in
        <xref linkend="hot-standby-conflict"/>.
        <varname>max_standby_archive_delay</varname> applies when WAL data is
        being read from WAL archive (and is therefore not current).
        If this value is specified without units, it is taken as milliseconds.
        The default is 30 seconds.
        A value of -1 allows the standby to wait forever for conflicting
        queries to complete.
        This parameter can only be set in the <filename>postgresql.conf</filename>
        file or on the server command line.
       -->
ホットスタンバイが稼動している場合、このパラメータは<a class="xref" href="hot-standby.html#HOT-STANDBY-CONFLICT" title="26.5.2. 問い合わせコンフリクトの処理">26.5.2</a>で記載されているように、まさに適用されようとしているWALエントリと衝突するスタンバイサーバの問い合わせをキャンセルするにはどれだけ待機しなければならないかを設定します。
<code class="varname">max_standby_archive_delay</code>はWALデータをWALアーカイブ（すなわち最新ではありません）から読み込んでいる時に適用されます。
この値が単位なしで指定された場合は、ミリ秒単位であるとみなします。
デフォルトは30秒です。
値-1は衝突する問い合わせが完了するまでスタンバイサーバが待ち続けられるようにします。
このパラメータは、<code class="filename">postgresql.conf</code>ファイル、もしくはサーバコマンドラインでのみ設定可能です。
       </p><p>
       <!--
        Note that <varname>max_standby_archive_delay</varname> is not the same as the
        maximum length of time a query can run before cancellation; rather it
        is the maximum total time allowed to apply any one WAL segment's data.
        Thus, if one query has resulted in significant delay earlier in the
        WAL segment, subsequent conflicting queries will have much less grace
        time.
       -->
<code class="varname">max_standby_archive_delay</code>はキャンセル前に問い合わせが実行できる最大の時間の長さと同じでないことに注意してください。
むしろ、任意の１つのWALセグメントのデータの適用のために許される最大合計時間です。
従って、ある問い合わせによりWALセグメント内の前の部分で大幅な遅延となった場合、その後の衝突する問い合わせの猶予時間はずっと短くなります。
       </p></dd><dt id="GUC-MAX-STANDBY-STREAMING-DELAY"><span class="term"><code class="varname">max_standby_streaming_delay</code> (<code class="type">integer</code>)
      <a id="id-1.6.6.9.5.3.6.1.3" class="indexterm"></a>
      </span></dt><dd><p>
       <!--
        When Hot Standby is active, this parameter determines how long the
        standby server should wait before canceling standby queries that
        conflict with about-to-be-applied WAL entries, as described in
        <xref linkend="hot-standby-conflict"/>.
        <varname>max_standby_streaming_delay</varname> applies when WAL data is
        being received via streaming replication.
        If this value is specified without units, it is taken as milliseconds.
        The default is 30 seconds.
        A value of -1 allows the standby to wait forever for conflicting
        queries to complete.
        This parameter can only be set in the <filename>postgresql.conf</filename>
        file or on the server command line.
       -->
ホットスタンバイが稼動している場合、このパラメータは<a class="xref" href="hot-standby.html#HOT-STANDBY-CONFLICT" title="26.5.2. 問い合わせコンフリクトの処理">26.5.2</a>で記載されているように、まさに適用されようとしているWALエントリと衝突するスタンバイサーバの問い合わせをキャンセルするにはどれだけ待機しなければならないかを設定します。
<code class="varname">max_standby_streaming_delay</code>はWALデータをストリーミングレプリケーションから受け取っている時に適用されます。
特に指定が無ければ単位はミリ秒です。
デフォルトは30秒です。
値-1は衝突する問い合わせが完了するまでスタンバイサーバが待ち続けられるようにします。
このパラメータは、<code class="filename">postgresql.conf</code>ファイル、もしくはサーバコマンドラインでのみ設定可能です。
       </p><p>
       <!--
        Note that <varname>max_standby_streaming_delay</varname> is not the same as
        the maximum length of time a query can run before cancellation; rather
        it is the maximum total time allowed to apply WAL data once it has
        been received from the primary server.  Thus, if one query has
        resulted in significant delay, subsequent conflicting queries will
        have much less grace time until the standby server has caught up
        again.
       -->
<code class="varname">max_standby_streaming_delay</code>はキャンセル前に問い合わせが実行できる最大の時間の長さと同じでないことに注意してください。
むしろ、プライマリサーバから一度受け取られたWALデータを適用するために許される最大合計時間です。
従って、ある問い合わせが大幅な遅延を起こした場合、その後の衝突する問い合わせは、スタンバイサーバがふたたび遅れを取り戻すまでの間、猶予時間はずっと短くなります。
       </p></dd><dt id="GUC-WAL-RECEIVER-STATUS-INTERVAL"><span class="term"><code class="varname">wal_receiver_status_interval</code> (<code class="type">integer</code>)
      <a id="id-1.6.6.9.5.3.7.1.3" class="indexterm"></a>
      </span></dt><dd><p>
      <!--
       Specifies the minimum frequency for the WAL receiver
       process on the standby to send information about replication progress
       to the primary or upstream standby, where it can be seen using the
       <link
       linkend="pg-stat-replication-view"><literal>pg_stat_replication</literal></link>
       view.  The standby will report
       the last write-ahead log location it has written, the last position it
       has flushed to disk, and the last position it has applied.
       This parameter's
       value is the maximum amount of time between reports.  Updates are
       sent each time the write or flush positions change, or at least as
       often as specified by this parameter.  Thus, the apply position may
       lag slightly behind the true position.
       If this value is specified without units, it is taken as seconds.
       The default value is 10 seconds.
       Setting this parameter to zero disables status updates completely.
       This parameter can only be set in
       the <filename>postgresql.conf</filename> file or on the server
       command line.
       -->
スタンバイサーバ上のWAL受信プロセスがプライマリー、または上位サーバに対してレプリケーションの進捗情報を送信する最小頻度を指定します。
送信された進捗情報は<a class="link" href="monitoring-stats.html#PG-STAT-REPLICATION-VIEW" title="表27.5 pg_stat_replicationビュー"><code class="literal">pg_stat_replication</code></a>ビューにより確認することが可能です。
スタンバイサーバは書き込みがされた直近の先行書き込みログ位置、ディスクにフラッシュされた直近のログ位置、およびリカバリ適用された直近のログ位置を報告します。
このパラメータの値がそれぞれの報告間における最大の時間間隔です。
書き込み、またはフラッシュ位置が変更される毎、あるいは最低でもこのパラメータで設定された頻度で更新情報が送信されます。
従って、適用位置は真の位置よりも少し後ろにずれることがあります。
この値が単位なしで指定された場合は、秒単位であるとみなします。
デフォルトの値は10秒です。
このパラメータをゼロに設定すると、ステータスの更新を完全に無効化します。
このパラメータは、<code class="filename">postgresql.conf</code>ファイル、もしくはサーバコマンドラインでのみ設定可能です。
      </p></dd><dt id="GUC-HOT-STANDBY-FEEDBACK"><span class="term"><code class="varname">hot_standby_feedback</code> (<code class="type">boolean</code>)
      <a id="id-1.6.6.9.5.3.8.1.3" class="indexterm"></a>
      </span></dt><dd><p>
       <!--
        Specifies whether or not a hot standby will send feedback to the primary
        or upstream standby
        about queries currently executing on the standby. This parameter can
        be used to eliminate query cancels caused by cleanup records, but
        can cause database bloat on the primary for some workloads.
        Feedback messages will not be sent more frequently than once per
        <varname>wal_receiver_status_interval</varname>. The default value is
        <literal>off</literal>. This parameter can only be set in the
        <filename>postgresql.conf</filename> file or on the server command line.
       -->
       ホットスタンバイがスタンバイサーバ上で現在処理を行っている問い合わせについて、プライマリーまたは上位サーバにフィードバックを送るか否かを指定します。
       このパラメータはレコードの回収に起因する問い合わせの取り消しを排除するために使用することができます。
       しかし、いくつかのワークロードに対してはプライマリーサーバ上でのデータベース肥大の原因となります。
       フィードバックメッセージは<code class="varname">wal_receiver_status_interval</code>毎に、2回以上送信されません。
       デフォルトの値は<code class="literal">off</code>です。
        このパラメータは、<code class="filename">postgresql.conf</code>ファイル、もしくはサーバコマンドラインでのみ設定可能です。
       </p><p>
       <!--
        If cascaded replication is in use the feedback is passed upstream
        until it eventually reaches the primary.  Standbys make no other use
        of feedback they receive other than to pass upstream.
       -->
       カスケードレプリケーションが使用されている場合、フィードバックは最終的にプライマリーに到達するまで上位サーバに転送されます。スタンバイは上位に転送する以外、受け取ったフィードバックを他に使用しません。
       </p><p>
<!--
        This setting does not override the behavior of
        <varname>old_snapshot_threshold</varname> on the primary; a snapshot on the
        standby which exceeds the primary's age threshold can become invalid,
        resulting in cancellation of transactions on the standby.  This is
        because <varname>old_snapshot_threshold</varname> is intended to provide an
        absolute limit on the time which dead rows can contribute to bloat,
        which would otherwise be violated because of the configuration of a
        standby.
-->
この設定は、プライマリの<code class="varname">old_snapshot_threshold</code>の挙動を上書きしません。
プライマリの年齢上限を超えたスタンバイ上のスナップショットは無効となる可能性があり、その場合スタンバイにおいてトランザクションのキャンセルを引き起こします。
これは、<code class="varname">old_snapshot_threshold</code>が、無効行によってデータ溢れが起こる時刻の絶対的な制限を提供することを意図しているからです。
そうでなければ、スタンバイの設定によってこの目的は成立しなくなってしまいます。
       </p></dd><dt id="GUC-WAL-RECEIVER-TIMEOUT"><span class="term"><code class="varname">wal_receiver_timeout</code> (<code class="type">integer</code>)
      <a id="id-1.6.6.9.5.3.9.1.3" class="indexterm"></a>
      </span></dt><dd><p>
       <!--
        Terminate replication connections that are inactive for longer
        than this amount of time. This is useful for
        the receiving standby server to detect a primary node crash or network
        outage.
        If this value is specified without units, it is taken as milliseconds.
        The default value is 60 seconds.
        A value of zero disables the timeout mechanism.
        This parameter can only be set in
        the <filename>postgresql.conf</filename> file or on the server
        command line.
       -->
指定された時間より長い間、活動していないレプリケーション接続は停止します。
このことは受信するスタンバイサーバがプライマリノードの機能停止、またはネットワーク停止を検出するのに便利です。
この値が単位なしで指定された場合は、ミリ秒単位であるとみなします。
デフォルト値は60秒です。
値ゼロは時間切れメカニズムを無効にします。
このパラメータは<code class="filename">postgresql.conf</code>ファイルまたはサーバのコマンドラインのみで設定可能です。
       </p></dd><dt id="GUC-WAL-RETRIEVE-RETRY-INTERVAL"><span class="term"><code class="varname">wal_retrieve_retry_interval</code> (<code class="type">integer</code>)
      <a id="id-1.6.6.9.5.3.10.1.3" class="indexterm"></a>
      </span></dt><dd><p>
<!--
        Specifies how long the standby server should wait when WAL data is not
        available from any sources (streaming replication,
        local <filename>pg_wal</filename> or WAL archive) before trying
        again to retrieve WAL data.
        If this value is specified without units, it is taken as milliseconds.
        The default value is 5 seconds.
        This parameter can only be set in
        the <filename>postgresql.conf</filename> file or on the server
        command line.
-->
WALデータがソース(ストリーミングレプリケーション、ローカルの<code class="filename">pg_wal</code>、またはWALアーカイブ)から取得できない時に、スタンバイサーバがWALデータ受信をリトライするまでにどの位の時間待つべきかを指定します。
このパラメータは、<code class="filename">postgresql.conf</code>ファイル、もしくはサーバコマンドラインでのみ設定可能です。
この値が単位なしで指定された場合は、ミリ秒単位であるとみなします。
デフォルト値は5秒です。
このパラメータは、<code class="filename">postgresql.conf</code>ファイルで設定するか、サーバのコマンドラインでのみ指定できます。
       </p><p>
<!--
        This parameter is useful in configurations where a node in recovery
        needs to control the amount of time to wait for new WAL data to be
        available. For example, in archive recovery, it is possible to
        make the recovery more responsive in the detection of a new WAL
        log file by reducing the value of this parameter. On a system with
        low WAL activity, increasing it reduces the amount of requests necessary
        to access WAL archives, something useful for example in cloud
        environments where the amount of times an infrastructure is accessed
        is taken into account.
-->
このパラメータは、リカバリ対象のノードにおいて、新しいWALデータが読み込み可能になるまでの待ち時間を制御する必要のある時に有用です。
たとえば、アーカイブリカバリにおいては、このパラメータの値を小さくすることにより、新しいWALログファイルを検出する際にリカバリの応答を早くすることができます。
WALの生成頻度が少ないシステムでは、この値を大きくすることにより、WALアーカイブへのアクセス頻度を減らすことができます。
これは、たとえば基盤へのアクセス回数が課金対象になるクラウド環境において、有用です。
       </p></dd><dt id="GUC-RECOVERY-MIN-APPLY-DELAY"><span class="term"><code class="varname">recovery_min_apply_delay</code> (<code class="type">integer</code>)
      <a id="id-1.6.6.9.5.3.11.1.3" class="indexterm"></a>
      </span></dt><dd><p>
<!--
        By default, a standby server restores WAL records from the
        sending server as soon as possible. It may be useful to have a time-delayed
        copy of the data, offering opportunities to correct data loss errors.
        This parameter allows you to delay recovery by a specified amount
        of time.  For example, if
        you set this parameter to <literal>5min</literal>, the standby will
        replay each transaction commit only when the system time on the standby
        is at least five minutes past the commit time reported by the master.
        If this value is specified without units, it is taken as milliseconds.
        The default is zero, adding no delay.
-->
デフォルトでは、スタンバイサーバは可能な限り早くプライマリからWALレコードをリストアします。
時間遅れのデータのコピーを持つことで、データ損失エラーを修正する機会を提供するのは有用かもしれません。
このパラメータを使う事で、決まった時間だけリカバリを遅らせることができます。
例えば、パラメータに<code class="literal">5min</code>と指定した場合、各トランザクションについて、スタンバイのシステム時刻が、マスターから報告されたコミット時刻より5分以上経過している場合のみ、スタンバイサーバはコミットを再生します。
単位を指定しない場合、ミリ秒として扱われます。
デフォルトは0で、遅延を与えません。
       </p><p>
<!--
        It is possible that the replication delay between servers exceeds the
        value of this parameter, in which case no delay is added.
        Note that the delay is calculated between the WAL time stamp as written
        on master and the current time on the standby. Delays in transfer
        because of network lag or cascading replication configurations
        may reduce the actual wait time significantly. If the system
        clocks on master and standby are not synchronized, this may lead to
        recovery applying records earlier than expected; but that is not a
        major issue because useful settings of this parameter are much larger
        than typical time deviations between servers.
-->
サーバ間のレプリケーション遅延はパラメータの値を上回る可能性があり、その場合には遅延は追加されません。
遅延は、マスタサーバで書かれたWALのタイムスタンプと、スタンバイサーバの現在時刻を使って計算されていることに注意してください。
ネットワークの遅延やカスケーディングレプリケーション構成によるデータ転送の遅延は、実際の待ち時間を大幅に減らすかもしれません。
もし、マスタサーバとスタンバイサーバのシステムクロックが同期されていない場合、期待値よりも早くレコードのリカバリを始めるかもしれません。
しかし、このパラメータの有用な設定値は典型的なサーバ間の時間のずれよりもずっと大きいので、それらは大きな問題ではありません。
       </p><p>
<!--
        The delay occurs only on WAL records for transaction commits.
        Other records are replayed as quickly as possible, which
        is not a problem because MVCC visibility rules ensure their effects
        are not visible until the corresponding commit record is applied.
-->
遅延はトランザクションコミットのWALレコードだけで発生します。
他のレコードは可能な限り早く再生されるでしょう。
対応する（トランザクション）コミットレコードが適用されるまではその効果が不可視であることがMVCCの可視ルールによって保証されているため、他のレコードが可能な限り早く再生されることは問題にはなりません。
       </p><p>
<!--
        The delay occurs once the database in recovery has reached a consistent
        state, until the standby is promoted or triggered. After that the standby
        will end recovery without further waiting.
-->
ひとたびリカバリ中のデータベースが整合性のとれた状態になれば、スタンバイサーバが昇格またはトリガーになるまで、遅延が発生します。
その後、スタンバイサーバはそれ以上待たずにリカバリを終了します。
       </p><p>
<!--
        This parameter is intended for use with streaming replication deployments;
        however, if the parameter is specified it will be honored in all cases
        except crash recovery.

        <varname>hot_standby_feedback</varname> will be delayed by use of this feature
        which could lead to bloat on the master; use both together with care.
-->
このパラメータはストリーミングレプリケーション配信で使われることを目的としていますが、パラメータが指定されていると、クラッシュリカバリを除くすべてのケースで使用されます。
この機能を使うことによって<code class="varname">hot_standby_feedback</code>が遅延され、マスタサーバの肥大化に繋がる可能性があります。両方同時に使う場合には注意して使ってください。

        </p><div class="warning"><h3 class="title">警告</h3><p>
<!--
          Synchronous replication is affected by this setting when <varname>synchronous_commit</varname>
          is set to <literal>remote_apply</literal>; every <literal>COMMIT</literal>
          will need to wait to be applied.
-->
<code class="varname">synchronous_commit</code>が<code class="literal">remote_apply</code>に設定されていれば、同期レプリケーションは、この設定に影響を受けます。各<code class="literal">COMMIT</code>は適用されるのを待つことが必要です。
         </p></div><p>
       </p><p>
<!--
        This parameter can only be set in the <filename>postgresql.conf</filename>
        file or on the server command line.
-->
このパラメータは、<code class="filename">postgresql.conf</code>ファイル、もしくはサーバコマンドラインでのみ設定可能です。
       </p></dd></dl></div></div><div class="sect2" id="RUNTIME-CONFIG-REPLICATION-SUBSCRIBER"><div class="titlepage"><div><div><h3 class="title">19.6.4. サブスクライバー</h3></div></div></div><!--
     <title>Subscribers</title>
--><p>
<!--
      These settings control the behavior of a logical replication subscriber.
      Their values on the publisher are irrelevant.
-->
これらの設定項目は、論理レプリケーションのサブスクライバーの挙動を制御します。
パブリッシャーにおける設定値とは無関係です。
     </p><p>
<!--
      Note that <varname>wal_receiver_timeout</varname>,
      <varname>wal_receiver_status_interval</varname> and
      <varname>wal_retrieve_retry_interval</varname> configuration parameters
      affect the logical replication workers as well.
-->
<code class="varname">wal_receiver_timeout</code>、<code class="varname">wal_receiver_status_interval</code>そして<code class="varname">wal_retrieve_retry_interval</code>設定パラメータは、論理レプリケーションワーカーにも影響することに注意してください。
     </p><div class="variablelist"><dl class="variablelist"><dt id="GUC-MAX-LOGICAL-REPLICATION-WORKERS"><span class="term"><code class="varname">max_logical_replication_workers</code> (<code class="type">int</code>)
      <a id="id-1.6.6.9.6.4.1.1.3" class="indexterm"></a>
      </span></dt><dd><p>
<!--
        Specifies maximum number of logical replication workers. This includes
        both apply workers and table synchronization workers.
-->
論理レプリケーションワーカーの最大数を指定します。
適用ワーカーと、テーブル同期ワーカーの両方が含まれます。
       </p><p>
<!--
        Logical replication workers are taken from the pool defined by
        <varname>max_worker_processes</varname>.
-->
論理レプリケーションワーカーは、<code class="varname">max_worker_processes</code>で定義されたプールから取得されます。
       </p><p>
<!--
        The default value is 4.
-->
デフォルト値は4です。
       </p></dd><dt id="GUC-MAX-SYNC-WORKERS-PER-SUBSCRIPTION"><span class="term"><code class="varname">max_sync_workers_per_subscription</code> (<code class="type">integer</code>)
      <a id="id-1.6.6.9.6.4.2.1.3" class="indexterm"></a>
      </span></dt><dd><p>
<!--
        Maximum number of synchronization workers per subscription. This
        parameter controls the amount of parallelism of the initial data copy
        during the subscription initialization or when new tables are added.
-->
サブスクリプションごとの同期ワーカーの最大数です。
このパラメータは、サブスクリプションの初期化中、あるいは新しいテーブルが追加されたときの初期データコピーの並列度を制御します。
       </p><p>
<!--
        Currently, there can be only one synchronization worker per table.
-->
今のところ、一つのテーブルにつき、同期ワーカーは一つだけです。
       </p><p>
<!--
        The synchronization workers are taken from the pool defined by
        <varname>max_logical_replication_workers</varname>.
-->
同期ワーカーは、<code class="varname">max_logical_replication_workers</code>で定義されたプールから取得されます。
       </p><p>
<!--
        The default value is 2.
-->
デフォルト値は2です。
       </p></dd></dl></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="runtime-config-wal.html">前へ</a> </td><td width="20%" align="center"><a accesskey="u" href="runtime-config.html">上へ</a></td><td width="40%" align="right"> <a accesskey="n" href="runtime-config-query.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">19.5. ログ先行書き込み（WAL） </td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top"> 19.7. 問い合わせ計画</td></tr></table></div></body></html>