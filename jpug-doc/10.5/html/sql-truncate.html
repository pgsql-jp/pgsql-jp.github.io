<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>TRUNCATE</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="sql-start-transaction.html" title="START TRANSACTION" /><link rel="next" href="sql-unlisten.html" title="UNLISTEN" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">TRUNCATE</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="sql-start-transaction.html" title="START TRANSACTION">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="sql-commands.html" title="SQLコマンド">Up</a></td><th width="60%" align="center">SQLコマンド</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="sql-unlisten.html" title="UNLISTEN">Next</a></td></tr></table><hr></hr></div><div class="refentry" id="SQL-TRUNCATE"><div class="titlepage"></div><a id="id-1.9.3.174.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle">TRUNCATE</span></h2><p>TRUNCATE — 1テーブルまたはテーブル群を空にする</p></div><div class="refsynopsisdiv"><h2>Synopsis</h2><pre class="synopsis">TRUNCATE [ TABLE ] [ ONLY ] <em class="replaceable"><code>name</code></em> [ * ] [, ... ]
    [ RESTART IDENTITY | CONTINUE IDENTITY ] [ CASCADE | RESTRICT ]</pre></div><div class="refsect1" id="id-1.9.3.174.5"><h2>説明</h2><p><code class="command">TRUNCATE</code>はテーブル群から全ての行を素早く削除します。
各テーブルに対して条件指定のない<code class="command">DELETE</code>コマンドの実行と同じ効果を持ちますが、実際にテーブルを走査しない分、このコマンドの方が高速です。
さらに、その後に<code class="command">VACUUM</code>操作を行うことなく、このコマンドはディスク領域を即座に回収します。
このコマンドは、大きなテーブルを対象とする場合に最も有用です。
  </p></div><div class="refsect1" id="id-1.9.3.174.6"><h2>パラメータ</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="replaceable"><code>name</code></em></span></dt><dd><p>空にするテーブルの名前です（スキーマ修飾名も可）。
テーブル名の前に<code class="literal">ONLY</code>が指定されている場合、そのテーブルのみを空にします。
<code class="literal">ONLY</code>が指定されていない場合、そのテーブルとそのすべての子テーブル（もしあれば）を空にします。
オプションで、テーブル名の後に<code class="literal">*</code>を指定することで、明示的に継承するテーブルも含まれることを示すことができます。
     </p></dd><dt><span class="term"><code class="literal">RESTART IDENTITY</code></span></dt><dd><p>消去されるテーブルの列により所有されるシーケンスを自動的に再開始させます。
     </p></dd><dt><span class="term"><code class="literal">CONTINUE IDENTITY</code></span></dt><dd><p>シーケンスの値を変更しません。これがデフォルトです。
     </p></dd><dt><span class="term"><code class="literal">CASCADE</code></span></dt><dd><p>指定されたテーブル、または、<code class="literal">CASCADE</code>により削除対象テーブルとされたテーブルを参照する外部キーを持つテーブルすべてを自動的に空にします。

     </p></dd><dt><span class="term"><code class="literal">RESTRICT</code></span></dt><dd><p>外部キーにより対象のテーブルを参照するテーブルのいずれかがこのコマンドで指定されていない場合、操作を拒否します。
これがデフォルトです。
     </p></dd></dl></div></div><div class="refsect1" id="id-1.9.3.174.7"><h2>注釈</h2><p>テーブルを空にするためにはそのテーブルに<code class="literal">TRUNCATE</code>権限を持たなければなりません。
  </p><p><code class="command">TRUNCATE</code>は操作対象の各テーブルに対する<code class="literal">ACCESS EXCLUSIVE</code>ロックを獲得します。
これは、この他のそのテーブルに対する同時操作をすべてブロックします。
<code class="literal">RESTART IDENTITY</code>が指定された場合、初期化対象のシーケンスがあると、それは同様に排他ロックされます。
テーブルへの同時アクセスが必要ならば、代わりに <code class="command">DELETE</code>コマンドを使用しなければなりません。
  </p><p>そのテーブルが他のテーブルから外部キーで参照されている場合、<code class="command">TRUNCATE</code>でそれらのテーブルをすべて空にするように指定していない限り、<code class="command">TRUNCATE</code>を使用することはできません。
このような場合に有効性を検査するならばテーブルスキャンが必要になりますが、テーブルスキャンを行うのであれば、このコマンドの利点がなくなるからです。
<code class="literal">CASCADE</code>を使用して、自動的にすべての依存テーブルを含めることができます。
しかし、意図しないデータ損失の可能性がありますので、このオプションを使用する時には十分に注意してください。

  </p><p><code class="command">TRUNCATE</code>は、テーブルに<code class="literal">ON DELETE</code>トリガがあっても、それを発行しません。
しかし、<code class="literal">ON TRUNCATE</code>トリガを発行します。
テーブルのいずれかに<code class="literal">ON TRUNCATE</code>トリガが定義されている場合、何らかの消去が行われる前にすべての<code class="literal">BEFORE TRUNCATE</code>トリガが発行されます。
また、最後の消去がなされ、シーケンスが初期化された後すべての<code class="literal">AFTER TRUNCATE</code>トリガが発行されます。
トリガは処理されるテーブルの順番（コマンドに列挙されたものが先、その後にカスケードのために追加されたもの）に発行されます。
  </p><p><code class="command">TRUNCATE</code>はMVCC的に安全ではありません。
同時実行中のトランザクションが、削除の前に取得したスナップショットを使っている場合、削除の後、テーブルはそのトランザクションからは空に見えます。
（詳しくは<a class="xref" href="mvcc.html" title="Chapter 13. 同時実行制御">Chapter 13</a>を参照してください。）
  </p><p>テーブル内のデータという観点では、<code class="command">TRUNCATE</code>はトランザクション的に安全です。
前後のトランザクションがコミットされなければ消去は安全にロールバックされます。
  </p><p><code class="literal">RESTART IDENTITY</code>が指定された場合、暗黙的に<code class="command">ALTER SEQUENCE RESTART</code>操作がトランザクション的に行われます。
つまりそれを囲むトランザクションがコミットされなければ、ロールバックされます。
これは通常の<code class="command">ALTER SEQUENCE RESTART</code>とは異なる動作です。
トランザクションがロールバックされる前に、初期化したシーケンスに対してさらにシーケンス操作を行う場合には注意してください。
シーケンスに対するこれらの操作の影響はロールバックされますが、<code class="function">currval()</code>への影響はロールバックされません。
つまりトランザクションの後、<code class="function">currval()</code>は、シーケンス自体と値とが一貫性のない状態になっていたとしても、失敗したトランザクションの内側で得た最後のシーケンス値を継続して反映します。
これは、失敗したトランザクションの後の<code class="function">currval()</code>の通常の動作と同じです。
  </p><p>現在のところ、<code class="command">TRUNCATE</code>は外部テーブルに対してはサポートされません。
このため、指定のテーブルの子孫に外部テーブルがあった場合、コマンドは失敗します。
  </p></div><div class="refsect1" id="id-1.9.3.174.8"><h2>例</h2><p><code class="literal">bigtable</code>テーブルおよび<code class="literal">fattable</code>テーブルを空にします。

</p><pre class="programlisting">TRUNCATE bigtable, fattable;</pre><p>
  </p><p>以下も同じですが、ここでは関連するシーケンスジェネレータをすべてリセットします。

</p><pre class="programlisting">TRUNCATE bigtable, fattable RESTART IDENTITY;</pre><p>
  </p><p><code class="literal">othertable</code>テーブル、および、外部キー制約により<code class="literal">othertable</code>を参照するすべてのテーブルを空にします。

</p><pre class="programlisting">TRUNCATE othertable CASCADE;</pre></div><div class="refsect1" id="id-1.9.3.174.9"><h2>互換性</h2><p>標準SQL:2008には、<code class="literal">TRUNCATE TABLE <em class="replaceable"><code>tablename</code></em></code>という構文の<code class="command">TRUNCATE</code>コマンドが含まれます。
<code class="literal">CONTINUE IDENTITY</code>/<code class="literal">RESTART IDENTITY</code>句も標準に記載され、関連してはいるのですが、若干異なります。
標準では、このコマンドの同時実行に関する動作の一部は実装に依存するものとされています。
このため、上記注釈を検討し、必要に応じて他の実装と比べなければなりません。
  </p></div><div class="refsect1" id="id-1.9.3.174.10"><h2>関連項目</h2><span class="simplelist"><a class="xref" href="sql-delete.html" title="DELETE"><span class="refentrytitle">DELETE</span></a></span></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="sql-start-transaction.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="sql-commands.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="sql-unlisten.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">START TRANSACTION </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> UNLISTEN</td></tr></table></div></body></html>