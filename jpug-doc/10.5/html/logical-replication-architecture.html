<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>31.5. アーキテクチャ</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="logical-replication-restrictions.html" title="31.4. 制限事項" /><link rel="next" href="logical-replication-monitoring.html" title="31.6. 監視" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">31.5. アーキテクチャ</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="logical-replication-restrictions.html" title="31.4. 制限事項">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="logical-replication.html" title="Chapter 31. 論理レプリケーション">Up</a></td><th width="60%" align="center">Chapter 31. 論理レプリケーション</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="logical-replication-monitoring.html" title="31.6. 監視">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="LOGICAL-REPLICATION-ARCHITECTURE"><div class="titlepage"><div><div><h2 class="title" style="clear: both">31.5. アーキテクチャ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="logical-replication-architecture.html#LOGICAL-REPLICATION-SNAPSHOT">31.5.1. 初期スナップショット</a></span></dt></dl></div><p>論理レプリケーションは、パブリッシャー側のデータベース上のデータのスナップショットをコピーすることから始まります。
それが完了したあとは、パブリッシャーにおける変更は、発生した時にリアルタイムでサブスクライバーに送られます。
サブスクライバーはパブリッシャーでコミットが発生した順にデータを適用します。
そのため、どの単一のサブスクリプションにおいても、パブリケーションに対するトランザクションの一貫性が保証されます。
  </p><p>論理レプリケーションは物理ストリーミングレプリケーション(<a class="xref" href="warm-standby.html#STREAMING-REPLICATION" title="26.2.5. ストリーミングレプリケーション">Section 26.2.5</a>参照)と似たアーキテクチャで構成されています。
<span class="quote">“<span class="quote">WAL送信</span>”</span>プロセスと<span class="quote">“<span class="quote">適用</span>”</span>プロセスで実装されています。
walsenderプロセスはWALのロジカルデコーディング（<a class="xref" href="logicaldecoding.html" title="Chapter 48. ロジカルデコーディング">Chapter 48</a>に記載）を開始し、標準のロジカルデコーディングプラグイン（pgoutput）をロードします。
このプラグインは、WALから読み込んだ更新を論理レプリケーションプロトコル（<a class="xref" href="protocol-logical-replication.html" title="52.5. 論理ストリーミングレプリケーションのプロトコル">Section 52.5</a>参照）に変換します。
そして、パブリケーションの指定にしたがってフィルターします。
データは次に、ストリーミングレプリケーションプロトコルを使って継続的に適用ワーカーに転送されます。
適用ワーカーは、データをローカルテーブルにマップし、更新を受信すると正しいトランザクション順に個々の更新を適用します。
  </p><p>サブスクライバーデータベースの適用プロセスは、常に<code class="varname">session_replication_role</code>を<code class="literal">replica</code>にセットして実行されます。
これによりトリガーと制約で通常の効果を生成します。
  </p><p>今のところ、論理レプリケーション適用プロセスは行トリガーだけを起動し、文トリガーは起動しません。
ただし、初期テーブル同期は<code class="command">COPY</code>コマンドのように実装されているので、<code class="command">INSERT</code>の行と文トリガーの両方を起動します。
  </p><div class="sect2" id="LOGICAL-REPLICATION-SNAPSHOT"><div class="titlepage"><div><div><h3 class="title">31.5.1. 初期スナップショット</h3></div></div></div><p>既存のサブスクライブされたテーブル中の初期データのスナップショットが取得され、特殊な適用プロセスの並列インスタンスにコピーされます。
このプロセスは自身の一時レプリケーションスロットを作成し、既存のデータをコピーします。
既存のデータのコピーが終わると、ワーカーは同期モードに入ります。
このモードでは、初期データのコピー中に起こった更新を標準の論理レプリケーションを使ってストリーミングすることにより、テーブルが主適用プロセスと同期状態になることを保証します。
ひとたび同期が完了すれば、テーブルのレプリケーションの制御は主適用プロセスに戻され、レプリケーションは通常通り継続されます。
    </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="logical-replication-restrictions.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="logical-replication.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="logical-replication-monitoring.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">31.4. 制限事項 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 31.6. 監視</td></tr></table></div></body></html>