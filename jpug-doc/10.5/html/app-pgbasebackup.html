<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>pg_basebackup</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="app-ecpg.html" title="ecpg" /><link rel="next" href="pgbench.html" title="pgbench" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">pg_basebackup</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="app-ecpg.html" title="ecpg">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="reference-client.html" title="PostgreSQLクライアントアプリケーション">Up</a></td><th width="60%" align="center">PostgreSQLクライアントアプリケーション</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="pgbench.html" title="pgbench">Next</a></td></tr></table><hr></hr></div><div class="refentry" id="APP-PGBASEBACKUP"><div class="titlepage"></div><a id="id-1.9.4.9.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle">pg_basebackup</span></h2><p>pg_basebackup — <span class="productname">PostgreSQL</span>クラスタのベースバックアップを取得する</p></div><div class="refsynopsisdiv"><h2>Synopsis</h2><div class="cmdsynopsis"><p id="id-1.9.4.9.4.1"><code class="command">pg_basebackup</code> [<em class="replaceable"><code>option</code></em>...]</p></div></div><div class="refsect1" id="id-1.9.4.9.5"><h2>説明
  </h2><p><span class="application">pg_basebackup</span>は、稼動中の<span class="productname">PostgreSQL</span>のデータベースクラスタのベースバックアップを取るために使用されます。
データベースへの他のクライアントに影響することなく、バックアップが取られます。
またこのバックアップはポイントインタイムリカバリ（<a class="xref" href="continuous-archiving.html" title="25.3. 継続的アーカイブとポイントインタイムリカバリ（PITR）">Section 25.3</a>参照）とログシッピングやストリーミングレプリケーションスタンバイサーバ用の開始点（<a class="xref" href="warm-standby.html" title="26.2. ログシッピングスタンバイサーバ">Section 26.2</a>参照）としても使用することができます。
  </p><p><span class="application">pg_basebackup</span>は、システムをバックアップモードに入れ、また戻すことを自動的に行い、データベースクラスタファイルのバイナリコピーを作成します。
バックアップは常にデータベースクラスタ全体のバックアップを取ります。
個々のデータベースや個々のデータベースオブジェクトをバックアップすることはできません。
個々のデータベースバックアップに関しては<a class="xref" href="app-pgdump.html" title="pg_dump"><span class="refentrytitle">pg_dump</span></a>などのツールを使用しなければなりません。
  </p><p>バックアップは通常の<span class="productname">PostgreSQL</span>接続を経由して、レプリケーションプロトコルを用いて、作成されます。
この接続はスーパーユーザまたは<code class="literal">REPLICATION</code>権限（<a class="xref" href="role-attributes.html" title="21.2. ロールの属性">Section 21.2</a>参照）を持つユーザが確立しなければなりません。
さらにレプリケーション用の接続には<code class="filename">pg_hba.conf</code>における明示的な権限が許されていなければなりません。
またサーバで<a class="xref" href="runtime-config-replication.html#GUC-MAX-WAL-SENDERS">max_wal_senders</a>を、バックアップ用に少なくとも１つのセッションとWALストリーミング用にもう一つ（使用する場合）を残すように十分大きく設定する必要があります。
  </p><p>同時に<code class="command">pg_basebackup</code>を複数実行することができます。
しかし性能の観点からは、１つのバックアップのみを取り結果をコピーする方が優れています。
  </p><p><span class="application">pg_basebackup</span>は、マスタからだけではなくスタンバイからもベースバックアップを作成することができます。
スタンバイからバックアップを取得するためには、レプリケーション接続を受け付けられるようにスタンバイを設定してください（つまり<code class="varname">max_wal_senders</code>と<a class="xref" href="runtime-config-replication.html#GUC-HOT-STANDBY">hot_standby</a>を設定し、<a class="link" href="auth-pg-hba-conf.html" title="20.1. pg_hba.confファイル">host-based authentication</a>を設定してください）。
またマスタで<a class="xref" href="runtime-config-wal.html#GUC-FULL-PAGE-WRITES">full_page_writes</a>を有効にする必要があります。
  </p><p>スタンバイからのオンラインバックアップではいくつかの制限があることに注意してください。

   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>バックアップ履歴ファイルはバックアップされるデータベースクラスタ内に作成されません。
     </p></li><li class="listitem"><p><code class="literal">-X none</code>を使用している場合、バックアップ終了時にバックアップに必要なすべてのWALファイルがアーカイブされているという保証はありません。
     </p></li><li class="listitem"><p>オンラインバックアップ中にスタンバイがマスタに昇格した場合、バックアップは失敗します。
     </p></li><li class="listitem"><p>バックアップに必要なすべてのWALレコードは、必要なだけの完全ページ書き出しを含んでいなければなりません。
つまりこれは、マスタで<code class="varname">full_page_writes</code>を有効にし、<code class="varname">archive_command</code>としてWALファイルから完全ページ書き出しを取り除く<span class="application">pg_compresslog</span>のようなツールを使用しないことが要求されます。
     </p></li></ul></div><p>
  </p></div><div class="refsect1" id="id-1.9.4.9.6"><h2>オプション</h2><p>以下のコマンドラインオプションは出力の場所と書式を制御します。

    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-D <em class="replaceable"><code>directory</code></em></code><br /></span><span class="term"><code class="option">--pgdata=<em class="replaceable"><code>directory</code></em></code></span></dt><dd><p>出力を書き出すディレクトリです。
<span class="application">pg_basebackup</span>は必要ならば、このディレクトリとその親ディレクトリすべてを作成します。
ディレクトリはすでに存在してもかまいませんが、存在しかつ空でない場合はエラーになります。
       </p><p>バックアップがtarモードであり、かつ、指定したディレクトリが<code class="literal">-</code>（ダッシュ）の場合、tarファイルは<code class="literal">stdout</code>に書き出されます。
       </p><p>このオプションは必須です。
       </p></dd><dt><span class="term"><code class="option">-F <em class="replaceable"><code>format</code></em></code><br /></span><span class="term"><code class="option">--format=<em class="replaceable"><code>format</code></em></code></span></dt><dd><p>出力形式を選択します。
<em class="replaceable"><code>format</code></em>には以下のいずれかを取ることができます。

        </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">p</code><br /></span><span class="term"><code class="literal">plain</code></span></dt><dd><p>普通のファイルとして、現在のデータディレクトリとテーブル空間と同じレイアウトで、出力を書き出します。
クラスタがテーブル空間を追加で持たない場合、データベース全体が指定したディレクトリに格納されます。
クラスタが追加のテーブル空間を持つ場合は、主データディレクトリは指定したディレクトリ内に格納されますが、他のテーブル空間はすべて、サーバ上の同じ絶対パスに格納されます。
           </p><p>これがデフォルトの書式です。
           </p></dd><dt><span class="term"><code class="literal">t</code><br /></span><span class="term"><code class="literal">tar</code></span></dt><dd><p>指定したディレクトリ内にtarファイルとして出力を書き出します。
主データディレクトリは<code class="filename">base.tar</code>という名前のファイルに書き出され、他のテーブル空間はすべてテーブル空間のOIDに因んだ名前のファイルに書き出されます。
            </p><p>対象ディレクトリとして<code class="literal">-</code>（ダッシュ）という値が指定された場合、tarの内容は標準出力に書き出されます。
これは例えば<span class="productname">gzip</span>へのパイプ処理に適しています。
これはクラスタが追加テーブル空間を持たず、WALストリーミングを使用していない場合のみ行うことができます。
           </p></dd></dl></div></dd><dt><span class="term"><code class="option">-r <em class="replaceable"><code>rate</code></em></code><br /></span><span class="term"><code class="option">--max-rate=<em class="replaceable"><code>rate</code></em></code></span></dt><dd><p>サーバから転送されるデータの最大転送速度です。
値は秒あたりのキロバイト数です。
添字<code class="literal">M</code>を使うと秒あたりのメガバイト数を指定できます。
添字<code class="literal">k</code>を使うこともできますが、効果はありません。
有効な値は秒あたり32キロバイトから秒あたり1024メガバイトまでです。
       </p><p>この目的は、実行中のサーバに対する<span class="application">pg_basebackup</span>の影響を制限することです。
       </p><p>このオプションはデータディレクトリの転送に対しては、常に影響があります。
WALファイルの転送については、収集方法が<code class="literal">fetch</code>の場合にのみ影響があります。
       </p></dd><dt><span class="term"><code class="option">-R</code><br /></span><span class="term"><code class="option">--write-recovery-conf</code></span></dt><dd><p>スタンバイサーバの設定を容易にするために、出力ディレクトリ（tar形式の場合はベースアーカイブファイルの中）に最低限の<code class="filename">recovery.conf</code>を書き出します。
<code class="filename">recovery.conf</code>ファイルは接続設定の情報、また、指定があれば<span class="application">pg_basebackup</span>が使用しているレプリケーションスロットの情報を記録するので、ストリーミングレプリケーションは後で同じ設定を使用します。
       </p></dd><dt><span class="term"><code class="option">-S <em class="replaceable"><code>slotname</code></em></code><br /></span><span class="term"><code class="option">--slot=<em class="replaceable"><code>slotname</code></em></code></span></dt><dd><p>このオプションは<code class="literal">-X stream</code>と一緒にのみ使用できます。
これによりWALストリーミングが指定したレプリケーションスロットを使用することになります。
ベースバックアップがレプリケーションスロットを利用したストリーミングレプリケーションのスタンバイとしての使用を意図したものであるなら、<code class="filename">recovery.conf</code>内で同じレプリケーションスロット名を使用すべきです。
そうすることで、ベースバックアップの終了とストリーミングレプリケーションの開始の間の時間に、サーバが必要なWALデータを一切削除しないことが保証されます。
       </p><p>このオプションが指定されず、サーバが一時レプリケーションスロットをサポートしている場合（バージョン10以上）、WALストリーミングには一時レプリケーションスロットが自動的に使用されます。
       </p></dd><dt><span class="term"><code class="option">--no-slot</code></span></dt><dd><p>このオプションは、サーバが一時レプリケーションスロットをサポートしていたとしても、バックアップ時にそれを作らないようにします。
       </p><p>ログストリームを使う場合、オプション<code class="option">-S</code>でスロット名を指定しなければ、デフォルトで一時レプリケーションスロットが作られます。
       </p><p>このオプションの主要な目的は、サーバに空いているレプリケーションスロットがない時にベースバックアップの取得を可能にすることです。
ほぼすべての場合において、レプリケーションスロットの使用が望ましいです。
なぜなら、必要なWALがバックアップ中にサーバによって削除されることを防止できるからです。
       </p></dd><dt><span class="term"><code class="option">-T <em class="replaceable"><code>olddir</code></em>=<em class="replaceable"><code>newdir</code></em></code><br /></span><span class="term"><code class="option">--tablespace-mapping=<em class="replaceable"><code>olddir</code></em>=<em class="replaceable"><code>newdir</code></em></code></span></dt><dd><p>ディレクトリ<em class="replaceable"><code>olddir</code></em>にあるテーブル空間を、バックアップ中に<em class="replaceable"><code>newdir</code></em>に再配置します。
これが有効であるためには、<em class="replaceable"><code>olddir</code></em>が、現在のテーブル空間のパス定義と完全に一致している必要があります(ただし、バックアップに含まれる<em class="replaceable"><code>olddir</code></em>内にテーブル空間がなくてもエラーにはなりません)。
<em class="replaceable"><code>olddir</code></em>と<em class="replaceable"><code>newdir</code></em>はいずれも絶対パスでなければなりません。
パス名に<code class="literal">=</code>記号が含まれるときは、バックスラッシュでエスケープしてください。
このオプションは、複数のテーブル空間に対して複数回指定することができます。
以下の例を参照してください。
       </p><p>この方法でテーブル空間を再配置すると、メインのデータディレクトリ内のシンボリックリンクは、新しい場所を指すように更新されます。
このため、新しいデータディレクトリは、すべてのテーブル空間が更新された場所にあり、新しいサーバインスタンスがすぐに使える状態になっています。
        </p></dd><dt><span class="term"><code class="option">--waldir=<em class="replaceable"><code>waldir</code></em></code></span></dt><dd><p>先行書き込みログのディレクトリの場所を指定します。
<em class="replaceable"><code>waldir</code></em>は絶対パスでなければなりません。
先行書き込みログのディレクトリは、バックアップがplainモードの場合にのみ指定できます。
       </p></dd><dt><span class="term"><code class="option">-X <em class="replaceable"><code>method</code></em></code><br /></span><span class="term"><code class="option">--wal-method=<em class="replaceable"><code>method</code></em></code></span></dt><dd><p>必要な先行書き込みログファイル（WALファイル）をバックアップに含めます。
これはバックアップ中に生成された先行書き込みログをすべて含みます。
方法<code class="literal">none</code>を指定しない場合、ログアーカイブを考慮することなく展開したディレクトリ内でそのままpostmasterを起動することができます。
つまりこれは完全なスタンドアローンバックアップを作成します。
       </p><p>以下の先行書き込みログを収集するための方法がサポートされます。

        </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">n</code><br /></span><span class="term"><code class="literal">none</code></span></dt><dd><p>先行書き込みログをバックアップに含めません。
           </p></dd><dt><span class="term"><code class="literal">f</code><br /></span><span class="term"><code class="literal">fetch</code></span></dt><dd><p>先行書き込みログファイルはバックアップの最後に収集されます。
したがって、<a class="xref" href="runtime-config-replication.html#GUC-WAL-KEEP-SEGMENTS">wal_keep_segments</a>パラメータを、バックアップの最後までログが削除されない程度に十分大きくする必要があります。
ログの転送時点でそのログがローテートされていた場合、バックアップは失敗し、使用することができません。
           </p><p>先行書き込みログファイルは<code class="filename">base.tar</code>ファイルに書き込まれます。
           </p></dd><dt><span class="term"><code class="literal">s</code><br /></span><span class="term"><code class="literal">stream</code></span></dt><dd><p>バックアップを作成する時に先行書き込みログをストリームします。
これは第二のサーバ接続を開き、バックアップを実行している間、並行して先行書き込みログのストリーミングを始めます。
したがって、これは<a class="xref" href="runtime-config-replication.html#GUC-MAX-WAL-SENDERS">max_wal_senders</a>で設定される接続を２つ使用します。
クライアントが受け取った先行書き込みログに追従している限り、このモードを使用すれば、マスタ上に余分に保管される先行書き込みログは必要ありません。
           </p><p>先行書き込みログファイルは<code class="filename">pg_wal.tar</code>という名前の別のファイルに書き込まれます（サーバのバージョンが10よりも古い場合は、ファイルの名前は<code class="filename">pg_xlog.tar</code>になります）。
           </p><p>この値がデフォルトです。
           </p></dd></dl></div><p>
       </p></dd><dt><span class="term"><code class="option">-z</code><br /></span><span class="term"><code class="option">--gzip</code></span></dt><dd><p>tarファイル出力のデフォルトの圧縮レベルによるgzip圧縮を有効にします。
tarファイルを生成する場合のみ圧縮を利用することができ、すべてのtarファイルの名前に拡張子<code class="filename">.gz</code>が自動的に付加されます。
       </p></dd><dt><span class="term"><code class="option">-Z <em class="replaceable"><code>level</code></em></code><br /></span><span class="term"><code class="option">--compress=<em class="replaceable"><code>level</code></em></code></span></dt><dd><p>tarファイル出力のgzip圧縮を有効にします。
また圧縮レベル（0から9まで、0は圧縮なし、9が最高の圧縮レベル）を指定します。
tarファイルを生成する場合のみ圧縮を利用することができ、すべてのtarファイルの名前に拡張子<code class="filename">.gz</code>が自動的に付加されます。
       </p></dd></dl></div><p>
   </p><p>以下のコマンドラインオプションはバックアップの生成とこのプログラムの実行を制御します。

    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-c <em class="replaceable"><code>fast|spread</code></em></code><br /></span><span class="term"><code class="option">--checkpoint=<em class="replaceable"><code>fast|spread</code></em></code></span></dt><dd><p>チェックポイントモードをfast（即座に実行）またはspread（デフォルト）に設定します(<a class="xref" href="continuous-archiving.html#BACKUP-LOWLEVEL-BASE-BACKUP" title="25.3.3. 低レベルAPIを使用したベースバックアップの作成">Section 25.3.3</a>を参照してください)。
       </p></dd><dt><span class="term"><code class="option">-l <em class="replaceable"><code>label</code></em></code><br /></span><span class="term"><code class="option">--label=<em class="replaceable"><code>label</code></em></code></span></dt><dd><p>バックアップのラベルを設定します。
何も指定がない場合、<span class="quote">“<span class="quote"><code class="literal">pg_basebackup base backup</code></span>”</span>というデフォルト値が使用されます。
       </p></dd><dt><span class="term"><code class="option">-n</code><br /></span><span class="term"><code class="option">--no-clean</code></span></dt><dd><p>デフォルトでは、<code class="command">pg_basebackup</code>がエラーでアボートするとき、ジョブを完了できないことがわかるより前に作成したすべてのディレクトリ（例えば、データディレクトリと先行書き込みログのディレクトリ）を削除します。
このオプションはきれいに片付けることを禁止するので、デバッグのために有用です。
       </p><p>テーブル空間のディレクトリはいずれにせよ削除されないことに注意してください。
       </p></dd><dt><span class="term"><code class="option">-P</code><br /></span><span class="term"><code class="option">--progress</code></span></dt><dd><p>進行状況報告を有効にします。
これを有効にすると、バックアップ中におおよその進行状況が報告されます。
データベースはバックアップ中に変更があるかもしれませんので、これはおおよそでしかなくちょうど<code class="literal">100%</code>では終わらないかもしれません。
特に、WALログがバックアップに含まれる場合、データ総量は前もって予測することはできません。
このためこの場合、推定対象容量はWALなしの総推定量を過ぎた後増加します。
       </p><p>これが有効な場合、バックアップはまずデータベース全体容量を計算し、その後バックアップに戻り、実際の内容を送信します。
バックアップに要する時間は少し長くなるかもしれません。特に最初のデータが送られるようになるまでの時間がより長くなります。
       </p></dd><dt><span class="term"><code class="option">-N</code><br /></span><span class="term"><code class="option">--no-sync</code></span></dt><dd><p>デフォルトでは、<code class="command">pg_basebackup</code>は全てのファイルがディスクに安全に書き込まれるまで待機します。
このオプションは、<code class="command">pg_basebackup</code>が待機せずに戻るようにするため、より高速になりますが、その後でOSがクラッシュするとベースバックアップの破損に繋がるかもしれません。
一般的に言って、このオプションはテスト用には有用ですが、実運用の環境を作成するときには使わない方が良いでしょう。
       </p></dd><dt><span class="term"><code class="option">-v</code><br /></span><span class="term"><code class="option">--verbose</code></span></dt><dd><p>冗長モードを有効にします。
開始時および終了段階でいくつか追加の段階が出力されます。
また進行状況報告も有効な場合、現在処理中のファイル名も正しく出力されます。
       </p></dd></dl></div><p>
   </p><p>以下のオプションはデータベース接続パラメータを制御します。

    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-d <em class="replaceable"><code>connstr</code></em></code><br /></span><span class="term"><code class="option">--dbname=<em class="replaceable"><code>connstr</code></em></code></span></dt><dd><p>サーバとの接続のために使用するパラメータを、接続文字列として指定します。
詳細については<a class="xref" href="libpq-connect.html#LIBPQ-CONNSTRING" title="33.1.1. 接続文字列">Section 33.1.1</a>を参照してください。
       </p><p>このオプションは他のクライアントアプリケーションとの整合性のために<code class="literal">--dbname</code>と呼ばれます。
しかし、<span class="application">pg_basebackup</span>はクラスタ内の何らかの特定のデータベースに接続しませんので、接続文字列内のデータベース名は無視されます。
       </p></dd><dt><span class="term"><code class="option">-h <em class="replaceable"><code>host</code></em></code><br /></span><span class="term"><code class="option">--host=<em class="replaceable"><code>host</code></em></code></span></dt><dd><p>サーバが稼働しているマシンのホスト名を指定します。
この値がスラッシュから始まる場合、Unixドメインソケット用のディレクトリとして使用されます。
デフォルトは、設定されていれば環境変数<code class="envar">PGHOST</code>から取得されます。
設定されていなければ、Unixドメインソケット接続とみなされます。
       </p></dd><dt><span class="term"><code class="option">-p <em class="replaceable"><code>port</code></em></code><br /></span><span class="term"><code class="option">--port=<em class="replaceable"><code>port</code></em></code></span></dt><dd><p>サーバが接続を監視するTCPポートもしくはローカルUnixドメインソケットファイルの拡張子を指定します。
デフォルトは、設定されている場合、環境変数<code class="envar">PGPORT</code>の値となります。設定されていなければ、コンパイル時のデフォルト値となります。
       </p></dd><dt><span class="term"><code class="option">-s <em class="replaceable"><code>interval</code></em></code><br /></span><span class="term"><code class="option">--status-interval=<em class="replaceable"><code>interval</code></em></code></span></dt><dd><p>状態パケットがサーバに返送される間隔を秒単位で指定します。
これにより簡単にサーバから進行状況を監視することができます。
ゼロという値は定期的な状態更新を完全に無効にします。
しかし、タイムアウトによる切断を防止するために、サーバにより要求された場合に更新は送信されます。
デフォルト値は１０秒です。
       </p></dd><dt><span class="term"><code class="option">-U <em class="replaceable"><code>username</code></em></code><br /></span><span class="term"><code class="option">--username=<em class="replaceable"><code>username</code></em></code></span></dt><dd><p>接続ユーザ名です。
       </p></dd><dt><span class="term"><code class="option">-w</code><br /></span><span class="term"><code class="option">--no-password</code></span></dt><dd><p>パスワードの入力を促しません。
サーバがパスワード認証を必要とし、かつ、<code class="filename">.pgpass</code>ファイルなどの他の方法が利用できない場合、接続試行は失敗します。
バッチジョブやスクリプトなどパスワードを入力するユーザが存在しない場合にこのオプションは有用かもしれません。
       </p></dd><dt><span class="term"><code class="option">-W</code><br /></span><span class="term"><code class="option">--password</code></span></dt><dd><p>データベースに接続する前に、<span class="application">pg_basebackup</span>は強制的にパスワード入力を促します。
       </p><p>サーバがパスワード認証を要求する場合<span class="application">pg_basebackup</span>は自動的にパスワード入力を促しますので、これが重要になることはありません。
しかし、<span class="application">pg_basebackup</span>は、サーバにパスワードが必要かどうかを判断するための接続試行を無駄に行います。
こうした余計な接続試行を防ぐために<code class="option">-W</code>の入力が有意となる場合もあります。
       </p></dd></dl></div><p>
   </p><p>以下のその他のオプションも使用することができます。

    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-V</code><br /></span><span class="term"><code class="option">--version</code></span></dt><dd><p><span class="application">pg_basebackup</span>のバージョンを表示し終了します。
       </p></dd><dt><span class="term"><code class="option">-?</code><br /></span><span class="term"><code class="option">--help</code></span></dt><dd><p><span class="application">pg_basebackup</span>コマンドライン引数の使用方法を表示し、終了します。
       </p></dd></dl></div><p>
   </p></div><div class="refsect1" id="id-1.9.4.9.7"><h2>環境</h2><p>他のほとんどの<span class="productname">PostgreSQL</span>ユーティリティと同様このユーティリティは<span class="application">libpq</span>でサポートされる環境変数（<a class="xref" href="libpq-envars.html" title="33.14. 環境変数">Section 33.14</a>参照）を使用します。
  </p></div><div class="refsect1" id="id-1.9.4.9.8"><h2>注意</h2><p>バックアップの開始時に、バックアップを取得するサーバ上でチェックポイントを書き込む必要があります。
特にオプション <code class="literal">--checkpoint=fast</code> を使用していない場合、これには少し時間を要する場合があり、その間 <span class="application">pg_basebackup</span> はアイドル状態であるように見えます。
  </p><p>このバックアップには、設定ファイルやサードパーティによりディレクトリに格納された追加ファイルを含め、データディレクトリとテーブル空間内のすべてのファイルが含まれますが、PostgreSQLによって管理される一部の一時ファイルは含まれません。
ただし、テーブル空間に使われるシンボリックリンクが保存されることを除くと、通常のファイルとディレクトリのみがコピーされます。
PostgreSQLが認識している一部のディレクトリを指すシンボリックリンクは空のディレクトリとしてコピーされます。
その他のシンボリックリンクおよび特殊デバイスファイルはスキップされます。
(正確な詳細については<a class="xref" href="protocol-replication.html" title="52.4. ストリーミングレプリケーションプロトコル">Section 52.4</a>を参照してください。)
  </p><p>オプション<code class="literal">--tablespace-mapping</code>が使われなければ、テーブル空間はデフォルトでサーバ上のと同じパスでplain形式でバックアップされます。
このオプションがないと、サーバと同じホスト上でのplain形式のベースバックアップの実行は動作しません、というのは、バックアップを元のテーブル空間と同じディレクトリに書き込まなければならないからです。
  </p><p>tar形式モードを使う場合、PostgreSQLサーバを起動する前に各tarファイルを解凍するのはユーザの責任です。
追加のテーブル空間がある場合、それについてのtarファイルは、正しい場所に解凍される必要があります。
この場合、テーブル空間へのシンボリックリンクは、<code class="filename">base.tar</code>ファイルに含まれる<code class="filename">tablespace_map</code>ファイルの内容に基づいて、サーバが作成します。
  </p><p><span class="application">pg_basebackup</span>は同じまたは9.1以降のより古いメジャーバージョンのサーバで動作します。
しかしWALストリーミングモード（<code class="literal">-X stream</code>）はバージョン9.3およびそれ以降のサーバでのみ動作します。
また、現在のバージョンのtar形式モード（<code class="literal">--format=tar</code>はバージョン9.5およびそれ以降のサーバでのみ動作します。
  </p></div><div class="refsect1" id="id-1.9.4.9.9"><h2>例</h2><p><code class="literal">mydbserver</code>で稼動するサーバのベースバックアップを作成し、ローカルディレクトリ<code class="filename">/usr/local/pgsql/data</code>に保管します。
</p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>pg_basebackup -h mydbserver -D /usr/local/pgsql/data</code></strong></pre><p>
  </p><p>各テーブル空間につき圧縮したtarファイルを1つ作成するようにローカルサーバをバックアップし、<code class="filename">backup</code>ディレクトリに保管します。
同時に実行時に進行状況を表示します。
</p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>pg_basebackup -D backup -Ft -z -P</code></strong></pre><p>
  </p><p>単一のテーブル空間を持つローカルデータベースのバックアップを作成し、それを<span class="productname">bzip2</span>で圧縮します。
</p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>pg_basebackup -D - -Ft -X fetch | bzip2 &gt; backup.tar.bz2</code></strong></pre><p>
（データベース内に複数のテーブル空間が存在する場合このコマンドは失敗します。）
  </p><p><code class="filename">/opt/ts</code>にあるテーブル空間を<code class="filename">./backup/ts</code>に再配置してローカルデータベースのバックアップを作成します。
</p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>pg_basebackup -D backup/data -T /opt/ts=$(pwd)/backup/ts</code></strong></pre><p>
  </p></div><div class="refsect1" id="id-1.9.4.9.10"><h2>関連項目</h2><span class="simplelist"><a class="xref" href="app-pgdump.html" title="pg_dump"><span class="refentrytitle">pg_dump</span></a></span></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="app-ecpg.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="reference-client.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="pgbench.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top"><span class="application">ecpg</span> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> <span class="application">pgbench</span></td></tr></table></div></body></html>