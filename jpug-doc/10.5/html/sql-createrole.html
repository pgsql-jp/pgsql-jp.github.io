<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>CREATE ROLE</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="sql-createpublication.html" title="CREATE PUBLICATION" /><link rel="next" href="sql-createrule.html" title="CREATE RULE" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">CREATE ROLE</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="sql-createpublication.html" title="CREATE PUBLICATION">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="sql-commands.html" title="SQLコマンド">Up</a></td><th width="60%" align="center">SQLコマンド</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="sql-createrule.html" title="CREATE RULE">Next</a></td></tr></table><hr></hr></div><div class="refentry" id="SQL-CREATEROLE"><div class="titlepage"></div><a id="id-1.9.3.74.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle">CREATE ROLE</span></h2><p>CREATE ROLE — 新しいデータベースロールを定義する</p></div><div class="refsynopsisdiv"><h2>Synopsis</h2><pre class="synopsis">CREATE ROLE <em class="replaceable"><code>name</code></em> [ [ WITH ] <em class="replaceable"><code>option</code></em> [ ... ] ]

<span class="phrase">ここで<em class="replaceable"><code>option</code></em>は以下の通りです。</span>

      SUPERUSER | NOSUPERUSER
    | CREATEDB | NOCREATEDB
    | CREATEROLE | NOCREATEROLE
    | INHERIT | NOINHERIT
    | LOGIN | NOLOGIN
    | REPLICATION | NOREPLICATION
    | BYPASSRLS | NOBYPASSRLS
    | CONNECTION LIMIT <em class="replaceable"><code>connlimit</code></em>
    | [ ENCRYPTED ] PASSWORD '<em class="replaceable"><code>password</code></em>'
    | VALID UNTIL '<em class="replaceable"><code>timestamp</code></em>'
    | IN ROLE <em class="replaceable"><code>role_name</code></em> [, ...]
    | IN GROUP <em class="replaceable"><code>role_name</code></em> [, ...]
    | ROLE <em class="replaceable"><code>role_name</code></em> [, ...]
    | ADMIN <em class="replaceable"><code>role_name</code></em> [, ...]
    | USER <em class="replaceable"><code>role_name</code></em> [, ...]
    | SYSID <em class="replaceable"><code>uid</code></em></pre></div><div class="refsect1" id="id-1.9.3.74.5"><h2>説明</h2><p><code class="command">CREATE ROLE</code>は、<span class="productname">PostgreSQL</span>データベースクラスタに新しいロールを加えます。
ロールとは、データベースオブジェクトを所有することができ、データベース権限を持つことができる実体のことです。
ロールは、使用状況に応じて<span class="quote">“<span class="quote">ユーザ</span>”</span>、<span class="quote">“<span class="quote">グループ</span>”</span>、もしくは、その両方であるとみなすことができます。
ユーザの管理と認証に関する情報については、<a class="xref" href="user-manag.html" title="Chapter 21. データベースロール">Chapter 21</a>と<a class="xref" href="client-authentication.html" title="Chapter 20. クライアント認証">Chapter 20</a>を参照してください。
このコマンドを使用するには、<code class="literal">CREATEROLE</code>権限を持つか、データベースのスーパーユーザでなければなりません。

  </p><p>ロールはデータベースクラスタのレベルで定義されるため、クラスタ内のすべてのデータベースで有効となることに注意してください。
  </p></div><div class="refsect1" id="id-1.9.3.74.6"><h2>パラメータ</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="replaceable"><code>name</code></em></span></dt><dd><p>新しいロールの名前です。
       </p></dd><dt><span class="term"><code class="literal">SUPERUSER</code><br /></span><span class="term"><code class="literal">NOSUPERUSER</code></span></dt><dd><p>これらの句によって、新しいロールが<span class="quote">“<span class="quote">スーパーユーザ</span>”</span>となるかどうかが決まります。
<span class="quote">“<span class="quote">スーパーユーザ</span>”</span>はデータベース内のすべてのアクセス制限より優先します。
スーパーユーザという状態は危険ですので、本当に必要な場合にのみ使用しなければなりません。
新しくスーパーユーザを作成するには、スーパーユーザでなければなりません。
指定されなかった場合のデフォルトは<code class="literal">NOSUPERUSER</code>です。
       </p></dd><dt><span class="term"><code class="literal">CREATEDB</code><br /></span><span class="term"><code class="literal">NOCREATEDB</code></span></dt><dd><p>これらの句はロールのデータベースの作成に関する権限を定義します。
<code class="literal">CREATEDB</code>が指定された場合、定義されたロールは新しくデータベースを作成することができます。
<code class="literal">NOCREATEDB</code>を使用した場合、そのロールにはデータベースを作成する権限が与えられません。
指定されなかった場合のデフォルトは<code class="literal">NOCREATEDB</code>です。
       </p></dd><dt><span class="term"><code class="literal">CREATEROLE</code><br /></span><span class="term"><code class="literal">NOCREATEROLE</code></span></dt><dd><p>これらの句は、ロールが新しいロールを作成（つまり<code class="command">CREATE ROLE</code>を実行）できるかどうかを決定します。
<code class="literal">CREATEROLE</code>権限を持つロールはロールを変更することも削除することもできます。
指定されなかった場合のデフォルトは<code class="literal">NOCREATEROLE</code>です。

       </p></dd><dt><span class="term"><code class="literal">INHERIT</code><br /></span><span class="term"><code class="literal">NOINHERIT</code></span></dt><dd><p>これらの句は、ロールがそのロールが属するロールの権限を<span class="quote">“<span class="quote">継承</span>”</span>するかどうかを決定します。
<code class="literal">INHERIT</code>属性を持つロールは自動的に、直接的にまたは間接的にメンバとして割り当てられたすべてのデータベース権限を使用します。
<code class="literal">INHERIT</code>がないと、他のロール内のメンバ資格により得られる能力はそのロールへの<code class="command">SET ROLE</code>だけです。
他のロールの持つ権限は、<code class="command">SET ROLE</code>を行った後にのみ利用可能です。
指定されなかった場合のデフォルトは<code class="literal">INHERIT</code>です。
       </p></dd><dt><span class="term"><code class="literal">LOGIN</code><br /></span><span class="term"><code class="literal">NOLOGIN</code></span></dt><dd><p>これらの句により、ロールがログイン可能かどうか、つまり、そのロールをクライアント接続時にセッションを認証するための名前として使用することができるかどうかが決まります。
<code class="literal">LOGIN</code>属性を持つロールはユーザとみなすことができます。
この属性を持たないロールは、データベース権限を管理する際に有用ですが、普通の意味ではユーザとはいえません。
指定されなかった場合のデフォルトは<code class="literal">NOLOGIN</code>ですが、<code class="command">CREATE ROLE</code>がその別名である<a class="xref" href="sql-createuser.html" title="CREATE USER"><span class="refentrytitle">CREATE USER</span></a>で呼び出された場合は例外です。
       </p></dd><dt><span class="term"><code class="literal">REPLICATION</code><br /></span><span class="term"><code class="literal">NOREPLICATION</code></span></dt><dd><p>これらの句は、ロールがレプリケーションロールかどうかを決定します。
レプリケーションモード（物理または論理レプリケーション）のサーバに接続できるためには、またレプリケーションスロットを作成または削除できるためには、ロールはこの属性（またはスーパーユーザ）を持っている必要があります。
<code class="literal">REPLICATION</code>属性を持つロールは、非常に高度な権限を持つものです。
このため実際にレプリケーションで使用するロールでのみ使用しなければなりません。
指定されない場合のデフォルトは<code class="literal">NOREPLICATION</code>です。
       </p></dd><dt><span class="term"><code class="literal">BYPASSRLS</code><br /></span><span class="term"><code class="literal">NOBYPASSRLS</code></span></dt><dd><p>これらの構文は、ロールがすべての行単位セキュリティ(RLS)ポリシーを無視するかどうかを決定します。
<code class="literal">NOBYPASSRLS</code>がデフォルトです。
pg_dumpはテーブルのすべての内容が確実にダンプされるようにするため、<code class="literal">row_security</code>をデフォルトで<code class="literal">OFF</code>に設定することに注意してください。
pg_dumpを実行するユーザが適切な権限を持っていなければ、エラーが返されます。
スーパーユーザおよびテーブルの所有者は、常にRLSを無視します。
       </p></dd><dt><span class="term"><code class="literal">CONNECTION LIMIT</code> <em class="replaceable"><code>connlimit</code></em></span></dt><dd><p>ロールがログイン可能である場合、これは、ロールが確立できる最大同時接続数を指定します。
-1（デフォルト）は無制限を意味します。
通常の接続のみがこの制限の対象として数えられることに注意してください。
準備されたトランザクションやバックグラウンドワーカの接続はこの制限の対象にはなりません。
       </p></dd><dt><span class="term">[ <code class="literal">ENCRYPTED</code> ] <code class="literal">PASSWORD</code> <em class="replaceable"><code>password</code></em></span></dt><dd><p>ロールのパスワードを設定します。
（パスワードは<code class="literal">LOGIN</code>属性を持つロールでのみ使用されますが、この属性を持たないロールにも定義することができます。）
パスワード認証を行う予定がなければ、このオプションを省略することができます。
パスワードの指定がなければ、パスワードがNULLに設定され、そのアカウントでのパスワード認証は常に失敗します。
NULLというパスワードを明示的に<code class="literal">PASSWORD NULL</code>と記述することもできます。
       </p><div class="note"><h3 class="title">Note</h3><p>空の文字列を指定した場合もパスワードをNULLに設定しますが、<span class="productname">PostgreSQL</span>のバージョン10より前はそのようになっていませんでした。
以前のバージョンでは、認証方式と細かいバージョンによって空の文字列が使えたり使えなかったりし、また、いずれにせよlibpqは空の文字列を拒絶していました。
この曖昧さを避けるためには、空の文字列の指定は避けるのが良いです。
         </p></div><p>パスワードは必ず暗号化されてシステムカタログに保存されます。
<code class="literal">ENCRYPTED</code>キーワードには何の効果もありませんが、後方互換性のために受け付けられます。
暗号化の方法は設定パラメータ<a class="xref" href="runtime-config-connection.html#GUC-PASSWORD-ENCRYPTION">password_encryption</a>によって決定されます。
指定されたパスワード文字列が既にMD5またはSCRAMの暗号化形式になっている場合は、<code class="varname">password_encryption</code>と関係なく、そのまま保存されます（指定のパスワードを暗号化した文字列を復号できないので、パスワードを別の形式で暗号化することができないからです）。
これにより、ダンプ／リストア時に暗号化したパスワードを再ロードすることができます。
       </p></dd><dt><span class="term"><code class="literal">VALID UNTIL</code> '<em class="replaceable"><code>timestamp</code></em>'</span></dt><dd><p><code class="literal">VALID UNTIL</code>句は、ロールのパスワードが無効になる日時を設定します。
この句が省略された場合、パスワードは永遠に有効になります。
       </p></dd><dt><span class="term"><code class="literal">IN ROLE</code> <em class="replaceable"><code>role_name</code></em></span></dt><dd><p><code class="literal">IN ROLE</code>句には、新しく作成するロールを新規にメンバとして追加する既存の1つ以上のロールを列挙します。
（新しく作成するロールを管理者として追加するオプションがないことに注意してください。このためには別途<code class="command">GRANT</code>コマンドを使用してください。）
       </p></dd><dt><span class="term"><code class="literal">IN GROUP</code> <em class="replaceable"><code>role_name</code></em></span></dt><dd><p><code class="literal">IN GROUP</code>は<code class="literal">IN ROLE</code>の別名で、廃止予定です。
       </p></dd><dt><span class="term"><code class="literal">ROLE</code> <em class="replaceable"><code>role_name</code></em></span></dt><dd><p><code class="literal">ROLE</code>には、新しく作成するロールのメンバとして自動的に追加する既存の1つ以上のロールを列挙します。
（これは実質的に新しく作成したロールを<span class="quote">“<span class="quote">グループ</span>”</span>とします。）
       </p></dd><dt><span class="term"><code class="literal">ADMIN</code> <em class="replaceable"><code>role_name</code></em></span></dt><dd><p><code class="literal">ADMIN</code>句は<code class="literal">ROLE</code>と似ていますが、新しく作成されるロールに指定されたロールが<code class="literal">WITH ADMIN OPTION</code>として追加される点が異なります。
つまり、新しく作成されるロールのメンバ資格を他者に与えることができる権利を、指定されたロールに与えます。
       </p></dd><dt><span class="term"><code class="literal">USER</code> <em class="replaceable"><code>role_name</code></em></span></dt><dd><p><code class="literal">USER</code>句は<code class="literal">ROLE</code>句の別名で廃止予定です。
       </p></dd><dt><span class="term"><code class="literal">SYSID</code> <em class="replaceable"><code>uid</code></em></span></dt><dd><p><code class="literal">SYSID</code>句は無視されますが、後方互換性を維持するために受け付けられます。
       </p></dd></dl></div></div><div class="refsect1" id="id-1.9.3.74.7"><h2>注釈</h2><p>ロールの属性を変更するには<a class="xref" href="sql-alterrole.html" title="ALTER ROLE"><span class="refentrytitle">ALTER ROLE</span></a>を、ロールを削除するには<a class="xref" href="sql-droprole.html" title="DROP ROLE"><span class="refentrytitle">DROP ROLE</span></a>を使用してください。
<code class="command">CREATE ROLE</code>で指定したすべての属性は、後で<code class="command">ALTER ROLE</code>コマンドで変更可能です。
  </p><p>グループとして使用しているロールのメンバの追加、および、削除についての推奨方法は、<a class="xref" href="sql-grant.html" title="GRANT"><span class="refentrytitle">GRANT</span></a>と<a class="xref" href="sql-revoke.html" title="REVOKE"><span class="refentrytitle">REVOKE</span></a>を使用することです。
  </p><p><code class="literal">VALID UNTIL</code>句は、パスワードの有効期限を定義するだけで、ロール自体の有効期限ではありません。
特に、パスワードを使わない認証方式でログインを行う場合には、この有効期限は強制されません。
  </p><p><code class="literal">INHERIT</code>属性は、許可可能な権限（つまり、データベースオブジェクトに対するアクセス権限とロールのメンバ資格）の継承を管理します。
これは、<code class="command">CREATE ROLE</code>や<code class="command">ALTER ROLE</code>で設定される特別なロール属性には適用されません。
<code class="literal">INHERIT</code>が設定されていたとしても、例えば、<code class="literal">CREATEDB</code>権限を持つロールのメンバであっても、データベース作成権限は即座に付与されません。
データベースを作成する前に<a class="xref" href="sql-set-role.html" title="SET ROLE"><span class="refentrytitle">SET ROLE</span></a>を使用してそのロールにならなければなりません。
  </p><p>後方互換性を維持するため、<code class="literal">INHERIT</code>属性はデフォルトです。
以前のリリースの<span class="productname">PostgreSQL</span>では、ユーザは常にメンバとなっているすべてのグループの権限でアクセスできました。
しかし、<code class="literal">NOINHERIT</code>の方が標準SQLの規定の意味により合ったものを提供します。
  </p><p><code class="literal">CREATEROLE</code>権限には注意が必要です。
<code class="literal">CREATEROLE</code> ロールという権限には継承という概念がありません。
あるロールが特定の権限を持っていなくても、別のロールを作成できることを意味します。つまり、簡単に自身の持つ権限と異なる権限（スーパーユーザ権限を持つロールは除きます）を持つ別のロールを作成できてしまいます。
たとえば、<code class="literal">CREATEROLE</code>権限を持ち、<code class="literal">CREATEDB</code>権限を持たない<span class="quote">“<span class="quote">user</span>”</span>というロールが、<code class="literal">CREATEDB</code>権限を持つロールを新規に作成することができます。
したがって、<code class="literal">CREATEROLE</code>権限を持つロールは、ほとんどスーパーユーザ権限を持つロールと同じであるものと考えてください。
  </p><p><span class="productname">PostgreSQL</span>には、<code class="command">CREATE ROLE</code>と同じ機能を持つプログラム（実際にこのコマンドを呼び出しています）<a class="xref" href="app-createuser.html" title="createuser"><span class="refentrytitle"><span class="application">createuser</span></span></a>があり、コマンドシェルから実行することができます。
  </p><p><code class="literal">CONNECTION LIMIT</code>オプションが加える制限は厳密ではありません。
もしそのロールに1つだけ接続<span class="quote">“<span class="quote">スロット</span>”</span>が残っていた時に、ほぼ同時に2つのセッションが新しく始まった場合、両方とも失敗する可能性があります。
また、この制限はスーパーユーザには適用されません。
  </p><p>このコマンドで暗号化しないパスワードを指定するときには注意しなければなりません。
パスワードはサーバに平文で送信されます。
クライアントのコマンド履歴やサーバのログにこれが残ってしまうかもしれません。
しかし、<a class="xref" href="app-createuser.html" title="createuser"><span class="refentrytitle"><span class="application">createuser</span></span></a>コマンドはパスワードを暗号化して送信します。
また、<a class="xref" href="app-psql.html" title="psql"><span class="refentrytitle"><span class="application">psql</span></span></a>には<code class="command">\password</code>コマンドがあり、これを使用して後でパスワードを安全に変更することができます。
  </p></div><div class="refsect1" id="id-1.9.3.74.8"><h2>例</h2><p>ログイン可能なロールを作成します。ただし、パスワードはありません。
</p><pre class="programlisting">CREATE ROLE jonathan LOGIN;</pre><p>
  </p><p>パスワード付きのロールを作成します。
</p><pre class="programlisting">CREATE USER davide WITH PASSWORD 'jw8s0F4';</pre><p>
<code class="command">CREATE USER</code>は<code class="literal">LOGIN</code>を意味する点を除き、<code class="command">CREATE ROLE</code>と同一です。
  </p><p>2004年まで有効なパスワードを持つロールを作成します。
2005年に1秒でも入った時点でパスワードは無効になります。

</p><pre class="programlisting">CREATE ROLE miriam WITH LOGIN PASSWORD 'jw8s0F4' VALID UNTIL '2005-01-01';</pre><p>
  </p><p>データベースを作成でき、かつ、ロールを管理できるロールを作成します。
</p><pre class="programlisting">CREATE ROLE admin WITH CREATEDB CREATEROLE;</pre></div><div class="refsect1" id="id-1.9.3.74.9"><h2>互換性</h2><p><code class="command">CREATE ROLE</code>文は標準SQLで規定されています。
しかしSQLでは以下の構文のみを要求しています。
</p><pre class="synopsis">CREATE ROLE <em class="replaceable"><code>name</code></em> [ WITH ADMIN <em class="replaceable"><code>role_name</code></em> ]</pre><p>
複数の初期管理者やそのほかの<code class="command">CREATE ROLE</code>のオプションは<span class="productname">PostgreSQL</span>の拡張です。
  </p><p>標準SQLでは、ユーザとロールという概念を定義し、それらを別の概念としてみなしています。
また、ユーザを定義するコマンドはすべて、各データベース実装で規定するものとしています。
<span class="productname">PostgreSQL</span>では、ユーザとロールを単一の実体に統一することを選択しています。
したがって、ロールは標準よりも非常に多くのオプションの属性を持っています。
  </p><p>ユーザは<code class="literal">NOINHERIT</code>属性を与えること、ロールは<code class="literal">INHERIT</code>属性を与えることで、標準SQLで規定された振舞いに最も近くなります。

  </p></div><div class="refsect1" id="id-1.9.3.74.10"><h2>関連項目</h2><span class="simplelist"><a class="xref" href="sql-set-role.html" title="SET ROLE"><span class="refentrytitle">SET ROLE</span></a>, <a class="xref" href="sql-alterrole.html" title="ALTER ROLE"><span class="refentrytitle">ALTER ROLE</span></a>, <a class="xref" href="sql-droprole.html" title="DROP ROLE"><span class="refentrytitle">DROP ROLE</span></a>, <a class="xref" href="sql-grant.html" title="GRANT"><span class="refentrytitle">GRANT</span></a>, <a class="xref" href="sql-revoke.html" title="REVOKE"><span class="refentrytitle">REVOKE</span></a>, <a class="xref" href="app-createuser.html" title="createuser"><span class="refentrytitle"><span class="application">createuser</span></span></a></span></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="sql-createpublication.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="sql-commands.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="sql-createrule.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">CREATE PUBLICATION </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> CREATE RULE</td></tr></table></div></body></html>