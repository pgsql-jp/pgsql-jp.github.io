<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>CREATE LANGUAGE</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="sql-createindex.html" title="CREATE INDEX" /><link rel="next" href="sql-creatematerializedview.html" title="CREATE MATERIALIZED VIEW" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">CREATE LANGUAGE</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="sql-createindex.html" title="CREATE INDEX">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="sql-commands.html" title="SQLコマンド">Up</a></td><th width="60%" align="center">SQLコマンド</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="sql-creatematerializedview.html" title="CREATE MATERIALIZED VIEW">Next</a></td></tr></table><hr></hr></div><div class="refentry" id="SQL-CREATELANGUAGE"><div class="titlepage"></div><a id="id-1.9.3.67.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle">CREATE LANGUAGE</span></h2><p>CREATE LANGUAGE — 新しい手続き言語を定義する</p></div><div class="refsynopsisdiv"><h2>Synopsis</h2><pre class="synopsis">CREATE [ OR REPLACE ] [ PROCEDURAL ] LANGUAGE <em class="replaceable"><code>name</code></em>
CREATE [ OR REPLACE ] [ TRUSTED ] [ PROCEDURAL ] LANGUAGE <em class="replaceable"><code>name</code></em>
    HANDLER <em class="replaceable"><code>call_handler</code></em> [ INLINE <em class="replaceable"><code>inline_handler</code></em> ] [ VALIDATOR <em class="replaceable"><code>valfunction</code></em> ]</pre></div><div class="refsect1" id="SQL-CREATELANGUAGE-DESCRIPTION"><h2>説明</h2><p><code class="command">CREATE LANGUAGE</code>は新しい手続き言語を<span class="productname">PostgreSQL</span>データベースに登録します。
これにより、関数とトリガプロシージャをその新しい言語で定義できるようになります。
  </p><div class="note"><h3 class="title">Note</h3><p><span class="productname">PostgreSQL</span> 9.1から、ほとんどの手続き言語は<span class="quote">“<span class="quote">拡張</span>”</span>としてまとめられました。
したがって<code class="command">CREATE LANGUAGE</code>ではなく<a class="xref" href="sql-createextension.html" title="CREATE EXTENSION"><span class="refentrytitle">CREATE EXTENSION</span></a>を使用してインストールすべきです。
<code class="command">CREATE LANGUAGE</code>を直接使用することは拡張インストール用スクリプトに限定されなければなりません。
おそらくアップグレードの結果<span class="quote">“<span class="quote">むきだしの</span>”</span>言語がデータベース内に存在する場合、<code class="literal">CREATE EXTENSION <em class="replaceable"><code>langname</code></em> FROM unpackaged</code>を用いて拡張に変換することができます。
   </p></div><p><code class="command">CREATE LANGUAGE</code>は、言語名とその言語で作成された関数の実行に責任を持つハンドラ関数を関連付けます。
言語ハンドラについての詳細は、<a class="xref" href="plhandler.html" title="Chapter 55. 手続き言語ハンドラの作成">Chapter 55</a>を参照してください。
  </p><p><code class="command">CREATE LANGUAGE</code>コマンドには2種類の構文があります。
最初の構文は、ユーザは必要な言語の名前のみを単に指定するものです。
この場合、<span class="productname">PostgreSQL</span>サーバは<a class="link" href="catalog-pg-pltemplate.html" title="51.37. pg_pltemplate"><code class="structname">pg_pltemplate</code></a>システムカタログを参照し、正しいパラメータを決定します。
2番目の構文では、ユーザは言語名の他に言語のパラメータも入力します。
この形式で、<code class="structname">pg_pltemplate</code>で定義されていない言語を作成することができますが、この手法は廃棄予定です。
  </p><p>指定された言語名に対応する<code class="structname">pg_pltemplate</code>カタログの項目をサーバが見つけると、コマンドに言語のパラメータが含まれていたとしてもカタログのデータを使用します。
この動作により、言語のサポート関数に関する古すぎる情報を含む、古いダンプファイルからの読み込みが簡単になります。
  </p><p>通常、新しい言語を登録するには、ユーザは<span class="productname">PostgreSQL</span>のスーパーユーザ権限を持たなければなりません。
しかし、言語が<code class="structname">pg_pltemplate</code>カタログ内に記載され、データベース所有者による作成可能印（<code class="structfield">tmpldbacreate</code>が真）が付いていれば、データベース所有者はそのデータベース内に新しい言語を登録することができます。
デフォルトで、信頼された言語はデータベース所有者による作成ができます。
しかし、これはスーパーユーザによる<code class="structname">pg_pltemplate</code>の変更により調整できます。
言語作成者が言語の所有者になり、後で削除したり、名前を変えたり、別の所有者を割り当てたりすることができます。
  </p><p><code class="command">CREATE OR REPLACE LANGUAGE</code>は新しい言語を作成、または、既存の定義を置き換えます。
言語がすでに存在する場合、パラメータは指定された値または<code class="structname">pg_pltemplate</code>から取り出された値にしたがって更新されますが、言語の所有権と権限に関する設定は変更されません。
また、その言語で作成された既存の関数も依然として有効であるものとみなされます。
言語を作成する際に通常要求される権限に加え、ユーザはスーパーユーザまたは既存言語の所有者でなければなりません。
<code class="literal">REPLACE</code>の場合、主に言語が存在することを確認するために使用することを意味します。
その言語が<code class="structname">pg_pltemplate</code>項目を持つ場合、<code class="literal">REPLACE</code>は既存の定義を実際にはまったく変更しません。
ただし、言語が作成された後で<code class="structname">pg_pltemplate</code>項目が変更されたという通常ではない場合は例外です。
  </p></div><div class="refsect1" id="SQL-CREATELANGUAGE-PARAMETERS"><h2>パラメータ</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">TRUSTED</code></span></dt><dd><p><code class="literal">TRUSTED</code>は、他の方法ではユーザがアクセスできないデータに対しては、その言語でのアクセスが許されないことを指定します。
言語の登録時にこのキーワードを省略すると、<span class="productname">PostgreSQL</span>のスーパーユーザ権限を持つユーザのみが、この言語を使って新しい関数を作れるようになります。
      </p></dd><dt><span class="term"><code class="literal">PROCEDURAL</code></span></dt><dd><p>これには意味はありません。
      </p></dd><dt><span class="term"><em class="replaceable"><code>name</code></em></span></dt><dd><p>新しい手続き言語の名前です。
この名前はデータベースの言語の中で一意でなければなりません。
      </p><p>後方互換を保持するため、この名前を単一引用符で囲むこともできます。
      </p></dd><dt><span class="term"><code class="literal">HANDLER</code> <em class="replaceable"><code>call_handler</code></em></span></dt><dd><p><em class="replaceable"><code>call_handler</code></em>は手続き言語の関数を実行するために呼び出される関数の名前で、事前に登録しておく必要があります。
このハンドラは、Version-1呼び出し規約に則って、C言語のようなコンパイル言語で書かれている必要があります。また、引数を取らず<code class="type">language_handler</code>型を返す関数として、<span class="productname">PostgreSQL</span>に登録されていなければなりません。
<code class="type">language_handler</code>型は、単に関数を呼び出しハンドラとして識別するのに使用するプレースホルダ型です。
      </p></dd><dt><span class="term"><code class="literal">INLINE</code> <em class="replaceable"><code>inline_handler</code></em></span></dt><dd><p><em class="replaceable"><code>inline_handler</code></em>はこの言語で無名コードブロックを実行（<a class="xref" href="sql-do.html" title="DO"><span class="refentrytitle">DO</span></a>コマンド）するために呼び出される、事前に登録された関数の名前です。
<em class="replaceable"><code>inline_handler</code></em>関数が指定されない場合、その言語では無名コードブロックをサポートしません。
このハンドラ関数は、<code class="command">DO</code>コマンドの内部表現となる<code class="type">internal</code>型の引数を1つ取らなければならず、また、通常<code class="type">void</code>を返します。
ハンドラの戻り値は無視されます。
      </p></dd><dt><span class="term"><code class="literal">VALIDATOR</code> <em class="replaceable"><code>valfunction</code></em></span></dt><dd><p><em class="replaceable"><code>valfunction</code></em>は、事前に登録された検証用関数の名前です。新しい関数が当該言語で作成された場合、その関数を検証するために呼び出されます。
検証用関数が指定されていない場合、新しい関数は作成時にチェックされません。
検証用関数は、<code class="type">oid</code>型の引数を1つ取る必要があります。
この引数は作成される関数のOIDになります。
また、通常<code class="type">void</code>型を返します。
      </p><p>検証用関数は、通常、関数本体が構文上正しいかどうかを検査するために使用されます。
しかし、それだけでなく、関数のプロパティも検査可能です。例えば、その言語が処理できない特定のデータ型が引数に含まれていないかなどがチェックできます。
エラーを通知するには、検証用関数で<code class="function">ereport()</code>関数を使用すべきです。
関数の戻り値は無視されます。
      </p></dd></dl></div><p>指定した言語名に対応する<code class="structname">pg_pltemplate</code>の項目がサーバにある場合、<code class="literal">TRUSTED</code>オプションとサポート関数名は無視されます。
  </p></div><div class="refsect1" id="SQL-CREATELANGUAGE-NOTES"><h2>注釈</h2><p>手続き言語を削除するには<a class="xref" href="sql-droplanguage.html" title="DROP LANGUAGE"><span class="refentrytitle">DROP LANGUAGE</span></a>を使用してください。
  </p><p>システムカタログ<code class="classname">pg_language</code>（ <a class="xref" href="catalog-pg-language.html" title="51.29. pg_language">Section 51.29</a>参照）には、現在インストールされている言語に関する情報が記録されています。
また<span class="application">psql</span>のコマンド<code class="command">\dL</code>はインストールされた言語を一覧表示します。
  </p><p>手続き言語で関数を作成するには、ユーザはその言語に対する<code class="literal">USAGE</code>権限を持たなければなりません。
デフォルトでは、信頼された言語については<code class="literal">PUBLIC</code>に（つまり全員に）<code class="literal">USAGE</code>が付与されています。
これは必要に応じて取り消すことができます。
  </p><p>手続き言語は各データベースに局所的です。
しかし、言語を<code class="literal">template1</code>データベースにインストールすることができます。
この場合、その後に作成されたすべてのデータベースで自動的にその言語は使用できるようになります。
  </p><p>呼び出しハンドラ関数とインラインハンドラ関数（もしあれば）、検証関数（もしあれば）は、サーバが<code class="structname">pg_pltemplate</code>内にその言語に関する項目を持っていない場合には、存在しなければなりません。
しかし、その項目があったとしても、関数がすでに存在しているとは限りません。
データベース内に存在していなければ自動的に定義されます。
（言語を実装する共有ライブラリがインストレーションで利用できない場合、これにより<code class="command">CREATE LANGUAGE</code>が失敗する可能性があります。）
  </p><p><span class="productname">PostgreSQL</span> 7.3より前のバージョンでは、ハンドラ関数が返すプレースホルダ型を<code class="type">language_handler</code>型ではなく<code class="type">opaque</code>型と宣言する必要がありました。
古いダンプファイルのロードをサポートするために、<code class="command">CREATE LANGUAGE</code>は<code class="type">opaque</code>型を返すと宣言された関数を受け入れます。
しかし、注意を促すメッセージを表示し、宣言された関数の戻り値型を<code class="type">language_handler</code>に変換します。
  </p></div><div class="refsect1" id="SQL-CREATELANGUAGE-EXAMPLES"><h2>例</h2><p>標準的な手続き言語を作成する推奨方法は単に以下のように行うことです。
</p><pre class="programlisting">CREATE LANGUAGE plperl;</pre><p>
  </p><p><code class="structname">pg_pltemplate</code>カタログ内に存在しない言語では、以下のような処理が必要です。
</p><pre class="programlisting">CREATE FUNCTION plsample_call_handler() RETURNS language_handler
    AS '$libdir/plsample'
    LANGUAGE C;
CREATE LANGUAGE plsample
    HANDLER plsample_call_handler;</pre></div><div class="refsect1" id="SQL-CREATELANGUAGE-COMPAT"><h2>互換性</h2><p><code class="command">CREATE LANGUAGE</code>は<span class="productname">PostgreSQL</span>の拡張です。
  </p></div><div class="refsect1" id="id-1.9.3.67.10"><h2>関連項目</h2><span class="simplelist"><a class="xref" href="sql-alterlanguage.html" title="ALTER LANGUAGE"><span class="refentrytitle">ALTER LANGUAGE</span></a>, <a class="xref" href="sql-createfunction.html" title="CREATE FUNCTION"><span class="refentrytitle">CREATE FUNCTION</span></a>, <a class="xref" href="sql-droplanguage.html" title="DROP LANGUAGE"><span class="refentrytitle">DROP LANGUAGE</span></a>, <a class="xref" href="sql-grant.html" title="GRANT"><span class="refentrytitle">GRANT</span></a>, <a class="xref" href="sql-revoke.html" title="REVOKE"><span class="refentrytitle">REVOKE</span></a></span></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="sql-createindex.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="sql-commands.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="sql-creatematerializedview.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">CREATE INDEX </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> CREATE MATERIALIZED VIEW</td></tr></table></div></body></html>