<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>19.1. パラメータの設定</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="runtime-config.html" title="Chapter 19. サーバの設定" /><link rel="next" href="runtime-config-file-locations.html" title="19.2. ファイルの場所" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">19.1. パラメータの設定</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="runtime-config.html" title="Chapter 19. サーバの設定">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="runtime-config.html" title="Chapter 19. サーバの設定">Up</a></td><th width="60%" align="center">Chapter 19. サーバの設定</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="runtime-config-file-locations.html" title="19.2. ファイルの場所">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="CONFIG-SETTING"><div class="titlepage"><div><div><h2 class="title" style="clear: both">19.1. パラメータの設定</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="config-setting.html#CONFIG-SETTING-NAMES-VALUES">19.1.1. パラメータ名とその値</a></span></dt><dt><span class="sect2"><a href="config-setting.html#CONFIG-SETTING-CONFIGURATION-FILE">19.1.2. 設定ファイルによるパラメータ操作</a></span></dt><dt><span class="sect2"><a href="config-setting.html#CONFIG-SETTING-SQL-COMMAND-INTERACTION">19.1.3. SQLを通じたパラメータ操作</a></span></dt><dt><span class="sect2"><a href="config-setting.html#id-1.6.6.4.5">19.1.4. シェルによるパラメータ操作</a></span></dt><dt><span class="sect2"><a href="config-setting.html#CONFIG-INCLUDES">19.1.5. 設定ファイルの内容の管理</a></span></dt></dl></div><div class="sect2" id="CONFIG-SETTING-NAMES-VALUES"><div class="titlepage"><div><div><h3 class="title">19.1.1. パラメータ名とその値</h3></div></div></div><p>    
    全てのパラメータの名前は大文字と小文字を区別しません。
    それぞれのパラメータは、論理値、整数、浮動小数点、文字列、またはenum（列挙型）の5つの型のいずれかの値を取ります。
型はパラメータをセットするための記法を定義します。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="emphasis"><em>論理型:</em></span>
値は<code class="literal">on</code>、<code class="literal">off</code>、<code class="literal">true</code>、<code class="literal">false</code>、<code class="literal">yes</code>、<code class="literal">no</code>、<code class="literal">1</code>、<code class="literal">0</code>（すべて大文字小文字の区別なし）、あるいは、曖昧でなければ、これらの先頭から数文字を省略形として使うこともできます。
      </p></li><li class="listitem"><p><span class="emphasis"><em>文字列型:</em></span>
一般に、単一引用符の中に値を入れます。
単一引用符を値に含める場合は単一引用符を２つ続けます。
なお、値が単純な数字や識別子である場合は、通常は引用符を省略できます。
      </p></li><li class="listitem"><p><span class="emphasis"><em>数値型(整数型と浮動小数点型):</em></span>
小数点は浮動小数点型のパラメータでのみ使用できます。
1000の位取りの区切り文字は使わないでください。
引用符は必要ありません。
      </p></li><li class="listitem"><p><span class="emphasis"><em>単位付きの数値:</em></span>
数値型のパラメータによっては暗黙的な単位を持つことがあります。
メモリの量や時間について記述するからです。
単位はキロバイト、ブロック（通常8キロバイト）、ミリ秒、秒、分などです。
修飾無しの数値によるこれらの設定においては、 <code class="structname">pg_settings</code>.<code class="structfield">unit</code> からデフォルト値が採用されます。
使い勝手を考えて、たとえば<code class="literal">'120 ms'</code>のように単位を明示的に指定することもできます。
この場合は、実際の単位に変換が行われます。
なお、この機能を使う場合は、引用符付きの文字列として値を指定しなければならないことに注意してください。
単位の名称は大文字小文字を区別します。
また、数値と単位の間に空白があっても構いません。

       </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>           有効なメモリの単位は <code class="literal">kB</code> (キロバイト),
          <code class="literal">MB</code> (メガバイト), <code class="literal">GB</code>
          (ギガバイト), <code class="literal">TB</code> (テラバイト)です。
メモリ単位の乗数は1024です。1000ではありません。
         </p></li><li class="listitem"><p>有効な時間の単位は <code class="literal">ms</code> (ミリ秒)、<code class="literal">s</code> (秒)、<code class="literal">min</code> (分)、<code class="literal">h</code> (時間)、<code class="literal">d</code> (日数) です。
         </p></li></ul></div><p>
      </p></li><li class="listitem"><p>       <span class="emphasis"><em>列挙型:</em></span>
       列挙型のパラメータは文字列パラメータと同じように記述します。
ただ、使用できる文字列の種類が決まっているだけです。
使用できる文字列は <code class="structname">pg_settings</code>.<code class="structfield">enumvals</code> で定義されています。
列挙型の値は大文字小文字を区別しません。
      </p></li></ul></div></div><div class="sect2" id="CONFIG-SETTING-CONFIGURATION-FILE"><div class="titlepage"><div><div><h3 class="title">19.1.2. 設定ファイルによるパラメータ操作</h3></div></div></div><p>   
    これらのパラメータを設定する最も基本的な方法は、<code class="filename">postgresql.conf</code><a id="id-1.6.6.4.3.2.2" class="indexterm"></a>ファイルを編集することで、これは通常 data ディレクトリに格納されています。
デフォルトのコピーはデータベースクラスタディレクトリが初期化されるときそこにインストールされます。このファイルがどういったものかの例を示します。
</p><pre class="programlisting"># This is a comment
log_connections = yes
log_destination = 'syslog'
search_path = '"$user", public'
shared_buffers = 128MB</pre><p>
1つの行毎に1つのパラメータが指定されます。
名前と値の間の等号は省略可能です。
（引用符付きのパラメータ値内を除き）空白は特に意味を持たず、何もない行は無視されます。
ハッシュ記号（<code class="literal">#</code>）はその行の後の表記がコメントであることを意味します。
単純でない識別子、または数値でないパラメータ値は単一引用符で括られなければなりません。
パラメータ値の中に単一引用符を埋め込むには、引用符を2つ（推奨）もしくはバックスラッシュ-引用符を使います。
    </p><p>この方法によりクラスタに対してデフォルト値が設定されます。
上書きされない限り、アクティブなセッションが見るのはこの値です。
次節以降では、管理者やユーザがこれらのデフォルト値を上書きする方法を説明します。
    </p><p>     <a id="id-1.6.6.4.3.4.1" class="indexterm"></a>
     
設定ファイルは、メインサーバプロセスが<span class="systemitem">SIGHUP</span>シグナルを受け取るたびに再読み込みされます。
このシグナルを手っ取り早く送信するには、コマンドラインから<code class="literal">pg_ctl reload</code>を実行するか、SQL関数の<code class="function">pg_reload_conf()</code>を呼び出します。
メインサーバプロセスは同時にこのシグナルを、現存のセッションが同様に新しい値を入手できるように、全ての現在実行しているサーバプロセスに伝播します(これは現在実行中のクライアントコマンドの処理を完了してから行われます)。
他の手段として、直接単一のサーバプロセスにシグナルを送ることも可能です。
一部のパラメータはサーバの起動時のみ設定されまするので、設定ファイル中のそれらのエントリの変更はすべて、サーバが再起動されるまで無視されます。
設定ファイル内で無効なパラメータが設定された場合も、同じように（ログには残りますが）<span class="systemitem">SIGHUP</span> 処理中は無視されます。
    </p><p><code class="filename">postgresql.conf</code>に加え、<span class="productname">PostgreSQL</span>のデータディレクトリには <code class="filename">postgresql.auto.conf</code><a id="id-1.6.6.4.3.5.4" class="indexterm"></a>というファイルがあります。
このファイルは <code class="filename">postgresql.conf</code> と同じフォーマットですが、決して手動で編集してはいけません。
このファイルは <a class="xref" href="sql-altersystem.html" title="ALTER SYSTEM"><span class="refentrytitle">ALTER SYSTEM</span></a> コマンドを使った設定値を保存します。
このファイルは<code class="filename">postgresql.conf</code> が読み込まれるときはいつでも自動的に読み込まれ、同じように設定が反映されます。
<code class="filename">postgresql.auto.conf</code>は、<code class="filename">postgresql.conf</code>の設定を上書きします。
    </p><p>システムビューの<a class="link" href="view-pg-file-settings.html" title="51.69. pg_file_settings"><code class="structname">pg_file_settings</code></a>は、設定ファイルへの変更を前もってテストしたい場合や、<span class="systemitem">SIGHUP</span>シグナルで望み通りの効果がなかった場合に問題を調査する際に役立ちます。
    </p></div><div class="sect2" id="CONFIG-SETTING-SQL-COMMAND-INTERACTION"><div class="titlepage"><div><div><h3 class="title">19.1.3. SQLを通じたパラメータ操作</h3></div></div></div><p>    <span class="productname">PostgreSQL</span>は3つのSQLコマンドでデフォルト値を設定します。
    すでに説明した<a class="xref" href="sql-altersystem.html" title="ALTER SYSTEM"><span class="refentrytitle">ALTER SYSTEM</span></a>コマンドは、SQLによってグローバルな設定値を変更する方法を提供します; <code class="filename">postgresql.conf</code>を編集するのと等価です。これに加え、データベース単位あるいはロール単位で設定するためのコマンドがあります:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>      <a class="xref" href="sql-alterdatabase.html" title="ALTER DATABASE"><span class="refentrytitle">ALTER DATABASE</span></a>コマンドはデータベース単位でグローバルな設定値を上書きします。
      </p></li><li class="listitem"><p>      <a class="xref" href="sql-alterrole.html" title="ALTER ROLE"><span class="refentrytitle">ALTER ROLE</span></a>コマンドはグローバルと、データベース単位の両方をユーザ固有の設定値で上書きします。
      </p></li></ul></div><p>     <code class="command">ALTER DATABASE</code>と<code class="command">ALTER ROLE</code>による設定値は新しくデータベースセッションを開始した時にのみ適用されます。
これらのコマンドは設定ファイルやサーバへのコマンド引数による設定値を上書きし、セッションの以後の状態に適用します。なお、一部の設定はサーバを起動した後では変更できず、これらのコマンドを使っては設定できません(以下に記述するコマンドでも同じことが言えます)。
    </p><p>クライアントがデータベースに接続すると、<span class="productname">PostgreSQL</span>では更に2つのSQL(そして同等の関数)を使ってセッションローカルの設定変更を行うことができます。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>     <a class="xref" href="sql-show.html" title="SHOW"><span class="refentrytitle">SHOW</span></a>コマンドを使ってすべてのパラメータの現在の値を調べることができます。
対応する関数は<code class="function">current_setting(setting_name text)</code>です。
     </p></li><li class="listitem"><p>      <a class="xref" href="sql-set.html" title="SET"><span class="refentrytitle">SET</span></a>でセッション内でローカルに変更できるパラメータの値を変更することができます。対応する関数は<code class="function">set_config(setting_name, new_value, is_local)</code>です。
      </p></li></ul></div><p>更にシステムビューの<a class="link" href="view-pg-settings.html" title="51.85. pg_settings"><code class="structname">pg_settings</code></a>を使ってセッションローカルな値を参照したり変更することができます。
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>     このビューを問い合わせるのは、<code class="command">SHOW ALL</code>を使うのと同じですが、更に詳細な情報を提供します。
フィルター条件を指定したり他のリレーションと結合ができるので、より柔軟です。
      </p></li><li class="listitem"><p>このビューに対して<a class="xref" href="sql-update.html" title="UPDATE"><span class="refentrytitle">UPDATE</span></a>を実行する、具体的には<code class="structname">setting</code>列を更新することは、<code class="command">SET</code>コマンドを実行するのと同等です。
たとえば、
</p><pre class="programlisting">SET configuration_parameter TO DEFAULT;</pre><p>
は
</p><pre class="programlisting">UPDATE pg_settings SET setting = reset_val WHERE name = 'configuration_parameter';</pre><p>
と同じです。
      </p></li></ul></div></div><div class="sect2" id="id-1.6.6.4.5"><div class="titlepage"><div><div><h3 class="title">19.1.4. シェルによるパラメータ操作</h3></div></div></div><p>      グローバルなデフォルト値を設定したりデータベース、ロール単位で上書きを行えるだけでなく、シェル機能を使って<span class="productname">PostgreSQL</span>に設定値を渡すことができます。
サーバも<span class="application">libpq</span>クライアントライブラリもシェル経由でパラメータ値を受けとることができます。
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>      サーバ起動時に、<code class="option">-c</code>コマンドラインパラメータを使ってパラメータ設定値を<code class="command">postgres</code>に渡すことができます。たとえば、
</p><pre class="programlisting">postgres -c log_connections=yes -c log_destination='syslog'</pre><p>
       このようにして渡された設定値は、<code class="filename">postgresql.conf</code>や<code class="command">ALTER SYSTEM</code>による設定を上書きします。
したがってサーバを再起動しない限りこれらの設定値をグローバルに変更することはできません。
     </p></li><li class="listitem"><p>      <span class="application">libpq</span>を使ってクライアントセッションを開始するときに<code class="envar">PGOPTIONS</code>環境変数を使って設定値を指定できます。
このようにして渡された設定値はセッションのデフォルトとなりますが、他のセッションには影響を与えません。
歴史的な理由により、<code class="envar">PGOPTIONS</code>の形式は<code class="command">postgres</code>を起動するときのものと似ています。たとえば、<code class="option">-c</code>フラグを指定しなければならない点です。
</p><pre class="programlisting">env PGOPTIONS="-c geqo=off -c statement_timeout=5min" psql</pre><p>
     </p><p>     他のクライアントやライブラリではそれぞれ固有の方法でシェルなどを経由して、SQLコマンドを直接使わずにセッションの設定を変更することができるかもしれません。
     </p></li></ul></div></div><div class="sect2" id="CONFIG-INCLUDES"><div class="titlepage"><div><div><h3 class="title">19.1.5. 設定ファイルの内容の管理</h3></div></div></div><p>      <span class="productname">PostgreSQL</span>は複雑な<code class="filename">postgresql.conf</code>ファイルを複数の小さなファイルに分割する複数の方法を提供しています。
これは、とりわけお互いに関連しているものの設定が同じではない複数のサーバを管理する際に有用です。
     </p><p>      <a id="id-1.6.6.4.6.3.1" class="indexterm"></a>
      
パラメータ設定に加え、<code class="filename">postgresql.conf</code>ファイルに<em class="firstterm">includeディレクティブ</em>を入れることができます。
このようにすると、別のファイルがあたかも設定ファイルのその場所に挿入されているかのごとく読み込まれ、処理されるように指定されます。
この機能により、設定ファイルを物理的に異なる複数のパーツに分解することができます。
Includeディレクティブは単に次のような形式になります。
</p><pre class="programlisting">include 'ファイル名'</pre><p>
ファイル名が絶対パスでない場合、参照する設定ファイルを含むディレクトリからの相対パスであると受け取られます。
Includeコマンドは入れ子にすることができます。
     </p><p>      <a id="id-1.6.6.4.6.4.1" class="indexterm"></a>
<code class="literal">include_if_exists</code>ディレクティブもあります。
これは参照ファイルが存在しないか、または読み込むことができない場合の動作を除き、<code class="literal">include</code>ディレクティブと同一の動作をします。
通常の<code class="literal">include</code>はこれをエラーと解釈しますが、<code class="literal">include_if_exists</code>はただ単にメッセージをログ出力し、そして参照している設定ファイルの処理を続けます。
     </p><p>      <a id="id-1.6.6.4.6.5.1" class="indexterm"></a>
includeする設定ファイルを含むディレクトリ全体を指定する<code class="literal">include_dir</code>ディレクティブを、<code class="filename">postgresql.conf</code>ファイルに含めることもできます。
このような感じです。
</p><pre class="programlisting">include_dir 'ディレクトリ名'</pre><p>
絶対パスではないディレクトリ名はその設定ファイルがあるディレクトリへの相対パスと見なされます。
指定したディレクトリの中で、ディレクトリではないファイルで末尾が<code class="literal">.conf</code>で終わるファイルだけがincludeされます。
また、文字<code class="literal">.</code> で開始するファイル名は一部のプラットフォームでは隠しファイルとされるので、間違いを防止するため無視されます。
includeされるディレクトリにある複数ファイルはファイル名順に処理されます(ファイル名は C ロケール規則で順序付けされます。
つまり、文字より数字、小文字より大文字が先になります)。
     </p><p>     
includeされるファイルもしくはディレクトリは、大きな単一の<code class="filename">postgresql.conf</code>ファイルを使う代わりに、データベース設定の一部分を論理的に分離するために使用することが可能です。
異なるメモリー容量を持つ二つのデータベースサーバを所有する会社を考えてみてください。
例えばログ取得のように、二つが共有する設定の要素があると思われます。
しかし、サーバ上のメモリに関連したパラメータは二つの間では異なります。
更に、サーバ特有のカスタマイズも存在することがあります。
この状況に対処する一つの方法として、そのサイトに対するカスタマイズされた設定の変更を三つのファイルにすることです。
それらをincludeするためには<code class="filename">postgresql.conf</code>ファイルの最後に以下を追加します。
</p><pre class="programlisting">include 'shared.conf'
include 'memory.conf'
include 'server.conf'</pre><p>
全てのシステムは同一の<code class="filename">shared.conf</code>を所有する様になるでしょう。
特定のメモリー容量を所有するそれぞれのサーバは同じ<code class="filename">memory.conf</code>を共有できます。
RAMが8GBのすべてのサーバには共通の<code class="filename">memory.conf</code>を1つ使い、16GBのサーバ群には別のものを使う、ということもできるでしょう。
そして最後の<code class="filename">server.conf</code>には、本当にサーバ固有となる設定情報を記載します。
     </p><p>     
別の方法として、設定ファイルディレクトリを作成し、この情報をそこのファイルに格納することができます。
たとえば、<code class="filename">conf.d</code>ディレクトリを<code class="filename">postgresql.conf</code>の最後で参照するようにできます。
</p><pre class="programlisting">include_dir 'conf.d'</pre><p>
そして、<code class="filename">conf.d</code>の中のファイルを以下のような名前にすることができます。
</p><pre class="programlisting">00shared.conf
01memory.conf
02server.conf</pre><p>
 
この命名規則により、これらのファイルが読み込まれる順序が明確になります。
サーバが設定を読み込んでいるときに各パラメータについて最後にあった設定だけが使用されるので、このことは重要です。
この例では、<code class="filename">conf.d/02server.conf</code>でされた指定は<code class="filename">conf.d/01memory.conf</code>の設定値よりも優先します。
     </p><p>     
代わりに以下の方法を使って、ファイルにわかりやすい名前をつけることもできます。
</p><pre class="programlisting">00shared.conf
01memory-8GB.conf
02server-foo.conf</pre><p>
 
こういった工夫で、設定ファイルのバリエーションに対して固有の名前を付与することができます。
また、バージョン管理リポジトリのリポジトリに複数のサーバの設定ファイルを置く場合に生じる曖昧さを排除することができます。
（データベース設定ファイルをバージョン管理することは、これもまた検討に値するやり方です）。
     </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="runtime-config.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="runtime-config.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="runtime-config-file-locations.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 19. サーバの設定 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 19.2. ファイルの場所</td></tr></table></div></body></html>