<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>8.4. バイナリ列データ型</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="datatype-character.html" title="8.3. 文字型" /><link rel="next" href="datatype-datetime.html" title="8.5. 日付/時刻データ型" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">8.4. バイナリ列データ型</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="datatype-character.html" title="8.3. 文字型">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="datatype.html" title="Chapter 8. データ型">Up</a></td><th width="60%" align="center">Chapter 8. データ型</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="datatype-datetime.html" title="8.5. 日付/時刻データ型">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="DATATYPE-BINARY"><div class="titlepage"><div><div><h2 class="title" style="clear: both">8.4. バイナリ列データ型</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="datatype-binary.html#id-1.5.7.12.9">8.4.1. <code class="type">bytea</code>のhex書式</a></span></dt><dt><span class="sect2"><a href="datatype-binary.html#id-1.5.7.12.10">8.4.2. <code class="type">bytea</code>のエスケープ書式</a></span></dt></dl></div><a id="id-1.5.7.12.2" class="indexterm"></a><a id="id-1.5.7.12.3" class="indexterm"></a><p><code class="type">bytea</code>データ型はバイナリ列の保存を可能にします。
<a class="xref" href="datatype-binary.html#DATATYPE-BINARY-TABLE" title="Table 8.6. バイナリ列データ型">Table 8.6</a>を参照してください。
   </p><div class="table" id="DATATYPE-BINARY-TABLE"><p class="title"><strong>Table 8.6. バイナリ列データ型</strong></p><div class="table-contents"><table class="table" summary="バイナリ列データ型" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>型名</th><th>格納サイズ</th><th>説明</th></tr></thead><tbody><tr><td><code class="type">bytea</code></td><td>1または4バイトと実際のバイナリ列の長さ</td><td>可変長のバイナリ列</td></tr></tbody></table></div></div><br class="table-break" /><p>バイナリ列はオクテット（またはバイト）の連続です。
バイナリ列は２つの点で文字列と区別されます。
1点目は、バイナリ列はゼロの値のオクテットと他の<span class="quote">“<span class="quote">表示できない</span>”</span>オクテット（通常32から126の範囲外のオクテット）を保存できるということです。
文字列ではゼロというオクテットは使用できません。
また、データベースで選択している文字セット符号化方式で無効なオクテット値やオクテット値の並びも使用できません。
2点目は、バイナリ列を演算すると実際のバイトが処理されるのに対して、文字列の処理はロケール設定に従うということです。
まとめると、バイナリ列はプログラマが<span class="quote">“<span class="quote">バイト列そのもの</span>”</span>と考えるものを格納するのに適し、文字列はテキストを格納するのに適しています。
   </p><p><code class="type">bytea</code>型は入出力用に2つの外部書式をサポートします。
<span class="productname">PostgreSQL</span>の歴史的な<span class="quote">“<span class="quote">エスケープ</span>”</span>書式と<span class="quote">“<span class="quote">hex</span>”</span>です。
入力ではこれらの両方とも常に受け入れられます。
出力書式は<a class="xref" href="runtime-config-client.html#GUC-BYTEA-OUTPUT">bytea_output</a>設定パラメータに依存し、デフォルトではhexです。
（hex書式は<span class="productname">PostgreSQL</span> 9.0から導入されたものであることに注意してください。
以前のバージョンや一部のツールではこれを理解しません。）
   </p><p>標準<acronym class="acronym">SQL</acronym>は、<code class="type">BLOB</code>または<code class="type">BINARY LARGE OBJECT</code>という、異なるバイナリ列型を定義します。
入力書式は<code class="type">bytea</code>と異なりますが、提供される関数および演算子はほぼ同じです。
   </p><div class="sect2" id="id-1.5.7.12.9"><div class="titlepage"><div><div><h3 class="title">8.4.1. <code class="type">bytea</code>のhex書式</h3></div></div></div><p><span class="quote">“<span class="quote">hex</span>”</span>書式ではバイナリデータの各バイトを上位4ビット、下位4ビットの順で2桁の16進数に符号化します。
（エスケープ書式と区別するために）文字列全体は<code class="literal">\x</code>という並びの後に付けられます。
一部の文脈では、先頭のバックスラッシュを二重にしてエスケープさせる必要があるかもしれません。
これはエスケープ書式でバックスラッシュを二重にしなければならない場合と同じで、詳細は以下に示します。
16進数の桁は大文字でも小文字でも構いません。
桁の組み合わせと次の組み合わせの間に空白文字を入れることができます。
（しかし桁の組み合わせの間や先頭の<code class="literal">\x</code>の間には入れることはできません。）
hex書式は外部のアプリケーションおよびプロトコルの間で広く互換性を持ち、また、エスケープ書式と比べ変換が高速になる傾向があります。
このため使用が好まれます。
   </p><p>例
</p><pre class="programlisting">SELECT E'\\xDEADBEEF';</pre><p>
   </p></div><div class="sect2" id="id-1.5.7.12.10"><div class="titlepage"><div><div><h3 class="title">8.4.2. <code class="type">bytea</code>のエスケープ書式</h3></div></div></div><p><span class="quote">“<span class="quote">エスケープ</span>”</span>書式は<code class="type">bytea</code>型用の伝統的な<span class="productname">PostgreSQL</span>の書式です。
これは、バイナリ列をASCII文字の並びとして表現しASCII文字として表現できないバイトは特殊なエスケープシーケンスとして表現するという方式を取ります。
アプリケーションの見地から文字として表現されたバイトが有意であれば、この表現は簡便です。
しかし現実にはバイナリ列と文字列の間の区別があいまいになりますので、通常は混乱します。
また選択されたこのエスケープ機構自体が多少非効率的です。
このためこの書式はおそらくほとんどの新しいアプリケーションでは避けるべきでしょう。
   </p><p>エスケープ書式で<code class="type">bytea</code>値を入力する際に、特定の値のオクテットをエスケープする<span class="emphasis"><em>必要</em></span>があります。
なお、すべてのオクテットの値をエスケープすることが<span class="emphasis"><em>できます</em></span>。
一般的にあるオクテットをエスケープするには、それをその3桁の8進数に変換し、バックスラッシュ(エスケープ文字列構文を使用してリテラルとして値を記述する場合は2つのバックスラッシュ)を前に付けます。
他にもバックスラッシュ自体(オクテット値92)を二重のバックスラッシュとして表現することができます。
<a class="xref" href="datatype-binary.html#DATATYPE-BINARY-SQLESC" title="Table 8.7. オクテットをエスケープしたbyteaリテラル">Table 8.7</a>には、エスケープする必要がある文字と、その適用可能な代替エスケープシーケンスを示しています。
   </p><div class="table" id="DATATYPE-BINARY-SQLESC"><p class="title"><strong>Table 8.7. オクテットをエスケープした<code class="type">bytea</code>リテラル</strong></p><div class="table-contents"><table class="table" summary="オクテットをエスケープしたbyteaリテラル" border="1"><colgroup><col /><col /><col /><col /><col /></colgroup><thead><tr><th>10進オクテット値</th><th>説明</th><th>エスケープされた入力表現</th><th>例</th><th>出力表現</th></tr></thead><tbody><tr><td>0</td><td>ゼロオクテット</td><td><code class="literal">E'\\000'</code></td><td><code class="literal">SELECT E'\\000'::bytea;</code></td><td><code class="literal">\000</code></td></tr><tr><td>39</td><td>単一引用符</td><td><code class="literal">''''</code>もしくは<code class="literal">E'\\047'</code></td><td><code class="literal">SELECT E'\''::bytea;</code></td><td><code class="literal">'</code></td></tr><tr><td>92</td><td>バックスラッシュ</td><td><code class="literal">E'\\\\'</code>もしくは<code class="literal">E'\\134'</code></td><td><code class="literal">SELECT E'\\\\'::bytea;</code></td><td><code class="literal">\\</code></td></tr><tr><td>0から31まで、および127から255まで</td><td><span class="quote">“<span class="quote">表示できない</span>”</span>オクテット</td><td><code class="literal">E'\\<em class="replaceable"><code>xxx'</code></em></code> (8進数)</td><td><code class="literal">SELECT E'\\001'::bytea;</code></td><td><code class="literal">\001</code></td></tr></tbody></table></div></div><br class="table-break" /><p>実際には、<span class="emphasis"><em>表示できない</em></span>オクテットに対するエスケープ要求はロケールの設定に依存して異なります。
ロケールの設定によっては、エスケープをしないで済むこともあります。
<a class="xref" href="datatype-binary.html#DATATYPE-BINARY-SQLESC" title="Table 8.7. オクテットをエスケープしたbyteaリテラル">Table 8.7</a>の例の各結果は、出力表現が時として2文字以上であっても、長さは正確に1オクテットであることに注意してください。
   </p><p><a class="xref" href="datatype-binary.html#DATATYPE-BINARY-SQLESC" title="Table 8.7. オクテットをエスケープしたbyteaリテラル">Table 8.7</a>で示したように、複数バックスラッシュが必要な理由は、文字列リテラルとして記述された入力文字列は、<span class="productname">PostgreSQL</span>サーバ上で2つの解析段階を通過する必要があることです。
各組み合わせの最初のバックスラッシュは文字列リテラル用パーサでエスケープ文字と解釈（エスケープ文字列構文の使用を前提）され、2番目のバックスラッシュを残して、そこで消費されます。
（この段階のエスケープを避けるためにドル引用符による文字列を使用することができます。）
残りのバックスラッシュは、<code class="type">bytea</code>入力関数が3桁のオクテット値の先頭に付く記号、もしくは、他のバックスラッシュをエスケープする記号として認識します。
例えば、<code class="literal">E'\\001'</code>としてサーバに渡された文字列リテラルは、エスケープ文字列パーサを通過した後<code class="literal">\001</code>のようになります。
<code class="literal">\001</code>はその後<code class="type">bytea</code>入力関数に送られ、10進数値1の1つのオクテットに変換されます。
単一引用符文字は<code class="type">bytea</code>では特別に扱われず、通常の文字列リテラルの規則に従うことに注意してください。
（<a class="xref" href="sql-syntax-lexical.html#SQL-SYNTAX-STRINGS" title="4.1.2.1. 文字列定数">Section 4.1.2.1</a>も参照してください。）
   </p><p>また、<code class="type">Bytea</code>オクテットは出力時も時々エスケープされます。
一般的には、各<span class="quote">“<span class="quote">表示できない</span>”</span>オクテットは、1つのバックスラッシュの後に等価な3桁8進数という形に変換されます。
ほとんどの<span class="quote">“<span class="quote">表示できる</span>”</span>オクテットは、クライアント文字セットにおける標準表現で表されます。
10進数で92となるオクテット（バックスラッシュ）は出力では二重になります。
詳細は<a class="xref" href="datatype-binary.html#DATATYPE-BINARY-RESESC" title="Table 8.8. bytea出力のエスケープされたオクテット">Table 8.8</a>に示します。
   </p><div class="table" id="DATATYPE-BINARY-RESESC"><p class="title"><strong>Table 8.8. <code class="type">bytea</code>出力のエスケープされたオクテット</strong></p><div class="table-contents"><table class="table" summary="bytea出力のエスケープされたオクテット" border="1"><colgroup><col /><col /><col /><col /><col /></colgroup><thead><tr><th>10進オクテット値</th><th>説明</th><th>エスケープされた出力表現</th><th>例</th><th>出力結果</th></tr></thead><tbody><tr><td>92</td><td>バックスラッシュ</td><td><code class="literal">\\</code></td><td><code class="literal">SELECT E'\\134'::bytea;</code></td><td><code class="literal">\\</code></td></tr><tr><td>0から31および127から255</td><td><span class="quote">“<span class="quote">表示できない</span>”</span>オクテット</td><td><code class="literal">\<em class="replaceable"><code>xxx</code></em></code>（8進数）</td><td><code class="literal">SELECT E'\\001'::bytea;</code></td><td><code class="literal">\001</code></td></tr><tr><td>32から126</td><td><span class="quote">“<span class="quote">表示できる</span>”</span>オクテット</td><td>クライアント文字セットにおける表現</td><td><code class="literal">SELECT E'\\176'::bytea;</code></td><td><code class="literal">~</code></td></tr></tbody></table></div></div><br class="table-break" /><p>使用する<span class="productname">PostgreSQL</span>のフロントエンドによっては、<code class="type">bytea</code>文字列をエスケープまたはアンエスケープする際に、追加的な作業が必要になることがあります。
例えば、使用するインタフェースが改行文字や復帰文字を自動的に翻訳してしまう場合、これらの文字もエスケープしなければならないかもしれません。
   </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="datatype-character.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="datatype.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="datatype-datetime.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">8.3. 文字型 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 8.5. 日付/時刻データ型</td></tr></table></div></body></html>