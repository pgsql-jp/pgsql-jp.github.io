<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>F.25. pg_buffercache</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="passwordcheck.html" title="F.24. passwordcheck" /><link rel="next" href="pgcrypto.html" title="F.26. pgcrypto" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">F.25. pg_buffercache</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="passwordcheck.html" title="F.24. passwordcheck">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="contrib.html" title="Appendix F. 追加で提供されるモジュール">Up</a></td><th width="60%" align="center">Appendix F. 追加で提供されるモジュール</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="pgcrypto.html" title="F.26. pgcrypto">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="PGBUFFERCACHE"><div class="titlepage"><div><div><h2 class="title" style="clear: both">F.25. pg_buffercache</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="pgbuffercache.html#id-1.11.7.34.7">F.25.1. <code class="structname">pg_buffercache</code>ビュー</a></span></dt><dt><span class="sect2"><a href="pgbuffercache.html#id-1.11.7.34.8">F.25.2. サンプル出力</a></span></dt><dt><span class="sect2"><a href="pgbuffercache.html#id-1.11.7.34.9">F.25.3. 作者</a></span></dt></dl></div><a id="id-1.11.7.34.2" class="indexterm"></a><p><code class="filename">pg_buffercache</code>モジュールは、共有バッファキャッシュで何が起きているかをリアルタイムに確認する方法を提供します。
 </p><a id="id-1.11.7.34.4" class="indexterm"></a><p>このモジュールはレコード集合を返す<code class="function">pg_buffercache_pages</code> C関数と、簡単に利用できるようにこの関数を隠蔽する<code class="structname">pg_buffercache</code>ビューを提供します。
 </p><p>デフォルトでは、使用はスーパーユーザと<code class="literal">pg_read_all_stats</code>ロールのメンバに限定されています。
<code class="command">GRANT</code>を使って他人にアクセス権を付与できます。
 </p><div class="sect2" id="id-1.11.7.34.7"><div class="titlepage"><div><div><h3 class="title">F.25.1. <code class="structname">pg_buffercache</code>ビュー</h3></div></div></div><p>ビューによって公開されている列の定義を<a class="xref" href="pgbuffercache.html#PGBUFFERCACHE-COLUMNS" title="Table F.16. pg_buffercacheの列">Table F.16</a>に示します。
  </p><div class="table" id="PGBUFFERCACHE-COLUMNS"><p class="title"><strong>Table F.16. <code class="structname">pg_buffercache</code>の列</strong></p><div class="table-contents"><table class="table" summary="pg_buffercacheの列" border="1"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th>名前</th><th>型</th><th>参照</th><th>説明</th></tr></thead><tbody><tr><td><code class="structfield">bufferid</code></td><td><code class="type">integer</code></td><td> </td><td>1から<code class="varname">shared_buffers</code>までの範囲で示されるID</td></tr><tr><td><code class="structfield">relfilenode</code></td><td><code class="type">oid</code></td><td><code class="literal">pg_class.relfilenode</code></td><td>リレーションのファイルノード番号</td></tr><tr><td><code class="structfield">reltablespace</code></td><td><code class="type">oid</code></td><td><code class="literal">pg_tablespace.oid</code></td><td>リレーションのテーブル空間OID</td></tr><tr><td><code class="structfield">reldatabase</code></td><td><code class="type">oid</code></td><td><code class="literal">pg_database.oid</code></td><td>リレーションのデータベースOID</td></tr><tr><td><code class="structfield">relforknumber</code></td><td><code class="type">smallint</code></td><td> </td><td>リレーション内のフォーク番号。<code class="filename">include/common/relpath.h</code>参照</td></tr><tr><td><code class="structfield">relblocknumber</code></td><td><code class="type">bigint</code></td><td> </td><td>リレーション内のページ番号</td></tr><tr><td><code class="structfield">isdirty</code></td><td><code class="type">boolean</code></td><td> </td><td>ダーティページかどうか</td></tr><tr><td><code class="structfield">usagecount</code></td><td><code class="type">smallint</code></td><td> </td><td>Clock-sweepアクセスカウント</td></tr><tr><td><code class="structfield">pinning_backends</code></td><td><code class="type">integer</code></td><td> </td><td>このバッファをピン留めしているバックエンドの数</td></tr></tbody></table></div></div><br class="table-break" /><p>共有キャッシュ内の各バッファに対して、1行が存在します。
未使用のバッファは、<code class="structfield">bufferid</code>を除き、すべてのフィールドがNULLになります。
共有システムカタログは、OIDがゼロのデータベースに属するものとして表示されます。
  </p><p>キャッシュはすべてのデータベースで共有されているため、現在のデータベースに属さないリレーションのページも表示されます。
これは、一部の行に対して一致する<code class="structname">pg_class</code>の結合行が存在しない、間違った結合をしてしまう可能性すらあることを意味します。
<code class="structname">pg_class</code>に対して結合しようとする場合、現在のデータベースのOIDまたは0と等しい<code class="structfield">reldatabase</code>を持つ行に限定して結合することをお勧めします。
  </p><p><code class="structname">pg_buffercache</code>ビューにアクセスがあると、ビューが表示するすべてのバッファ状態をコピーするために十分な期間、内部バッファマネージャはロックを取得します。
これにより、一貫した結果集合が生成されること、また、必要以上に長く通常のバッファ操作がブロックされないことが保証されます。
とは言え、このビューが頻繁に読み取られると、データベース性能に多少影響が発生する可能性があります。
  </p></div><div class="sect2" id="id-1.11.7.34.8"><div class="titlepage"><div><div><h3 class="title">F.25.2. サンプル出力</h3></div></div></div><pre class="screen">regression=# SELECT c.relname, count(*) AS buffers
             FROM pg_buffercache b INNER JOIN pg_class c
             ON b.relfilenode = pg_relation_filenode(c.oid) AND
                b.reldatabase IN (0, (SELECT oid FROM pg_database
                                      WHERE datname = current_database()))
             GROUP BY c.relname
             ORDER BY 2 DESC
             LIMIT 10;

             relname             | buffers
---------------------------------+---------
 tenk2                           |     345
 tenk1                           |     141
 pg_proc                         |      46
 pg_class                        |      45
 pg_attribute                    |      43
 pg_class_relname_nsp_index      |      30
 pg_proc_proname_args_nsp_index  |      28
 pg_attribute_relid_attnam_index |      26
 pg_depend                       |      22
 pg_depend_reference_index       |      20
(10 rows)</pre></div><div class="sect2" id="id-1.11.7.34.9"><div class="titlepage"><div><div><h3 class="title">F.25.3. 作者</h3></div></div></div><p>   Mark Kirkwood <code class="email">&lt;<a class="email" href="mailto:markir@paradise.net.nz">markir@paradise.net.nz</a>&gt;</code>
  </p><p>設計協力: Neil Conway <code class="email">&lt;<a class="email" href="mailto:neilc@samurai.com">neilc@samurai.com</a>&gt;</code>
  </p><p>デバッグのアドバイス: Tom Lane <code class="email">&lt;<a class="email" href="mailto:tgl@sss.pgh.pa.us">tgl@sss.pgh.pa.us</a>&gt;</code>
  </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="passwordcheck.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="contrib.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="pgcrypto.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">F.24. passwordcheck </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> F.26. pgcrypto</td></tr></table></div></body></html>