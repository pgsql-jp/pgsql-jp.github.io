<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>59.3. PostgreSQLの遺伝的問い合わせ最適化（GEQO）</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="geqo-intro2.html" title="59.2. 遺伝的アルゴリズム" /><link rel="next" href="geqo-biblio.html" title="59.4. さらに深く知るには" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">59.3. PostgreSQLの遺伝的問い合わせ最適化（<acronym xmlns="http://www.w3.org/1999/xhtml" class="acronym">GEQO</acronym>）</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="geqo-intro2.html" title="59.2. 遺伝的アルゴリズム">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="geqo.html" title="Chapter 59. 遺伝的問い合わせ最適化">Up</a></td><th width="60%" align="center">Chapter 59. 遺伝的問い合わせ最適化</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="geqo-biblio.html" title="59.4. さらに深く知るには">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="GEQO-PG-INTRO"><div class="titlepage"><div><div><h2 class="title" style="clear: both">59.3. PostgreSQLの遺伝的問い合わせ最適化（<acronym class="acronym">GEQO</acronym>）</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="geqo-pg-intro.html#id-1.10.12.5.6">59.3.1. <acronym class="acronym">GEQO</acronym>を使用した計画候補の生成</a></span></dt><dt><span class="sect2"><a href="geqo-pg-intro.html#GEQO-FUTURE">59.3.2. <span class="productname">PostgreSQL</span> <acronym class="acronym">GEQO</acronym>の今後の実装作業</a></span></dt></dl></div><p><acronym class="acronym">GEQO</acronym>のモジュールは、問い合わせ最適化問題をあたかもよく知られている巡回セールスマン問題（<acronym class="acronym">TSP</acronym>）のように扱います。
可能な問い合わせプランは、整数の文字列として符号化されます。
それぞれの文字列は、問い合わせの1つのリレーションから次へと結合の順番を表します。
例えば、以下の結合ツリーは整数文字列「4-1-3-2」によって符号化されています。
</p><pre class="literallayout">   /\
  /\ 2
 /\ 3
4  1</pre><p>
これが意味するのは、まずリレーション「4」と「1」を、次に「3」を、そして「2」を結合するということです。
ここで1、2、3、4は<span class="productname">PostgreSQL</span>オプティマイザ内でリレーションIDを表します。
   </p><p><span class="productname">PostgreSQL</span>における<acronym class="acronym">GEQO</acronym>実装の特有な特徴は下記の様なものです。

    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p><em class="firstterm">定常状態</em><acronym class="acronym">GA</acronym>の使用（世代全体の置き換えではなく、個体の中で適応度の低いものだけの置き換え）は、改良された問い合わせ計画へ素早い収束を可能にします。
これは、妥当な時間内での問い合わせ処理にはきわめて重要です。
      </p></li><li class="listitem" style="list-style-type: disc"><p><acronym class="acronym">GA</acronym>による<acronym class="acronym">TSP</acronym>の解決策の辺損失を低く抑えるため、非常に適した<em class="firstterm">辺再組合せ交叉</em>を使用します。
      </p></li><li class="listitem" style="list-style-type: disc"><p><acronym class="acronym">TSP</acronym>の合法な巡回を行うために必要な修復処理を要求しないように、遺伝的演算子の突然変異は無視しています。
      </p></li></ul></div><p>
   </p><p><acronym class="acronym">GEQO</acronym>モジュールの部品は D. WhitleyのGenitorアルゴリズムを適合させたものです。
   </p><p><acronym class="acronym">GEQO</acronym>モジュールにより、<span class="productname">PostgreSQL</span>問い合わせオプティマイザが、大きな結合問い合わせをしらみつぶし検索以外の方法で実行することが可能になります。
   </p><div class="sect2" id="id-1.10.12.5.6"><div class="titlepage"><div><div><h3 class="title">59.3.1. <acronym class="acronym">GEQO</acronym>を使用した計画候補の生成</h3></div></div></div><p><acronym class="acronym">GEQO</acronym>の計画作成では、個々のリレーションのスキャンに対する計画を生成するために標準のプランナが使用されます。
そして、結合計画が遺伝的手法を用いて展開されます。
上で示した通り、
結合計画候補はそれぞれ、基本リレーションの結合順によって表現されています。
初期段階では、<acronym class="acronym">GEQO</acronym>コードは単純にランダムに取り得る結合順をいくつか生成します。
考慮された結合順それぞれについて、標準プランナコードが呼び出され、その結合順を使用して問い合わせを行った場合のコストを推定します。
（結合順の各段階において、全体で3つの取り得る結合戦略が考慮されます。
そして、あらかじめ決められたリレーションスキャン計画もすべて利用可能です。
推定コストとはこれらの可能性の中から最も安価なものです。）
より低い推定コストの結合順を、より高い推定コストのものより<span class="quote">“<span class="quote">より高い適応度</span>”</span>と判断します。
遺伝的アルゴリズムは適応度が低い候補を破棄します。
そして、より多く合致する候補の遺伝子を組み合わせて、つまり、検討すべき新しい順序を作成するために既知の低コスト結合順をランダムに位置を選択して、新しい候補が生成されます。
事前に設定された数まで結合順を検討するまで、この処理が繰り返されます。
そして、この検索の間にもっとも優れたものが、最終的な計画を生成するために使用されます。
   </p><p>初期の群を選択する時、および、その後の最善の候補の突然変異の時に無作為な選択がなされますので、この処理は生来非決定論的なものです。
選択された計画の予期せぬ変化を避けるために、GEQOアルゴリズムの各実行では乱数生成器を現在の<a class="xref" href="runtime-config-query.html#GUC-GEQO-SEED">geqo_seed</a>パラメータ設定で再スタートさせます。
<code class="varname">geqo_seed</code>とその他のGEQOパラメータが変更されない限り、一定の問い合わせ（と統計のようなプランナへの他の入力）に対しては同じ計画が生成されます。
異なる検索パスで実験するためには、<code class="varname">geqo_seed</code>を変更してみて下さい。
   </p></div><div class="sect2" id="GEQO-FUTURE"><div class="titlepage"><div><div><h3 class="title">59.3.2. <span class="productname">PostgreSQL</span> <acronym class="acronym">GEQO</acronym>の今後の実装作業</h3></div></div></div><p>遺伝的アルゴリズムのパラメータ設定を改善するためにはまだ課題が残っています。
<code class="filename">src/backend/optimizer/geqo/geqo_main.c</code>の<code class="function">gimme_pool_size</code>と<code class="function">gimme_number_generations</code>というルーチンでは、次の2つの相反する要求を満たす妥協点を見つけなければいけません。
      </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>問い合わせ計画の最適性
        </p></li><li class="listitem"><p>計算時間
        </p></li></ul></div><p>
     </p><p>現在の実装では、各結合順候補の適応度は標準プランナの結合選択と、一から作成したコスト推定コードを実行して推定されます。
異なる候補が同様の副結合順で使用されるにつれて、多くの作業が繰り返されることになります。
これは、副結合のコスト推定を記憶することで、非常に高速になるはずです。
この状態を記憶するために要するメモリ量が非合理的に拡大することを防止することが問題です。
     </p><p>最も基本的なレベルでは、TSP用に設計されたGAアルゴリズムを用いた問い合わせ最適化の解法が適切かどうかは明確ではありません。
TSPの場合は、部分文字列（巡回経路の一部）に関連付けられたコストは残りの巡回経路と独立していますが、これは問い合わせ最適化の場合には確実に成り立ちません。
したがって、辺再組合せ交叉が最も有効な突然変異手続きかどうかは疑わしいと言えます。
     </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="geqo-intro2.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="geqo.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="geqo-biblio.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">59.2. 遺伝的アルゴリズム </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 59.4. さらに深く知るには</td></tr></table></div></body></html>