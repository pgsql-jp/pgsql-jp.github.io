<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>F.35. seg</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="postgres-fdw.html" title="F.34. postgres_fdw" /><link rel="next" href="sepgsql.html" title="F.36. sepgsql" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">F.35. seg</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="postgres-fdw.html" title="F.34. postgres_fdw">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="contrib.html" title="Appendix F. 追加で提供されるモジュール">Up</a></td><th width="60%" align="center">Appendix F. 追加で提供されるモジュール</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="sepgsql.html" title="F.36. sepgsql">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="SEG"><div class="titlepage"><div><div><h2 class="title" style="clear: both">F.35. seg</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="seg.html#id-1.11.7.44.4">F.35.1. 原理</a></span></dt><dt><span class="sect2"><a href="seg.html#id-1.11.7.44.5">F.35.2. 構文</a></span></dt><dt><span class="sect2"><a href="seg.html#id-1.11.7.44.6">F.35.3. 精度</a></span></dt><dt><span class="sect2"><a href="seg.html#id-1.11.7.44.7">F.35.4. 使用方法</a></span></dt><dt><span class="sect2"><a href="seg.html#id-1.11.7.44.8">F.35.5. 注釈</a></span></dt><dt><span class="sect2"><a href="seg.html#id-1.11.7.44.9">F.35.6. クレジット</a></span></dt></dl></div><a id="id-1.11.7.44.2" class="indexterm"></a><p>本モジュールは線分、浮動小数点区間を表現する<code class="type">seg</code>データ型を実装します。
<code class="type">seg</code>は区間の終端内の不確定性を表すことができ、特に実験計測の表現に有用です。
 </p><div class="sect2" id="id-1.11.7.44.4"><div class="titlepage"><div><div><h3 class="title">F.35.1. 原理</h3></div></div></div><p>計測の幾何は数値の連続における点より通常より複雑です。
計測は通常、多少あいまいな制限を持つ連続の部分部分となります。
不確実性と不規則性のため、さらに、タンパク質を安定させる温度範囲など計測される値は本質的に何らかの状態を示す区間となる可能性があるため、計測は区間として現れます。
  </p><p>一般的な見方を使うと、こうしたデータは値の組合せではなく区間としてデータを格納する方が便利なようです。
実際、ほとんどのアプリケーションでより効率的であると判明してさえいます。
  </p><p>一般的な見方をさらに進めると、制限の曖昧さは、伝統的な数値データ型を使用することで情報がある程度損失してしまうことを暗示しています。
これを考えてみましょう。
計測機器で6.50と読み取り、読み取ったデータをデータベースに格納します。
それを取り出す時にどうなるでしょう。
見てみましょう。

</p><pre class="screen">test=&gt; select 6.50 :: float8 as "pH";
 pH
---
6.5
(1 row)</pre><p>

計測という世界では6.50は6.5と同じではありません。
時としてこれが致命的な違いになる場合があります。
実験者は信頼する桁を書き出し（公開し）ます。
6.50は実際には、6.5というより大きくよりあいまいな区間に含まれるあいまいな区間です。
2つに共通するものは（おそらく）その中央の値だけでしょう。
私達は厳密にこうした異なるデータ項目が同じものとして現れることを好みません。
  </p><p>まとめ？
任意の可変精度を持つ区間の制限を記録できる特別なデータ型を持つことは素晴らしいことでしょう。
各データ要素が独自の精度を記録するという意味での可変です。
  </p><p>以下を見てください。

</p><pre class="screen">test=&gt; select '6.25 .. 6.50'::seg as "pH";
          pH
------------
6.25 .. 6.50
(1 row)</pre><p>
  </p></div><div class="sect2" id="id-1.11.7.44.5"><div class="titlepage"><div><div><h3 class="title">F.35.2. 構文</h3></div></div></div><p>区間の外部表現は、1つまたは2つの浮動小数点値を範囲演算子（<code class="literal">..</code>または<code class="literal">...</code>）で結び付けた形になります。
他にも、中央値と正負の偏差として指定することも可能です。
省略可能な確実性指示子（<code class="literal">&lt;</code>、<code class="literal">&gt;</code>、<code class="literal">~</code>）を格納することもできます。
（しかし、確実性指示子はすべての組み込みの演算子で無視されます。）
<a class="xref" href="seg.html#SEG-REPR-TABLE" title="Table F.27. seg外部表現">Table F.27</a>に許される表現についての概要を、<a class="xref" href="seg.html#SEG-INPUT-EXAMPLES" title="Table F.28. 有効なSEG入力の例">Table F.28</a>にいくつか例を示します。
  </p><p><a class="xref" href="seg.html#SEG-REPR-TABLE" title="Table F.27. seg外部表現">Table F.27</a>では、<em class="replaceable"><code>x</code></em>、<em class="replaceable"><code>y</code></em>、<em class="replaceable"><code>delta</code></em>は浮動小数点数値を表します。
<em class="replaceable"><code>delta</code></em>以外の<em class="replaceable"><code>x</code></em>と<em class="replaceable"><code>y</code></em>の前に確実性指示子を付与することができます。
  </p><div class="table" id="SEG-REPR-TABLE"><p class="title"><strong>Table F.27. <code class="type">seg</code>外部表現</strong></p><div class="table-contents"><table class="table" summary="seg外部表現" border="1"><colgroup><col /><col /></colgroup><tbody><tr><td><code class="literal"><em class="replaceable"><code>x</code></em></code></td><td>単一値（幅0の区間）
      </td></tr><tr><td><code class="literal"><em class="replaceable"><code>x</code></em> .. <em class="replaceable"><code>y</code></em></code></td><td><em class="replaceable"><code>x</code></em>から<em class="replaceable"><code>y</code></em>までの区間
      </td></tr><tr><td><code class="literal"><em class="replaceable"><code>x</code></em> (+-) <em class="replaceable"><code>delta</code></em></code></td><td><em class="replaceable"><code>x</code></em> - <em class="replaceable"><code>delta</code></em>から<em class="replaceable"><code>x</code></em> + <em class="replaceable"><code>delta</code></em>までの区間
      </td></tr><tr><td><code class="literal"><em class="replaceable"><code>x</code></em> ..</code></td><td>下限値<em class="replaceable"><code>x</code></em>を持つ閉じていない区間
      </td></tr><tr><td><code class="literal">.. <em class="replaceable"><code>x</code></em></code></td><td>上限値<em class="replaceable"><code>x</code></em>を持つ閉じていない区間
      </td></tr></tbody></table></div></div><br class="table-break" /><div class="table" id="SEG-INPUT-EXAMPLES"><p class="title"><strong>Table F.28. 有効な<code class="type">SEG</code>入力の例</strong></p><div class="table-contents"><table class="table" summary="有効なSEG入力の例" border="1"><colgroup><col /><col /></colgroup><tbody><tr><td><code class="literal">5.0</code></td><td>幅0のセグメントを作成します（こうすると点になります）。
      </td></tr><tr><td><code class="literal">~5.0</code></td><td>幅0のセグメントを作成し、データ内に<code class="literal">~</code>を記録します。
<code class="literal">~</code>は<code class="type">seg</code>型の演算では無視されますが、コメントとして保持されます。
      </td></tr><tr><td><code class="literal">&lt;5.0</code></td><td>5.0という点を作成します。
<code class="literal">&lt;</code>は無視されますが、コメントとして保持されます。
      </td></tr><tr><td><code class="literal">&gt;5.0</code></td><td>5.0という点を作成します。
<code class="literal">&gt;</code>は無視されますが、コメントとして保持されます。
      </td></tr><tr><td><code class="literal">5(+-)0.3</code></td><td><code class="literal">4.7 .. 5.3</code>という区間を作成します。
<code class="literal">(+-)</code>という記述は保持されないことに注意してください。
      </td></tr><tr><td><code class="literal">50 .. </code></td><td> 50以上のすべて</td></tr><tr><td><code class="literal">.. 0</code></td><td>0以下のすべて</td></tr><tr><td><code class="literal">1.5e-2 .. 2E-2 </code></td><td><code class="literal">0.015 .. 0.02</code>という区間を作成します</td></tr><tr><td><code class="literal">1 ... 2</code></td><td><code class="literal">1...2</code>、<code class="literal">1 .. 2</code>、<code class="literal">1..2</code>と同じです（範囲演算子前後の空白は無視されます）。
      </td></tr></tbody></table></div></div><br class="table-break" /><p>データソースで<code class="literal">...</code>が広く使用されるため、<code class="literal">..</code>の代わりの綴りとして許可されています。
残念なことにこれにより解析上の曖昧性が生じました。
<code class="literal">0...23</code>の上限が<code class="literal">23</code>なのか<code class="literal">0.23</code>なのかが明確ではありません。
これは、<code class="type">seg</code>の入力において、少なくとも1つの桁を数値内の小数点の前に書くことを要求することで解決されます。
  </p><p>健全性検査として<code class="type">seg</code>は、<code class="literal">5 .. 2</code>のような、下限値が上限値より大きな区間を拒絶します。
  </p></div><div class="sect2" id="id-1.11.7.44.6"><div class="titlepage"><div><div><h3 class="title">F.35.3. 精度</h3></div></div></div><p>内部的に<code class="type">seg</code>値には32ビット浮動小数点数値の組合せが格納されます。
これは7桁以上の有効桁を持つ数値が切り詰められることを意味します。

  </p><p>有効桁が正確に7桁、または7桁未満の数値は元の精度が保たれます。
つまり、問い合わせが0.00を返す場合、後ろに続く0は書式付けのための見かけのものではないことが確実です。
これは元のデータの精度を反映します。
前にある0の数は精度には影響しません。
0.0067は2有効桁のみを持つものと考えられます。
  </p></div><div class="sect2" id="id-1.11.7.44.7"><div class="titlepage"><div><div><h3 class="title">F.35.4. 使用方法</h3></div></div></div><p><code class="filename">seg</code>モジュールには<code class="type">seg</code>値用のGiSTインデックス演算子クラスが含まれます。
GiST演算子クラスでサポートされる演算子を<a class="xref" href="seg.html#SEG-GIST-OPERATORS" title="Table F.29. Seg GiST演算子">Table F.29</a>に示します。
  </p><div class="table" id="SEG-GIST-OPERATORS"><p class="title"><strong>Table F.29. Seg GiST演算子</strong></p><div class="table-contents"><table class="table" summary="Seg GiST演算子" border="1"><colgroup><col /><col /></colgroup><thead><tr><th>演算子</th><th>説明</th></tr></thead><tbody><tr><td><code class="literal">[a, b] &lt;&lt; [c, d]</code></td><td>[a, b]が完全に[c, d]の左側に存在します。
つまり、b &lt;cならば[a, b] &lt;&lt; [c, d]は真です。
さもなくば偽です。
      </td></tr><tr><td><code class="literal">[a, b] &gt;&gt; [c, d]</code></td><td>[a, b]が完全に [c, d]の右側に存在します。
つまり、a &gt; dならば[a, b] &gt;&gt; [c, d]は真、さもなくば偽です。
      </td></tr><tr><td><code class="literal">[a, b] &amp;&lt; [c, d]</code></td><td>重なるまたは左側。
これは<span class="quote">“<span class="quote">右側にはみださない</span>”</span>ととらえた方がいいかもしれません。
b &lt;= dならば真です。
      </td></tr><tr><td><code class="literal">[a, b] &amp;&gt; [c, d]</code></td><td>重なるか右側。
これは<span class="quote">“<span class="quote">左側にはみださない</span>”</span>ととらえた方がいいかもしれません。
a &gt;= cならば真です。
      </td></tr><tr><td><code class="literal">[a, b] = [c, d]</code></td><td>同一。
セグメント[a, b]と [c, d]が同一、つまり、a == bかつc == dです。
      </td></tr><tr><td><code class="literal">[a, b] &amp;&amp; [c, d]</code></td><td>セグメント[a, b]と[c, d]に重なりがあります。
      </td></tr><tr><td><code class="literal">[a, b] @&gt; [c, d]</code></td><td>セグメント[a, b]はセグメント[c, d]を包含します。つまり、a &lt;= cかつb &gt;= dです。
      </td></tr><tr><td><code class="literal">[a, b] &lt;@ [c, d]</code></td><td>セグメント[a, b]はセグメント[c, d]に包含されます。つまり、a &gt;= cかつb &lt;= dです。
      </td></tr></tbody></table></div></div><br class="table-break" /><p>（PostgreSQL 8.2以前では、包含演算子<code class="literal">@&gt;</code>および<code class="literal">&lt;@</code>はそれぞれ<code class="literal">@</code>および<code class="literal">~</code>という名前でした。
以前の名前もまだ利用できますが、廃止予定であり、いずれなくなります。
以前の名前は、コアの幾何データ型で以前従っていた規約と反対であることに注意してください。）
  </p><p>以下の例のように、標準B-tree演算子も提供されます。

  </p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col /><col /></colgroup><thead><tr><th>演算子</th><th>説明</th></tr></thead><tbody><tr><td><code class="literal">[a, b] &lt; [c, d]</code></td><td>より小さい</td></tr><tr><td><code class="literal">[a, b] &gt; [c, d]</code></td><td>より大きい</td></tr></tbody></table></div><p>

これらの演算子はソート以外の実用的な目的に対して大きな意味を持ちません。
これらの演算子はまず(a)と(c)を比べ、等しければ(b)と(d)を比べます。
論理的にはほとんどの場合優れたソート処理と思えます。
こうした型をORDER BYで使用したい場合に有用です。
  </p></div><div class="sect2" id="id-1.11.7.44.8"><div class="titlepage"><div><div><h3 class="title">F.35.5. 注釈</h3></div></div></div><p>使用方法の例はリグレッションテストの<code class="filename">sql/seg.sql</code>を参照してください。
  </p><p><code class="literal">(+-)</code>を通常の範囲に変換する機構は、境界で有効な桁数を決定するという点で完全に正確ではありません。
例えば以下のように、結果の区間に10の冪乗が含まれる場合、下限値に余計な桁を追加します。

</p><pre class="screen">postgres=&gt; select '10(+-)1'::seg as seg;
      seg
---------
9.0 .. 11             -- should be: 9 .. 11</pre><p>
  </p><p>R-treeインデックスの性能は入力値の初期の順序に大きく依存する可能性があります。
<code class="type">seg</code>列で入力テーブルをソートすることは非常に役に立つでしょう。
例として<code class="filename">sort-segments.pl</code>スクリプトを参照してください。
  </p></div><div class="sect2" id="id-1.11.7.44.9"><div class="titlepage"><div><div><h3 class="title">F.35.6. クレジット</h3></div></div></div><p>原作者：Gene Selkov, Jr. <code class="email">&lt;<a class="email" href="mailto:selkovjr@mcs.anl.gov">selkovjr@mcs.anl.gov</a>&gt;</code>,
   Mathematics and Computer Science Division, Argonne National Laboratory.
  </p><p>GiST (<a class="ulink" href="http://gist.cs.berkeley.edu/" target="_top">http://gist.cs.berkeley.edu/</a>)の要旨（gist）を説明していただいたJoe Hellerstein博士（<a class="ulink" href="http://db.cs.berkeley.edu/jmh/" target="_top">http://db.cs.berkeley.edu/jmh/</a>）に感謝します。
また、自分の世界を作成できるようにし、静かに生活できるようにしてもらった、過去から現在までのすべてのPostgres開発者に感謝します。
データベース研究を長年誠実にサポートしてくれたArgonne LabとU.S. Department of Energyにも感謝します。
  </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="postgres-fdw.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="contrib.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="sepgsql.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">F.34. postgres_fdw </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> F.36. sepgsql</td></tr></table></div></body></html>