<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>27.2. リカバリ対象の設定</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="archive-recovery-settings.html" title="27.1. アーカイブリカバリの設定" /><link rel="next" href="standby-settings.html" title="27.3. スタンバイサーバの設定" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">27.2. リカバリ対象の設定</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="archive-recovery-settings.html" title="27.1. アーカイブリカバリの設定">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="recovery-config.html" title="Chapter 27. リカバリの設定">Up</a></td><th width="60%" align="center">Chapter 27. リカバリの設定</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="standby-settings.html" title="27.3. スタンバイサーバの設定">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="RECOVERY-TARGET-SETTINGS"><div class="titlepage"><div><div><h2 class="title" style="clear: both">27.2. リカバリ対象の設定</h2></div></div></div><p>デフォルトでは、リカバリはWALログの最後までリカバリします。以下のパラメータは、それより前の停止ポイントを指定するために使う事ができます。
多くの場合、<code class="varname">recovery_target</code>、<code class="varname">recovery_target_lsn</code>、<code class="varname">recovery_target_name</code>、<code class="varname">recovery_target_time</code>や<code class="varname">recovery_target_xid</code>のうち一つが使われますが、設定ファイルで２つ以上指定された場合、最後に指定されたものが使われます。
     </p><div class="variablelist"><dl class="variablelist"><dt id="RECOVERY-TARGET"><span class="term"><code class="varname">recovery_target</code><code class="literal"> = 'immediate'</code>
      <a id="id-1.6.14.7.3.1.1.3" class="indexterm"></a>
      </span></dt><dd><p>このパラメータは、整合性のとれた状態になると、つまりできるだけ早く、リカバリを終了するよう指定します。
オンラインバックアップからリストアした場合、これはバックアップが終了した時点を意味します。
       </p><p>厳密には、この文字列パラメータは、<code class="literal">'immediate'</code>だけが有効な値です。
       </p></dd><dt id="RECOVERY-TARGET-NAME"><span class="term"><code class="varname">recovery_target_name</code> (<code class="type">string</code>)
      <a id="id-1.6.14.7.3.2.1.3" class="indexterm"></a>
      </span></dt><dd><p>このパラメータは、指定した（<code class="function">pg_create_restore_point()</code>により作成された）名前付けリストアポイントまでリカバリを進行させます。
       </p></dd><dt id="RECOVERY-TARGET-TIME"><span class="term"><code class="varname">recovery_target_time</code> (<code class="type">timestamp</code>)
      <a id="id-1.6.14.7.3.3.1.3" class="indexterm"></a>
      </span></dt><dd><p>このパラメータは、指定したタイムスタンプまでリカバリを進行させます。
厳密な停止ポイントは、<a class="xref" href="recovery-target-settings.html#RECOVERY-TARGET-INCLUSIVE">recovery_target_inclusive</a>の影響を受けます。
       </p></dd><dt id="RECOVERY-TARGET-XID"><span class="term"><code class="varname">recovery_target_xid</code> (<code class="type">string</code>)
      <a id="id-1.6.14.7.3.4.1.3" class="indexterm"></a>
      </span></dt><dd><p>このパラメータは、指定したトランザクションIDまでリカバリを進行させます。
トランザクションIDはトランザクションの開始時に順番に割り振られ、トランザクションはそれとは異なる順番で完了し得るということを理解しておいてください。
リカバリされるトランザクションは、指定されたものよりも前 (オプションによっては指定されたものも含まれる) にコミットされたものになります。
厳密な停止ポイントは、<a class="xref" href="recovery-target-settings.html#RECOVERY-TARGET-INCLUSIVE">recovery_target_inclusive</a>の影響を受けます。
       </p></dd><dt id="RECOVERY-TARGET-LSN"><span class="term"><code class="varname">recovery_target_lsn</code> (<code class="type">pg_lsn</code>)
      <a id="id-1.6.14.7.3.5.1.3" class="indexterm"></a>
      </span></dt><dd><p>このパラメータは、指定した先行書き込みログ(WAL)の場所のLSNまでリカバリを進行させます。
厳密な停止ポイントは、<a class="xref" href="recovery-target-settings.html#RECOVERY-TARGET-INCLUSIVE">recovery_target_inclusive</a>の影響を受けます。
このパラメータは、 システムデータ型<a class="link" href="datatype-pg-lsn.html" title="8.19. pg_lsn 型"><code class="type">pg_lsn</code></a>を使用して解析されます。
       </p></dd></dl></div><p>以下のオプションはリカバリ対象をより詳細に指定し、リカバリが対象に達した時の動作に影響を与えます。
     </p><div class="variablelist"><dl class="variablelist"><dt id="RECOVERY-TARGET-INCLUSIVE"><span class="term"><code class="varname">recovery_target_inclusive</code> (<code class="type">boolean</code>)
      <a id="id-1.6.14.7.5.1.1.3" class="indexterm"></a>
      </span></dt><dd><p>指定したリカバリ対象の後に停止するか(<code class="literal">true</code>)、その前に停止するか(<code class="literal">false</code>)を指定します。
<a class="xref" href="recovery-target-settings.html#RECOVERY-TARGET-LSN">recovery_target_lsn</a>、<a class="xref" href="recovery-target-settings.html#RECOVERY-TARGET-TIME">recovery_target_time</a>、又は<a class="xref" href="recovery-target-settings.html#RECOVERY-TARGET-XID">recovery_target_xid</a>が指定されている場合は適用されます。
この設定は、指定した対象のWALの場所(LSN)、コミット時刻、あるいはトランザクションIDが、それぞれ正確に一致するトランザクションをリカバリに含めるかどうかを制御します。
デフォルトは<code class="literal">true</code>です。
       </p></dd><dt id="RECOVERY-TARGET-TIMELINE"><span class="term"><code class="varname">recovery_target_timeline</code> (<code class="type">string</code>)
      <a id="id-1.6.14.7.5.2.1.3" class="indexterm"></a>
      </span></dt><dd><p>リカバリが作成する個別のタイムラインを指定します。
デフォルトでは、ベースバックアップが取得された際のものと同じタイムラインに沿ってリカバリされます。
これを<code class="literal">latest</code>に設定すると、アーカイブ時に見つけた最新のタイムラインに回復します。これはスタンバイサーバで有用です。
この他にこのパラメータが必要となるのは、ポイントインタイムリカバリの実施後に到達したような状態に戻す場合など、複数回に渡ってリカバリするような複雑なリカバリのシチュエーションのみです。
この論考については <a class="xref" href="continuous-archiving.html#BACKUP-TIMELINES" title="25.3.5. タイムライン">Section 25.3.5</a> を参照してください。
       </p></dd><dt id="RECOVERY-TARGET-ACTION"><span class="term"><code class="varname">recovery_target_action</code> (<code class="type">enum</code>)
      <a id="id-1.6.14.7.5.3.1.3" class="indexterm"></a>
      </span></dt><dd><p>リカバリ対象に到達した場合に、サーバがする動作を指定します。
デフォルトは<code class="literal">pause</code>で、リカバリを休止することを意味します。
<code class="literal">promote</code>は、リカバリの過程が終われば、サーバは接続の受け付けを始めることを意味します。
最後に、<code class="literal">shutdown</code>は、リカバリ対象に到達した後にサーバを停止します。
       </p><p><code class="literal">pause</code>の設定の意図した使い方は、このリカバリ対象がリカバリのための最も望ましいポイントかどうかチェックするために、データベースに対して問い合わせを実行できるようにすることです。
休止された状態は、<code class="function">pg_wal_replay_resume()</code>(<a class="xref" href="functions-admin.html#FUNCTIONS-RECOVERY-CONTROL-TABLE" title="Table 9.81. リカバリ制御関数">Table 9.81</a>参照)の使用により再開することができます。
その後、それはリカバリを終了させます。
このリカバリ対象が希望の止まるポイントでない場合、サーバをシャットダウンし、リカバリ対象の設定をより後の対象に変更し、リカバリを継続するために再起動してください。
       </p><p><code class="literal">shutdown</code>の設定はインスタンスを正確に望ましい再生ポイントで準備するのに有用です。
インスタンスはさらに多くのWALレコードを再生できます(実際、次に起動するときには最後のチェックポイントからWALレコードを再生しなければなりません)。
       </p><p><code class="varname">recovery_target_action</code>を<code class="literal">shutdown</code>に設定する場合、<code class="filename">recovery.conf</code>の名前が変更されるわけではありませんので、設定を変更するか、<code class="filename">recovery.conf</code>を手動で削除しない限り、次の起動はすぐにシャットダウンで終わってしまうことに注意してください。
       </p><p>この設定はリカバリ対象が設定されていない場合には効果がありません。
<a class="xref" href="runtime-config-replication.html#GUC-HOT-STANDBY">hot_standby</a>が有効になっていない場合、<code class="literal">pause</code>の設定は<code class="literal">shutdown</code>と同じように動作します。
       </p></dd></dl></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="archive-recovery-settings.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="recovery-config.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="standby-settings.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">27.1. アーカイブリカバリの設定 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 27.3. スタンバイサーバの設定</td></tr></table></div></body></html>