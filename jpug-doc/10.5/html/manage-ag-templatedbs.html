<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>22.3. テンプレートデータベース</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="manage-ag-createdb.html" title="22.2. データベースの作成" /><link rel="next" href="manage-ag-config.html" title="22.4. データベースの設定" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">22.3. テンプレートデータベース</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="manage-ag-createdb.html" title="22.2. データベースの作成">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="managing-databases.html" title="Chapter 22. データベース管理">Up</a></td><th width="60%" align="center">Chapter 22. データベース管理</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="manage-ag-config.html" title="22.4. データベースの設定">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="MANAGE-AG-TEMPLATEDBS"><div class="titlepage"><div><div><h2 class="title" style="clear: both">22.3. テンプレートデータベース</h2></div></div></div><p>実際の<code class="command">CREATE DATABASE</code>の動作は、既存のデータベースをコピーすることです。
デフォルトでは、<code class="literal">template1</code>という名前の標準のシステムデータベースをコピーします。<a id="id-1.6.9.6.2.3" class="indexterm"></a>
したがって、このデータベースは新しく作成するデータベースの元になる<span class="quote">“<span class="quote">テンプレート</span>”</span>となります。
<code class="literal">template1</code>にオブジェクトを追加した場合、追加したオブジェクトはその後に作成されるユーザデータベースにコピーされます。
この振舞いによって、データベース標準オブジェクト群にサイト独自の変更を行うことができます。
例えば、<span class="application">PL/Perl</span>手続き言語を<code class="literal">template1</code>にインストールした場合、データベースを作成する時に追加作業を行うことなく、自動的にこの言語をユーザデータベースで使用することができます。
  </p><p><code class="literal">template0</code>という名前の二次的な標準システムデータベースがあります。
<a id="id-1.6.9.6.3.2" class="indexterm"></a>
このデータベースには<code class="literal">template1</code>の初期内容と同じデータが含まれています。
つまり、使用しているバージョンの<span class="productname">PostgreSQL</span>で定義済みの標準オブジェクトのみから構成されています。
<code class="literal">template0</code>をデータベースクラスタを初期化した後に変更してはいけません。
<code class="command">CREATE DATABASE</code>を<code class="literal">template1</code>ではなく<code class="literal">template0</code>をコピーするように実行することで、<code class="literal">template1</code>に追加されたサイト独自のものを含まない、<span class="quote">“<span class="quote">汚れがない</span>”</span>ユーザデータベースを作成することができます。
これは特に、<code class="literal">pg_dump</code>ダンプからリストアする時に便利です。
このダンプスクリプトは、後で<code class="literal">template1</code>に追加される可能性のあるオブジェクトと衝突しないように、ダンプしたデータベースの内容を正しく再作成するために、汚れのないデータベースにリストアされなければなりません。
  </p><p><code class="literal">template1</code>の代わりに<code class="literal">template0</code>をコピーするその他の一般的な理由は、<code class="literal">template0</code>をコピーするときに新規の符号化方式とロケールを設定できることです。
一方、<code class="literal">template1</code>のコピーはそれが行ったと同一の設定を使用しなければなりません。
これは<code class="literal">template0</code>が理解しない符号化方式特有の、またはロケール特有のデータを含んでいる可能性があることに依ります。
  </p><p><code class="literal">template0</code>をコピーしてデータベースを作成するには、
</p><pre class="programlisting">CREATE DATABASE <em class="replaceable"><code>dbname</code></em> TEMPLATE template0;</pre><p>
をSQL環境から実行するか、または
</p><pre class="programlisting">createdb -T template0 <em class="replaceable"><code>dbname</code></em></pre><p>
をシェルから実行します。
  </p><p>さらにテンプレートデータベースを作成することができます。
また、実際のところ<code class="command">CREATE DATABASE</code>のテンプレートとして名前を指定することで、クラスタ内の任意のデータベースをコピーすることができます。
しかし、この機能は、（まだ）汎用目的の<span class="quote">“<span class="quote"><code class="command">COPY DATABASE</code></span>”</span>能力を意図したものではないことは理解しておいてください。
コピー操作の間、他のセッションから元のデータベースに接続することができないという点が大きな制限です。
<code class="command">CREATE DATABASE</code>は、その起動時に他の接続が存在する場合失敗します。
コピー操作中は元のデータベースへの新しい接続を許しません。
  </p><p><code class="literal">datistemplate</code>列と<code class="literal">datallowconn</code>列という、データベースそれぞれに有用なフラグが<code class="literal">pg_database</code>に存在します。
<a id="id-1.6.9.6.7.4" class="indexterm"></a>
<code class="literal">datistemplate</code>は、そのデータベースが<code class="command">CREATE DATABASE</code>のテンプレートとして使用されることを目的としているものであることを意味するために設定することができます。
このフラグが設定された場合、<code class="literal">CREATEDB</code>権限を持つすべてのユーザはそのデータベースを複製することができます。
設定されていない場合は、スーパーユーザとそのデータベース所有者のみがそれを複製することができます。
<code class="literal">datallowconn</code>が偽の場合、そのデータベースへの新規接続はできません（しかし、このフラグを偽にするだけでは既存のセッションは閉ざされません）。
<code class="literal">template0</code>データベースは、変更を防ぐために、通常<code class="literal">datallowconn</code> = <code class="literal">false</code>とされています。
<code class="literal">template0</code>と<code class="literal">template1</code>の両方は、常に<code class="literal">datistemplate</code> = <code class="literal">true</code>とされていなければなりません。
  </p><div class="note"><h3 class="title">Note</h3><p><code class="literal">template1</code>と<code class="literal">template0</code>には、<code class="literal">template1</code>という名前が<code class="command">CREATE DATABASE</code>のデフォルトのソースデータベースの名前であること以上の特別な地位はありません。
例えば、<code class="literal">template1</code>を削除し、<code class="literal">template0</code>から再作成しても何も問題ありません。
この操作は、不注意にごみを<code class="literal">template1</code>に追加してしまった場合にお勧めします。
（<code class="literal">template1</code>を削除するには、<code class="literal">pg_database.datistemplate = false</code>としなければなりません。）
   </p><p>データベースクラスタが初期化される時、<code class="literal">postgres</code>データベースも作成されます。
このデータベースは、ユーザとアプリケーションのデフォルトの接続先を意図したものです。
これは<code class="literal">template1</code>の単純なコピーで、必要に応じて削除したり再作成したりすることができます。
   </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="manage-ag-createdb.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="managing-databases.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="manage-ag-config.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">22.2. データベースの作成 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 22.4. データベースの設定</td></tr></table></div></body></html>