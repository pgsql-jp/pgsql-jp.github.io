<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>18.5. サーバのシャットダウン</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="kernel-resources.html" title="18.4. カーネルリソースの管理" /><link rel="next" href="upgrading.html" title="18.6. PostgreSQLクラスタのアップグレード処理" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">18.5. サーバのシャットダウン</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="kernel-resources.html" title="18.4. カーネルリソースの管理">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="runtime.html" title="Chapter 18. サーバの準備と運用">Up</a></td><th width="60%" align="center">Chapter 18. サーバの準備と運用</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="upgrading.html" title="18.6. PostgreSQLクラスタのアップグレード処理">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="SERVER-SHUTDOWN"><div class="titlepage"><div><div><h2 class="title" style="clear: both">18.5. サーバのシャットダウン</h2></div></div></div><a id="id-1.6.5.7.2" class="indexterm"></a><p>データベースサーバをシャットダウンする方法は複数あります。
マスタ<code class="command">postgres</code>プロセスに異なるシグナルを送ることで、シャットダウンの方法を制御します。

   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="systemitem">SIGTERM</span><a id="id-1.6.5.7.3.2.1.1.2" class="indexterm"></a></span></dt><dd><p>これは<em class="firstterm">スマートシャットダウン</em>モードです。
<span class="systemitem">SIGTERM</span>を受け取った後で、サーバは新しい接続を禁止しますが、既に存在するセッションは通常通り動作させます。
すべてのセッションが通常に終了するまではシャットダウンしません。
サーバがオンラインバックアップモードである場合、オンラインバックアップモードが活動しなくなるまでさらに待ちます。
バックアップモードが活動している間、新規接続は依然として許可されますが、スーパーユーザに対してだけです
（この例外はスーパーユーザがオンラインバックアップモード停止のための接続を許可します）。
スマートシャットダウンが要求された時にサーバがリカバリ状態である場合、すべての通常のセッションが終了した後のみでリカバリとストリーミングレプリケーションが停止します。
      </p></dd><dt><span class="term"><span class="systemitem">SIGINT</span><a id="id-1.6.5.7.3.2.2.1.2" class="indexterm"></a></span></dt><dd><p>これは<em class="firstterm">高速シャットダウン</em>モードです。
サーバは新しい接続を禁止しすべての存在するサーバプロセスに<span class="systemitem">SIGTERM</span>を送り、この結果サーバプロセスは現在のトランザクションをアボートし、即座に終了します。
そして サーバはすべてのサーバプロセスの終了を待って、最後にシャットダウンします。
サーバがオンラインバックアップモードである場合、バックアップモードは終了しますので、そのバックアップは使用することができなくなります。
      </p></dd><dt><span class="term"><span class="systemitem">SIGQUIT</span><a id="id-1.6.5.7.3.2.3.1.2" class="indexterm"></a></span></dt><dd><p>これは<em class="firstterm">即時シャットダウン</em>モードです。
サーバは、すべての子プロセスに<span class="systemitem">SIGQUIT</span>を送信し、それらが終了するのを待ちます。
5秒以内に終了しないものには、<span class="systemitem">SIGKILL</span>が送られます。
すべての子プロセスが終了したら、マスタサーバプロセスはすぐに終了しますが、このとき通常のデータベースのシャットダウン処理を実行しません。
これは次の起動時に（WALログを再実行することで）リカバリをすることになります。
これは緊急の時にのみ使うことを勧めます。
      </p></dd></dl></div><p>
  </p><p><code class="command">pg_ctl</code>プログラムは、サーバをシャットダウンさせるシグナルを送信するための便利なインタフェースを提供します。
他にも、Windows以外のシステムでは<code class="command">kill</code>を使用して直接シグナルを送信することもできます。
<code class="command">postgres</code>プロセスの<acronym class="acronym">PID</acronym>は、<code class="command">ps</code>プログラム、もしくはデータディレクトリの中の<code class="filename">postmaster.pid</code>ファイルを使用して見つけることができます。
例えば、高速シャットダウンをするためには下記のようになります。
</p><pre class="screen">$ <strong class="userinput"><code>kill -INT `head -1 /usr/local/pgsql/data/postmaster.pid`</code></strong></pre><p>
  </p><div class="important"><h3 class="title">Important</h3><p>サーバをシャットダウンするために<span class="systemitem">SIGKILL</span>を使わない方が良いでしょう。
これによってサーバが共有メモリとセマフォを解放できなくなり、新しくサーバを開始する前に、手動でその作業をしなければならなくなる可能性があります。
さらに、<span class="systemitem">SIGKILL</span>は、子プロセスにシグナルを中継することなく<code class="command">postgres</code>を停止させます。
このため、個々の子プロセスを停止させるために、同じ作業を手作業で行わなければならなくなります。
   </p></div><p>他のセッションを継続させながら個別のセッションを停止するには<code class="function">pg_terminate_backend()</code>（<a class="xref" href="functions-admin.html#FUNCTIONS-ADMIN-SIGNAL-TABLE" title="Table 9.78. サーバシグナル送信関数">Table 9.78</a>を参照）を使用するか、そのセッションに関連する子プロセスに<span class="systemitem">SIGTERM</span>シグナルを送ります。
  </p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="kernel-resources.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="runtime.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="upgrading.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">18.4. カーネルリソースの管理 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 18.6. <span class="productname">PostgreSQL</span>クラスタのアップグレード処理</td></tr></table></div></body></html>