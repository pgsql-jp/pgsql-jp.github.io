<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>VACUUM</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="sql-update.html" title="UPDATE" /><link rel="next" href="sql-values.html" title="VALUES" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">VACUUM</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="sql-update.html" title="UPDATE">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="sql-commands.html" title="SQLコマンド">Up</a></td><th width="60%" align="center">SQLコマンド</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="sql-values.html" title="VALUES">Next</a></td></tr></table><hr></hr></div><div class="refentry" id="SQL-VACUUM"><div class="titlepage"></div><a id="id-1.9.3.177.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle">VACUUM</span></h2><p>VACUUM — データベースの不要領域の回収とデータベースの解析（オプション）を行う</p></div><div class="refsynopsisdiv"><h2>Synopsis</h2><pre class="synopsis">VACUUM [ ( { FULL | FREEZE | VERBOSE | ANALYZE | DISABLE_PAGE_SKIPPING } [, ...] ) ] [ <em class="replaceable"><code>table_name</code></em> [ (<em class="replaceable"><code>column_name</code></em> [, ...] ) ] ]
VACUUM [ FULL ] [ FREEZE ] [ VERBOSE ] [ <em class="replaceable"><code>table_name</code></em> ]
VACUUM [ FULL ] [ FREEZE ] [ VERBOSE ] ANALYZE [ <em class="replaceable"><code>table_name</code></em> [ (<em class="replaceable"><code>column_name</code></em> [, ...] ) ] ]</pre></div><div class="refsect1" id="id-1.9.3.177.5"><h2>説明</h2><p><code class="command">VACUUM</code> は、無効タプルが使用する領域を回収します。
<span class="productname">PostgreSQL</span>の通常動作では、削除されたタプルや更新によって不要となったタプルは、テーブルから物理的には削除されません。
これらのタプルは<code class="command">VACUUM</code>が完了するまで存在し続けます。
そのため、特に更新頻度が多いテーブルでは、<code class="command">VACUUM</code>を定期的に実行する必要があります。
  </p><p>パラメータの指定がない場合、<code class="command">VACUUM</code>は現在のユーザがバキュームできる権限を持つ、現在のデータベース内の全てのテーブルを処理します。
パラメータを指定した場合、<code class="command">VACUUM</code>は指定したテーブルのみを処理します。
  </p><p><code class="command">VACUUM ANALYZE</code>は、指定したテーブルの1つひとつに対し、<code class="command">VACUUM</code>を行った後、<code class="command">ANALYZE</code>を行います。
このコマンドの組合わせは、日常的な管理スクリプトで使うと便利です。
処理の詳細に関しては、<a class="xref" href="sql-analyze.html" title="ANALYZE"><span class="refentrytitle">ANALYZE</span></a>を参照してください。
  </p><p>（<code class="literal">FULL</code>が指定されていない）通常の<code class="command">VACUUM</code>は、単に領域を回収し、そこを再利用可能な状態に変更します。
この形式のコマンドでは排他的ロックを取得しないため、テーブルへの通常の読み書き操作と並行して実行することができます。
しかし余った領域はオペレーティングシステムには(ほとんどの場合)返されません。
同じテーブル内で再利用できるように保持されるだけです。
<code class="command">VACUUM FULL</code>では、テーブルの内容全体を新しいディスクファイルに領域を余すことなく書き換えるため、オペレーティングシステムに未使用の領域を返すことができます。
この形式では、実行速度がかなり低速になります。また、処理中のテーブルに対する排他的ロックが必要になります。
  </p><p>オプションリストが括弧でくくられていた場合、オプションを任意の順序で記述することができます。
括弧がないと、オプションは上で示した通りの順番で指定しなければなりません。
括弧付きの構文は<span class="productname">PostgreSQL</span> 9.0で追加されました。
カッコがない構文は廃止予定です。
  </p></div><div class="refsect1" id="id-1.9.3.177.6"><h2>パラメータ</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">FULL</code></span></dt><dd><p>より多くの領域の回収することができる<span class="quote">“<span class="quote">完全な</span>”</span>バキュームを選択します。
ただし、通常よりも処理に時間がかかります。
また、テーブルに対する排他ロックが必要です。
またこの方式では、テーブルのコピーを新しく書き出し、操作が終わるまで古いコピーが解放されませんので、余分にディスク領域が必要です。
通常、大きな容量がテーブルから回収されなければならない場合にのみこれが使用されるべきです。
     </p></dd><dt><span class="term"><code class="literal">FREEZE</code></span></dt><dd><p>積極的なタプルの<span class="quote">“<span class="quote">凍結</span>”</span>を選択します。
<code class="literal">FREEZE</code>指定は、<a class="xref" href="runtime-config-client.html#GUC-VACUUM-FREEZE-MIN-AGE">vacuum_freeze_min_age</a>および<a class="xref" href="runtime-config-client.html#GUC-VACUUM-FREEZE-TABLE-AGE">vacuum_freeze_table_age</a>パラメータをゼロとして<code class="command">VACUUM</code>を実行することと同じです。
テーブルが書き換えられる時は、必ず積極的な凍結が行われるので、<code class="literal">FULL</code>が指定されているときは、このオプションは冗長です。
     </p></dd><dt><span class="term"><code class="literal">VERBOSE</code></span></dt><dd><p>各テーブルについてバキューム処理の詳細な報告を出力します。
     </p></dd><dt><span class="term"><code class="literal">ANALYZE</code></span></dt><dd><p>プランナが使用する統計情報を更新し、問い合わせを実行する最も効率的な方法を決定できるようにします。
     </p></dd><dt><span class="term"><code class="literal">DISABLE_PAGE_SKIPPING</code></span></dt><dd><p>通常、<code class="command">VACUUM</code>は<a class="link" href="routine-vacuuming.html#VACUUM-FOR-VISIBILITY-MAP" title="24.1.4. 可視性マップの更新">可視性マップ</a>に基いてページをスキップします。
すべてのタプルが凍結されていることがわかっているページは、常にスキップできます。
また、すべてのタプルがすべてのトランザクションに対して可視であることがわかっているページは、積極的なバキュームを実行している場合を除き、スキップできます。
さらに、積極的なバキュームを実行している場合を除き、一部のページは、他のセッションがその使用を終了するのを待つのを避けるため、スキップされます。
このオプションは、ページをスキップする動作をすべて無効にします。
これは可視性マップの内容が怪しいと考えられるときにのみ使用されることを意図したもので、それはデータベースの破損を引き起こすようなハードウェアあるいはソフトウェアの障害がある場合にのみ発生します。
     </p></dd><dt><span class="term"><em class="replaceable"><code>table_name</code></em></span></dt><dd><p>バキューム対象のテーブル名です（スキーマ修飾名も可）。
省略すると、現在のデータベース内のすべての通常テーブルとマテリアライズドビューがバキュームされます。
指定したテーブルがパーティションテーブルの場合、そのすべてのリーフパーティションがバキュームされます。
     </p></dd><dt><span class="term"><em class="replaceable"><code>column_name</code></em></span></dt><dd><p>解析の対象とする列名です。デフォルトは全列です。
列リストが指定された場合は<code class="literal">ANALYZE</code>を暗示します。
     </p></dd></dl></div></div><div class="refsect1" id="id-1.9.3.177.7"><h2>出力</h2><p><code class="literal">VERBOSE</code>が指定された場合、<code class="command">VACUUM</code>は、現在処理中のテーブルを示す進行状況メッセージを表示します。
同様に、テーブルについての各種の統計情報も表示されます。
   </p></div><div class="refsect1" id="id-1.9.3.177.8"><h2>注釈</h2><p>テーブルをバキュームするためには、通常はテーブルの所有者もしくはスーパーユーザでなければなりません。
しかしデータベースの所有者は共有カタログを除くデータベース内の全テーブルをバキュームすることができます。
（共有カタログに関する制限は、データベース全体の<code class="command">VACUUM</code>はスーパーユーザのみが実行可能であることを意味します。）
<code class="command">VACUUM</code>は、呼び出したユーザがバキュームするための権限を持たないテーブルはすべて飛ばします。
   </p><p>トランザクションブロック内で<code class="command">VACUUM</code>を実行することはできません。
   </p><p><acronym class="acronym">GIN</acronym>インデックスを持つテーブルでは、<code class="command">VACUUM</code>（全構文）は待ち状態のインデックス挿入を主<acronym class="acronym">GIN</acronym>インデックス構造内の適切なところに移動させることにより、待ち状態のインデックス挿入をすべて完了させます。
<a class="xref" href="gin-implementation.html#GIN-FAST-UPDATE" title="64.4.1. GIN高速更新手法">Section 64.4.1</a>を参照してください。
   </p><p>不要となった行を削除するため、実運用状態のデータベースに対しては定期的に（少なくとも毎晩）<code class="command">VACUUM</code>を実行することを推奨します。
また、テーブルに対して多数の行を追加/削除した後は、そのテーブルに<code class="command">VACUUM ANALYZE</code>を発行することを推奨します。
これによりシステムカタログに最近なされた全ての変更が反映されることになり、<span class="productname">PostgreSQL</span>の問い合わせプランナが、問い合わせ計画の作成時により良い選択をできるようになります。
   </p><p><code class="option">FULL</code>オプションを日常的に使用することは推奨しませんが、特殊なケースでは有用となる場合もあります。
例えば、テーブル内のほとんど全ての行を削除または更新し、そのテーブルによるディスクの使用量を物理的に縮小させて高速なテーブルスキャンを行いたい場合です。
<code class="command">VACUUM FULL</code>はたいていの場合、通常の<code class="command">VACUUM</code>よりもテーブルを縮小します。
   </p><p><code class="command">VACUUM</code>によりI/Oトラフィックがかなり増大しますので、実行中の他のセッションの性能が悪化する可能性があります。
このため、コストベースのバキューム遅延機能の使用が推奨される場合があります。
詳細は<a class="xref" href="runtime-config-resource.html#RUNTIME-CONFIG-RESOURCE-VACUUM-COST" title="19.4.4. コストに基づくVacuum遅延">Section 19.4.4</a>を参照してください。
   </p><p><span class="productname">PostgreSQL</span>には、バキューム保守作業を自動化する<span class="quote">“<span class="quote">autovacuum</span>”</span>機能があります。
自動バキューム処理および手作業によるバキューム処理に関する詳細については、<a class="xref" href="routine-vacuuming.html" title="24.1. 定常的なバキューム作業">Section 24.1</a>を参照してください。

   </p></div><div class="refsect1" id="id-1.9.3.177.9"><h2>例</h2><p><code class="literal">onek</code> というテーブル1つだけを掃除し、オプティマイザ用に解析し、バキューム処理の詳細な報告を出力するには、次のようにします。

</p><pre class="programlisting">VACUUM (VERBOSE, ANALYZE) onek;</pre></div><div class="refsect1" id="id-1.9.3.177.10"><h2>互換性</h2><p>標準SQLには<code class="command">VACUUM</code>文はありません。
  </p></div><div class="refsect1" id="id-1.9.3.177.11"><h2>関連項目</h2><span class="simplelist"><a class="xref" href="app-vacuumdb.html" title="vacuumdb"><span class="refentrytitle"><span class="application">vacuumdb</span></span></a>, <a class="xref" href="runtime-config-resource.html#RUNTIME-CONFIG-RESOURCE-VACUUM-COST" title="19.4.4. コストに基づくVacuum遅延">Section 19.4.4</a>, <a class="xref" href="routine-vacuuming.html#AUTOVACUUM" title="24.1.6. 自動バキュームデーモン">Section 24.1.6</a></span></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="sql-update.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="sql-commands.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="sql-values.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">UPDATE </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> VALUES</td></tr></table></div></body></html>