<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>33.5. １行１行問い合わせ結果を受け取る</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="libpq-async.html" title="33.4. 非同期コマンドの処理" /><link rel="next" href="libpq-cancel.html" title="33.6. 処理中の問い合わせのキャンセル" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">33.5. １行１行問い合わせ結果を受け取る</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="libpq-async.html" title="33.4. 非同期コマンドの処理">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="libpq.html" title="Chapter 33. libpq - C ライブラリ">Up</a></td><th width="60%" align="center">Chapter 33. <span xmlns="http://www.w3.org/1999/xhtml" class="application">libpq</span> - C ライブラリ</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="libpq-cancel.html" title="33.6. 処理中の問い合わせのキャンセル">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="LIBPQ-SINGLE-ROW-MODE"><div class="titlepage"><div><div><h2 class="title" style="clear: both">33.5. １行１行問い合わせ結果を受け取る</h2></div></div></div><a id="id-1.7.3.12.2" class="indexterm"></a><p>通常、<span class="application">libpq</span>はSQLコマンドの結果全体を収集し、それを１つの<code class="type">PGresult</code>としてアプリケーションに返します。
これは、多くの行数を返すコマンドでは動作しなくなるかもしれません。
こうした場合、アプリケーションは<code class="function">PQsendQuery</code>と<code class="function">PQgetResult</code>を<em class="firstterm">単一行モード</em>で使用することができます。
このモードでは、結果行は、サーバから受け取ったかのように、アプリケーションに１度に１行返されます。
  </p><p>単一行モードに入るためには、<code class="function">PQsendQuery</code>（または同系列の関数）の呼び出しに成功した直後に<code class="function">PQsetSingleRowMode</code>を呼び出してください。
このモード選択は、現在実行中の問い合わせに対してのみ有効です。
その後、<a class="xref" href="libpq-async.html" title="33.4. 非同期コマンドの処理">Section 33.4</a>の説明通りに、ヌルを返すようになるまで<code class="function">PQgetResult</code>を繰り返し呼び出してください。
問い合わせが何らかの行を返す場合、<code class="literal">PGRES_TUPLES_OK</code>ではなく<code class="literal">PGRES_SINGLE_TUPLE</code>状態コードを持つ以外通常の問い合わせ結果と同じように見える、個々の<code class="structname">PGresult</code>オブジェクトを返します。
最後の行の後、または問い合わせがゼロ行を返す場合は即座に、<code class="literal">PGRES_TUPLES_OK</code>状態のゼロ行のオブジェクトが返されます。
これはもう行が届かないことを通知するものです。
（しかしヌルが返るまで<code class="function">PQgetResult</code>を呼び出さなければならないことに注意してください。）
<code class="structname">PGresult</code>オブジェクトのすべては、その問い合わせに対する通常の<code class="structname">PGresult</code>と同一の行説明データ（列名、型など）を持ちます。
各オブジェクトは通常通り<code class="function">PQclear</code>で解放しなければなりません。
  </p><p>   </p><div class="variablelist"><dl class="variablelist"><dt id="LIBPQ-PQSETSINGLEROWMODE"><span class="term">      <code class="function">PQsetSingleRowMode</code>
      <a id="id-1.7.3.12.5.1.1.1.2" class="indexterm"></a>
     </span></dt><dd><p>現在実行中の問い合わせについて単一行モードを選択します。

</p><pre class="synopsis">int PQsetSingleRowMode(PGconn *conn);</pre><p>
      </p><p>この関数は<code class="function">PQsendQuery</code>またはその系列の関数のいずれかの後即座に、<code class="function">PQconsumeInput</code>や<code class="function">PQgetResult</code>など接続に対する何らかの他の操作を行う前のみに呼び出すことができます。
正しい時点で呼び出された場合、この関数は現在の問い合わせに対して単一行モードを有効にし、１を返します。
この他の場合、モードは変更されず、関数はゼロを返します。
いずれの場合でも、現在の問い合わせが完了した後に通常モードに戻ります。
      </p></dd></dl></div><p>
  </p><div class="caution"><h3 class="title">Caution</h3><p>問い合わせを処理している間、サーバはいくつか行を返した後にエラーになり、問い合わせがアボートする可能性があります。
通常の<span class="application">libpq</span>では、こうした行を破棄しエラーのみを報告します。
しかし単一行モードでは、これらの行はすでにアプリケーションに返されています。
このためアプリケーションは<code class="literal">PGRES_SINGLE_TUPLE</code>状態の<code class="structname">PGresult</code>オブジェクトをいくつか見た後に<code class="literal">PGRES_FATAL_ERROR</code>オブジェクトを見るかもしれません。
適切な振る舞いのトランザクションのために、最終的に問い合わせが失敗した場合、アプリケーションはこれまで処理した行を破棄するまたは取り消すように設計しなければなりません。
   </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="libpq-async.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="libpq.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="libpq-cancel.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">33.4. 非同期コマンドの処理 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 33.6. 処理中の問い合わせのキャンセル</td></tr></table></div></body></html>