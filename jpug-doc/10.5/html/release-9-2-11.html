<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>E.91. リリース9.2.11</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="release-9-2-12.html" title="E.90. リリース9.2.12" /><link rel="next" href="release-9-2-10.html" title="E.92. リリース9.2.10" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">E.91. リリース9.2.11</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="release-9-2-12.html" title="E.90. リリース9.2.12">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="release.html" title="Appendix E. リリースノート">Up</a></td><th width="60%" align="center">Appendix E. リリースノート</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="release-9-2-10.html" title="E.92. リリース9.2.10">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="RELEASE-9-2-11"><div class="titlepage"><div><div><h2 class="title" style="clear: both">E.91. リリース9.2.11</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="release-9-2-11.html#id-1.11.6.95.4">E.91.1. バージョン9.2.11への移行</a></span></dt><dt><span class="sect2"><a href="release-9-2-11.html#id-1.11.6.95.5">E.91.2. 変更点</a></span></dt></dl></div><p><strong>リリース日: </strong>2015-05-22</p><p>このリリースは9.2.10に対し、各種不具合を修正したものです。
9.2メジャーリリースにおける新機能については、<a class="xref" href="release-9-2.html" title="E.102. リリース9.2">Section E.102</a>を参照してください。
  </p><div class="sect2" id="id-1.11.6.95.4"><div class="titlepage"><div><div><h3 class="title">E.91.1. バージョン9.2.11への移行</h3></div></div></div><p>9.2.Xからの移行ではダンプ/リストアは不要です。
   </p><p>しかしながら、<code class="filename">contrib/citext</code>の<code class="function">regexp_matches()</code>関数を利用している場合は、以下にある関連する変更履歴項目を確認してください。
   </p><p>また、9.2.10よりも前のリリースからアップグレードする場合は、<a class="xref" href="release-9-2-10.html" title="E.92. リリース9.2.10">Section E.92</a>を参照して下さい。
   </p></div><div class="sect2" id="id-1.11.6.95.5"><div class="titlepage"><div><div><h3 class="title">E.91.2. 変更点</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>認証タイムアウトになる直前にクライアントが切断したときにクラッシュする可能性を防止しました。
(Benkocs Norbert Attila)
     </p><p>タイムアウト割り込みがセッション切断処理の途中で生じると、SSL関連状態が二重に解放するおそれがあり、典型的にはクラッシュを引き起こし、そのために他のセッションでもサービス不能を引き起こします。実験では認証されていないリモート攻撃者がある程度一貫して本障害を引き起こすことができたため、セキュリティ問題として扱います。
(CVE-2015-3165)
     </p></li><li class="listitem"><p>システムコールのエラー判定を改善しました。
(Noah Misch)
     </p><p><code class="function">snprintf()</code>の代替実装は下にあるシステムライブラリ呼び出しから報告されるエラーの確認を怠っていました。
主な問題はメモリ不足状況を見逃すおそれがあったことです。
実装コードがバッファが上書きされていないのを上書きされたとみなしていることにより、最悪の場合には情報露出をもたらすおそれがありました。
また、他のシステムライブラリ関数呼び出しでも、エラーチェックをしていないセキュリティに関連した箇所が少しありました。
     </p><p>いくつかの<code class="function">*printf()</code>族関数の呼び出しで、メモリ不足エラーがちょうど悪いときに起きた場合に情報露出する脆弱性がある可能性が残ります。
私たちはリスクは大きくないと判断しましたが、該当箇所の分析は継続します。
(CVE-2015-3166)
     </p></li><li class="listitem"><p><code class="filename">contrib/pgcrypto</code>で、復号失敗を報告するメッセージを<span class="quote">“<span class="quote">Wrong key or corrupt data</span>”</span>（誤ったキーまたは不正なデータ）に統一しました。
(Noah Misch)
     </p><p>以前は、間違ったキーによる復号の場合には異なったエラーメッセージが報告されていました。
この様なエラーメッセージの違いは、他システムからキーを復元しようとする攻撃者への助けになるとみられます。
<code class="filename">pgcrypto</code>のこの振る舞いが攻撃に利用できるかは不明ですが、一つの何にでも当てはまるメッセージを使う方がリスクを避けるのにより良いと考えられます。
(CVE-2015-3167)
     </p></li><li class="listitem"><p><code class="filename">contrib/citext</code>の<code class="function">regexp_matches()</code>関数の誤った宣言を修正しました。
(Tom Lane)
     </p><p>この関数は本体関数と同様に<code class="type">setof text[]</code>を返すべきでしたが、誤って単に<code class="type">text[]</code>を返すように宣言されていました。
この誤りは二つの結果をもたらしました。
第一にマッチするものが無いときに空集合（ゼロ行）を得るべきところ、スカラnullを得ます。
第二にたとえ複数のマッチがあったとしても一つの結果配列しか得られないことから、<code class="literal">g</code>フラグが事実上無視されていました。
     </p><p>この振る舞いは明らかにバグですが、以前の振る舞いに依存したアプリケーションがありえます。
そのため、<span class="productname">PostgreSQL</span> 9.5になるまでは関数宣言はデフォルトでは変更しません。
9.5より前の系列では、従来の振る舞いが<code class="literal">citext</code>拡張モジュールのバージョン1.0として存在し、その一方で私たちは正しい宣言をバージョン1.1として提供します（これはデフォルトではインストール<span class="emphasis"><em>されません</em></span>）。
9.5より前の系列で修正を適用するには、<code class="literal">citext</code>をインストールした各データベースで<code class="literal">ALTER EXTENSION citext UPDATE TO '1.1'</code>を実行します（必要に応じて1.0に戻す<span class="quote">“<span class="quote">UPDATE</span>”</span>も可能です）。
どちらの方向にバージョン変更する場合でも、<code class="filename">citext</code>の<code class="function">regexp_matches()</code>関数を使った全てのビューやルールを削除して再作成する必要があることに注意してください。
     </p></li><li class="listitem"><p>HOT更新後の遅延排他制約の誤った検査を修正しました。
(Tom Lane)
     </p><p>遅延排他制約に違反する可能性のある新しい行が同じトランザクションで後でHOT更新された（インデックスが付かない列の更新でその行が同テーブルページ内に格納できた）場合、後に削除される行が、新たな行と当初に衝突していた場合でも、排他制約は最後に行われる検査で違反を報告することがありました。
     </p></li><li class="listitem"><p>スタースキーマ風の問い合わせのプラン作成を修正しました。
(Tom Lane)
     </p><p>大きなテーブルの効率的なスキャンでは時に、二つ以上の他テーブル（一般にはディメンションテーブル、それらのキーは大きいファクトテーブルでインデックス付けが必要）から供されるインデックスパラメータが要求されます。
プランナはこのようなプランを探せなければいけませんが、過度に制限的な検索ヒューリスティックがこれを妨げていました。
     </p></li><li class="listitem"><p>他の外部結合に対する anti-join (NOT EXISTS 結合) の不適切な配置換えを防止しました。
(Tom Lane)
     </p><p>プランナのこの誤りにより<span class="quote">“<span class="quote">could not find RelOptInfo for given relids</span>”</span>エラーが見られましたが、しかし時には誤ったクエリプランが一貫性チェックを通過して、黙って誤ったクエリ出力が生じることがあると考えられます。
     </p></li><li class="listitem"><p>外部結合プランノードでの部分式の誤ったマッチングを修正しました。
(Tom Lane)
     </p><p>これまでは、字面として同一の非STRICTの部分式が外部結合の上位と下位の両方で使われているとき、プランナが結合の下位で計算した値を再利用しようとすることがありましたが、エグゼキュータは外側の行にマッチしない場合は値をNULLに強制するはずなので、これは正しくありません。
     </p></li><li class="listitem"><p>結合順序のヒューリスティックが失敗した場合に対応できるようにGEQOプランナを修正しました。
(Tom Lane)
     </p><p>この誤りが<code class="literal">LATERAL</code>を含む問い合わせでエラー<span class="quote">“<span class="quote">failed to join all relations together</span>”</span>（全てのリレーションを一緒に結合するのに失敗しました）を導くのが見かけられ、また、そのほかの場合でも起きるようです。
     </p></li><li class="listitem"><p><code class="literal">max_prepared_transactions</code>が小さすぎるとき、PostgreSQL起動時にデッドロックの可能性があり、修正しました。
(Heikki Linnakangas)
     </p></li><li class="listitem"><p>タイムライン切り替え後、使えない事前割り当てされたWALファイルをアーカイブしないようにしました。
(Heikki Linnakangas)
     </p></li><li class="listitem"><p><span class="quote">“<span class="quote">cannot GetMultiXactIdMembers() during recovery</span>”</span>(リカバリ中にGetMultiXactIdMembers()は実行できません)というエラーが発生しないようにしました。
(Álvaro Herrera)
     </p></li><li class="listitem"><p>クラッシュ後に再帰的に<code class="function">fsync()</code>を行うようにしました。
(Abhijit Menon-Sen, Robert Haas)
     </p><p>これにより別のクラッシュがすぐ後に生じた場合でも一貫性を確実にします（問題となるのは二番目のクラッシュが単なるデータベースクラッシュではなくシステムレベルのクラッシュである場合です）。
     </p></li><li class="listitem"><p>SIGTERMシグナルを受け取った後にエラーが起きた場合に、autovacuumランチャープロセスがシャットダウンに失敗する可能性があったのを修正しました。
(Álvaro Herrera)
     </p></li><li class="listitem"><p><code class="function">LockBufferForCleanup()</code>で予期せぬシグナルに対応するようにしました。
(Andres Freund)
     </p><p>この誤りは<span class="quote">“<span class="quote">multiple backends attempting to wait for pincount 1</span>”</span>（複数バックエンドがピンカウント1を待とうとしています）という偽性のエラーをひき起こすことがあります。
     </p></li><li class="listitem"><p>行全体の参照を含むチェック制約の付いたテーブルに対する<code class="literal">COPY IN</code>実行時のクラッシュを修正しました。
(Tom Lane)
     </p><p>知られている失敗ケースでは9.4以上のみクラッシュしますが、非常に似たコードが9.3と9.2にあるので、これらのバージョン系列も同様に修正します。
     </p></li><li class="listitem"><p>read-only であるトランザクションのコミットにおいては、当該のユーザに限り、WALフラッシュや同期レプリケーションを待たないようにしました。
(Andres Freund)
     </p><p>これまでは、HOTページ掃除のためにWALを書くトランザクションのコミットにて遅延がおきる可能性があり、全スタンバイがダウンしている場合には、セッションが開始時に固まってしまうなどの望ましくない結果に至りました。
同期レプリケーションのときのキャッチアップ割り込み処理でもセッションが固まることがありました。
本修正はこれらの問題を解消します。
     </p></li><li class="listitem"><p>一時テーブル上のハッシュインデックスを操作するときに生じるクラッシュを修正しました。
(Heikki Linnakangas)
     </p></li><li class="listitem"><p>他プロセスが同時にインデックスを変更している場合、ハッシュインデックスのバケツ分割に失敗する可能性があり、修正しました。
(Tom Lane)
     </p></li><li class="listitem"><p>インデックス式のANALYZE中に割り込みを検査するようにしました。
(Jeff Janes)
     </p><p><code class="command">ANALYZE</code>ではインデックスの式を何度も実行します。
こういった式の中に遅い関数があった場合、<code class="command">ANALYZE</code>をループが終わる前にキャンセルできることが望まれます。
     </p></li><li class="listitem"><p><code class="command">SELECT FOR UPDATE</code>、<code class="command">UPDATE</code>、または、<code class="command">DELETE</code>での行ロック後に<code class="literal">READ COMMITTED</code>再チェックが生じたときに、外部テーブルの<code class="structfield">tableoid</code>が確実に正しく報告されるようにしました。
     </p></li><li class="listitem"><p>外部サーバユーザマッピングのオブジェクト説明文字列にターゲットサーバ名を追加しました。
(Álvaro Herrera)
     </p></li><li class="listitem"><p>Kerberos/GSSAPI/SSPI認証を使うとき、<code class="literal">include_realm</code>を1に設定することを推奨します。
(Stephen Frost)
     </p><p>これが無いと、他レルムからの同名ユーザが区別できません。
当面はドキュメント変更のみですが、これは<span class="productname">PostgreSQL</span> 9.5でデフォルト設定になります。
     </p></li><li class="listitem"><p>IPv4の<code class="filename">pg_hba.conf</code>項目をIPv4-in-IPv6アドレスと照合する実装を除去しました。
(Tom Lane)
     </p><p>この実装は2003年にその時の一部のLinuxカーネルでIPv4-in-IPv6アドレスを持ちながらIPv4接続を報告するというレポートに応えて追加されました。
しかしながら、このロジックは9.0で図らずも壊れていました。
それ以来、どこにも苦情が無いことは、それがもう必要でないことを示しています。
現在、壊れた実装が一部システムでクラッシュをひき起こすという報告がされているので、これを修正するのでなく、単に除去します
（私たちが修正することを選んだなら、それは IPv4の<code class="filename">pg_hba.conf</code>項目の現在の意味に対する、微妙で潜在的にセキュリティ影響のある変更に向かい、これはマイナーリリースで行うこととして良いことではありません）。
     </p></li><li class="listitem"><p>レプリケーションコマンド<code class="literal">IDENTIFY_SYSTEM</code>でWAL挿入でなくWALフラッシュ位置を報告するようにしました。
(Heikki Linnakangas)
     </p><p>これにより<span class="application">pg_receivexlog</span>の起動失敗の可能性を回避します。
     </p></li><li class="listitem"><p>Windows でサービスシャットダウンするときに、サービスが早くに強制終了されてしまうのを防ぐために、サービスコントロールマネージャに周期的に状態更新を送るようにしました。
また、<span class="application">pg_ctl</span>が確実にシャットダウンを待つようにしました。
(Krystian Bigaj)
     </p></li><li class="listitem"><p><span class="application">libpq</span>のノンブロッキングモードを使うとき、ネットワークデッドロックの危険性を軽減しました。
(Heikki Linnakangas)
     </p><p>大きいデータを送るとき、サーバが出力をブロックするほどの応答データを送ってくる場合には、時々に入力バッファが捌けることが重要です
（典型的なシナリオは、サーバが<code class="literal">COPY FROM STDIN</code>の実行中に連続して NOTICE メッセージを送ってくる場合です）。
このとき、通常のブロッキングモードなら適切に動作しますが、ノンブロッキングモードの場合はそうではありません。
私たちは<span class="application">libpq</span>を日和見的に可能なときに入力を排出するように修正しましたが、この問題に対する完全な対策にはアプリケーションの協力が必要です。
アプリケーションは write-ready 状態だけでなく、read-ready に気を付けなければならず、read-ready に応じて確実に<code class="function">PQconsumeInput()</code>を呼ばなければいけません。
     </p></li><li class="listitem"><p><span class="application">libpq</span>におけるURI接続文字列の空値の構文解析誤りを修正しました。
(Thomas Fanghaenel)
     </p></li><li class="listitem"><p><span class="application">ecpg</span>で配列の扱いが修正されました。
(Michael Meskes)
     </p></li><li class="listitem"><p><code class="command">\connect</code>の最初の引数として、URIと接続文字列を正常に扱えるように<span class="application">psql</span>を修正しました。
(David Fetter, Andrew Dunstan, Álvaro Herrera)
     </p><p>この構文は（ドキュメント化されていませんが）永らく受け入れられてきました。
しかし、これまで一部パラメータにて与えられた文字列でなく以前の接続から取得されることがあり、これは望ましくない動作であると合意されています。
     </p></li><li class="listitem"><p>一部のプラットフォームで<span class="application">psql</span>から終了時に<code class="filename">~/.psql_history</code>を書くのに失敗したという間違ったエラーメッセージがでるのを抑止しました。
(Tom Lane)
     </p><p>この誤動作はとても古いバージョン（2006年より前）の<span class="application">libedit</span>のバグを回避するために引き起こされました。
私たちはその回避策を取り除くことで修正しました。
このことで古いバージョンの<span class="application">libedit</span>を使っている場合、同様の障害を引き起こします。
ライブラリをアップグレードするか<span class="application">libreadline</span>を使うことを推奨します。
     </p></li><li class="listitem"><p><span class="application">pg_dump</span>のシステム提供されたダンプ不要のキャストを判断する規則を修正しました。
(Tom Lane)
     </p></li><li class="listitem"><p><span class="application">pg_dump</span>で、<code class="literal">-Fd</code> と一緒に指定された場合に <code class="literal">-Z</code> 圧縮レベル オプションを尊重するように修正しました。
(Michael Paquier)
     </p></li><li class="listitem"><p><span class="application">pg_dump</span>を、ダンプ順序の選択で、拡張モジュールの設定テーブル間の外部キー関係を考慮するようにしました。
(Gilles Darold, Michael Paquier, Stephen Frost)
     </p><p>この誤りで、外部キー制約が一時的に違反になるために再ロードできないダンプを作ってしまう可能性がありました。
     </p></li><li class="listitem"><p>VALUES (...) だけであるけれどカラム別名を持つビューのダンプについて修正しました。
(Tom Lane)
     </p></li><li class="listitem"><p><span class="application">pg_upgrade</span>で、新たなクラスタのタイムラインを強制的に1にするようにしました。
(Bruce Momjian)
     </p><p>この変更は、WALヒストリファイルが無いという誤ったエラーによるアップグレード失敗を防ぎます。
     </p></li><li class="listitem"><p><span class="application">pg_upgrade</span>で、不適切な接続不能データベースが無いか処理前に検査するようにしました。
(Bruce Momjian)
     </p></li><li class="listitem"><p><span class="application">pg_upgrade</span>で、生成される<code class="literal">delete_old_cluster</code>スクリプトの中でディレクトリパスを適切にクオートするようにしました。
(Bruce Momjian)
     </p></li><li class="listitem"><p><span class="application">pg_upgrade</span>で、データベースレベルの凍結情報を適切に保持するようにしました。
(Bruce Momjian)
     </p><p>この誤りは<code class="literal">postgres</code>データベースと<code class="literal">template1</code>データベースのテーブルに対してclogファイルが無いというエラーを引き起こす可能性がありました。
     </p></li><li class="listitem"><p>Administratorで実行しても失敗しないように、Windows上で<span class="application">pg_upgrade</span>と<span class="application">pg_resetxlog</span>を制限された権限で実行するようにしました。
(Muhammad Asif Naeem)
     </p></li><li class="listitem"><p><span class="application">initdb</span>と<span class="application">pg_basebackup</span>でディレクトリを読み取るときに、<code class="function">readdir()</code>が失敗した場合の扱いを改善しました。
(Marco Nenciarini)
     </p></li><li class="listitem"><p><span class="application">pg_receivexlog</span>が失敗する問題を修正しました。
(Andres Freund)
     </p><p>9.2.10で誤ってマージされたパッチは<span class="quote">“<span class="quote">could not create archive status file</span>”</span>(アーカーブステータスファイルを作成することができません)というエラーを引き起こしていました。
     </p></li><li class="listitem"><p><code class="filename">contrib/intarray</code>で遅いソートアルゴリズムを修正しました。
(Tom Lane)
     </p></li><li class="listitem"><p>Sparc V8 マシンでのコンパイル失敗を修正しました。
(Rob Rowan)
     </p></li><li class="listitem"><p>タイムゾーンデータファイルが、エジプト、モンゴル、パレスチナにおける夏時間規則の変更、カナダ、チリの歴史的変更、America/Adak の時間帯省略形の改定（HAST/HADT でなく HST/HDT となる）が含まれる<span class="application">tzdata</span> release 2015d に更新されました。
     </p></li></ul></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="release-9-2-12.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="release.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="release-9-2-10.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">E.90. リリース9.2.12 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> E.92. リリース9.2.10</td></tr></table></div></body></html>