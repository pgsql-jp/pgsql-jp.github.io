<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>52.4. ストリーミングレプリケーションプロトコル</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="sasl-authentication.html" title="52.3. SASL認証" /><link rel="next" href="protocol-logical-replication.html" title="52.5. 論理ストリーミングレプリケーションのプロトコル" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">52.4. ストリーミングレプリケーションプロトコル</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="sasl-authentication.html" title="52.3. SASL認証">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="protocol.html" title="Chapter 52. フロントエンド/バックエンドプロトコル">Up</a></td><th width="60%" align="center">Chapter 52. フロントエンド/バックエンドプロトコル</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="protocol-logical-replication.html" title="52.5. 論理ストリーミングレプリケーションのプロトコル">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="PROTOCOL-REPLICATION"><div class="titlepage"><div><div><h2 class="title" style="clear: both">52.4. ストリーミングレプリケーションプロトコル</h2></div></div></div><p>ストリーミングレプリケーションを初期化するために、フロントエンドは開始メッセージにて<code class="literal">replication</code>パラメータを送信します。
ブール値の<code class="literal">true</code>がバックエンドに対して、SQL文ではなく小規模なレプリケーションコマンド群を発行できるようになる、walsenderモードに入るように伝えます。
walsenderモードでは簡易問い合わせプロトコルのみを使用することができます。
<a class="xref" href="runtime-config-logging.html#GUC-LOG-REPLICATION-COMMANDS">log_replication_commands</a>が有効であれば、レプリケーションコマンドはサーバログにログが残ります。
<code class="literal">database</code>を値として渡すことにより、
<code class="literal">dbname</code>パラメータに指定したデータベースに接続することをwalsenderに教えます。
それにより、そのデータベースからの論理的レプリケーションとして使用する接続が可能となります。</p><p>レプリケーションコマンドをテストするために、<code class="literal">replication</code>オプションを含む接続文字列を使用して、<span class="application">psql</span>または他の<code class="literal">libpq</code>によるレプリケーション接続を作成できます。
例を示します。
</p><pre class="programlisting">psql "dbname=postgres replication=database" -c "IDENTIFY_SYSTEM;"</pre><p>
しかし、物理的レプリケーションのために<a class="xref" href="app-pgreceivewal.html" title="pg_receivewal"><span class="refentrytitle">pg_receivewal</span></a>を使用し、論理的レプリケーションのため<a class="xref" href="app-pgrecvlogical.html" title="pg_recvlogical"><span class="refentrytitle"><span class="application">pg_recvlogical</span></span></a>を使用すれば、もっと有用なことが多いです。</p><p>walsenderモードで受け付けられるコマンドは以下の通りです。
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">IDENTIFY_SYSTEM</code>
     <a id="id-1.10.5.9.4.1.1.1.2" class="indexterm"></a>
    </span></dt><dd><p>サーバに自身を識別することを要求します。
サーバは以下の４つのフィールドを持つ単一行の結果セットをもって応答します。
     </p><p>      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">       <code class="literal">systemid</code> (<code class="type">text</code>)
      </span></dt><dd><p>クラスタを識別する一意なシステム識別子です。
これを使用してスタンバイを初期化するために使用するベースバックアップが同じクラスタに由来していることを検査することができます。
      </p></dd><dt><span class="term">       <code class="literal">timeline</code> (<code class="type">int4</code>)
      </span></dt><dd><p>現在のタイムラインIDです。
同様にスタンバイがマスタと一貫性を持つことを検査するために使用されます。
      </p></dd><dt><span class="term">       <code class="literal">xlogpos</code> (<code class="type">text</code>)
      </span></dt><dd><p>現在のWALの吐き出し位置です。
ストリーミングを開始できる先行書き込みログの既知の位置を得る際に有用です。
      </p></dd><dt><span class="term">       <code class="literal">dbname</code> (<code class="type">text</code>)
      </span></dt><dd><p>接続したデータベース名またはNULLです。
      </p></dd></dl></div><p>
     </p></dd><dt><span class="term"><code class="literal">SHOW</code> <em class="replaceable"><code>name</code></em>
     <a id="id-1.10.5.9.4.1.2.1.3" class="indexterm"></a>
    </span></dt><dd><p>実行時パラメータの現在の設定を送信するようサーバに要求します。
これはSQLコマンド<a class="xref" href="sql-show.html" title="SHOW"><span class="refentrytitle">SHOW</span></a>と同等です。
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="replaceable"><code>name</code></em></span></dt><dd><p>実行時パラメータの名前です。
利用できるパラメータは<a class="xref" href="runtime-config.html" title="Chapter 19. サーバの設定">Chapter 19</a>に記述されています。
         </p></dd></dl></div></dd><dt><span class="term"><code class="literal">TIMELINE_HISTORY</code> <em class="replaceable"><code>tli</code></em>
     <a id="id-1.10.5.9.4.1.3.1.3" class="indexterm"></a>
    </span></dt><dd><p><em class="replaceable"><code>tli</code></em>のタイムラインのため、サーバにタイムライン履歴ファイルの送付を要求します。
サーバは2列単一行の結果セットを返します。
     </p><p>      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">       <code class="literal">filename</code> (<code class="type">text</code>)
      </span></dt><dd><p>タイムライン履歴ファイル名、例えば<code class="filename">00000002.history</code>
      </p></dd><dt><span class="term">       <code class="literal">content</code> (<code class="type">bytea</code>)
      </span></dt><dd><p>タイムライン履歴ファイルの内容
      </p></dd></dl></div><p>
     </p></dd><dt id="PROTOCOL-REPLICATION-CREATE-SLOT"><span class="term"><code class="literal">CREATE_REPLICATION_SLOT</code> <em class="replaceable"><code>slot_name</code></em> [ <code class="literal">TEMPORARY</code> ] { <code class="literal">PHYSICAL</code> [ <code class="literal">RESERVE_WAL</code> ] | <code class="literal">LOGICAL</code> <em class="replaceable"><code>output_plugin</code></em> [ <code class="literal">EXPORT_SNAPSHOT</code> | <code class="literal">NOEXPORT_SNAPSHOT</code> | <code class="literal">USE_SNAPSHOT</code> ] }
     <a id="id-1.10.5.9.4.1.4.1.11" class="indexterm"></a>
    </span></dt><dd><p>物理的または論理的レプリケーションスロットを作成します。
レプリケーションスロットの詳細は<a class="xref" href="warm-standby.html#STREAMING-REPLICATION-SLOTS" title="26.2.6. レプリケーションスロット">Section 26.2.6</a>を参照。
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="replaceable"><code>slot_name</code></em></span></dt><dd><p>作成するスロット名。
有効なレプリケーションスロット名でなければならない。
（<a class="xref" href="warm-standby.html#STREAMING-REPLICATION-SLOTS-MANIPULATION" title="26.2.6.1. レプリケーションスロットへの問い合わせと操作">Section 26.2.6.1</a>を参照）。
         </p></dd><dt><span class="term"><em class="replaceable"><code>output_plugin</code></em></span></dt><dd><p>ロジカルデコーディングに使用される出力プラグイン名。
（<a class="xref" href="logicaldecoding-output-plugin.html" title="48.6. ロジカルデコーディングの出力プラグイン">Section 48.6</a>を参照）。
         </p></dd><dt><span class="term"><code class="literal">TEMPORARY</code></span></dt><dd><p>このレプリケーションスロットが一時スロットであることを指定します。
一時スロットはディスクに保存されず、エラー発生時またはセッション終了時に自動で機に削除されます。
        </p></dd><dt><span class="term"><code class="literal">RESERVE_WAL</code></span></dt><dd><p>この物理的レプリケーションスロットが直ちに<acronym class="acronym">WAL</acronym>を予約することを指定します。
そうでなければ、<acronym class="acronym">WAL</acronym>はストリーミングレプリケーションクライアントからの接続に応じてだけ予約されます。
        </p></dd><dt><span class="term"><code class="literal">EXPORT_SNAPSHOT</code><br /></span><span class="term"><code class="literal">NOEXPORT_SNAPSHOT</code><br /></span><span class="term"><code class="literal">USE_SNAPSHOT</code></span></dt><dd><p>論理スロットの初期化時に作成されたスナップショットの処理について決定します。
デフォルトの<code class="literal">EXPORT_SNAPSHOT</code>はスナップショットが他のセッションで利用できるようエクスポートします。
このオプションはトランザクションの内側で使用することはできません。
<code class="literal">USE_SNAPSHOT</code>はこのコマンドを実行している現在のトランザクションでスナップショットを利用します。
このオプションはトランザクション内で使用しなければならず、<code class="literal">CREATE_REPLICATION_SLOT</code>がそのトランザクション内で実行される最初のコマンドでなければなりません。
最後に、<code class="literal">NOEXPORT_SNAPSHOT</code>は論理デコーディングで通常通りにスナップショットを使用するだけで、他には何もしません。
        </p></dd></dl></div><p>このコマンドへの応答として、サーバは以下のフィールドを含む1行の結果集合を送信します。

      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">slot_name</code> (<code class="type">text</code>)</span></dt><dd><p>新しく作成されたレプリケーションスロットの名前です。
         </p></dd><dt><span class="term"><code class="literal">consistent_point</code> (<code class="type">text</code>)</span></dt><dd><p>スロットが一貫性のある状態になった時点のWAL位置です。
これが、このスロット上でストリーミングを開始できる最も早い場所となります。
         </p></dd><dt><span class="term"><code class="literal">snapshot_name</code> (<code class="type">text</code>)</span></dt><dd><p>このコマンドでエクスポートされるスナップショットの識別子です。
スナップショットは、この接続上で新しいコマンドが実行されるか、レプリケーション接続が閉じられるまで有効です。
作成されたのが物理スロットの場合はNULLになります。
         </p></dd><dt><span class="term"><code class="literal">output_plugin</code> (<code class="type">text</code>)</span></dt><dd><p>新しく作成されたレプリケーションスロットが使用する出力プラグインの名前です。
作成されたのが物理スロットの場合はNULLになります。
         </p></dd></dl></div><p>
     </p></dd><dt><span class="term"><code class="literal">START_REPLICATION</code> [ <code class="literal">SLOT</code> <em class="replaceable"><code>slot_name</code></em> ] [ <code class="literal">PHYSICAL</code> ] <em class="replaceable"><code>XXX/XXX</code></em> [ <code class="literal">TIMELINE</code> <em class="replaceable"><code>tli</code></em> ]
     <a id="id-1.10.5.9.4.1.5.1.8" class="indexterm"></a>
    </span></dt><dd><p>サーバに対して、WALのストリーミングを<em class="replaceable"><code>XXX/XXX</code></em> WAL時点から開始するよう指示します。
<code class="literal">TIMELINE</code>オプションが指定された場合、ストリーミングは<em class="replaceable"><code>tli</code></em>のタイムラインから開始されます。
そうでなければ、サーバの現在のタイムラインが選択されます。
サーバが、例えば、要求されたWALの断片がすでに回収されているなど、エラーを返すことがありえます。
成功時サーバはCopyBothResponseメッセージで応答し、フロントエンドに対するWALストリームを開始します。
     </p><p><em class="replaceable"><code>slot_name</code></em>を経由してスロット名が提供された場合、それはレプリケーションの進行として更新されます。
それによってサーバは、どのWALセグメントがまだスタンバイに必要か、<code class="varname">hot_standby_feedback</code>のトランザクションはどれか、を感知します。
     </p><p>最新ではなくて、サーバの過去のタイムラインをクライアントが要求した場合、サーバは要求された開始時点から他のタイムラインに切り替えるまでの、全てのWALストリームを送付します。
クライアントが旧タイムラインの終点のストリームを要求した場合、サーバはCOPYモードに入らずにCommandCompleteをすぐに応答します。
     </p><p>最新でないタイムラインの全てのWALストリームを送付した後、サーバはCOPYモードを出ることによりストリームを終了します。
クライアントもCOPYモードを出ることにより承認した場合、サーバは2列単一行の結果セットを送付し、サーバにある次のタイムラインを示します。
最初の列は次のタイムラインID(<code class="type">int8</code>型)であり、次の列は切り替えたXLOGの位置(<code class="type">text</code>型)です。
通常切り替えた位置はWALストリームの終点ですが、昇格する前に再実行されなかった旧タイムラインからWALを送付するというまれな場合もあります。
最後に、サーバはCommandCompleteメッセージを送付し、新規のコマンドを受理できるようになります。
     </p><p>WALデータはCopyDataメッセージ群として送信されます。
（これにより他の情報を混在させることができます。
具体的にはサーバはストリーム開始後に失敗が起きた場合にErrorResponseメッセージを送信することができます。）
サーバからクライアントへの各CopyDataメッセージのペイロード、は以下の書式のどれかを含みます。
     </p><p>      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">          XLogData (B)
      </span></dt><dd><p>      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">          Byte1('w')
      </span></dt><dd><p>メッセージをWALデータとして識別します。
      </p></dd><dt><span class="term">          Int64
      </span></dt><dd><p>このメッセージ内のWALの開始点。
      </p></dd><dt><span class="term">          Int64
      </span></dt><dd><p>サーバ上の現在のWAL終了点。
      </p></dd><dt><span class="term">          Int64
      </span></dt><dd><p>転送時点でのサーバのシステム時刻。
2000年1月1日午前0時からのマイクロ秒。
      </p></dd><dt><span class="term">          Byte<em class="replaceable"><code>n</code></em>
      </span></dt><dd><p>WALデータストリームの断片。
      </p><p>単一のWALレコードが2つのXLogDataメッセージに分かれることはありません。
しかしWALレコードがWALページ境界を跨る場合、継続レコードを用いてすでに分割されていますので、ページ境界で分割することができます。
言い換えると、先頭の主WALレコードとその継続レコードは、別のXLogDataメッセージとして分かれることがありえます。
      </p></dd></dl></div><p>
      </p></dd><dt><span class="term">プライマリキープアライブメッセージ(B)
      </span></dt><dd><p>      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">          Byte1('k')
      </span></dt><dd><p>このメッセージを送信元キープアライブとして識別します。
      </p></dd><dt><span class="term">          Int64
      </span></dt><dd><p>サーバ上の現在のWAL終端。
      </p></dd><dt><span class="term">          Int64
      </span></dt><dd><p>転送時点でのサーバのシステム時刻。
2000年1月1日午前0時からのマイクロ秒。
      </p></dd><dt><span class="term">          Byte1
      </span></dt><dd><p>タイムアウトによる切断を避けるため、クライアントがこのメッセージに即時に応答するべき方法の1つ。
0またはその他
      </p></dd></dl></div><p>
      </p></dd></dl></div><p>
     </p><p>以下のメッセージ書式の1つ（およびCopyDataメッセージのペイロード中のもの）を使用して、受理プロセスは送信者にいつでも応答できます。
     </p><p>      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">スタンバイ状態の更新(F)
      </span></dt><dd><p>      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">          Byte1('r')
      </span></dt><dd><p>メッセージを受信側の状態更新として識別します。
      </p></dd><dt><span class="term">          Int64
      </span></dt><dd><p>スタンバイにおいて受信しディスクに書き込まれた最終WALバイト+1の場所。
      </p></dd><dt><span class="term">          Int64
      </span></dt><dd><p>スタンバイにおいてディスクに吐き出された最終WALバイト+1の場所。
      </p></dd><dt><span class="term">          Int64
      </span></dt><dd><p>スタンバイにおいて適用された最終WALバイト+1の場所。
      </p></dd><dt><span class="term">          Int64
      </span></dt><dd><p>転送時点でのクライアントのシステム時刻。
2000年1月1日午前0時からのマイクロ秒。
      </p></dd><dt><span class="term">          Byte1
      </span></dt><dd><p>値が1の場合、このメッセージにすぐ応答するように、クライアントはサーバへ要求します。
この方法は、接続がまだ保持されているか検査するために、サーバへのピング送信として使用できます。
      </p></dd></dl></div><p>
      </p></dd></dl></div><p>
     </p><p>      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">ホットスタンバイフィードバックメッセージ(F)
      </span></dt><dd><p>      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">          Byte1('h')
      </span></dt><dd><p>メッセージをホットスタンバイのフィードバックメッセージとして識別します。
      </p></dd><dt><span class="term">          Int64
      </span></dt><dd><p>転送時点でのクライアントのシステム時刻。
2000年1月1日午前0時からのマイクロ秒
      </p></dd><dt><span class="term">          Int32
      </span></dt><dd><p>スタンバイの現在のグローバルのxminですが、すべてのレプリケーションスロットのcatalog_xminは除きます。
この値と次のcatalog_xminがいずれも0なら、この接続ではホットスタンバイのフィードバックはもう送信されないという通知として扱われます。
後でゼロでないメッセージによりフィードバック機構を再開することができます。
      </p></dd><dt><span class="term">          Int32
      </span></dt><dd><p>スタンバイのグローバルのxmin xidのエポックです。
      </p></dd><dt><span class="term">          Int32
      </span></dt><dd><p>スタンバイのすべてのレプリケーションスロットのcatalog_xminの最小値です。
スタンバイ上にcatalog_xminが存在しない、あるいはホットスタンバイのフィードバックが無効化されている場合は0に設定します。
      </p></dd><dt><span class="term">          Int32
      </span></dt><dd><p>スタンバイのcatalog_xmin xidのエポックです。
      </p></dd></dl></div><p>
      </p></dd></dl></div><p>
     </p></dd><dt><span class="term"><code class="literal">START_REPLICATION</code> <code class="literal">SLOT</code> <em class="replaceable"><code>slot_name</code></em> <code class="literal">LOGICAL</code> <em class="replaceable"><code>XXX/XXX</code></em> [ ( <em class="replaceable"><code>option_name</code></em> [ <em class="replaceable"><code>option_value</code></em> ] [, ...] ) ]</span></dt><dd><p>サーバに対して、<em class="replaceable"><code>XXX/XXX</code></em>WAL時点から、論理的レプリケーションのWALストリームを開始するよう指示します。
例えば、要求されたWALがすでに回収された場合、サーバはエラーを返します。
サーバが、例えば、要求されたWALセクションがすでに回収されている場合、エラーを返すことがありえます。
成功時サーバはCopyBothResponseメッセージで応答し、フロントエンドに対するWALストリームを開始します。
     </p><p>CopyBothResponse内部のメッセージは、<code class="literal">START_REPLICATION ... PHYSICAL</code>の記述と同じ書式です。
     </p><p>選択されたスロットに関連した出力プラグインは、出力ストリームの処理に使用されます。
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">SLOT</code> <em class="replaceable"><code>slot_name</code></em></span></dt><dd><p>ストリームを変更したスロット名。
このパラメータは必須であり、<code class="literal">LOGICAL</code>モードにおいて<code class="literal">CREATE_REPLICATION_SLOT</code>によって作成された、実在する論理的レプリケーションスロットに対応しなければなりません。
         </p></dd><dt><span class="term"><em class="replaceable"><code>XXX/XXX</code></em></span></dt><dd><p>ストリームを開始するWAL時点。
        </p></dd><dt><span class="term"><em class="replaceable"><code>option_name</code></em></span></dt><dd><p>レプリケーションスロットのロジカルデコーディング出力プラグインに渡すオプション名。
        </p></dd><dt><span class="term"><em class="replaceable"><code>option_value</code></em></span></dt><dd><p>オプションの値。
文字列定数の形式。
        </p></dd></dl></div></dd><dt><span class="term">     <code class="literal">DROP_REPLICATION_SLOT</code> <em class="replaceable"><code>slot_name</code></em> [<span class="optional"> <code class="literal">WAIT</code> </span>]
     <a id="id-1.10.5.9.4.1.7.1.4" class="indexterm"></a>
    </span></dt><dd><p>レプリケーションスロットを削除し、サーバ側で準備した資源を解放します。
このスロットが、walsenderが接続しているデータベース以外のデータベースで作成された論理スロットの場合、このコマンドは失敗します。
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="replaceable"><code>slot_name</code></em></span></dt><dd><p>削除するスロット名。
         </p></dd><dt><span class="term"><code class="literal">WAIT</code></span></dt><dd><p>このオプションを使用すると、スロットが使用中の時に、スロットの使用が終わるまでコマンドを待機させます。
デフォルトの動作ではエラーを発生させます。
        </p></dd></dl></div></dd><dt><span class="term"><code class="literal">BASE_BACKUP</code> [ <code class="literal">LABEL</code> <em class="replaceable"><code>'label'</code></em> ] [ <code class="literal">PROGRESS</code> ] [ <code class="literal">FAST</code> ] [ <code class="literal">WAL</code> ] [ <code class="literal">NOWAIT</code> ] [ <code class="literal">MAX_RATE</code> <em class="replaceable"><code>rate</code></em> ] [ <code class="literal">TABLESPACE_MAP</code> ]
     <a id="id-1.10.5.9.4.1.8.1.11" class="indexterm"></a>
    </span></dt><dd><p>サーバにベースバックアップのストリーミングを始めるよう指示します。
システムはバックアップが開始される前に自動的にバックアップモードになり、バックアップが完了した時に取り出されます。
以下のオプションを受け付けることができます。
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">LABEL</code> <em class="replaceable"><code>'label'</code></em></span></dt><dd><p>バックアップのラベルを設定します。
指定がない場合、<code class="literal">base backup</code>というバックアップラベルが使用されます。
ラベルについての引用符付け規則は、<a class="xref" href="runtime-config-compatible.html#GUC-STANDARD-CONFORMING-STRINGS">standard_conforming_strings</a>を有効にした場合の標準SQLの文字列の規則と同じです。
         </p></dd><dt><span class="term"><code class="literal">PROGRESS</code></span></dt><dd><p>進行状況の報告を生成するために必要な情報を要求します。
これは、ストリームが完了するまでにどのくらいかかるかを計算するために使用することができる、各テーブル空間のヘッダ内の概算容量を返送します。
これは、転送を始める前のすべてのファイルサイズを１度数え上げることで計算されます。
これ自体が性能に与える悪影響があるかもしれません。
特に最初のデータがストリームされるまでにより多くの時間がかかる可能性があります。
データベースファイルはバックアップの間変更される可能性がありますので、容量は概算に過ぎず、概算時と実ファイルを送信するまでの間に増減される可能性があります。
         </p></dd><dt><span class="term"><code class="literal">FAST</code></span></dt><dd><p>高速チェックポイントを要求します。
         </p></dd><dt><span class="term"><code class="literal">WAL</code></span></dt><dd><p>バックアップ内に必要なWALセグメントを含めます。
ベースディレクトリtarファイルの<code class="filename">pg_wal</code>ディレクトリにある、バックアップの開始から終了までのすべてのファイルが含まれます。
         </p></dd><dt><span class="term"><code class="literal">NOWAIT</code></span></dt><dd><p>デフォルトでは、バックアップは必要な最終WALセグメントがアーカイブされるまで待機します。
ログアーカイブが有効でない場合は警告が発せられます。
<code class="literal">NOWAIT</code>により、必要なログが利用できるようになったことを確認することをクライアント側の責任として、この待機や警告が無効になります。
         </p></dd><dt><span class="term"><code class="literal">MAX_RATE</code> <em class="replaceable"><code>rate</code></em></span></dt><dd><p>サーバからクライアントへ転送する単位時間当たりの最大データ容量を制限します（絞ります）。
予期される単位はkB/s（キロバイト/秒）です。
このオプションが指定された場合、値はゼロまたは32 kB以上1 GB以下でなければなりません。
ゼロが渡されるかオプションが指定されない場合、転送の制約は課されません。
         </p></dd><dt><span class="term"><code class="literal">TABLESPACE_MAP</code></span></dt><dd><p>ディレクトリ<code class="filename">pg_tblspc</code>にあるシンボリックリンクに関する情報を<code class="filename">tablespace_map</code>という名前のファイルに含めます。
テーブル空間マップファイルには、ディレクトリ<code class="filename">pg_tblspc/</code>に存在する各シンボリックリンクの名前とそのシンボリックリンクのフルパスが含まれています。
         </p></dd></dl></div><p>
     </p><p>バックアップを開始する時、サーバはまず２つの通常の結果セットを送信し、続けて１つ以上のCopyResponse結果を送信します。
     </p><p>最初の通常の結果セットには、1行2列という形でバックアップの開始位置が含まれます。
最初の列にはXLogRecPtr書式の開始位置が、2番目の列には対応するタイムラインIDが含まれます。
     </p><p>２番目の通常の結果セットには各テーブル空間に付き１行を持ちます。
この行のフィールドは以下の通りです。
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">spcoid</code> (<code class="type">oid</code>)</span></dt><dd><p>テーブル空間のOIDです。
ベースディレクトリの場合はNULLです。
         </p></dd><dt><span class="term"><code class="literal">spclocation</code> (<code class="type">text</code>)</span></dt><dd><p>テーブル空間ディレクトリのフルパスです。
ベースディレクトリの場合はNULLです。
         </p></dd><dt><span class="term"><code class="literal">size</code> (<code class="type">int8</code>)</span></dt><dd><p>進行状況報告が要求された場合は、テーブル空間の概算容量です。
要求されていない場合はNULLです。
         </p></dd></dl></div><p>
     </p><p>２番目の通常の結果セットの後、１つ以上のCopyResponse結果が送信されます。
主データディレクトリ用に1つ、<code class="literal">pg_default</code>、<code class="literal">pg_global</code>以外の追加のテーブル空間ごとに1つ送信されます。
CopyResponse結果内のデータは、テーブル空間の内容のtar形式（POSIX 1003.1-2008標準で規定された<span class="quote">“<span class="quote">ustar交換形式</span>”</span>に従う）ダンプです。
ただし標準で規定された最後の２つのゼロブロックは省略されています。
このtarデータが終わった後、最終の通常結果セットが送信されます。
結果セットには、開始位置と同じ書式のバックアップのWAL終了位置が含まれます。
     </p><p>データディレクトリと各テーブル空間のtarアーカイブには、そのディレクトリ内のファイルが<span class="productname">PostgreSQL</span>ファイルかそのディレクトリに追加された他のファイルかに関係なく、すべて含まれます。
以下に除かれるファイルを示します。
      </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>         <code class="filename">postmaster.pid</code>
        </p></li><li class="listitem" style="list-style-type: disc"><p>         <code class="filename">postmaster.opts</code>
        </p></li><li class="listitem" style="list-style-type: disc"><p>PostgreSQLサーバの操作中に作成される種々の一時ファイルおよびディレクトリで、<code class="filename">pgsql_tmp</code>で始まるすべてのファイルおよびディレクトリなど。
        </p></li><li class="listitem" style="list-style-type: disc"><p>サブディレクトリを含む<code class="filename">pg_wal</code>。
バックアップがwalファイルを含めて実行される場合、合成された版の<code class="filename">pg_wal</code>が含まれます。
これにはバックアップが動作するために必要なファイルのみが含まれ、残りの内容は含まれません。
        </p></li><li class="listitem" style="list-style-type: disc"><p><code class="filename">pg_dynshmem</code>、<code class="filename">pg_notify</code>、<code class="filename">pg_replslot</code>、<code class="filename">pg_serial</code>、<code class="filename">pg_snapshots</code>、<code class="filename">pg_stat_tmp</code>、<code class="filename">pg_subtrans</code>は（それがシンボリックリンクであったとしても）空のディレクトリとしてコピーされます。
        </p></li><li class="listitem" style="list-style-type: disc"><p>シンボリックリンク（上記で列挙したディレクトリは除きます）や特殊デバイスファイルなど、通常のファイルとディレクトリ以外のものは省略されます。
（<code class="filename">pg_tblspc</code>中のシンボリックリンクは保持されます。）
        </p></li></ul></div><p>
サーバ上の基盤となるファイルシステムがサポートする場合、所有者、グループ、ファイルのモードが設定されます。
     </p></dd></dl></div><p>
</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="sasl-authentication.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="protocol.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="protocol-logical-replication.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">52.3. SASL認証 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 52.5. 論理ストリーミングレプリケーションのプロトコル</td></tr></table></div></body></html>