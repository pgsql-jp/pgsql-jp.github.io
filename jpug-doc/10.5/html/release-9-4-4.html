<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>E.48. リリース9.4.4</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="release-9-4-5.html" title="E.47. リリース9.4.5" /><link rel="next" href="release-9-4-3.html" title="E.49. リリース9.4.3" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">E.48. リリース9.4.4</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="release-9-4-5.html" title="E.47. リリース9.4.5">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="release.html" title="Appendix E. リリースノート">Up</a></td><th width="60%" align="center">Appendix E. リリースノート</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="release-9-4-3.html" title="E.49. リリース9.4.3">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="RELEASE-9-4-4"><div class="titlepage"><div><div><h2 class="title" style="clear: both">E.48. リリース9.4.4</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="release-9-4-4.html#id-1.11.6.52.4">E.48.1. バージョン9.4.4への移行</a></span></dt><dt><span class="sect2"><a href="release-9-4-4.html#id-1.11.6.52.5">E.48.2. 変更点</a></span></dt></dl></div><p><strong>リリース日: </strong>2015-06-12</p><p>このリリースは9.4.3に対し、少数の不具合を修正したものです。
9.4メジャーリリースにおける新機能については、<a class="xref" href="release-9-4.html" title="E.52. リリース9.4">Section E.52</a>を参照してください。
  </p><div class="sect2" id="id-1.11.6.52.4"><div class="titlepage"><div><div><h3 class="title">E.48.1. バージョン9.4.4への移行</h3></div></div></div><p>9.4.Xからの移行ではダンプ/リストアは不要です。
   </p><p>しかしながら、以前に9.3.0から9.3.4の<span class="application">pg_upgrade</span>を使ってアップグレードしている場合には、以下の変更点の最初の項目を確認してください。
   </p><p>また、9.4.2よりも前のリリースからアップグレードする場合は、<a class="xref" href="release-9-4-2.html" title="E.50. リリース9.4.2">Section E.50</a>を参照して下さい。
   </p></div><div class="sect2" id="id-1.11.6.52.5"><div class="titlepage"><div><div><h3 class="title">E.48.2. 変更点</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>一貫性のないデータベース状態からのリカバリに失敗する可能性があり、修正しました。
(Robert Haas)
     </p><p>最近の<span class="productname">PostgreSQL</span>リリースでマルチトランザクション周回を防ぐ仕組みが導入されましたが、そのコードの一部はデータベースがまだ一貫した状態になっていないときのクラッシュリカバリ中に実行が必要となる可能性について責任を果たしていませんでした。
これはクラッシュ後の再起動失敗やスタンバイサーバの開始失敗を引き起こすおそれがあります。
バージョン9.3.0から9.3.4の<span class="application">pg_upgrade</span>を使って構築されたデータベースでは、以前に修正された<span class="application">pg_upgrade</span>のバグの長引く影響が同様の障害を引き起こします。
     </p><p>問題の<span class="application">pg_upgrade</span>のバグは、本来はより大きい値であるべきときでも<code class="filename">pg_control</code>の<code class="literal">oldestMultiXid</code>に1を設定します。
本リリースで導入された修正では、このような状態では直ちに緊急自動バキュームが生じ、適正な<code class="literal">oldestMultiXid</code>値を確定できるまで実行されます。
このことが困難を引き起こすのであれば、本リリースにアップグレードする<span class="emphasis"><em>前に</em></span>手動バキュームを行うことで回避できます。
詳細手順は以下の通りです。

      </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><span class="application">pg_controldata</span>が<span class="quote">“<span class="quote">Latest checkpoint's oldestMultiXid</span>”</span>を1と報告するかを確認します。そうでなければ、やるべきことはありません。
        </p></li><li class="listitem"><p><code class="filename">PGDATA/pg_multixact/offsets</code>で<code class="filename">0000</code>ファイルが在るかを見ます。
ファイルが在るなら、やるべきことはありません。
        </p></li><li class="listitem"><p>さもなくば、<code class="structname">pg_class</code>.<code class="structfield">relminmxid</code>が1である各テーブルに対して、
<a class="xref" href="runtime-config-client.html#GUC-VACUUM-MULTIXACT-FREEZE-MIN-AGE">vacuum_multixact_freeze_min_age</a>と<a class="xref" href="runtime-config-client.html#GUC-VACUUM-MULTIXACT-FREEZE-TABLE-AGE">vacuum_multixact_freeze_table_age</a>を0に設定したうえで、<code class="command">VACUUM</code>を行います。
（同時実行セッションの性能影響を減らすため、<a class="xref" href="runtime-config-resource.html#RUNTIME-CONFIG-RESOURCE-VACUUM-COST" title="19.4.4. コストに基づくVacuum遅延">Section 19.4.4</a>に記載されているバキュームコスト遅延設定を使うことができます）
        </p></li></ol></div><p>
     </p></li><li class="listitem"><p>稀にリレーションキャッシュ初期化ファイル無効化に失敗するのを修正しました。
(Tom Lane)
     </p><p>ちょうど悪いタイミングの同時動作で、システムカタログの<code class="command">VACUUM FULL</code>が、新たなセッションのためにキャッシュ読み込み動作を避けるのに使われる<span class="quote">“<span class="quote">initファイル</span>”</span>の更新に失敗することがありました。
この結果、後のセッションがそのシステムカタログに全くアクセスできなくなってしまいます。
これはとても古くからのバグですが、起こすのが難しく、最近まで再現できるケースが見つかりませんでした。
     </p></li><li class="listitem"><p>新たなセッション開始と<code class="literal">CREATE/DROP DATABASE</code>との間のデッドロックを回避しました。
(Tom Lane)
     </p><p><code class="command">DROP DATABASE</code>コマンドの対象であるか、または、<code class="command">CREATE DATABASE</code>コマンドでのテンプレートであるデータベースに対する新たなセッション開始が、5秒待った後、たとえ新たなセッションがその前に終了していたとしても、失敗する可能性がありました。
     </p></li><li class="listitem"><p>内部インデックススキャンでセミ結合とアンチ結合についてプランナのコスト見積りを改善しました。
(Tom Lane, Tomas Vondra)
     </p><p>全ての結合節がインデックススキャン条件として使われている場合、たとえ内部スキャンが見かけ上は多数の行を読みだすとしても、エグゼキュータは一行を取得した後止まるので、この種の実行計画は全く低コストです。
プランナはこの効果をごく一部しか考慮しておらず、他の能率が大きく劣る他の計画タイプを選んでしまう可能性をもたらしていました。
     </p></li></ul></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="release-9-4-5.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="release.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="release-9-4-3.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">E.47. リリース9.4.5 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> E.49. リリース9.4.3</td></tr></table></div></body></html>