<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>19.12. ロック管理</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="runtime-config-client.html" title="19.11. クライアント接続デフォルト" /><link rel="next" href="runtime-config-compatible.html" title="19.13. バージョンとプラットフォーム互換性" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">19.12. ロック管理</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="runtime-config-client.html" title="19.11. クライアント接続デフォルト">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="runtime-config.html" title="Chapter 19. サーバの設定">Up</a></td><th width="60%" align="center">Chapter 19. サーバの設定</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="runtime-config-compatible.html" title="19.13. バージョンとプラットフォーム互換性">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="RUNTIME-CONFIG-LOCKS"><div class="titlepage"><div><div><h2 class="title" style="clear: both">19.12. ロック管理</h2></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="GUC-DEADLOCK-TIMEOUT"><span class="term"><code class="varname">deadlock_timeout</code> (<code class="type">integer</code>)
      <a id="id-1.6.6.15.2.1.1.3" class="indexterm"></a>
      <a id="id-1.6.6.15.2.1.1.4" class="indexterm"></a>
      <a id="id-1.6.6.15.2.1.1.5" class="indexterm"></a>
      </span></dt><dd><p>       
これは、デッドロック状態があるかどうかを調べる前にロックを待つ時間をミリ秒で計算したものです。
デッドロックの検査は比較的高価なので、サーバはロックを待つ度にこれを実行するわけではありません。
楽天的ですがデッドロックは実用レベルのアプリケーションでは頻繁に発生しないと仮定し、デッドロックの検査の前にしばらくはロック待ちをします。
この値を増やすことにより必要のないデッドロックの検査で無駄にされる時間は減りますが、本当にデッドロックがあった場合の報告が遅れます。
デフォルトは1秒（<code class="literal">1s</code>）で、おそらく実用の際にはこれ以上は必要でしょう。
負荷の大きいサーバではもっと必要かもしれません。
理想としてはこの設定は通常のトランザクションにかかる時間を超えているべきです。
そうすればロック待ちトランザクションがデッドロックの検査をする前にロックが解除される可能性が改善されます。
スーパーユーザのみこの設定を変更できます。
       </p><p>       
       <a class="xref" href="runtime-config-logging.html#GUC-LOG-LOCK-WAITS">log_lock_waits</a>が設定された場合、このパラメータはロック待機に関するログメッセージを出力する前の待機時間を決定します。
ロック遅延の調査を行う場合は、通常の<code class="varname">deadlock_timeout</code>よりも短い値を設定することを勧めます。
       </p></dd><dt id="GUC-MAX-LOCKS-PER-TRANSACTION"><span class="term"><code class="varname">max_locks_per_transaction</code> (<code class="type">integer</code>)
      <a id="id-1.6.6.15.2.2.1.3" class="indexterm"></a>
      </span></dt><dd><p>       
       共有ロックテーブルは、<code class="varname">max_locks_per_transaction</code> * （<a class="xref" href="runtime-config-connection.html#GUC-MAX-CONNECTIONS">max_connections</a> + <a class="xref" href="runtime-config-resource.html#GUC-MAX-PREPARED-TRANSACTIONS">max_prepared_transactions</a>）オブジェクト（例えばテーブル）上のロック追跡します。
したがって、ある時点でこの数以上の個々のオブジェクトをロックすることはできません。
このパラメータは各トランザクションで割り当てられるオブジェクトロックの平均値を制御します。
個々のトランザクションでは、このロックテーブルにすべてのトランザクションのロックが収まる限りオブジェクトのロックを獲得できます。
これは、ロックできる行数では<span class="emphasis"><em>ありません</em></span>。この値には制限がありません。
デフォルトの64は、経験的に十分であると証明されていますが、単一のトランザクションで数多くの異なるテーブルをいじる問い合わせがいる場合、たとえば、数多くの子テーブルを持つ親テーブルの問い合わせなど、この値を大きくする必要があるかも知れません。
このパラメータはサーバ起動時のみ設定されます。
       </p><p>       
       スタンバイサーバを稼動するとき、このパラメータをマスターサーバと同じか、より高い値に設定しなければなりません。
       そうしないと、問い合わせはスタンバイサーバでは許可されません。
       </p></dd><dt id="GUC-MAX-PRED-LOCKS-PER-TRANSACTION"><span class="term"><code class="varname">max_pred_locks_per_transaction</code> (<code class="type">integer</code>)
      <a id="id-1.6.6.15.2.3.1.3" class="indexterm"></a>
      </span></dt><dd><p>       
       共有記述ロックテーブル（shared predicate lock table）は、<code class="varname">max_pred_locks_per_transaction</code> * (<a class="xref" href="runtime-config-connection.html#GUC-MAX-CONNECTIONS">max_connections</a> + <a class="xref" href="runtime-config-resource.html#GUC-MAX-PREPARED-TRANSACTIONS">max_prepared_transactions</a>)オブジェクト（例えば諸テーブル）のロックを追跡します。
       従って、この数以上の明確なオブジェクトは同時にロックされません。
       このパラメータはそれぞれのトランザクションに対して割り当てられたオブジェクトのロックの平均数を管理します。
       個別のトランザクションはロックテーブル内の全てのトランザクションのロックが適合する限り、より多くのオブジェクトをロックできます。
       これはロック可能な行数では<span class="emphasis"><em>ありません</em></span>。その値は無制限です。
       デフォルトは64で、テストでは一般的に充分ですが、単一のシリアライザブルトランザクションで数多くの異なるテーブルに触れるクライアントが存在する場合、この値を大きくする必要があることがあります。
       このパラメータはサーバ起動時のみ設定可能です。
       </p></dd><dt id="GUC-MAX-PRED-LOCKS-PER-RELATION"><span class="term"><code class="varname">max_pred_locks_per_relation</code> (<code class="type">integer</code>)
      <a id="id-1.6.6.15.2.4.1.3" class="indexterm"></a>
      </span></dt><dd><p>リレーション全体をカバーするロックに昇格する前に、一つリレーションの中で述語ロックできるページ数あるいはタプル数を指定します。
0以上の値は、絶対的な制限を表し、負の数は<a class="xref" href="runtime-config-locks.html#GUC-MAX-PRED-LOCKS-PER-TRANSACTION">max_pred_locks_per_transaction</a>をその絶対値で割ったものを表します。
  デフォルトは-2で、以前のバージョンの<span class="productname">PostgreSQL</span>の振る舞いを維持します。
このパラメータは<code class="filename">postgresql.conf</code>ファイル、または、サーバのコマンドラインのみで設定可能です。
       </p></dd><dt id="GUC-MAX-PRED-LOCKS-PER-PAGE"><span class="term"><code class="varname">max_pred_locks_per_page</code> (<code class="type">integer</code>)
      <a id="id-1.6.6.15.2.5.1.3" class="indexterm"></a>
      </span></dt><dd><p>リレーション全体をカバーするロックに昇格する前に、一つページの中で述語ロックできる行数を指定します。
デフォルトは2です。
このパラメータは<code class="filename">postgresql.conf</code>ファイル、または、サーバのコマンドラインのみで設定可能です。
       </p></dd></dl></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="runtime-config-client.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="runtime-config.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="runtime-config-compatible.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">19.11. クライアント接続デフォルト </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 19.13. バージョンとプラットフォーム互換性</td></tr></table></div></body></html>