<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>CREATE TABLE AS</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="sql-createtable.html" title="CREATE TABLE" /><link rel="next" href="sql-createtablespace.html" title="CREATE TABLESPACE" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">CREATE TABLE AS</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="sql-createtable.html" title="CREATE TABLE">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="sql-commands.html" title="SQLコマンド">Up</a></td><th width="60%" align="center">SQLコマンド</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="sql-createtablespace.html" title="CREATE TABLESPACE">Next</a></td></tr></table><hr></hr></div><div class="refentry" id="SQL-CREATETABLEAS"><div class="titlepage"></div><a id="id-1.9.3.82.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle">CREATE TABLE AS</span></h2><p>CREATE TABLE AS — 問い合わせの結果によって新しいテーブルを定義する</p></div><div class="refsynopsisdiv"><h2>Synopsis</h2><pre class="synopsis">CREATE [ [ GLOBAL | LOCAL ] { TEMPORARY | TEMP } | UNLOGGED ] TABLE [ IF NOT EXISTS ] <em class="replaceable"><code>table_name</code></em>
    [ (<em class="replaceable"><code>column_name</code></em> [, ...] ) ]
    [ WITH ( <em class="replaceable"><code>storage_parameter</code></em> [= <em class="replaceable"><code>value</code></em>] [, ... ] ) | WITH OIDS | WITHOUT OIDS ]
    [ ON COMMIT { PRESERVE ROWS | DELETE ROWS | DROP } ]
    [ TABLESPACE <em class="replaceable"><code>tablespace_name</code></em> ]
    AS <em class="replaceable"><code>query</code></em>
    [ WITH [ NO ] DATA ]</pre></div><div class="refsect1" id="id-1.9.3.82.5"><h2>説明</h2><p><code class="command">CREATE TABLE AS</code>はテーブルを作成し、<code class="command">SELECT</code> コマンドによって算出されたデータをそのテーブルに格納します。
テーブルの列は、<code class="command">SELECT</code>の出力列に結び付いた名前とデータ型を持ちます（ただし、新しい列名を明示したリストを渡すと、この列名を上書きすることができます）。
  </p><p><code class="command">CREATE TABLE AS</code>はビューの作成と似ていますが、実際にはまったく異なります。
<code class="command">CREATE TABLE AS</code>は新しいテーブルを作成し、新しいテーブルの内容を初期化するために一度だけ問い合わせを評価します。
それ以降に行われた、問い合わせの元テーブルに対する変更は、新しいテーブルには反映されません。
反対に、ビューは問い合わせの度に定義された<code class="command">SELECT</code>文を再評価します。
  </p></div><div class="refsect1" id="id-1.9.3.82.6"><h2>パラメータ</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">GLOBAL</code>または<code class="literal">LOCAL</code></span></dt><dd><p>互換性を保持するためのキーワードで、無視されます。
これらのキーワードの使用は廃止予定です。
詳細については<a class="xref" href="sql-createtable.html" title="CREATE TABLE"><span class="refentrytitle">CREATE TABLE</span></a>を参照してください。
     </p></dd></dl></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">TEMPORARY</code>または<code class="literal">TEMP</code></span></dt><dd><p>指定された場合、テーブルは一時テーブルとして作成されます。
詳細については<a class="xref" href="sql-createtable.html" title="CREATE TABLE"><span class="refentrytitle">CREATE TABLE</span></a>を参照してください。
     </p></dd><dt><span class="term"><code class="literal">UNLOGGED</code></span></dt><dd><p>指定された場合、テーブルはログを取らないテーブルとして作成されます。
詳細については<a class="xref" href="sql-createtable.html" title="CREATE TABLE"><span class="refentrytitle">CREATE TABLE</span></a>を参照してください。
     </p></dd><dt><span class="term"><code class="literal">IF NOT EXISTS</code></span></dt><dd><p>同じ名前のリレーションが既に存在する場合にエラーとしません。
この場合、注意が発行されます。
詳しくは<a class="xref" href="sql-createtable.html" title="CREATE TABLE"><span class="refentrytitle">CREATE TABLE</span></a>を参照してください。
     </p></dd><dt><span class="term"><em class="replaceable"><code>table_name</code></em></span></dt><dd><p>作成するテーブルの名前です（スキーマ修飾名も可）。
     </p></dd><dt><span class="term"><em class="replaceable"><code>column_name</code></em></span></dt><dd><p>新しいテーブルにおける列の名前です。
列名を指定しない場合は、問い合わせの出力列名を利用します。
     </p></dd><dt><span class="term"><code class="literal">WITH ( <em class="replaceable"><code>storage_parameter</code></em> [= <em class="replaceable"><code>value</code></em>] [, ... ] )</code></span></dt><dd><p>この句は、新しいテーブル用の格納パラメータ(省略可能)を指定します。
詳細は<a class="xref" href="sql-createtable.html#SQL-CREATETABLE-STORAGE-PARAMETERS" title="格納パラメータ">格納パラメータ</a>を参照してください。
<code class="literal">WITH</code>には、<code class="literal">OIDS=TRUE</code>（もしくは単なる<code class="literal">OIDS</code>）を含めて、新しいテーブルの行が行に割り当てられたOID（オブジェクト識別子）を持たなければならないことを指定することもできます。
また、<code class="literal">OIDS=FALSE</code>を含めて、OIDを持たないことを指定することもできます。
詳細は<a class="xref" href="sql-createtable.html" title="CREATE TABLE"><span class="refentrytitle">CREATE TABLE</span></a>を参照してください。
     </p></dd><dt><span class="term"><code class="literal">WITH OIDS</code><br /></span><span class="term"><code class="literal">WITHOUT OIDS</code></span></dt><dd><p>これらは古い構文で、それぞれ<code class="literal">WITH (OIDS)</code>と<code class="literal">WITH (OIDS=FALSE)</code>と同じです。
<code class="literal">OIDS</code>と格納パラメータの設定の両方を指定したい場合、上記の<code class="literal">WITH ( ... )</code>構文を使用しなければなりません。
     </p></dd><dt><span class="term"><code class="literal">ON COMMIT</code></span></dt><dd><p>トランザクションブロックの終了時の一時テーブルの動作を<code class="literal">ON COMMIT</code>を使用して制御することができます。
以下の3つのオプションがあります。

      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">PRESERVE ROWS</code></span></dt><dd><p>トランザクションの終了時に特別な処理は何も行われません。
これがデフォルトの動作です。
         </p></dd><dt><span class="term"><code class="literal">DELETE ROWS</code></span></dt><dd><p>各トランザクションブロックの終了時に、一時テーブルのすべての行が削除されます。
本質的には、コミット毎に自動的に<a class="xref" href="sql-truncate.html" title="TRUNCATE"><span class="refentrytitle">TRUNCATE</span></a>が行われます。
         </p></dd><dt><span class="term"><code class="literal">DROP</code></span></dt><dd><p>現在のトランザクションブロックの終了時に一時テーブルは削除されます。
         </p></dd></dl></div></dd><dt><span class="term"><code class="literal">TABLESPACE <em class="replaceable"><code>tablespace_name</code></em></code></span></dt><dd><p><em class="replaceable"><code>tablespace_name</code></em>は、新しいテーブルの作成先となるテーブル空間名です。
指定がなければ、<a class="xref" href="runtime-config-client.html#GUC-DEFAULT-TABLESPACE">default_tablespace</a>、一時テーブルの場合は<a class="xref" href="runtime-config-client.html#GUC-TEMP-TABLESPACES">temp_tablespaces</a>が考慮されます。
     </p></dd><dt><span class="term"><em class="replaceable"><code>query</code></em></span></dt><dd><p><a class="xref" href="sql-select.html" title="SELECT"><span class="refentrytitle">SELECT</span></a>、<a class="link" href="sql-select.html#SQL-TABLE" title="TABLEコマンド">TABLE</a>、<a class="xref" href="sql-values.html" title="VALUES"><span class="refentrytitle">VALUES</span></a>コマンドまたは、あらかじめ準備された<code class="command">SELECT</code>、<code class="command">TABLE</code>または<code class="command">VALUES</code>問い合わせを実行する<a class="xref" href="sql-execute.html" title="EXECUTE"><span class="refentrytitle">EXECUTE</span></a>コマンドです。
     </p></dd><dt><span class="term"><code class="literal">WITH [ NO ] DATA</code></span></dt><dd><p>この句は問い合わせで生成されるデータを新しいテーブルにコピーすべきかどうかを指定します。
コピーしない場合はテーブル構造のみがコピーされます。
デフォルトではデータをコピーします。
     </p></dd></dl></div></div><div class="refsect1" id="id-1.9.3.82.7"><h2>注釈</h2><p>このコマンドは、<a class="xref" href="sql-selectinto.html" title="SELECT INTO"><span class="refentrytitle">SELECT INTO</span></a>と同等の機能を持ちますが、<code class="command">SELECT INTO</code>構文の他の使用方法と混乱する可能性が少ないため、こちらを使用する方が良いでしょう。
さらに、<code class="command">CREATE TABLE AS</code>は、<code class="command">SELECT INTO</code>が提供する機能のスーパーセットを提供します。
  </p><p><code class="command">CREATE TABLE AS</code>コマンドでは、OIDを含めるかどうかを明示的に指定できます。
OIDの有無を明示していない場合、設定変数<a class="xref" href="runtime-config-compatible.html#GUC-DEFAULT-WITH-OIDS">default_with_oids</a>が使用されます。
  </p></div><div class="refsect1" id="id-1.9.3.82.8"><h2>例</h2><p><code class="literal">films</code>の最近の項目のみから構成される、新しいテーブル<code class="literal">films_recent</code>を作成します。

</p><pre class="programlisting">CREATE TABLE films_recent AS
  SELECT * FROM films WHERE date_prod &gt;= '2002-01-01';</pre><p>
  </p><p>テーブルを完全に複製するために、<code class="literal">TABLE</code>コマンドを使った短縮形も使用することができます。

</p><pre class="programlisting">CREATE TABLE films2 AS
  TABLE films;</pre><p>
  </p><p>プリペアド文を使用して、<code class="literal">films</code>内の最近の項目のみから構成される一時テーブル<code class="literal">films_recent</code>を作成します。
この新しいテーブルはOIDを持ち、コミット時に削除されます。

</p><pre class="programlisting">PREPARE recentfilms(date) AS
  SELECT * FROM films WHERE date_prod &gt; $1;
CREATE TEMP TABLE films_recent WITH (OIDS) ON COMMIT DROP AS
  EXECUTE recentfilms('2002-01-01');</pre></div><div class="refsect1" id="id-1.9.3.82.9"><h2>互換性</h2><p><code class="command">CREATE TABLE AS</code>は標準<acronym class="acronym">SQL</acronym>に従います。
以下は非標準の拡張です。

   </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p>標準では副問い合わせ句を括弧で囲む必要がありますが、<span class="productname">PostgreSQL</span>ではこの括弧は省略可能です。
     </p></li><li class="listitem"><p>標準では<code class="literal">WITH [ NO ] DATA</code>句は必須ですが、PostgreSQLでは省略可能です。
     </p></li><li class="listitem"><p><span class="productname">PostgreSQL</span>の一時テーブルの扱いは標準とは異なります。
詳細は<a class="xref" href="sql-createtable.html" title="CREATE TABLE"><span class="refentrytitle">CREATE TABLE</span></a>を参照してください。
     </p></li><li class="listitem"><p><code class="literal">WITH</code>句は<span class="productname">PostgreSQL</span>の拡張です。
格納パラメータもOIDも標準にはありません。
     </p></li><li class="listitem"><p><span class="productname">PostgreSQL</span>のテーブル空間という概念は標準にはありません。
したがって、<code class="literal">TABLESPACE</code>句は拡張です。
     </p></li></ul></div></div><div class="refsect1" id="id-1.9.3.82.10"><h2>関連項目</h2><span class="simplelist"><a class="xref" href="sql-creatematerializedview.html" title="CREATE MATERIALIZED VIEW"><span class="refentrytitle">CREATE MATERIALIZED VIEW</span></a>, <a class="xref" href="sql-createtable.html" title="CREATE TABLE"><span class="refentrytitle">CREATE TABLE</span></a>, <a class="xref" href="sql-execute.html" title="EXECUTE"><span class="refentrytitle">EXECUTE</span></a>, <a class="xref" href="sql-select.html" title="SELECT"><span class="refentrytitle">SELECT</span></a>, <a class="xref" href="sql-selectinto.html" title="SELECT INTO"><span class="refentrytitle">SELECT INTO</span></a>, <a class="xref" href="sql-values.html" title="VALUES"><span class="refentrytitle">VALUES</span></a></span></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="sql-createtable.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="sql-commands.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="sql-createtablespace.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">CREATE TABLE </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> CREATE TABLESPACE</td></tr></table></div></body></html>