<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>54.2. プログラマへ</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="nls-translator.html" title="54.1. 翻訳者へ" /><link rel="next" href="plhandler.html" title="Chapter 55. 手続き言語ハンドラの作成" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">54.2. プログラマへ</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="nls-translator.html" title="54.1. 翻訳者へ">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="nls.html" title="Chapter 54. 多言語サポート">Up</a></td><th width="60%" align="center">Chapter 54. 多言語サポート</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="plhandler.html" title="Chapter 55. 手続き言語ハンドラの作成">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="NLS-PROGRAMMER"><div class="titlepage"><div><div><h2 class="title" style="clear: both">54.2. プログラマへ</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="nls-programmer.html#NLS-MECHANICS">54.2.1. 仕組み</a></span></dt><dt><span class="sect2"><a href="nls-programmer.html#NLS-GUIDELINES">54.2.2. メッセージ記述の指針</a></span></dt></dl></div><div class="sect2" id="NLS-MECHANICS"><div class="titlepage"><div><div><h3 class="title">54.2.1. 仕組み</h3></div></div></div><p>本節では、<span class="productname">PostgreSQL</span>配布物の一部であるプログラムやライブラリにおける各国語サポートの実装方法を説明します。
現在はCプログラムにのみ適用できます。
  </p><div class="procedure" id="id-1.10.7.3.2.3"><p class="title"><strong>プログラムにNLSサポートを追加する</strong></p><ol class="procedure" type="1"><li class="step"><p>プログラムの起動処理に以下のコードを追加してください。
</p><pre class="programlisting">#ifdef ENABLE_NLS
#include &lt;locale.h&gt;
#endif

...

#ifdef ENABLE_NLS
setlocale(LC_ALL, "");
bindtextdomain("<em class="replaceable"><code>progname</code></em>", LOCALEDIR);
textdomain("<em class="replaceable"><code>progname</code></em>");
#endif</pre><p>
（<em class="replaceable"><code>progname</code></em>は実際には自由に選択できます。）
    </p></li><li class="step"><p>どこであろうと翻訳の候補となるメッセージが見つかったら、<code class="function">gettext()</code>の呼び出しが追加される必要があります。
例えば、
</p><pre class="programlisting">fprintf(stderr, "panic level %d\n", lvl);</pre><p>
は、次のように変更されます。
</p><pre class="programlisting">fprintf(stderr, gettext("panic level %d\n"), lvl);</pre><p>
（NLSサポートが組み込まれていない場合、<code class="symbol">gettext</code>はノーオペレーション命令として定義されます。）
    </p><p>これは混乱しがちになります。一般的なショートカットは以下のものです。
</p><pre class="programlisting">#define _(x) gettext(x)</pre><p>
他の解決方法は、バックエンドにおける<code class="function">ereport()</code>のように、そのプログラムが通信のほとんどを1つまたは数個の関数で行っている場合有効です。
その場合、この関数の内部で全ての入力文字列に対し<code class="function">gettext</code>を呼び出すようにすることになります。
    </p></li><li class="step"><p>プログラムのソースのあるディレクトリに<code class="filename">nls.mk</code>を追加してください。
これはmakefileとして読まれます。
以下の変数への代入をここで設定する必要があります。

     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="varname">CATALOG_NAME</code></span></dt><dd><p><code class="function">textdomain()</code>の呼び出しに使用されるプログラム名です。
        </p></dd><dt><span class="term"><code class="varname">AVAIL_LANGUAGES</code></span></dt><dd><p>用意された翻訳のリストです。初めは空です。
        </p></dd><dt><span class="term"><code class="varname">GETTEXT_FILES</code></span></dt><dd><p>翻訳可能文字列を含むファイルの一覧です。
つまり、これらは<code class="function">gettext</code>もしくは他の解決法として印が付けられます。
結局、これはプログラムのほとんど全てのソースファイルを含むことになります。
この一覧があまりに長くなる場合、最初の<span class="quote">“<span class="quote">file</span>”</span>を<code class="literal">+</code>とし、2番目の単語を1行に対して1つのファイル名を持ったファイルとすることができます。
        </p></dd><dt><span class="term"><code class="varname">GETTEXT_TRIGGERS</code></span></dt><dd><p>翻訳者が作業を行う上で、どの関数呼び出しが翻訳可能文字列を含むかを知る必要に迫られた場合に、メッセージカタログを生成するツールです。
デフォルトでは、<code class="function">gettext()</code>呼び出しのみを認識します。
<code class="function">_</code>や他の識別子を使用した場合、ここに記載しなければなりません。
翻訳可能文字列がその最初の引数ではない場合、その項目は（例えば2番目の引数の場合）<code class="literal">func:2</code>という形式でなければなりません。
複数形メッセージをサポートする関数がある場合、その項目は（単一形および複数形メッセージ引数を特定する）<code class="literal">func:1,2</code>のようになります。
        </p></dd></dl></div><p>
    </p></li></ol></div><p>ビルドシステムは、自動的にメッセージカタログの構築およびインストールを行います。
  </p></div><div class="sect2" id="NLS-GUIDELINES"><div class="titlepage"><div><div><h3 class="title">54.2.2. メッセージ記述の指針</h3></div></div></div><p>メッセージの翻訳を簡単にするために以下に指針をいくつか示します。

   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>以下のように実行時に文章を構築することはしないでください。
</p><pre class="programlisting">printf("Files were %s.\n", flag ? "copied" : "removed");</pre><p>
文章内の単語の順番は言語によって異なる可能性があります。
さらに全ての断章に対して<code class="function">gettext()</code>を呼び出すことを覚えていたとしても、断章が個別に的確に翻訳されるわけではありません。
それぞれのメッセージが全て調和して翻訳されるかどうか、ちょっとしたコードの複製を用意するとよいかもしません。
番号、ファイル名、および実行時変数のみメッセージテキストに実行時に挿入するべきです。
     </p></li><li class="listitem"><p>同様の理由で、以下も上手くいきません。
</p><pre class="programlisting">printf("copied %d file%s", n, n!=1 ? "s" : "");</pre><p>
これは複数形がどのように形成されるかを決めてかかっているからです。
もし、以下のようにして回避できたと考えると、
</p><pre class="programlisting">if (n==1)
    printf("copied 1 file");
else
    printf("copied %d files", n):</pre><p>
失望することになります。
言語の中には、独特の規則によって2つ以上の形式になるものもあります。
問題全体を回避するためこのメッセージを設計することが最善です。たとえば以下のようにします。
</p><pre class="programlisting">printf("number of copied files: %d", n);</pre><p>
     </p><p>適切に複数形を持つメッセージを構築したいと本当に思うのなら、これに対するサポートがありますが、多少厄介です。
<code class="function">ereport()</code>内の主たる、または詳細なエラーメッセージを生成する場合、以下のように書くことができます。
</p><pre class="programlisting">errmsg_plural("copied %d file",
              "copied %d files",
              n,
              n)</pre><p>
最初の引数は英文の単数形に適切な書式文字列で、二番目は英文の複数形に適切な書式文字列、そして三番目はどの複数形を使用するのかを決定する整数制御値です。引き続く引数はいつものように書式文字列毎に書式化されます。（通常、複数化制御値は書式化されるべき値の内の１つです。）英語では<em class="replaceable"><code>n</code></em>が１であるか、そうでないかのみ重要ですが、他の言語では数多くの複数書式が存在します。
翻訳者にはグループとして２つの英文書式を参照し、<em class="replaceable"><code>n</code></em>の実行時の値に基づいて選択される適切な１つでもって、複数の代替文字列を供給する機会があります。
     </p><p><code class="function">errmsg</code>あるいは<code class="function">errdetail</code>報告に直接行かない複数形メッセージが必要であれば、基礎となっている関数、<code class="function">ngettext</code>を使用する必要があります。
gettextのドキュメントを参照してください。
     </p></li><li class="listitem"><p>メッセージをどのように他の出力と合わせる予定なのかなど翻訳者と何か連絡を取り合いたい場合、<code class="literal">translator</code>で始まるコメントを最初に付けてどうなるかを知らせてください。
以下のようにします。
</p><pre class="programlisting">/* translator: This message is not what it seems to be. */</pre><p>
これらのコメントはメッセージカタログにコピーされますので翻訳者は参照できます。
     </p></li></ul></div><p>
  </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="nls-translator.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="nls.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="plhandler.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">54.1. 翻訳者へ </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 55. 手続き言語ハンドラの作成</td></tr></table></div></body></html>