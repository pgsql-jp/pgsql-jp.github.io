<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>CREATE OPERATOR CLASS</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="sql-createoperator.html" title="CREATE OPERATOR" /><link rel="next" href="sql-createopfamily.html" title="CREATE OPERATOR FAMILY" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">CREATE OPERATOR CLASS</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="sql-createoperator.html" title="CREATE OPERATOR">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="sql-commands.html" title="SQLコマンド">Up</a></td><th width="60%" align="center">SQLコマンド</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="sql-createopfamily.html" title="CREATE OPERATOR FAMILY">Next</a></td></tr></table><hr></hr></div><div class="refentry" id="SQL-CREATEOPCLASS"><div class="titlepage"></div><a id="id-1.9.3.70.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle">CREATE OPERATOR CLASS</span></h2><p>CREATE OPERATOR CLASS —    新しい演算子クラスを定義する
  </p></div><div class="refsynopsisdiv"><h2>Synopsis</h2><pre class="synopsis">CREATE OPERATOR CLASS <em class="replaceable"><code>name</code></em> [ DEFAULT ] FOR TYPE <em class="replaceable"><code>data_type</code></em>
  USING <em class="replaceable"><code>index_method</code></em> [ FAMILY <em class="replaceable"><code>family_name</code></em> ] AS
  {  OPERATOR <em class="replaceable"><code>strategy_number</code></em> <em class="replaceable"><code>operator_name</code></em> [ ( <em class="replaceable"><code>op_type</code></em>, <em class="replaceable"><code>op_type</code></em> ) ] [ FOR SEARCH | FOR ORDER BY <em class="replaceable"><code>sort_family_name</code></em> ]
   | FUNCTION <em class="replaceable"><code>support_number</code></em> [ ( <em class="replaceable"><code>op_type</code></em> [ , <em class="replaceable"><code>op_type</code></em> ] ) ] <em class="replaceable"><code>function_name</code></em> ( <em class="replaceable"><code>argument_type</code></em> [, ...] )
   | STORAGE <em class="replaceable"><code>storage_type</code></em>
  } [, ... ]</pre></div><div class="refsect1" id="id-1.9.3.70.5"><h2>説明</h2><p><code class="command">CREATE OPERATOR CLASS</code>は新しい演算子クラスを作成します。
演算子クラスは、特定のデータ型がインデックスでどのように使用されるかを定義します。
演算子クラスにより、データ型およびインデックスメソッドの特定の役割もしくは<span class="quote">“<span class="quote">戦略</span>”</span>に、どの演算子を使用するかが指定されます。
また、インデックスの列に対して演算子クラスが選択される際、演算子クラスによってインデックスメソッドが使用するサポートプロシージャが指定されます。
演算子クラスで使用される全ての演算子および関数は、演算子クラスを作成できるようになる前に定義しておく必要があります。

  </p><p>スキーマ名が与えられている場合、その演算子クラスは指定されたスキーマに作成されます。
スキーマ名がなければ、演算子クラスは現在のスキーマに作成されます。
異なるインデックスメソッドに使用する場合のみ、同じスキーマ内の2つの演算子クラスに同じ名前を付けることができます。
  </p><p>演算子クラスは、それを定義したユーザが所有者となります。
現在、演算子クラスを作成するには、スーパーユーザである必要があります。
（誤った演算子クラスを定義すると、サーバを混乱させ、サーバクラッシュの原因とさえなり得るため、この制限が付けられています）。
  </p><p>現在、<code class="command">CREATE OPERATOR CLASS</code>では、インデックスメソッドに必要な全ての演算子および関数が演算子クラス定義に含まれているかどうか、また、演算子や関数の形式がそれ自身で整合性を持っているかを検査しません。
ユーザの責任において、有効な演算子クラスを定義してください。
  </p><p>関連する演算子クラスを<em class="firstterm">演算子族</em>にまとめることができます。
既存の演算子族に新しい演算子クラスを追加するためには、<code class="command">CREATE OPERATOR CLASS</code>で<code class="literal">FAMILY</code>オプションを指定してください。
このオプションを指定しないと、新しい演算子クラスはそのクラスと同じ名前の演算子族内に置かれます（この演算子族が存在しない場合は作成します）。
  </p><p>詳細については<a class="xref" href="xindex.html" title="37.14. インデックス拡張機能へのインタフェース">Section 37.14</a>を参照してください。
  </p></div><div class="refsect1" id="id-1.9.3.70.6"><h2>パラメータ</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="replaceable"><code>name</code></em></span></dt><dd><p>作成する演算子クラスの名前です。
演算子クラス名は、スキーマ修飾することができます。
     </p></dd><dt><span class="term"><code class="literal">DEFAULT</code></span></dt><dd><p><code class="literal">DEFAULT</code>を付けると、その演算子クラスが、そのデータ型のデフォルトの演算子クラスになります。
特定のデータ型およびインデックスメソッドのデフォルトにできる演算子クラスは最大1つまでです。
     </p></dd><dt><span class="term"><em class="replaceable"><code>data_type</code></em></span></dt><dd><p>この演算子クラスを使用する列のデータ型です。
     </p></dd><dt><span class="term"><em class="replaceable"><code>index_method</code></em></span></dt><dd><p>この演算子クラスを使用するインデックスメソッドの名前です。
     </p></dd><dt><span class="term"><em class="replaceable"><code>family_name</code></em></span></dt><dd><p>この演算子クラスの追加先となる既存の演算子族の名前です。
指定されない場合、演算子クラスと同じ名前の演算子族が使用されます（演算子族が存在しない場合は作成します）。
     </p></dd><dt><span class="term"><em class="replaceable"><code>strategy_number</code></em></span></dt><dd><p>演算子クラスに関連する演算子のインデックスメソッドの戦略番号です。
     </p></dd><dt><span class="term"><em class="replaceable"><code>operator_name</code></em></span></dt><dd><p>演算子クラスに関連する演算子の名前です（スキーマ修飾名でも可）。
     </p></dd><dt><span class="term"><em class="replaceable"><code>op_type</code></em></span></dt><dd><p><code class="literal">OPERATOR</code>句では、演算子の入力データ型、もしくは、左単項演算子か右単項演算子を表す<code class="literal">NONE</code>を指定します。
演算子クラスのデータ型と同じである通常の場合、入力データ型は省略可能です。
     </p><p><code class="literal">FUNCTION</code>句では、関数の入力データ型（B-Tree比較関数およびハッシュ関数用）またはクラスのデータ型（B-treeソートサポート関数とGiST、SP-GiST、GIN、BRIN演算子クラスのすべての関数用）と異なる場合、関数がサポートする予定の演算対象データ型です。
これらのデフォルトは常に正確です。
このため、しかしデータ型を跨がる比較をサポートする予定のB-treeソートサポート関数は除き、<code class="literal">FUNCTION</code>句で<em class="replaceable"><code>op_type</code></em>を指定する必要はありません。
     </p></dd><dt><span class="term"><em class="replaceable"><code>sort_family_name</code></em></span></dt><dd><p>順序付け演算子に関連したソート順序を記述する、既存の<code class="literal">btree</code>演算子族の名前（スキーマ修飾可）です。
     </p><p><code class="literal">FOR SEARCH</code>も<code class="literal">FOR ORDER BY</code>も指定されていない場合、<code class="literal">FOR SEARCH</code>がデフォルトです。
     </p></dd><dt><span class="term"><em class="replaceable"><code>support_number</code></em></span></dt><dd><p>演算子クラスに関連する関数用のインデックスメソッドのサポートプロシージャの番号です。
     </p></dd><dt><span class="term"><em class="replaceable"><code>function_name</code></em></span></dt><dd><p>演算子クラス用のインデックスメソッドのサポートプロシージャとなる関数の名前です（スキーマ修飾名でも可）。
     </p></dd><dt><span class="term"><em class="replaceable"><code>argument_type</code></em></span></dt><dd><p>関数のパラメータのデータ型です。
     </p></dd><dt><span class="term"><em class="replaceable"><code>storage_type</code></em></span></dt><dd><p>インデックスに実際に格納されるデータ型です。
通常、このデータ型は列のデータ型と同じです。
しかし、異なるデータ型を許可するインデックスメソッドも存在します（現時点ではGiST、GIN、BRIN）。
インデックスメソッドが異なるデータ型の使用を許可していなければ、<code class="literal">STORAGE</code>句を指定してはいけません。
列<em class="replaceable"><code>data_type</code></em>が<code class="type">anyarray</code>として指定された場合、<em class="replaceable"><code>storage_type</code></em>を<code class="type">anyelement</code>として宣言し、インデックスのエントリが各インデックスが作成される実際の配列型に属する要素型のメンバーであることを示すことができます。
     </p></dd></dl></div><p><code class="literal">OPERATOR</code>、<code class="literal">FUNCTION</code>、<code class="literal">STORAGE</code>は任意の順番で記述できます。
  </p></div><div class="refsect1" id="id-1.9.3.70.7"><h2>注釈</h2><p>インデックス機構は、使用する前に関数に関するアクセス権限を検査しませんので、
関数や演算子を演算子クラスに含めることは、PUBLICに実行権限を与えることと同じです。
通常、演算子クラスで有用な種類の関数ではこれは問題になりません。
  </p><p>演算子はSQL関数で定義してはなりません。
SQL関数は呼び出し元の問い合わせにインライン化されることが多いので、オプティマイザでその問い合わせがインデックスに一致するかどうかを認識できなくなってしまうからです。
  </p><p><span class="productname">PostgreSQL</span> 8.4より前までは、<code class="literal">OPERATOR</code>句に<code class="literal">RECHECK</code>オプションを含めることができました。
インデックス演算子に<span class="quote">“<span class="quote">損失がある</span>”</span>かどうかは実行時にその場で決定されるようになりましたので、これはサポートされなくなりました。
これにより、演算子に損失があるかもしれないしないかもしれないような場合を効率的に扱うことができるようになりました。
  </p></div><div class="refsect1" id="id-1.9.3.70.8"><h2>例</h2><p>以下のコマンド例では、<code class="literal">_int4</code>データ型（<code class="type">int4</code>の配列）のGiSTインデックス演算子クラスを定義しています。
この例の詳細については、<a class="xref" href="intarray.html" title="F.19. intarray">intarray</a>モジュールを参照してください。
  </p><pre class="programlisting">CREATE OPERATOR CLASS gist__int_ops
    DEFAULT FOR TYPE _int4 USING gist AS
        OPERATOR        3       &amp;&amp;,
        OPERATOR        6       = (anyarray, anyarray),
        OPERATOR        7       @&gt;,
        OPERATOR        8       &lt;@,
        OPERATOR        20      @@ (_int4, query_int),
        FUNCTION        1       g_int_consistent (internal, _int4, smallint, oid, internal),
        FUNCTION        2       g_int_union (internal, internal),
        FUNCTION        3       g_int_compress (internal),
        FUNCTION        4       g_int_decompress (internal),
        FUNCTION        5       g_int_penalty (internal, internal, internal),
        FUNCTION        6       g_int_picksplit (internal, internal),
        FUNCTION        7       g_int_same (_int4, _int4, internal);</pre></div><div class="refsect1" id="id-1.9.3.70.9"><h2>互換性
  </h2><p><code class="command">CREATE OPERATOR CLASS</code>は<span class="productname">PostgreSQL</span>の拡張です。
標準SQLには<code class="command">CREATE OPERATOR CLASS</code>文はありません。
  </p></div><div class="refsect1" id="id-1.9.3.70.10"><h2>関連項目</h2><span class="simplelist"><a class="xref" href="sql-alteropclass.html" title="ALTER OPERATOR CLASS"><span class="refentrytitle">ALTER OPERATOR CLASS</span></a>, <a class="xref" href="sql-dropopclass.html" title="DROP OPERATOR CLASS"><span class="refentrytitle">DROP OPERATOR CLASS</span></a>, <a class="xref" href="sql-createopfamily.html" title="CREATE OPERATOR FAMILY"><span class="refentrytitle">CREATE OPERATOR FAMILY</span></a>, <a class="xref" href="sql-alteropfamily.html" title="ALTER OPERATOR FAMILY"><span class="refentrytitle">ALTER OPERATOR FAMILY</span></a></span></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="sql-createoperator.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="sql-commands.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="sql-createopfamily.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">CREATE OPERATOR </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> CREATE OPERATOR FAMILY</td></tr></table></div></body></html>