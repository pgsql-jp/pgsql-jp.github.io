<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>52.9. 論理レプリケーションのメッセージ書式</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="protocol-error-fields.html" title="52.8. エラーおよび警報メッセージフィールド" /><link rel="next" href="protocol-changes.html" title="52.10. プロトコル2.0からの変更点の要約" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">52.9. 論理レプリケーションのメッセージ書式</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="protocol-error-fields.html" title="52.8. エラーおよび警報メッセージフィールド">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="protocol.html" title="Chapter 52. フロントエンド/バックエンドプロトコル">Up</a></td><th width="60%" align="center">Chapter 52. フロントエンド/バックエンドプロトコル</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="protocol-changes.html" title="52.10. プロトコル2.0からの変更点の要約">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="PROTOCOL-LOGICALREP-MESSAGE-FORMATS"><div class="titlepage"><div><div><h2 class="title" style="clear: both">52.9. 論理レプリケーションのメッセージ書式</h2></div></div></div><p>本節では論理レプリケーションの各メッセージの書式の詳細について説明します。
これらのメッセージはレプリケーションスロットのSQLインタフェースから返されるか、あるいはwalsenderから送信されるかのいずれかです。
walsenderの場合は、<a class="xref" href="protocol-replication.html" title="52.4. ストリーミングレプリケーションプロトコル">Section 52.4</a>で説明されているようにレプリケーションプロトコルのWALメッセージ内でカプセル化され、通常は物理レプリケーションと同じメッセージフローに従います。</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Begin</span></dt><dd><p>
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">        Byte1('B')</span></dt><dd><p>メッセージが開始メッセージであることを識別します。</p></dd><dt><span class="term">        Int64</span></dt><dd><p>トランザクションの最後のLSNです。</p></dd><dt><span class="term">        Int64</span></dt><dd><p>トランザクションのコミット時刻です。
その値はPostgreSQLのエポック（2000-01-01）からのマイクロ秒数です。</p></dd><dt><span class="term">        Int32</span></dt><dd><p>トランザクションのXIDです。</p></dd></dl></div></dd><dt><span class="term">Commit</span></dt><dd><p>
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">        Byte1('C')</span></dt><dd><p>メッセージがCommitメッセージであることを識別します。</p></dd><dt><span class="term">        Int8</span></dt><dd><p>フラグですが現在は未使用です（0でなければなりません）。</p></dd><dt><span class="term">        Int64</span></dt><dd><p>コミットのLSNです。</p></dd><dt><span class="term">        Int64</span></dt><dd><p>トランザクションの終了LSNです。</p></dd><dt><span class="term">        Int64</span></dt><dd><p>トランザクションのコミット時刻です。
その値はPostgreSQLのエポック（2000-01-01）からのマイクロ秒数です。</p></dd></dl></div></dd><dt><span class="term">Origin</span></dt><dd><p>
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">        Byte1('O')</span></dt><dd><p>メッセージがOriginメッセージであることを識別します。</p></dd><dt><span class="term">        Int64</span></dt><dd><p>Originサーバ上のコミットのLSNです。</p></dd><dt><span class="term">        String</span></dt><dd><p>Originの名前です。</p></dd></dl></div><p>一つのトランザクション内で複数のOriginメッセージがあり得ることに注意してください。</p></dd><dt><span class="term">Relation</span></dt><dd><p>
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">        Byte1('R')</span></dt><dd><p>メッセージがRelationメッセージであることを識別します。</p></dd><dt><span class="term">        Int32</span></dt><dd><p>リレーションのIDです。</p></dd><dt><span class="term">        String</span></dt><dd><p>名前空間（<code class="literal">pg_catalog</code>の場合は空文字列）。</p></dd><dt><span class="term">        String</span></dt><dd><p>リレーション名。</p></dd><dt><span class="term">        Int8</span></dt><dd><p>リレーションのレプリカ識別子の設定（<code class="structname">pg_class</code>の<code class="structfield">relreplident</code>と同じ）。</p></dd><dt><span class="term">        Int16</span></dt><dd><p>列数。</p></dd></dl></div><p>
次に、各列について以下のメッセージ部分があります。
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">        Int8</span></dt><dd><p>列のフラグ。
現在は、フラグがないことを示す0か、列がキーの一部であることを示す1のいずれかにできます。</p></dd><dt><span class="term">        String</span></dt><dd><p>列名。</p></dd><dt><span class="term">        Int32</span></dt><dd><p>列のデータ型のID。</p></dd><dt><span class="term">        Int32</span></dt><dd><p>列の型修飾子（<code class="structfield">atttypmod</code>）。</p></dd></dl></div></dd><dt><span class="term">Type</span></dt><dd><p>
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">        Byte1('Y')</span></dt><dd><p>メッセージがTypeメッセージであることを識別します。</p></dd><dt><span class="term">        Int32</span></dt><dd><p>データ型のID。</p></dd><dt><span class="term">        String</span></dt><dd><p>名前空間（<code class="literal">pg_catalog</code>の場合は空文字列）。</p></dd><dt><span class="term">        String</span></dt><dd><p>データ型の名前。</p></dd></dl></div></dd><dt><span class="term">Insert</span></dt><dd><p>
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">        Byte1('I')</span></dt><dd><p>メッセージがInsertメッセージであることを識別します。</p></dd><dt><span class="term">        Int32</span></dt><dd><p>Relationメッセージ中のIDに対応するリレーションのID。</p></dd><dt><span class="term">        Byte1('N')</span></dt><dd><p>以下のTupleDataメッセージが新しいタプルであることを識別します。</p></dd><dt><span class="term">        TupleData</span></dt><dd><p>新しいタプルの内容を表すTupleDataメッセージ部分です。</p></dd></dl></div></dd><dt><span class="term">Update</span></dt><dd><p>
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">        Byte1('U')</span></dt><dd><p>メッセージがUpdateメッセージであることを識別します。</p></dd><dt><span class="term">        Int32</span></dt><dd><p>Relationメッセージ中のIDに対応するリレーションのID。</p></dd><dt><span class="term">        Byte1('K')</span></dt><dd><p>これに続くTupleData副メッセージがキーであることを識別します。
このフィールドはオプションで、UPDATEがREPLICA IDENTITYインデックスの一部となっている列のどれかを変更したときにのみ存在します。</p></dd><dt><span class="term">        Byte1('O')</span></dt><dd><p>これに続くTupleData副メッセージが古いタプルであることを識別します。
このフィールドはオプションで、UPDATEが発生したテーブルでREPLICA IENTITYがFULLに設定されている場合にのみ存在します。</p></dd><dt><span class="term">        TupleData</span></dt><dd><p>古いタプルまたは主キーの内容を表すTupleDataメッセージ部分です。
この前に'O'または'K'の部分が存在するときにのみ存在します。</p></dd><dt><span class="term">        Byte1('N')</span></dt><dd><p>これに続くTupleDataメッセージが新しいタプルであることを識別します。</p></dd><dt><span class="term">        TupleData</span></dt><dd><p>新しいタプルの内容を表すTupleDataメッセージ部分です。</p></dd></dl></div><p>Updateメッセージは'K'メッセージ部分と'O'メッセージ部分のいずれかを含むか、どちらも含まないかであり、その両方を含むことはできません。</p></dd><dt><span class="term">Delete</span></dt><dd><p>
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">        Byte1('D')</span></dt><dd><p>メッセージがDeleteメッセージであることを識別します。</p></dd><dt><span class="term">        Int32</span></dt><dd><p>Relationメッセージ中のIDに対応するリレーションのID。</p></dd><dt><span class="term">        Byte1('K')</span></dt><dd><p>これに続くTupleData副メッセージがキーであることを識別します。
このフィールドはDELETEが発生したテーブルがインデックスをREPLICA IDENTITYとして使用している場合にのみ存在します。</p></dd><dt><span class="term">        Byte1('O')</span></dt><dd><p>これに続くTupleDataメッセージが古いタプルであることを識別します。
このフィールドはDELETEが発生したテーブルでREPLICA IDENTITYがFULLに設定されている場合にのみ存在します。</p></dd><dt><span class="term">        TupleData</span></dt><dd><p>直前のフィールドに従って、古いタプルまたは主キーの内容を表すTupleDataメッセージ部分です。</p></dd></dl></div><p>Deleteメッセージは'K'メッセージ部分と'O'メッセージ部分のいずれかを含みますが、両方を含むことはできません。</p></dd></dl></div><p>
以下のメッセージ部分は上記のメッセージに共通です。
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">TupleData</span></dt><dd><p>
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">        Int16</span></dt><dd><p>列数。</p></dd></dl></div><p>
次に各列を表す以下の副メッセージの一つがあります。
        Next, one of the following submessages appears for each column:
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">        Byte1('n')</span></dt><dd><p>データがNULL値であることを識別します。</p></dd></dl></div><p>
または、
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">        Byte1('u')</span></dt><dd><p>TOAST値が変更されないことを識別します（実際の値は送信されません）。</p></dd></dl></div><p>
または
</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">        Byte1('t')</span></dt><dd><p>データがテキスト形式の値であることを識別します。</p></dd><dt><span class="term">        Int32</span></dt><dd><p>列値の長さ。</p></dd><dt><span class="term">        Byte<em class="replaceable"><code>n</code></em></span></dt><dd><p>テキスト形式での列の値。
（将来のリリースでは他の形式もサポートするかもしれません。）
<em class="replaceable"><code>n</code></em>は上記の長さです。
</p></dd></dl></div></dd></dl></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="protocol-error-fields.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="protocol.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="protocol-changes.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">52.8. エラーおよび警報メッセージフィールド </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 52.10. プロトコル2.0からの変更点の要約</td></tr></table></div></body></html>