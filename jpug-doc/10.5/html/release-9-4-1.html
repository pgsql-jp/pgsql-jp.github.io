<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>E.51. リリース9.4.1</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="release-9-4-2.html" title="E.50. リリース9.4.2" /><link rel="next" href="release-9-4.html" title="E.52. リリース9.4" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">E.51. リリース9.4.1</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="release-9-4-2.html" title="E.50. リリース9.4.2">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="release.html" title="Appendix E. リリースノート">Up</a></td><th width="60%" align="center">Appendix E. リリースノート</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="release-9-4.html" title="E.52. リリース9.4">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="RELEASE-9-4-1"><div class="titlepage"><div><div><h2 class="title" style="clear: both">E.51. リリース9.4.1</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="release-9-4-1.html#id-1.11.6.55.4">E.51.1. バージョン9.4.1への移行</a></span></dt><dt><span class="sect2"><a href="release-9-4-1.html#id-1.11.6.55.5">E.51.2. 変更点</a></span></dt></dl></div><p><strong>リリース日: </strong>2015-02-05</p><p>このリリースは9.4.0に対し、各種不具合を修正したものです。
9.4メジャーリリースにおける新機能については、<a class="xref" href="release-9-4.html" title="E.52. リリース9.4">Section E.52</a>を参照してください。
  </p><div class="sect2" id="id-1.11.6.55.4"><div class="titlepage"><div><div><h3 class="title">E.51.1. バージョン9.4.1への移行</h3></div></div></div><p>9.4.Xからの移行ではダンプ/リストアは不要です。
   </p><p>しかしながら、あなたがWindowsユーザで<span class="quote">“<span class="quote">Norwegian (Bokmål)</span>”</span>ロケールを使っているのなら、アップグレード後に<span class="productname">PostgreSQL</span>システムカタログ内に格納された全ての<span class="quote">“<span class="quote">Norwegian (Bokmål)_Norway</span>”</span>または<span class="quote">“<span class="quote">norwegian-bokmal</span>”</span>ロケール名をASCIIによる別名<span class="quote">“<span class="quote">Norwegian_Norway</span>”</span>に置き換える手動操作が必要です。
詳細は<a class="ulink" href="http://wiki.postgresql.org/wiki/Changes_To_Norwegian_Locale" target="_top">http://wiki.postgresql.org/wiki/Changes_To_Norwegian_Locale</a>を参照してください。
   </p></div><div class="sect2" id="id-1.11.6.55.5"><div class="titlepage"><div><div><h3 class="title">E.51.2. 変更点</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="function">to_char()</code>のバッファオーバーランを修正しました。
(Bruce Momjian)
     </p><p><code class="function">to_char()</code>が大きな桁数をとる数値書式テンプレートを処理するとき、<span class="productname">PostgreSQL</span>がバッファ終端を超えて読み取ることがありえました。
また、巧妙に作りこまれたタイムスタンプ書式テンプレートに対して、<span class="productname">PostgreSQL</span>がバッファ終端を超えて書き込むことがありえました。
どちらの場合もサーバをクラッシュさせることができます。
可能性は低いと見られますが、権限昇格に至る攻撃ができる可能性も排除できません。
(CVE-2015-0241)
     </p></li><li class="listitem"><p><code class="function">*printf()</code>置換関数におけるバッファオーバランを修正しました。
(Tom Lane)
     </p><p><span class="productname">PostgreSQL</span>には<code class="function">printf</code>や関連する関数の置き換え実装が含まれています。
およそ500桁以上の精度で浮動小数点数を（変換指定子<code class="literal">e</code>、<code class="literal">E</code>、<code class="literal">f</code>、<code class="literal">F</code>、<code class="literal">g</code>、<code class="literal">G</code>で）整形するとき、これらのコードでスタックバッファオーバランが起きます。
これはサーバをクラッシュさせ、また、権限昇格に至る攻撃ができる可能性も排除できません。データベース利用者はSQL関数<code class="function">to_char()</code>を通してこのバッファオーバランを起こすことができます。
<span class="productname">PostgreSQL</span>コア機能に影響があるほか、printf族の関数を使用している拡張モジュールにも危険があると考えられます。
     </p><p>この問題は主にWindows上の<span class="productname">PostgreSQL</span>に影響があります。
<span class="productname">PostgreSQL</span>は、その他の現代的なプラットフォーム上では、これら関数のシステム実装を使います。
(CVE-2015-0242)
     </p></li><li class="listitem"><p><code class="filename">contrib/pgcrypto</code>でのバッファオーバランを修正しました。
(Marko Tiikkaja, Noah Misch)
     </p><p><code class="filename">pgcrypto</code>モジュールでのメモリサイズ追跡の誤りにより、
スタックバッファオーバランと未初期化メモリ内容への不適切な依存が起こりえました。
このバッファオーバランはサーバをクラッシュさせ、また、
権限昇格に至る攻撃ができる可能性も排除できません。
(CVE-2015-0243)
     </p></li><li class="listitem"><p>エラー後にフロントエンド/バックエンドプロトコルの同期が失われる可能性があり、
修正しました。
(Heikki Linnakangas)
     </p><p>サーバがクライアントからのメッセージを読んでいる途中に何らかエラーが起きた場合、同期が失われ、メッセージデータの一部分を新たなプロトコルメッセージと解釈しようと誤って試みられる可能性がありました。
攻撃者がコマンドパラメータ中に巧妙に作りこんだバイナリデータを送り出すことで、SQLコマンドを注入することができるかもしれません。
この筋書を引き起こす最もありそうなエラーは、ステートメントタイムアウトと問い合わせキャンセルです。
とりわけ脆弱なのは、タイムアウトを使っていて、任意のユーザ作成データをバイナリの問い合わせパラメータとして送れるアプリケーションです。
ステートメントタイムアウトを無効にすることで、脆弱性を悪用される危険性を無くせはしませんが軽減できます。
本問題を報告してくれた Emil Lenngren 氏に感謝します。(CVE-2015-0244)
     </p></li><li class="listitem"><p>制約違反エラーメッセージを通した情報漏洩を修正しました。
(Stephen Frost)
     </p><p>いくつかのサーバエラーメッセージは一意性制約などの制約に違反した列の値を表示します。ユーザがテーブルの全列に<code class="literal">SELECT</code>権限を持たないとすれば、このことは、見ることができてはいけない値が露出していることになります。
該当コードを修正し、値が表示されるのは SQLコマンドに由来する値であるか、ユーザで<code class="literal">SELECT</code>可能であるときだけにしました。
(CVE-2014-8161)
     </p></li><li class="listitem"><p>Windows上で回帰テストの一時インストールへの接続制限を厳重にしました。
(Noah Misch)
     </p><p>テスト一式を起動したOSユーザからのみ接続を許すようにSSPI認証を使うようにします。
これは、他のユーザがテスト用postmasterに接続できるという、他のプラットフォーム向けで以前封鎖したのと同様の脆弱性を、Windows上でも封鎖するものです。
(CVE-2014-0067)
     </p></li><li class="listitem"><p>Windowsの<span class="quote">“<span class="quote">Norwegian (Bokmål)</span>”</span>ロケールに対応しました。
(Heikki Linnakangas)
     </p><p>非ASCIIのロケール名は、どのエンコーディングで解釈すべきか明らかでないので問題があります。やっかいなロケール名にASCIIの別名<span class="quote">“<span class="quote">Norwegian_Norway</span>”</span>を割り当てました。
     </p><p>9.4.0では、これを<span class="quote">“<span class="quote">norwegian-bokmal</span>”</span>に割り当てていましたが、全てのWindows構成で動作するわけではないことがわかりました。
現在は代替に<span class="quote">“<span class="quote">Norwegian_Norway</span>”</span>が推奨されます。
     </p></li><li class="listitem"><p>EvalPlanQual処理で解放済みメモリを使用してしまう問題を修正しました。
(Tom Lane)
     </p><p><code class="literal">READ COMMITTED</code>モードで最近に更新した行をロックまたは更新すると、
本障害によりクラッシュする可能性がありました。
     </p></li><li class="listitem"><p>EvalPlanQual処理でタプルロック取得を試みる際にデッドロックに陥る可能性を回避しました。
(Álvaro Herrera, Mark Kirkwood)
     </p></li><li class="listitem"><p>複数の他トランザクションが同時に<code class="literal">FOR SHARE</code>タプルロックを保持している中で、トランザクションが<code class="literal">FOR NO KEY EXCLUSIVE</code>タプルロックの取得を試みて待つのに失敗してしまうのを、修正しました。
(Álvaro Herrera)
     </p></li><li class="listitem"><p>幅の大きいテーブルに対する<code class="command">EXPLAIN</code>の性能を改善しました。
(Tom Lane)
     </p></li><li class="listitem"><p><code class="type">jsonb</code>ユニコードエスケープ処理について修正し、結果として<code class="literal">\u0000</code>は使用不能になりました。
(Tom Lane)
     </p><p>これまでは、JSONユニコードエスケープ<code class="literal">\u0000</code>は受け入れられ、6文字データとして格納されました。
しかし、これは<code class="literal">\\u0000</code>の入力で格納されたものと区別がつかず、曖昧になっています。
さらに、<code class="literal">-&gt;&gt;</code>演算子など、エスケープ解除したテキスト出力が期待されるところで、エスケープシーケンスが<code class="literal">\u0000</code>と出力され、JSONエスケープが除去されるという予想に合いません
（バイト00を出力するのが一貫した振る舞いですが<span class="productname">PostgreSQL</span>はテキスト文字列中にバイト00を含めることをサポートしていません）。
9.4.0 ではJSON出力変換規則を修正してこの状況を改善しようという思慮に欠けた試みを入れました。
しかし、当然ながらこれは根本的な曖昧さを修正するものではなく、ユニコードエスケープシーケンスの他の使用方法の破壊を生じました。
これをもとに戻し、中心的問題を回避するため<code class="literal">\u0000</code>は<code class="type">jsonb</code>入力では受け付けないようにしました。
     </p><p><code class="type">jsonb</code>列に9.4.0で格納された<code class="literal">\u0000</code>値が含まれている場合、これからは、それは、本ケースで9.4.0により格納されたデータの他の有効な解釈である<code class="literal">\\u0000</code>であったものとして読み出されます。
     </p><p><code class="type">json</code>型は曖昧な格納の問題を持ちませんが、一貫性に欠けたエスケープ解除したテキスト出力の問題があります。
そのため今後は、エスケープ解除した形式への変換が必要なときには、<code class="literal">\u0000</code>は<code class="type">json</code>値の中でも受け付けられません。
この変更は、値に何ら処理を加えない限り、<code class="type">json</code>列に<code class="literal">\u0000</code>を格納できなくするものではありません。
これは、非ASCIIのユニコードエスケープをUTF8以外のデータベースに格納することが許されていることと、ちょうど類似しています。
     </p></li><li class="listitem"><p><code class="function">xpath()</code>の名前空間の扱いを修正しました。
(Ali Akbar)
     </p><p>これまで、入力<code class="type">xml</code>値で返される指定要素でなく先祖要素に名前空間宣言が付加されているとき、<code class="function">xpath()</code>呼び出しから返される<code class="type">xml</code>値は、名前空間宣言を持ちませんでした。
孤立と見なされるとき結果が正しいなら先祖の宣言を伝搬するようにしました。
     </p></li><li class="listitem"><p>範囲演算子の選択率見積についていくつか誤りを修正しました。
(Emre Hasegeli)
     </p><p>このパッチは稀なプランナエラー <span class="quote">“<span class="quote">unexpected operator NNNN</span>”</span>（予想外の演算子NNNN）を修正して、そのほかいくつかの選択率見積を改善します。
     </p></li><li class="listitem"><p>意図しないGINインデックス要素の最大サイズの縮小を元に戻しました。
(Heikki Linnakangas)
     </p><p>9.4.0は以前のバージョンでは受付されていたデータに対して、<span class="quote">“<span class="quote">index row size exceeds maximum</span>”</span>（インデックス行のサイズが最大値を超えています）というエラーで失敗することがありました。
     </p></li><li class="listitem"><p>GINインデックス再スキャンを繰り返すときの、問い合わせ中のメモリリークを修正しました。
(Heikki Linnakangas)
     </p></li><li class="listitem"><p>ゼロ以外の<code class="varname">gin_fuzzy_search_limit</code>を使うときクラッシュする可能性があり、修正しました。
(Heikki Linnakangas)
     </p></li><li class="listitem"><p>ロジカルデコーディングについて様々な修正をしました。
(Andres Freund)
     </p></li><li class="listitem"><p><code class="varname">wal_log_hints</code>の変更を伝えるパラメータ変更レコードの誤ったWAL再生を修正しました。
(Petr Jelinek)
     </p></li><li class="listitem"><p><span class="quote">“<span class="quote">pgstat wait timeout</span>”</span>というメッセージをWARNINGレベルからLOGレベルに変更して、文言もより分かりやすくしました。
(Tom Lane)
     </p><p>本メッセージは元々は基本的には起こらないケースと考えられていました。
しかし、遅いビルドファームのマシンでたびたび発生して、邪魔になっていました。
LOGレベルに下げ、また、言い回しに幾分の努力を払い、<span class="quote">“<span class="quote">using stale statistics instead of current ones because stats collector is not responding</span>”</span> （統計情報コレクタが応答しないため最新でない鮮度に欠けた統計情報を使います）としました。
     </p></li><li class="listitem"><p>macOS の<code class="function">setlocale()</code>がpostmaster内で不必要な追加スレッドを開始するときに警告するようにしました。
(Noah Misch)
     </p></li><li class="listitem"><p><code class="filename">/etc/passwd</code>が読めないときの<span class="application">libpq</span>の振る舞いを修正しました。
(Tom Lane)
     </p><p><code class="function">PQsetdbLogin()</code>を実行するとき、<span class="application">libpq</span>はOSユーザ名を確認しようとします。それは、ほとんどのUnixプラットフォームで<code class="filename">/etc/passwd</code>の読み取りを伴います。
9.4時点では読み取り失敗をハードエラーとして扱っていましたが、アプリケーションが接続するデータベースロール名を提示しない場合のみ失敗にするという従来の振る舞いに戻しました。
このことは<code class="filename">/etc/passwd</code>ファイルの無いchroot環境での運用を支援します。
     </p></li><li class="listitem"><p><span class="application">psql</span>特別変数の解析について一貫性を改善しました。
(Tom Lane)
     </p><p><code class="literal">ECHO_HIDDEN</code>と<code class="literal">ON_ERROR_ROLLBACK</code>に対して<code class="literal">on</code>と<code class="literal">off</code>を異なる書き方（<code class="literal">1</code>/<code class="literal">0</code>など）で書けるようになります。
<code class="literal">COMP_KEYWORD_CASE</code>、<code class="literal">ECHO</code>、<code class="literal">ECHO_HIDDEN</code>、<code class="literal">HISTCONTROL</code>、<code class="literal">ON_ERROR_ROLLBACK</code>、および、<code class="literal">VERBOSITY</code>に対して解釈できない値には警告するようになります。
全ての特別変数の値について大文字小文字の区別なく受け付けるようになります。
これまでは大文字小文字の区別があるものと無いものが混在していました。
     </p></li><li class="listitem"><p><span class="application">pg_dump</span>をイベントトリガーのコメントを失敗せずに扱うように修正しました。
(Tom Lane)
     </p></li><li class="listitem"><p>並列の<span class="application">pg_dump</span>で<code class="option">--serializable-deferrable</code>を使えるようにしました。
(Kevin Grittner)
     </p></li><li class="listitem"><p><code class="literal">pg_basebackup -x/-X</code>で作られたWALファイルが、スタンバイが昇格したときに再度アーカイブされることを防止しました。
(Andres Freund)
     </p></li><li class="listitem"><p><code class="filename">contrib/tablefunc</code>の<code class="function">connectby()</code>で、予想外の問い合わせ結果（特にNULL）を安全に扱えるようにしました。
(Michael Paquier)
     </p><p>これまで<code class="function">connectby()</code>はNULLのキー値に遭遇するとクラッシュしていました。現在はその行を出力しますが更なる再帰はしません。
     </p></li><li class="listitem"><p>Coverity静的コード解析からの多数の警告を一掃しました。
(Andres Freund, Tatsuo Ishii, Marko Kreen, Tom Lane, Michael Paquier)
     </p><p>ほとんどは表面的な変更ですが、一部は稀に起こりうるバグの修正で、メモリ不足で失敗した後に適切なエラーを出さずクラッシュする例があります。
セキュリティ問題は無いと考えられます。
     </p></li><li class="listitem"><p><span class="application">configure</span>の<code class="varname">CFLAGS</code>環境変数で自動設定される<code class="varname">CFLAGS</code>を上書きできるようにしました。
(Tom Lane)
     </p><p>これまでは、<span class="application">configure</span>は自発的に選択したスイッチをユーザ指定された<code class="varname">CFLAGS</code>文字列の末尾に追加していました。
ほとんどのコンパイラはスイッチを左から右に処理するため、このことはconfigureによる選択がユーザ指定を（競合する内容の場合には）上書きしていたことを意味します。
これは反対にしなければいけません。それで、ユーザの文字列を最初でなく最後に置くように修正しました。
     </p></li><li class="listitem"><p><span class="application">pg_regress</span>が成功して終了したら、一時インストールで作成したものを全て削除するようにしました。
(Tom Lane)
     </p><p><code class="literal">make check-world</code>では多数の一時インストール作成を必要とするため、これは、<code class="literal">make check-world</code>実行におけるかなりのディスク使用量削減になります。
     </p></li><li class="listitem"><p>タイムゾーン省略形のリストにCST(China Standard Time)を追加しました。
(Tom Lane)
     </p></li><li class="listitem"><p>タイムゾーンデータファイルを、チリとメキシコの夏時間規則の変更がされ、アイスランドの歴史的変更が加わった <span class="application">tzdata</span> release 2015a に更新しました。
     </p></li></ul></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="release-9-4-2.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="release.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="release-9-4.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">E.50. リリース9.4.2 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> E.52. リリース9.4</td></tr></table></div></body></html>