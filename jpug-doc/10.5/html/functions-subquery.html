<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>9.22. 副問い合わせ式</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="functions-window.html" title="9.21. ウィンドウ関数" /><link rel="next" href="functions-comparisons.html" title="9.23. 行と配列の比較" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">9.22. 副問い合わせ式</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="functions-window.html" title="9.21. ウィンドウ関数">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="functions.html" title="Chapter 9. 関数と演算子">Up</a></td><th width="60%" align="center">Chapter 9. 関数と演算子</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="functions-comparisons.html" title="9.23. 行と配列の比較">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="FUNCTIONS-SUBQUERY"><div class="titlepage"><div><div><h2 class="title" style="clear: both">9.22. 副問い合わせ式</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="functions-subquery.html#FUNCTIONS-SUBQUERY-EXISTS">9.22.1. <code class="literal">EXISTS</code></a></span></dt><dt><span class="sect2"><a href="functions-subquery.html#FUNCTIONS-SUBQUERY-IN">9.22.2. <code class="literal">IN</code></a></span></dt><dt><span class="sect2"><a href="functions-subquery.html#FUNCTIONS-SUBQUERY-NOTIN">9.22.3. <code class="literal">NOT IN</code></a></span></dt><dt><span class="sect2"><a href="functions-subquery.html#FUNCTIONS-SUBQUERY-ANY-SOME">9.22.4. <code class="literal">ANY</code>/<code class="literal">SOME</code></a></span></dt><dt><span class="sect2"><a href="functions-subquery.html#FUNCTIONS-SUBQUERY-ALL">9.22.5. <code class="literal">ALL</code></a></span></dt><dt><span class="sect2"><a href="functions-subquery.html#id-1.5.8.27.15">9.22.6. 単独行に関する比較</a></span></dt></dl></div><a id="id-1.5.8.27.2" class="indexterm"></a><a id="id-1.5.8.27.3" class="indexterm"></a><a id="id-1.5.8.27.4" class="indexterm"></a><a id="id-1.5.8.27.5" class="indexterm"></a><a id="id-1.5.8.27.6" class="indexterm"></a><a id="id-1.5.8.27.7" class="indexterm"></a><a id="id-1.5.8.27.8" class="indexterm"></a><p>本節では<span class="productname">PostgreSQL</span>で使用できる<acronym class="acronym">SQL</acronym>準拠の副問い合わせについて説明します。
本節で記載した全ての式は結果として論理値（真/偽）を返します。
  </p><div class="sect2" id="FUNCTIONS-SUBQUERY-EXISTS"><div class="titlepage"><div><div><h3 class="title">9.22.1. <code class="literal">EXISTS</code></h3></div></div></div><pre class="synopsis">EXISTS (<em class="replaceable"><code>subquery</code></em>)</pre><p><code class="token">EXISTS</code>の引数は、任意の<code class="command">SELECT</code>文、つまり<em class="firstterm">副問い合わせ</em>です。
副問い合わせはそれが何らかの行を返すか否かの決定のために評価されます。
もし1つでも行を返すのであれば、<code class="token">EXISTS</code>の結果は<span class="quote">“<span class="quote">true（真）</span>”</span>となり、副問い合わせが行を返さない場合、<code class="token">EXISTS</code>の結果は<span class="quote">“<span class="quote">false（偽）</span>”</span>となります。
  </p><p>副問い合わせは、取り囲んでいる問い合わせから変数を参照することができ、その値は副問い合わせの評価時には定数として扱われます。
  </p><p>この副問い合わせは通常、最後まで実行されず、少なくとも１つの行が返されたかどうかを判定し得るに足りる時点まで実行されます。
（シーケンス関数を呼び出すような）副作用のある副問い合わせを記述することは配慮不足です。副作用が生じるかどうかは予想できません。
  </p><p>結果は何らかの行が返されるのかのみに依存し、それらの行の内容には依存しないことから、副問い合わせの出力リストは通常重要ではありません。
よく使われるコーディング規約は、全ての<code class="literal">EXISTS</code>テストを<code class="literal">EXISTS(SELECT 1 WHERE ...)</code>といった形式で記述することです。
とは言っても、<code class="token">INTERSECT</code>を使う副問い合わせのようにこの規則には例外があります。
  </p><p>以下の簡単な例は<code class="literal">col2</code>上の内部結合に似ていますが、しかしたとえ<code class="literal">tab2</code>の行といくつか一致したとしても<code class="literal">tab1</code>のそれぞれの行に対して最大限１つの出力行を生成します。
</p><pre class="screen">SELECT col1
FROM tab1
WHERE EXISTS (SELECT 1 FROM tab2 WHERE col2 = tab1.col2);</pre><p>
  </p></div><div class="sect2" id="FUNCTIONS-SUBQUERY-IN"><div class="titlepage"><div><div><h3 class="title">9.22.2. <code class="literal">IN</code></h3></div></div></div><pre class="synopsis"><em class="replaceable"><code>expression</code></em> IN (<em class="replaceable"><code>subquery</code></em>)</pre><p>右辺は括弧で括られた副問い合わせで、正確に１列を返すものでなければなりません。
左辺式は評価され、副問い合わせの結果行と比較されます。
副問い合わせの行のどれかと等しい場合、<code class="token">IN</code>の結果は<span class="quote">“<span class="quote">true（真）</span>”</span>です。
（副問い合わせが行を返さない場合を含め）等しい行が見つからない場合、結果は<span class="quote">“<span class="quote">false（偽）</span>”</span>です。
  </p><p>左辺の式がNULLを生じる場合、または右辺の値に等しいものがなくて少なくとも1つの右辺の行がNULLを持つ場合、<code class="token">IN</code>構文の結果は偽ではなくNULLとなることに注意してください。
これは、NULL値の論理的な組み合わせに対するSQLの標準規則に従うものです。
  </p><p><code class="token">EXISTS</code>と同様、副問い合わせが完全に評価されることを前提としてはなりません。
  </p><pre class="synopsis"><em class="replaceable"><code>row_constructor</code></em> IN (<em class="replaceable"><code>subquery</code></em>)</pre><p><code class="token">IN</code>のこの形式の左辺は、<a class="xref" href="sql-expressions.html#SQL-SYNTAX-ROW-CONSTRUCTORS" title="4.2.13. 行コンストラクタ">Section 4.2.13</a>で説明する、行のコンストラクタです。
右辺は括弧で括られた副問い合わせで、左辺の行にある式の数と正確に同じ数の列を返さなければなりません。
左辺の式は副問い合わせの結果のそれぞれの行に対し、行に関して評価、比較が行われます。
副問い合わせの行に等しいものが見つかった場合、<code class="token">IN</code> の結果は<span class="quote">“<span class="quote">true（真）</span>”</span>となります。
（副問い合わせが行を返さない場合を含め）等しい行が見つからない場合、結果は<span class="quote">“<span class="quote">false（偽）</span>”</span>です。
  </p><p>通常通り、行にあるNULL値はSQLの論理式の標準規則で結合されます。
２つの行は対応する全ての構成要素が非NULLかつ等しい場合に等しいとみなされます。
１つでも対応する構成要素が非NULLかつ等しくないものがあれば、２つの行は等しくないとみなされます。
それ以外の場合、その行の比較結果は不明（NULL）です。
行毎の結果すべてが不等もしくはNULLの場合、少なくとも１つのNULLがあると、<code class="token">IN</code>の結果はNULLとなります。
  </p></div><div class="sect2" id="FUNCTIONS-SUBQUERY-NOTIN"><div class="titlepage"><div><div><h3 class="title">9.22.3. <code class="literal">NOT IN</code></h3></div></div></div><pre class="synopsis"><em class="replaceable"><code>expression</code></em> NOT IN (<em class="replaceable"><code>subquery</code></em>)</pre><p>右辺は括弧で括られた副問い合わせで、正確に１つの列を返さなければなりません。
左辺の式は副問い合わせ結果の行それぞれに対して評価、比較されます。
等しくない副問い合わせの行だけがある（副問い合わせが行を返さない場合を含む）と、<code class="token">NOT IN</code>の結果は<span class="quote">“<span class="quote">true（真）</span>”</span>です。
等しい行が1つでもあれば、結果は<span class="quote">“<span class="quote">false（偽）</span>”</span>です。
  </p><p>左辺の式でNULLが生じる場合、または右辺の値に等しいものがなく、少なくとも１つの右辺の式がNULLを生み出す場合、<code class="token">NOT IN</code>構文の結果は真ではなくNULLとなることに注意してください。
これは、NULL値の論理的な組み合わせに対するSQLの標準規則に従うものです。
  </p><p><code class="token">EXISTS</code>と同様、副問い合わせが完全に評価されることを前提としてはなりません。
  </p><pre class="synopsis"><em class="replaceable"><code>row_constructor</code></em> NOT IN (<em class="replaceable"><code>subquery</code></em>)</pre><p><code class="token">NOT IN</code>のこの形式の左辺は、<a class="xref" href="sql-expressions.html#SQL-SYNTAX-ROW-CONSTRUCTORS" title="4.2.13. 行コンストラクタ">Section 4.2.13</a>で説明する行コンストラクタです。
右辺は括弧で括られた副問い合わせで、左辺の行にある式の数と正確に同じ数の列を返さなければなりません。
左辺の式は副問い合わせの結果のそれぞれの行に対し、評価、比較が行われます。
副問い合わせの行に不等のもののみが見つかった場合（副問い合わせが行を返さない場合を含む）、<code class="token">NOT IN</code>の結果は<span class="quote">“<span class="quote">true（真）</span>”</span>となります。
等しい行が１つでも見つかった場合、結果は<span class="quote">“<span class="quote">false（偽）</span>”</span>です。
  </p><p>通常通り、行にあるNULL値はSQLの論理式の標準規則で結合されます。
2つの行は対応する全ての構成要素が非NULLかつ等しい場合に等しいとみなされます。
１つでも構成要素が非NULLかつ等しくない場合、２つの行は等しくないとみなされます。
それ以外の場合、その行の比較結果は不明（NULL）です。
行毎の結果すべてが不等もしくはNULLの場合、少なくとも1つのNULLがあると、<code class="token">NOT IN</code>の結果はNULLとなります。
  </p></div><div class="sect2" id="FUNCTIONS-SUBQUERY-ANY-SOME"><div class="titlepage"><div><div><h3 class="title">9.22.4. <code class="literal">ANY</code>/<code class="literal">SOME</code></h3></div></div></div><pre class="synopsis"><em class="replaceable"><code>expression</code></em> <em class="replaceable"><code>operator</code></em> ANY (<em class="replaceable"><code>subquery</code></em>)
<em class="replaceable"><code>expression</code></em> <em class="replaceable"><code>operator</code></em> SOME (<em class="replaceable"><code>subquery</code></em>)</pre><p>右辺は括弧で括られた副問い合わせで、正確に1つの列を返さなければなりません。
左辺の式は副問い合わせの結果行それぞれに対して、指定された<em class="replaceable"><code>operator</code></em>を使用して評価、比較されます。なお、<em class="replaceable"><code>operator</code></em>は結果として論理値を生成する必要があります。
真の結果が１つでもあると、<code class="token">ANY</code>の結果は<span class="quote">“<span class="quote">true（真）</span>”</span>です。
真の結果がない（副問い合わせが行を返さない場合を含む）と、結果は<span class="quote">“<span class="quote">false（偽）</span>”</span>です。
  </p><p><code class="token">SOME</code>は<code class="token">ANY</code>の同義語です。
<code class="token">IN</code>は<code class="literal">= ANY</code>と等価です。
  </p><p>成功がなく、右辺の行が演算子の結果として１つでもNULLを生成した場合、<code class="token">ANY</code>構文の結果は偽ではなくNULLになることに注意してください。
これは、NULL値の論理的な組み合わせに対するSQLの標準規則に従うものです。
  </p><p><code class="token">EXISTS</code>と同様、副問い合わせが完全に評価されると前提してはなりません。
  </p><pre class="synopsis"><em class="replaceable"><code>row_constructor</code></em> <em class="replaceable"><code>operator</code></em> ANY (<em class="replaceable"><code>subquery</code></em>)
<em class="replaceable"><code>row_constructor</code></em> <em class="replaceable"><code>operator</code></em> SOME (<em class="replaceable"><code>subquery</code></em>)</pre><p><code class="token">ANY</code>のこの形式の左辺は、<a class="xref" href="sql-expressions.html#SQL-SYNTAX-ROW-CONSTRUCTORS" title="4.2.13. 行コンストラクタ">Section 4.2.13</a>で説明されている行コンストラクタです。
右辺は括弧で括られた副問い合わせで、左辺の行にある式の数と正確に同じ数の列を返さなければなりません。
左辺の式は副問い合わせの結果のそれぞれの行に対し、与えられた<em class="replaceable"><code>operator</code></em>を使用して行に関する評価、比較が行われます。
比較の結果、副問い合わせの行のどれかに対して真となる場合、<code class="token">ANY</code>の結果は<span class="quote">“<span class="quote">true（真）</span>”</span>です。
比較の結果、副問い合わせの全ての行に対して偽となる場合（副問い合わせが行を返さないという場合も含む）、結果は<span class="quote">“<span class="quote">false（偽）</span>”</span>です。
比較の結果、いかなる行でも真を返さず、かつ、少なくとも１つの行がNULLを返す場合、結果はNULLになります。
  </p><p>行コンストラクタ比較の意味についての詳細は<a class="xref" href="functions-comparisons.html#ROW-WISE-COMPARISON" title="9.23.5. 行コンストラクタの比較">Section 9.23.5</a>を参照して下さい。
  </p></div><div class="sect2" id="FUNCTIONS-SUBQUERY-ALL"><div class="titlepage"><div><div><h3 class="title">9.22.5. <code class="literal">ALL</code></h3></div></div></div><pre class="synopsis"><em class="replaceable"><code>expression</code></em> <em class="replaceable"><code>operator</code></em> ALL (<em class="replaceable"><code>subquery</code></em>)</pre><p>右辺は括弧で括られた副問い合わせで、正確に１つの列を返さなければなりません。
左辺の式は副問い合わせの結果行それぞれに対して、指定された<em class="replaceable"><code>operator</code></em>を使用して評価、比較されます。なお、<em class="replaceable"><code>operator</code></em>は結果として論理値を生成する必要があります。
全ての行が真になる場合（副問い合わせが行を返さない場合を含む）、<code class="token">ALL</code>の結果は<span class="quote">“<span class="quote">true（真）</span>”</span>です。
1つでも偽の結果があると、結果は<span class="quote">“<span class="quote">false（偽）</span>”</span>です。
比較がどの行でも偽を返さず、かつ、少なくとも1つの行でNULLを返した場合、結果はNULLとなります。
  </p><p>   <code class="token">NOT IN</code>は<code class="literal">&lt;&gt; ALL</code>と等価です。
  </p><p><code class="token">EXISTS</code>と同様、副問い合わせが完全に評価されることを前提としてはなりません。
  </p><pre class="synopsis"><em class="replaceable"><code>row_constructor</code></em> <em class="replaceable"><code>operator</code></em> ALL (<em class="replaceable"><code>subquery</code></em>)</pre><p><code class="token">ALL</code>のこの形式の左辺は、<a class="xref" href="sql-expressions.html#SQL-SYNTAX-ROW-CONSTRUCTORS" title="4.2.13. 行コンストラクタ">Section 4.2.13</a>で説明する行コンストラクタです。
右辺は括弧で括られた副問い合わせで、左辺の行にある式の数と正確に同じ数の列を返さなければなりません。
左辺の式は副問い合わせの結果のそれぞれの行に対し、与えられた<em class="replaceable"><code>operator</code></em>を使用して行に関する評価、比較が行われます。
比較した結果、すべての副問い合わせ行に対して真を返す場合（副問い合わせが行を返さないという場合も含む）、<code class="token">ALL</code>の結果は<span class="quote">“<span class="quote">true（真）</span>”</span>となります。
比較した結果、いずれかの副問い合わせ行で偽を返す場合、この結果は<span class="quote">“<span class="quote">false（偽）</span>”</span>となります。
比較結果がすべての副問い合わせ行に対して偽を返さず、少なくとも１行でNULLを返す場合、結果はNULLとなります。
  </p><p>行コンストラクタに関する比較の意味については<a class="xref" href="functions-comparisons.html#ROW-WISE-COMPARISON" title="9.23.5. 行コンストラクタの比較">Section 9.23.5</a>を参照してください。
  </p></div><div class="sect2" id="id-1.5.8.27.15"><div class="titlepage"><div><div><h3 class="title">9.22.6. 単独行に関する比較</h3></div></div></div><a id="id-1.5.8.27.15.2" class="indexterm"></a><pre class="synopsis"><em class="replaceable"><code>row_constructor</code></em> <em class="replaceable"><code>operator</code></em> (<em class="replaceable"><code>subquery</code></em>)</pre><p>左辺は、<a class="xref" href="sql-expressions.html#SQL-SYNTAX-ROW-CONSTRUCTORS" title="4.2.13. 行コンストラクタ">Section 4.2.13</a>で説明されている行コンストラクタです。
右辺は括弧で括られた副問い合わせで、左辺の行とまったく同じ数の列を返さなければなりません。さらに、副問い合わせは複数行を返すことはできません。
（行をまったく返さない場合、結果はNULLとみなされます。）
左辺は副問い合わせの結果の単一行に対し行全体で評価、比較が行われます。
  </p><p>行コンストラクタに関する比較の意味についての詳細は<a class="xref" href="functions-comparisons.html#ROW-WISE-COMPARISON" title="9.23.5. 行コンストラクタの比較">Section 9.23.5</a>を参照してください。
  </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="functions-window.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="functions.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="functions-comparisons.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">9.21. ウィンドウ関数 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 9.23. 行と配列の比較</td></tr></table></div></body></html>