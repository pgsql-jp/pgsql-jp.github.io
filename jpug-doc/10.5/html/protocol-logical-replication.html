<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>52.5. 論理ストリーミングレプリケーションのプロトコル</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="protocol-replication.html" title="52.4. ストリーミングレプリケーションプロトコル" /><link rel="next" href="protocol-message-types.html" title="52.6. メッセージのデータ型" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">52.5. 論理ストリーミングレプリケーションのプロトコル</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="protocol-replication.html" title="52.4. ストリーミングレプリケーションプロトコル">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="protocol.html" title="Chapter 52. フロントエンド/バックエンドプロトコル">Up</a></td><th width="60%" align="center">Chapter 52. フロントエンド/バックエンドプロトコル</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="protocol-message-types.html" title="52.6. メッセージのデータ型">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="PROTOCOL-LOGICAL-REPLICATION"><div class="titlepage"><div><div><h2 class="title" style="clear: both">52.5. 論理ストリーミングレプリケーションのプロトコル</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="protocol-logical-replication.html#PROTOCOL-LOGICAL-REPLICATION-PARAMS">52.5.1. 論理ストリーミングレプリケーションのパラメータ</a></span></dt><dt><span class="sect2"><a href="protocol-logical-replication.html#PROTOCOL-LOGICAL-MESSAGES">52.5.2. 論理レプリケーションのプロトコルのメッセージ</a></span></dt><dt><span class="sect2"><a href="protocol-logical-replication.html#PROTOCOL-LOGICAL-MESSAGES-FLOW">52.5.3. 論理レプリケーションのプロトコルのメッセージフロー</a></span></dt></dl></div><p>この節では論理レプリケーションのプロトコルについて説明します。
このプロトコルはレプリケーションコマンド<code class="literal">START_REPLICATION</code> <code class="literal">SLOT</code> <em class="replaceable"><code>slot_name</code></em> <code class="literal">LOGICAL</code>で始まるメッセージフローです。
 </p><p>論理ストリーミングレプリケーションのプロトコルは、物理レプリケーションプロトコルの基本要素の上に構築されています。
 </p><div class="sect2" id="PROTOCOL-LOGICAL-REPLICATION-PARAMS"><div class="titlepage"><div><div><h3 class="title">52.5.1. 論理ストリーミングレプリケーションのパラメータ</h3></div></div></div><p>論理レプリケーションの<code class="literal">START_REPLICATION</code>コマンドは以下のパラメータを受け付けます。

   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">      proto_version
     </span></dt><dd><p>プロトコルのバージョンです。
現在はバージョン<code class="literal">1</code>のみが受け付けられます。
      </p></dd><dt><span class="term">      publication_names
     </span></dt><dd><p>サブスクライブする（変更を受け取る）対象となるパブリケーション名をカンマで区切ったリストです。
個々のパブリケーション名は標準的なオブジェクト名と扱われ、必要に応じて引用符で括ることができます。
      </p></dd></dl></div><p>

  </p></div><div class="sect2" id="PROTOCOL-LOGICAL-MESSAGES"><div class="titlepage"><div><div><h3 class="title">52.5.2. 論理レプリケーションのプロトコルのメッセージ</h3></div></div></div><p>個々のプロトコルのメッセージについては以降の副節で説明します。
個々のメッセージについては<a class="xref" href="protocol-logicalrep-message-formats.html" title="52.9. 論理レプリケーションのメッセージ書式">Section 52.9</a>で説明されています。
  </p><p>トップレベルのプロトコルのメッセージはすべてメッセージタイプのバイトで始まります。
コード内では文字として表現されますが、これは文字符号化のないバイト（符号付き）です。
  </p><p>ストリーミングレプリケーションのプロトコルはメッセージ長を含むため、トップレベルのプロトコルのメッセージはそのヘッダに長さを埋め込む必要がありません。
  </p></div><div class="sect2" id="PROTOCOL-LOGICAL-MESSAGES-FLOW"><div class="titlepage"><div><div><h3 class="title">52.5.3. 論理レプリケーションのプロトコルのメッセージフロー</h3></div></div></div><p><code class="literal">START_REPLICATION</code>コマンドと再生進捗のメッセージを除き、すべての情報はバックエンド側からフロントエンド側にのみ流れます。
  </p><p>論理レプリケーションのプロトコルは、個々のトランザクションを一つずつ送信します。
これはつまり、BeginとCommitのメッセージの対の間にある全てのメッセージは同じトランザクションに属するということです。
  </p><p>送信されるすべてのトランザクションにはゼロ個以上のDMLメッセージ（Insert、Update、Delete）が含まれます。
カスケードの設定がされている場合は、Originメッセージを含めることができます。
Originメッセージはトランザクションの起点が別のレプリケーションノードであることを示します。
論理レプリケーションのプロトコルという観点では、レプリケーションノードはほぼ何でも良いため、唯一の識別子はOriginの名前です。
（必要なら）必要に応じてこれを処理するのは下流側の責任です。
Originメッセージは必ずトランザクション内のどのDMLよりも前に送信されます。
  </p><p>すべてのDMLメッセージは任意のリレーションIDを含んでおり、これをRelationメッセージ内のIDと関連付けることができます。
Relationメッセージはあるリレーションのスキーマを記述します。
あるリレーションについてのRelationメッセージは、現在のセッションでそのリレーションについて初めてDMLメッセージを送信する場合、あるいはRelationメッセージが最後に送信された後でリレーションの定義が変更された場合に送信されます。
このプロトコルは、クライアントが必要なだけ多くのリレーションについて、メタデータをキャッシュできることを前提としています。
  </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="protocol-replication.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="protocol.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="protocol-message-types.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">52.4. ストリーミングレプリケーションプロトコル </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 52.6. メッセージのデータ型</td></tr></table></div></body></html>