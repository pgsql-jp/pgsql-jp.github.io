<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>E.16. リリース9.6.1</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="release-9-6-2.html" title="E.15. リリース9.6.2" /><link rel="next" href="release-9-6.html" title="E.17. リリース9.6" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">E.16. リリース9.6.1</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="release-9-6-2.html" title="E.15. リリース9.6.2">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="release.html" title="Appendix E. リリースノート">Up</a></td><th width="60%" align="center">Appendix E. リリースノート</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="release-9-6.html" title="E.17. リリース9.6">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="RELEASE-9-6-1"><div class="titlepage"><div><div><h2 class="title" style="clear: both">E.16. リリース9.6.1</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="release-9-6-1.html#id-1.11.6.20.4">E.16.1. バージョン9.6.1への移行</a></span></dt><dt><span class="sect2"><a href="release-9-6-1.html#id-1.11.6.20.5">E.16.2. 変更点</a></span></dt></dl></div><p><strong>Release date: </strong>2016-10-27</p><p>このリリースは9.6.0に対し、各種不具合を修正したものです。
9.6メジャーリリースにおける新機能については、<a class="xref" href="release-9-6.html" title="E.17. リリース9.6">Section E.17</a>
を参照してください。
  </p><div class="sect2" id="id-1.11.6.20.4"><div class="titlepage"><div><div><h3 class="title">E.16.1. バージョン9.6.1への移行</h3></div></div></div><p>9.6.Xからの移行ではダンプ/リストアは不要です。
   </p><p>しかしながら、インストレーションが下記変更点の最初の2項目に書かれたバグの影響を受けている場合には、アップデート後に壊れた空き領域マップおよび/または可視性マップを修復する作業が必要になるでしょう。
   </p></div><div class="sect2" id="id-1.11.6.20.5"><div class="titlepage"><div><div><h3 class="title">E.16.2. 変更点</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>リレーションの空き領域マップと可視性マップの切り捨てに関するWAL記録を修正しました。
(Pavan Deolasee, Heikki Linnakangas)
     </p><p>クラッシュリカバリの際にこれらのファイルが正しくリストアされない、あるいは、スタンバイサーバで誤った書き込みがされる可能性がありました。
空き領域マップ内のでたらめな項目は、リレーション自体から切り捨てられて存在しないページへのアクセスを引き起こすおそれがあり、典型的には<span class="quote">“<span class="quote">could not read block <em class="replaceable"><code>XXX</code></em>: read only 0 of 8192 bytes（ブロックXXXが読み取りできません: 8192バイトのうち0バイトのみ読み取りました）</span>”</span>のようなエラーをもたらします。
チェックサム検査を有効にしているなら、可視性マップでのチェックサムエラーの可能性もあります。
     </p><p>問題があるかどうかの判断とそうであるときの修復の手順について、
<a class="ulink" href="https://wiki.postgresql.org/wiki/Free_Space_Map_Problems" target="_top">https://wiki.postgresql.org/wiki/Free_Space_Map_Problems</a>
で説明されています。
     </p></li><li class="listitem"><p><span class="application">pg_upgrade</span>がリレーションの可視性マップを9.6形式に書き換えたときに起こりうるデータ破損を修正しました。
(Tom Lane)
     </p><p>ビッグエンディアンのマシンで、新たな可視性マップのバイト列が誤った順で書かれ、完全に誤ったマップをもたらしました。
Windowsで、古いマップがテキストモードを使って読まれていて、偶然に復帰(CR)・改行(LF)と一致したバイト列を含んでいる場合に誤った結果をもたらしました。
後者のエラーは、マップファイルが誤った長さに見えるため、ほとんど常に<span class="application">pg_upgrade</span>のエラーになります。
     </p><p>ビッグエンディアンのマシン（多くの非インテルアーキテクチャはビッグエンディアンです）を使っていて、<span class="application">pg_upgrade</span>を9.6より前のリリースからのアップグレードに使っていた場合には、すべての可視性マップが不正で再生成を要すると考えるべきです。
そのためには<code class="filename">contrib/pg_visibility</code>の<code class="function">pg_truncate_visibility_map()</code>関数を用いて各リレーションの可視性マップを切り捨ればよいです。
詳細については
<a class="ulink" href="https://wiki.postgresql.org/wiki/Visibility_Map_Problems" target="_top">https://wiki.postgresql.org/wiki/Visibility_Map_Problems</a>
を参照してください。
     </p></li><li class="listitem"><p><code class="command">INSERT ... ON CONFLICT</code>での自己競合する挿入には直列化のエラーを出さないようにしました。
(Thomas Munro, Peter Geoghegan)
     </p></li><li class="listitem"><p><code class="literal">DISTINCT</code>を使用する集約関数の実行で解放済みメモリ使用の危険があり、修正しました。
(Peter Geoghegan)
     </p><p>これはクラッシュまたは誤った問い合わせ結果をもたらすおそれがあります。
     </p></li><li class="listitem"><p>ウィンドウ関数として使用される多様型の集約の誤った扱いを修正しました。
(Tom Lane)
     </p><p>集約の遷移関数は、その第一引数と戻り値が状態の型でなく集約の出力の型であると知らされました。
このことは多様遷移関数のエラーまたはクラッシュを引き起こしました。
     </p></li><li class="listitem"><p>行単位セキュリティが有効なテーブルの列名リストを伴う<code class="command">COPY</code>を修正しました。
(Adam Brightwell)
     </p></li><li class="listitem"><p>
<a class="xref" href="runtime-config-statistics.html#GUC-TRACK-IO-TIMING">track_io_timing</a>がonのとき、有効なXMLを出力するように<code class="command">EXPLAIN</code>を修正しました。
(Markus Winand)
     </p><p>これまでXML出力形式オプションは<code class="literal">&lt;I/O-Read-Time&gt;</code>のような文法的に無効なタグを生成していました。
これは<code class="literal">&lt;I-O-Read-Time&gt;</code>となります。
     </p></li><li class="listitem"><p>準備されたトランザクションでの<code class="command">TRUNCATE</code>に対する統計情報の更新が修正されました。
(Stas Kelvich)
     </p></li><li class="listitem"><p>テーブルの作成または定義変更における、継承した<code class="literal">CHECK</code>制約のマージでのバグを修正しました。
(Tom Lane, Amit Langote)
     </p><p>同一の<code class="literal">CHECK</code>制約を親テーブルと子テーブルにどの順でも加えることを可能にします。
親テーブルからの有効な制約と子テーブルの<code class="literal">NOT VALID</code>な制約とのマージを防止します。
そのうえ、<code class="literal">NO INHERIT</code>な子の制約と継承された制約とのマージを防止します。
     </p></li><li class="listitem"><p><code class="structname">pg_settings</code>.<code class="structfield">unit</code>で<code class="varname">min_wal_size</code>と<code class="varname">max_wal_size</code>に実用的な値を表示するようにしました。
(Tom Lane)
     </p></li><li class="listitem"><p><code class="function">jsonb_set()</code>で配列要素の置換を修正しました。
(Tom Lane)
     </p><p>対象が存在するJSON配列要素の場合、新たな値で置き換えられる代わりに削除されていました。
     </p></li><li class="listitem"><p>バッファロックの保持なしにタプル可視性をテストすることによる、とても低い確率のデータ破損を回避しました。
(Thomas Munro, Peter Geoghegan, Tom Lane)
     </p></li><li class="listitem"><p>サーバ再起動をまたいでコミットタイムスタンプを維持するようにしました。
(Julien Rouhaud, Craig Ringer)
     </p><p><a class="xref" href="runtime-config-replication.html#GUC-TRACK-COMMIT-TIMESTAMP">track_commit_timestamp</a>がonのとき、クリーンなサーバ再起動の後に古いコミットタイムスタンプがアクセス不能になっていました。
     </p></li><li class="listitem"><p>サブトランザクションのWAL出力がディスクに溢れるほど大きいとき、適切に動作するようにロジカルWALデコーディングを修正しました。
(Andres Freund)
     </p></li><li class="listitem"><p>ロジカルWALでコーディングでダングリングポインタ問題を修正しました。
(Stas Kelvich)
     </p></li><li class="listitem"><p>Linuxでhuge pagesを使用しようとするとき、共有メモリ割り当て要求を実際のhuge pageサイズの倍数にまるめるようにしました。
(Tom Lane)
     </p><p>これにより、典型的ではないデフォルトhuge pageサイズを持つシステムで<code class="function">munmap()</code>中に起こりうる失敗を回避します。
クラッシュリカバリの場合を除いて、ログメッセージの他には悪影響はありませんでした。
     </p></li><li class="listitem"><p><span class="application">libpq</span>で複数接続を横断してSSLコンテキストを共有をしようとしなくしました。
(Heikki Linnakangas)
     </p><p>特に異なる接続に異なるSSLパラメータを使おうとするとき、これは稀な場合で起きる様々なバグをもたらしました。
     </p></li><li class="listitem"><p><span class="application">libpq</span>で稀な場合のメモリリークを回避しました。
(Tom Lane)
     </p><p>報告された問題は<code class="function">PQreset()</code>でエラー報告がメモリリークするものですが、関連したケースがいくつかあると思われます。
     </p></li><li class="listitem"><p><span class="application">pg_upgrade</span>でライブラリがロード可能かを名前順に検査するようにしました。
(Tom Lane)
     </p><p>これは言語の変換モジュールから、その基となる言語とデータ型のモジュールへの拡張間の依存を処理するための回避策です。
     </p></li><li class="listitem"><p>インデックスアクセスメソッドを含む拡張に対して正しく動作するように<span class="application">pg_upgrade</span>を修正しました。
(Tom Lane)
     </p><p>これを可能にするため、サーバが<code class="command">ALTER EXTENSION ADD/DROP ACCESS METHOD</code>に対応するように拡張されました。
この機能はアクセスメソッドの動的作成に対応した当初のパッチに含まれているべきでしたが、見落とされていました。
     </p></li><li class="listitem"><p><span class="application">pg_upgrade</span>のファイルのコピー/リンク/リライト段階におけるエラー報告を改善しました。
(Tom Lane, Álvaro Herrera)
     </p></li><li class="listitem"><p><span class="application">pg_dump</span>を7.4より前のサーバに対して動作するように修正しました。
(Amit Langote, Tom Lane)
     </p></li><li class="listitem"><p><span class="application">pg_rewind</span>で<code class="option">--source-server</code>と<code class="option">--source-target</code>のオプションを両方指定することを禁止しました。
(Michael Banck)
     </p></li><li class="listitem"><p><span class="application">pg_rewind</span>がソースサーバ上のセッションで<code class="varname">synchronous_commit</code>をoffにするようにしました。
(Michael Banck, Michael Paquier)
     </p><p>これによりソースサーバが同期レプリケーションを使用していて、何らかの理由でそれが機能していないときでも、<span class="application">pg_rewind</span>が動作するようになります。
     </p></li><li class="listitem"><p><span class="application">pg_xlogdump</span>で<code class="option">--follow</code>オプションを使っているとき、新たなWALセグメントのオープンを再試行するようにしました。
(Magnus Hagander)
     </p><p>これはサーバの次セグメント作成における起こりうる遅れを許容します。
     </p></li><li class="listitem"><p>ロールバックされた更新の対象となっていた破損したタプルに対して正しいTIDを報告するように<code class="filename">contrib/pg_visibility</code>を修正しました。
(Tom Lane)
     </p></li><li class="listitem"><p>単独での<span class="application">PL/Python</span>の並行makeが確実に成功するようにmakefileの依存を修正しました。
(Pavel Raiskup)
     </p></li><li class="listitem"><p>タイムゾーンデータファイルを<span class="application">tzdata</span> release 2016hに更新しました。
パレスチナとトルコの夏時間法の変更、トルコとロシアのいくつかの地域の歴史的修正が含まれます。
南極大陸、旧ソ連、スリランカのいくつかのタイムゾーンでは数値による省略形に切り替えました。
     </p><p>IANAタイムゾーンデータベースはこれまで全てのタイムゾーンについて文字による省略形を提供しましたが、地元の人々の間でほとんど、あるいは全く通用していない省略形をしばしば作成していました。
IANAは英語の省略形が現実に使われている形跡がないゾーンにおいてはUTCオフセット数値を使うことを選ぶという方針に転換しようとしてるところです。
少なくともしばらくの間、<span class="productname">PostgreSQL</span>はタイムスタンプの入力に、このような削除された省略形を引き続き受け入れます。
しかし、それらは<code class="structname">pg_timezone_names</code>ビューには現れず、出力にも使用されなくなります。
     </p><p>本更新では<code class="literal">AMT</code>はもはやアルメニア時間の意味で使われるものとしては現れません。
それゆえに、これをアマゾン時間すなわちUTC+4ではなくUTC-4と解釈するように<code class="literal">Default</code>省略形セットを変更しました。
     </p></li></ul></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="release-9-6-2.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="release.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="release-9-6.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">E.15. リリース9.6.2 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> E.17. リリース9.6</td></tr></table></div></body></html>