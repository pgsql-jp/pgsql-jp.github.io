<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>32.3. 各種の比較用ファイル</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="regress-evaluation.html" title="32.2. テストの評価" /><link rel="next" href="regress-tap.html" title="32.4. TAPテスト" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">32.3. 各種の比較用ファイル</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="regress-evaluation.html" title="32.2. テストの評価">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="regress.html" title="Chapter 32. リグレッションテスト">Up</a></td><th width="60%" align="center">Chapter 32. リグレッションテスト</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="regress-tap.html" title="32.4. TAPテスト">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="REGRESS-VARIANT"><div class="titlepage"><div><div><h2 class="title" style="clear: both">32.3. 各種の比較用ファイル</h2></div></div></div><p>試験の中には必然的に環境に依存した結果となるものがありますので、<span class="quote">“<span class="quote">expected</span>”</span>結果ファイルの代替を指定する方法を用意しています。
各リグレッションテストは、異なるプラットフォームで出力される可能性がある、複数の比較用ファイルを持つことができます。
各試験に対してどの比較用ファイルを使用するかを決定する方法には、独立した２つの機構があります。
   </p><p>1つ目のメカニズムにより、特定のプラットフォームのための比較用ファイルを選ぶことができます。
関連付けを行う<code class="filename">src/test/regress/resultmap</code>というファイルがあり、どの比較用ファイルがどのプラットフォームで使用されるのかを定義します。
特定のプラットフォームにおいて試験の<span class="quote">“<span class="quote">失敗</span>”</span>の誤検知を防ぐためには、まず結果ファイルを選ぶ、あるいは結果ファイルを作成してから、<code class="filename">resultmap</code>ファイルに1行加えてください。
   </p><p>マッピングファイルの各行の書式は下記の通りです。
</p><pre class="synopsis">testname:output:platformpattern=comparisonfilename</pre><p>
testnameは特定のリグレッションテストのモジュール名です。
outputの値は、どの出力ファイルを検査するのかを示します。
標準のリグレッションテストでは、これは常に<code class="literal">out</code>です。
この値は出力ファイルの拡張子に対応します。
platformpatternとは、<code class="command">expr</code> Unixツールスタイル（最初に暗黙的な<code class="literal">^</code>がある正規表現）のパターンです。
これは<code class="command">config.guess</code>によって出力されるプラットフォーム名と比較されます。
comparisonfilenameは置き換える結果比較ファイルの（ディレクトリ部分を除いた）名前です。
   </p><p>以下に例を示します。
システムの中には、非常に小さな浮動小数値に対し、アンダーフローエラーを報告せずに0として解釈するものがあります。
これにより<code class="filename">float8</code>リグレッションテストにわずかな違いが発生します。
そのため、<code class="filename">float8-small-is-zero.out</code>という異なる比較ファイルを用意し、そこにこういったシステムでの期待される値を記述します。
<span class="systemitem">OpenBSD</span>プラットフォームにおいて偽の<span class="quote">“<span class="quote">失敗</span>”</span>メッセージ出力を行わせないようにするために、<code class="filename">resultmap</code>に以下を含めます。
</p><pre class="programlisting">float8:out:i.86-.*-openbsd=float8-small-is-zero.out</pre><p>
これは、<code class="command">config.guess</code>の出力が<code class="literal">i.86-.*-openbsd</code>に一致するすべてのマシンに対して適用されます。
<code class="filename">resultmap</code>のその他の行は、他のプラットフォーム向けの適切な比較ファイルを選択します。
   </p><p>2つ目の比較用ファイルの選択の仕組みはかなり自動化されています。
これは単純に、提供されている各種比較用ファイルの中から<span class="quote">“<span class="quote">もっとも一致するもの</span>”</span>を使用します。
リグレッションテストのドライバスクリプトは、試験において、標準の比較用ファイル<code class="literal"><em class="replaceable"><code>testname</code></em>.out</code>と<code class="literal"><em class="replaceable"><code>testname</code></em>_<em class="replaceable"><code>digit</code></em>.out</code>（ここで<em class="replaceable"><code>digit</code></em>は<code class="literal">0</code>-<code class="literal">9</code>のいずれかからなる1つの数字です）という名前の別のファイルの両方を考慮します。
もしこの中のいずれかのファイルが正確に一致した場合、試験が成功したものとみなします。
さもなくば、生成されたdiffの結果がもっとも小さかった結果ファイルを選択して、失敗報告を生成します。
（<code class="filename">resultmap</code>に特定の試験用の項目が含まれていると、<code class="filename">resultmap</code>内の名前が元となる<em class="replaceable"><code>testname</code></em>に置き換えられます。）
   </p><p>例えば、<code class="literal">char</code>の試験では、比較用ファイル<code class="filename">char.out</code>には<code class="literal">C</code>ロケールと<code class="literal">POSIX</code>ロケールで想定される結果が含まれています。
一方、<code class="filename">char_1.out</code>ファイルには、他の多くのロケールで現れる結果がソートされて含まれています。
   </p><p>この最善一致の仕組みは、ロケールに依存した結果に対応できるように考え出されました。
しかし、この仕組みはプラットフォームの名前だけでは簡単に予測できる試験結果とならないような、任意の状況で使用することができます。
この仕組みの制約は、現在の環境でどの種類の比較ファイルが本当に<span class="quote">“<span class="quote">正しい</span>”</span>のかが試験ドライバでは分からないという点です。
単にもっともうまく動いていそうなものを選択しているだけだからです。
したがって、すべての文脈で平等に有効とみなすことができるような種類の結果においてのみ利用するのが、もっとも安全です。
   </p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="regress-evaluation.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="regress.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="regress-tap.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">32.2. テストの評価 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 32.4. TAPテスト</td></tr></table></div></body></html>