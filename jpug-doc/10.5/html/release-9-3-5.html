<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>E.72. リリース9.3.5</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="release-9-3-6.html" title="E.71. リリース9.3.6" /><link rel="next" href="release-9-3-4.html" title="E.73. リリース9.3.4" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">E.72. リリース9.3.5</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="release-9-3-6.html" title="E.71. リリース9.3.6">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="release.html" title="Appendix E. リリースノート">Up</a></td><th width="60%" align="center">Appendix E. リリースノート</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="release-9-3-4.html" title="E.73. リリース9.3.4">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="RELEASE-9-3-5"><div class="titlepage"><div><div><h2 class="title" style="clear: both">E.72. リリース9.3.5</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="release-9-3-5.html#id-1.11.6.76.4">E.72.1. バージョン9.3.5への移行</a></span></dt><dt><span class="sect2"><a href="release-9-3-5.html#id-1.11.6.76.5">E.72.2. 変更点</a></span></dt></dl></div><p><strong>リリース日: </strong>2014-07-24</p><p>このリリースは9.3.4に対し、各種不具合を修正したものです。
9.3メジャーリリースにおける新機能については、<a class="xref" href="release-9-3.html" title="E.77. リリース9.3">Section E.77</a>を参照してください。
  </p><div class="sect2" id="id-1.11.6.76.4"><div class="titlepage"><div><div><h3 class="title">E.72.1. バージョン9.3.5への移行</h3></div></div></div><p>9.3.Xからの移行ではダンプ/リストアは不要です。
   </p><p>しかしながら、本リリースでは、<span class="application">pg_upgrade</span>のロジックエラーや、いくつかのGiSTインデックスのインデックス破損問題を修正しています。
下記に示すはじめの2つの変更点を確認し、使用しているインストレーションが影響を受けるか、その場合どのような処置を施すべきか判断してください。
   </p><p>また、9.3.4よりも前のリリースからアップグレードする場合は、<a class="xref" href="release-9-3-4.html" title="E.73. リリース9.3.4">Section E.73</a>を参照して下さい。
   </p></div><div class="sect2" id="id-1.11.6.76.5"><div class="titlepage"><div><div><h3 class="title">E.72.2. 変更点</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="application">pg_upgrade</span>において、<span class="application">initdb</span>により残された<code class="filename">pg_multixact</code>ファイルを削除しました。(Bruce Momjian)
     </p><p>9.3.5以前のバージョンの<span class="application">pg_upgrade</span>でデータベースクラスタを9.3にアップグレードした場合、
残るべきではない<code class="filename">$PGDATA/pg_multixact/offsets/0000</code>ファイルが残っており、
これはいずれ<code class="command">VACUUM</code>コマンドで問題を引き起こす原因になっていました。
<span class="emphasis"><em>しかしながら、一般的なケースではこのファイルは実質的に有効であり、削除すべきではありません。</em></span>
この問題があるかどうかは、以下のクエリをスーパーユーザでクラスタのどのデータベースにでも実行することで確認できます。
</p><pre class="programlisting">WITH list(file) AS (SELECT * FROM pg_ls_dir('pg_multixact/offsets'))
SELECT EXISTS (SELECT * FROM list WHERE file = '0000') AND
       NOT EXISTS (SELECT * FROM list WHERE file = '0001') AND
       NOT EXISTS (SELECT * FROM list WHERE file = 'FFFF') AND
       EXISTS (SELECT * FROM list WHERE file != '0000')
       AS file_0000_removal_required;</pre><p>
このクエリが<code class="literal">t</code>が返した場合、手動で<code class="filename">$PGDATA/pg_multixact/offsets/0000</code>ファイルを削除してください。
クエリが<code class="literal">f</code>を返した場合は、何もしないでください。
     </p></li><li class="listitem"><p><code class="filename">contrib/btree_gist</code>拡張モジュールにおける<code class="type">bit</code>カラムのインデックスの初期化パディングバイトを修正しました。
(Heikki Linnakangas)
     </p><p>このエラーは、等価であるべき値を等価と見なさないことが原因で、正しくないクエリー結果を引き起こします。
<code class="type">bit</code>型または<code class="type">bit varying</code>型のカラムにGiSTインデックスを使っている場合、このアップデート適用後に<code class="command">REINDEX</code>が必要です。
     </p></li><li class="listitem"><p>GINリストページを削除した際、ページを破損から保護します。(Heikki Linnakangas)
     </p><p>インデックスのページ更新をディスクへの書き込み中にシステムクラッシュが発生した場合、インデックス破損が起こる可能性を防ぐ修正です。
     </p></li><li class="listitem"><p>WALからの更新を再実行中にGiSTインデックスページのリンク先を削除しません。(Heikki Linnakangas)
     </p><p>このエラーはホットスタンバイ中にGiSTインデックススキャンを実施した場合、一時的に間違った回答を引き起こす可能性がありました。
     </p></li><li class="listitem"><p>SP-GiSTテキストインデックスへの挿入中に無限ループに陥る稀なケースを修正しました。(Tom Lane)
     </p></li><li class="listitem"><p><code class="literal">-|-</code>（隣接範囲）演算子を使ったSP-GiSTインデックス検索からの応答が間違っているのを修正しました。(Heikki Linnakangas)
     </p></li><li class="listitem"><p><code class="filename">pg_multixact/members</code>での周回データの処理を修正しました。(Álvaro Herrera)
     </p></li><li class="listitem"><p><code class="structname">pg_multixact</code>の切り詰めを<code class="command">VACUUM</code>中ではなく、チェックポイント中に行うようにしました。(Álvaro Herrera)
     </p><p>この変更により、クラッシュ後のWALリプレイにおいて、まだ必要とされるかもしれない<code class="structname">pg_multixact</code>セグメントが削除されないことを保証しました。
     </p></li><li class="listitem"><p>WALリカバリー後にall-visibleフラグが不整合を起こす可能性があったのを修正しました。(Heikki Linnakangas)
     </p></li><li class="listitem"><p><code class="function">ReceiveSharedInvalidMessages</code>関数を入れ子で呼ばれた場合、キャッシュの無効化が正しくない可能性があり、修正しました。(Andres Freund)
     </p></li><li class="listitem"><p>タプル更新の際、他プロセスによって同時にロックされ競合状態が発生するのを修正しました。(Andres Freund, Álvaro Herrera)
     </p></li><li class="listitem"><p>継承された子テーブルを読み込む<code class="literal">UNION ALL</code>上のサブクエリによって、
プランナが<span class="quote">“<span class="quote">could not find pathkey item to sort</span>”</span>エラーになる障害を修正しました。
     </p></li><li class="listitem"><p>ターゲットリストに複数行を返す関数がある場合、サブクエリの出力が一意であると決めつけないようにしました。(David Rowley)
     </p><p>この見落としは<code class="literal">WHERE x IN (SELECT y, generate_series(1,10) FROM t GROUP BY y)</code>のような構成で最適化ミスを引き起こす可能性がありました。
     </p></li><li class="listitem"><p>可能であれば<code class="literal">AND</code>/<code class="literal">OR</code>条件の入力から null定数を除去するようにプランナを改善しました。(Tom Lane)
     </p><p>より積極的にパラメータ置換をすることにより、9.2以上の版において古いバージョンのものより悪いプランになるかもしれなかったのを、この変更で修正しました。
     </p></li><li class="listitem"><p>同等の<code class="literal">VARIADIC</code>型の関数呼び出しと非<code class="literal">VARIADIC</code>型の関数呼び出しを、プランナが同等の物として見なすことを保証しました。(Tom Lane)
     </p><p>この不具合では、例えば可変引数関数に対して要素インデックスを使うことに失敗する可能性がありました。
このようなインデックスを使うべき可変引数関数においては、インデックス或いはビューの再生成が必要でした。
この修正は既存の9.3がインストールされたシステムでも有効です。
     </p></li><li class="listitem"><p><code class="function">json_populate_recordset()</code>とそれに類する関数において、入れ子の<code class="type">JSON</code>オブジェクトの扱いを修正しました。(Michael Paquier, Tom Lane)
     </p><p>入れ子の<code class="type">JSON</code>オブジェクトは出力表示ではなく、親オブジェクトの前フィールドの結果であるべきでした。
     </p></li><li class="listitem"><p><code class="function">to_json()</code>および関連する関数で、入力型カテゴリの識別を修正しました。(Tom Lane)
     </p><p><code class="type">JSON</code>の結果内で<code class="type">money</code>フィールドのクオートが不十分であることが知られており、他のデータタイプでも同様に誤った結果になっていたかもしれません。
     </p></li><li class="listitem"><p>複合要素の構造体のTOASTフィールド取り出し失敗を修正しました。(Tom Lane)
     </p><p>これは、TOASTポインタが参照している値を得ずに他のテーブルにコピーできたケースの修正です。
オリジナルデータが後から削除された場合、不正な領域を指し示すポインタ(dangling pointer)となってしまい、<span class="quote">“<span class="quote">missing chunk number 0 for toast value ...</span>”</span>のようなエラーを引き起こしていました。
     </p></li><li class="listitem"><p>Appendプラン出力の行全体を参照することによって、<span class="quote">“<span class="quote">record type has not been registered</span>”</span>エラーとなる問題を修正しました。(Tom Lane)
     </p></li><li class="listitem"><p>カーソルを巻き戻している間にユーザ定義関数を呼び出した場合、クラッシュする可能性があり、修正しました。(Tom Lane)
     </p></li><li class="listitem"><p><code class="literal">FROM</code> 句で関数が引数を評価する際のメモリリーク（クエリー処理内限定）を修正しました。(Tom Lane)
     </p></li><li class="listitem"><p>正規表現処理中のメモリリーク（セッション内限定）を修正しました。(Tom Lane、Arthur O'Dwyer、Greg Stark)
     </p></li><li class="listitem"><p><code class="filename">hungarian.stop</code>のデータエンコーディングエラーを修正しました。(Tom Lane)
     </p></li><li class="listitem"><p><a class="xref" href="runtime-config-compatible.html#GUC-DEFAULT-WITH-OIDS">default_with_oids</a>がtrueの場合でも、外部テーブルがOID付で作成される事を防止しました。(Etsuro Fujita)
     </p></li><li class="listitem"><p>実行中のトランザクションで行を挿入し、当該行を削除したサブトランザクションがロールバックした場合の、行の有効性チェックを修正しました。(Andres Freund)
     </p><p>これを行った後、同一トランザクション内で、<code class="command">CREATE INDEX</code>または<code class="command">CLUSTER</code>が実行された場合、
問題（少なくとも誤ったワーニングが出て、最悪の場合、無限ループに陥る）の原因となります。
     </p></li><li class="listitem"><p><code class="command">PREPARE TRANSACTION</code>中は、<code class="structname">pg_stat_activity</code>の<code class="structfield">xact_start</code>の値を消去します。(Andres Freund)
     </p><p><code class="command">PREPARE</code>コマンド実行後、トランザクション内に元のセッションは最早存在しないので、トランザクション開始時刻を表示し続けるべきではありません。
     </p></li><li class="listitem"><p>テキスト検索オブジェクトに対する<code class="command">REASSIGN OWNED</code>が失敗しないように修正しました。(Álvaro Herrera)
     </p></li><li class="listitem"><p><code class="command">VACUUM FULL</code>中に<code class="structname">pg_class</code>の<code class="structfield">relminmxid</code>の値が戻らないようにしました。(Álvaro Herrera)
     </p></li><li class="listitem"><p>ルールとビューのダンプで読みやすさの向上と過度の空白文字を避けるためにインデントを減らしました。(Greg Stark, Tom Lane)
     </p><p>この変更は、複数のユニオンのリストのように、恐らくユーザが入れ子だと考えていないケースを含め、入れ子構造に貼り付けられるインデントの総量を減らすものです。
恐らく深い入れ子構造では空白文字の総量はO(N^2)で増加し続け、パフォーマンスの問題やメモリ不足エラーを起こすリスクもありました。
現在、インデントは40の剰余数に減らしています。これは最初は奇妙に見えますが、単純にインデントを制限するよりも可読性を保つことが出来ます。
ユニオンのリストを括弧で括った場合の冗長性も同様に減らされています。
     </p></li><li class="listitem"><p>後から追加されるカラムによって<code class="literal">USING</code>節にマッチする複数の入力カラムがもたらされる場合の、ルールとビューのダンプを修正しました。(Tom Lane)
     </p></li><li class="listitem"><p>削除された列を含んだ複合型の値を返す<code class="literal">FROM</code>句を持つ関数のビュー出力を修正しました。(Tom Lane)
     </p></li><li class="listitem"><p>postmaster起動中はシグナルをブロックします。(Tom Lane)
     </p><p>これにより、例えば起動途中に<span class="systemitem">SIGINT</span>を受け取っても、postmasterは適切に後片付けを行う事ができるようになります。
     </p></li><li class="listitem"><p>IPアドレスの代わりにホスト名が<code class="filename">pg_hba.conf</code>に定義されている場合、クライアントのホスト名検索処理を修正しました。(Tom Lane)
     </p><p>DNSの逆引き検索に失敗した場合、エントリーがマッチしない事を黙認せず報告することを保証しました。
また、DNS逆引き検索に失敗した場合に発生していた、ホスト名エントリー毎でなく、コネクション毎に検索する事を保証しました。
     </p></li><li class="listitem"><p>rootユーザでも <code class="literal">postgres -C 変数</code>および<code class="literal">postgres --describe-config</code>を使うことができるようにしました。(MauMau)
     </p><p>これらの操作はルートでのサーバ起動禁止に必要では無く、制限を緩和することによって<span class="application">pg_ctl</span>が失敗する幾つかのシナリオを回避できます。
     </p></li><li class="listitem"><p><code class="literal">make check</code>で一時的に起動されたpostmasterのUNIXドメインソケットを保護します。(Noah Misch)
     </p><p>ローカルユーザはサーバのブートストラップスーパーユーザとしてソケットファイルにアクセス出来、接続可能でした。
そのため、任意のコードをテストを実行しているオペレーティングシステムのユーザとして実行可能でした。
これは既にCVE-2014-0067の中で指摘されていました。
この変更では、サーバのソケットを一時ファイルシステム<code class="filename">/tmp</code>配下のモード0700のサブディレクトリに配置することで、リスクを防御します。
UNIXソケットがサポートされていないプラットフォーム、特にWindowsでは一時postmasterがローカルTCP接続を必要とするため、この危険性は残ります。
     </p><p>この変更の有益な影響は、<code class="literal">DEFAULT_PGSOCKET_DIR</code>を上書きするビルドの<code class="literal">make check</code> テストが簡単になることです。
よく使われるデフォルトではない<code class="filename">/var/run/postgresql</code>のようなファイルには、
ビルドユーザに書き込み権限がないために必要とされる回避策が、今後必要とされなくなります。
     </p></li><li class="listitem"><p>テーブルスペース作成のWALリプレイをWindowsで動作するように修正しました。(MauMau)
     </p></li><li class="listitem"><p>Windowsでソケット生成失敗の判定処理を修正しました。(Bruce Momjian)
     </p></li><li class="listitem"><p>Windowsで、設定ファイルから(<a class="xref" href="runtime-config-logging.html#GUC-LOG-CONNECTIONS">log_connections</a>のような)PGC_BACKENDパラメータ値を、新しい接続への適用を許可します。(Amit Kapila)
     </p><p>以前は、起動後にファイルのパラメータを変更しても反映されませんでした。
     </p></li><li class="listitem"><p>Windowsの実行パス名を適切にクオートします。(Nikhil Deshpande)
     </p><p>この見落としは、インストールパスにスペースと<code class="literal">@</code>が両方含まれる場合、
Windowsで<span class="application">initdb</span>や<span class="application">pg_upgrade</span>がエラーになる原因となっていました。
     </p></li><li class="listitem"><p>macOSで<span class="application">libpython</span>のリンクを修正しました。(Tom Lane)
     </p><p>これまでの方式では、Xcode 5.0とそれ以降で提供されているPythonライブラリでエラーになります。
     </p></li><li class="listitem"><p>クライアントが取り込むよりも速くサーバがデータを送り続けた場合、<span class="application">libpq</span> のバッファが肥大化することを回避しました。(Shin-ichi Morita、Tom Lane)
     </p><p><span class="application">libpq</span>はOut of Memoryになるまで入力バッファの拡張を強要していた可能性がありました
（<span class="quote">“<span class="quote">lost synchronization with server</span>”</span>の報告は誤解を招いたかもしれません）。
一般的な環境下では、<code class="function">recv()</code> ループが取り込むよりもずっと早くデータが送られ続けるというのは、かなりこじつけで、
クライアントが人為的にスケジューラによる制約で遅くなっている場合に観測されているくらいです。
     </p></li><li class="listitem"><p><span class="application">libpq</span>のLDAP照会で、意図した通りのタイムアウトを保証しました。(Laurenz Albe)
     </p></li><li class="listitem"><p><code class="type">char ポインタ</code>の配列を複数行返すFETCHステートメントがターゲットの場合、<span class="application">ecpg</span>が正しく動作するように修正しました。また、その他の配列操作も修正しました。(Ashutosh Bapat)
     </p></li><li class="listitem"><p>テーブルの主キーに依存したマテリアライズドビューに対応するため、<span class="application">pg_dump</span>を修正しました。(Tom Lane)
     </p><p>これはビューのクエリーが<code class="literal">GROUP BY</code>でリストを纏める機能を利用している場合に発生します。
<span class="application">pg_dump</span>はそれらを混同してしまい、マテリアライズドビューを通常のビューとしてダンプしていました。
     </p></li><li class="listitem"><p><span class="application">pg_dumpall</span>の<code class="option">-i</code>オプションのパースを修正しました。(Tom Lane)
     </p></li><li class="listitem"><p><span class="application">pg_restore</span>の、古いスタイルのラージオブジェクトのコメント処理を修正しました。(Tom Lane)
     </p><p>9.0までのバージョンの<span class="application">pg_dump</span>で生成したアーカイブファイルで、ラージオブジェクトに数件以上のコメントが含まれている場合、
アーカイブファイルを直接データベースにリストアすると失敗していました。
     </p></li><li class="listitem"><p>新しいサーバではTOASTテーブルを作るが古いバージョンでは作らないケースについて<span class="application">pg_upgrade</span>を修正しました。(Bruce Momjian)
     </p><p>この稀な状況により<span class="quote">“<span class="quote">relation OID mismatch</span>”</span>エラーを引き起こす可能性がありました。
     </p></li><li class="listitem"><p><span class="application">pg_upgrade</span>で<code class="structname">pg_database</code>.<code class="structfield">datminmxid</code>と
<code class="structname">pg_class</code>.<code class="structfield">relminmxid</code>の古いバージョンの値を保持するか、9.3以前からのアップグレード時に適切な値を代入します。
また、コアサーバの不適切な値を防ぎます。(Bruce Momjian, Álvaro Herrera, Tom Lane)
     </p><p>これらの変更は、新しいデータベースサーバ起動時にオートバキュームが直ちにクラスタの全内容をスキャンを要求する、
或いは固定されていないマルチトランザクションID(MXID）の追跡が完全に出来なくなるシナリオを防ぎます。
     </p></li><li class="listitem"><p><code class="filename">contrib/auto_explain</code>によってユーザの<code class="command">EXPLAIN</code>の出力が変化するのを防ぎました。(Tom Lane)
     </p><p><code class="filename">auto_explain</code>が有効な場合、<code class="literal">EXPLAIN (ANALYZE, TIMING OFF)</code>コマンドを実行してもタイミング情報が出力される可能性がありました。
     </p></li><li class="listitem"><p><code class="filename">contrib/dblink</code>のクエリー実行範囲内でのメモリリークを修正しました。(MauMau, Joe Conway)
     </p></li><li class="listitem"><p><code class="filename">contrib/pgcrypto</code>関数で、処理が戻る前にスタック変数から機密情報を削除する事を保証します。(Marko Kreen)
     </p></li><li class="listitem"><p><code class="filename">contrib/pgstattuple</code>の<code class="function">pgstat_heap()</code>が解放済メモリを使わないようにしました。(Noah Misch)
     </p></li><li class="listitem"><p><code class="filename">contrib/uuid-ossp</code>モジュールで、呼び出し間でOSSP UUIDライブラリの状態をキャッシュします。(Tom Lane)
     </p><p>この改善はUUID生成の効率を上げ、<code class="filename">/dev/urandom</code>から取り出すエントロピー量を減らします。
     </p></li><li class="listitem"><p>タイムゾーンデータファイルを<span class="application">tzdata</span>リリース2014eに更新しました。
クリミア、エジプト、モロッコでの夏時間の変更が含まれます。
     </p></li></ul></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="release-9-3-6.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="release.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="release-9-3-4.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">E.71. リリース9.3.6 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> E.73. リリース9.3.4</td></tr></table></div></body></html>