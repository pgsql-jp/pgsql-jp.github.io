<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>17.1. Visual C++またはMicrosoft Windows SDKを使用した構築</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="install-windows.html" title="Chapter 17. Windowsにおけるソースコードからのインストール" /><link rel="next" href="runtime.html" title="Chapter 18. サーバの準備と運用" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">17.1. <span xmlns="http://www.w3.org/1999/xhtml" class="productname">Visual C++</span>または<span xmlns="http://www.w3.org/1999/xhtml" class="productname">Microsoft Windows SDK</span>を使用した構築</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="install-windows.html" title="Chapter 17. Windowsにおけるソースコードからのインストール">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="install-windows.html" title="Chapter 17. Windowsにおけるソースコードからのインストール">Up</a></td><th width="60%" align="center">Chapter 17. <span xmlns="http://www.w3.org/1999/xhtml" class="productname">Windows</span>におけるソースコードからのインストール</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="runtime.html" title="Chapter 18. サーバの準備と運用">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="INSTALL-WINDOWS-FULL"><div class="titlepage"><div><div><h2 class="title" style="clear: both">17.1. <span class="productname">Visual C++</span>または<span class="productname">Microsoft Windows SDK</span>を使用した構築</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="install-windows-full.html#id-1.6.4.8.8">17.1.1. 必要条件</a></span></dt><dt><span class="sect2"><a href="install-windows-full.html#id-1.6.4.8.9">17.1.2. 64ビット版のWindowsにおける特別な考慮事項</a></span></dt><dt><span class="sect2"><a href="install-windows-full.html#id-1.6.4.8.10">17.1.3. 構築</a></span></dt><dt><span class="sect2"><a href="install-windows-full.html#id-1.6.4.8.11">17.1.4. 整理およびインストール</a></span></dt><dt><span class="sect2"><a href="install-windows-full.html#id-1.6.4.8.12">17.1.5. リグレッションテストの実行</a></span></dt><dt><span class="sect2"><a href="install-windows-full.html#id-1.6.4.8.13">17.1.6. 文書の構築</a></span></dt></dl></div><p>Microsoftが提供するVisual C++コンパイラスィートを使用してPostgreSQLを構築することができます。
これらのコンパイラは<span class="productname">Visual Studio</span>、<span class="productname">Visual Studio Express</span>、いくつかのバージョンの<span class="productname">Microsoft Windows SDK</span>にあります。
すでに<span class="productname">Visual Studio</span>環境が設定されているのでなければ、Microsoftから無料でダウンロードできる<span class="productname">Visual Studio Express 2017 for Windows Desktop</span>のコンパイラや<span class="productname">Windows SDK 8.1</span>のものを使用することが最も簡単な方法です。
 </p><p>32ビットも64ビットもマイクロソフトのコンパイラ一式で構築が可能です。
32ビットPostgreSQLの構築は<span class="productname">Visual Studio 2005</span>から<span class="productname">Visual Studio 2017</span>(Expressエディション含む)までに付属のコンパイラをサポートします。単体のWindows SDKの6.0から8.1までについても同様です。
64ビットPostgreSQLの構築は<span class="productname">Microsoft Windows SDK</span>のバージョン6.0aから8.1、もしくは<span class="productname">Visual Studio 2008</span>かそれ以上のバージョンでサポートしています。
<span class="productname">Visual Studio 2005</span>から<span class="productname">Visual Studio 2013</span>までで構築する場合、コンパイルは<span class="productname">Windows XP</span>や<span class="productname">Windows Server 2003</span>までサポートされています。
<span class="productname">Visual Studio 2015</span>での構築は、<span class="productname">Windows Vista</span>や<span class="productname">Windows Server 2008</span>までサポートされています。
<span class="productname">Visual Studio 2017</span>での構築は、<span class="productname">Windows 7 SP1</span>や<span class="productname">Windows Server 2008 R2 SP1</span>までサポートされています。
 </p><p><span class="productname">Visual C++</span>または<span class="productname">Platform SDK</span>を使用して構築するためのツールが<code class="filename">src/tools/msvc</code>ディレクトリに存在します。
構築する際に、<span class="productname">MinGW</span>や<span class="productname">Cygwin</span>に付属するツールがシステムPATHに存在しないことを確認してください。
また、PATH上で必要なVisual C++ツールがすべて利用可能になっていることを確認してください。
<span class="productname">Visual Studio</span>では、<span class="application">Visual Studio コマンドプロンプト</span>を起動してください。
64ビット版を構築したい場合には、それぞれ64ビット版のコマンドを使用する必要があります。
<span class="productname">Microsoft Windows SDK</span>では、SDKのスタートメニューにある<span class="application">CMD shell</span>を起動してください。
最近のSDKでは、<code class="command">setenv</code>コマンドを使うことで対象のCPUアーキテクチャ、構築種類、対象OSを変更することができます。
例えば<code class="command">setenv /x86 /release /xp</code>は対象をWindows XP以降の32ビットリリース版として構築します。
その他の<code class="command">setenv</code>のオプションについては<code class="command">/?</code>を参照してください。
すべてのコマンドは<code class="filename">src\tools\msvc</code>ディレクトリから実行しなければなりません。
 </p><p>構築する前に、<code class="filename">config.pl</code>ファイルを編集して、変更したい設定オプションや使用する何らかのサードパーティ製のライブラリのパスを反映させる必要があるかもしれません。
まず<code class="filename">config_default.pl</code>ファイルを読み取り、解析することから始まり、そして<code class="filename">config.pl</code>内の何らかの変更が適用されて、すべての設定が決定されます。
例えば、<span class="productname">Python</span>インストレーションの場所を指定する場合、以下を<code class="filename">config.pl</code>に記載します。
</p><pre class="programlisting">$config-&gt;{python} = 'c:\python26';</pre><p>
<code class="filename">config_default.pl</code>内の指定と異なるパラメータのみを指定する必要があります。
 </p><p>何か他に環境変数を設定する必要があれば、<code class="filename">buildenv.pl</code>という名前のファイルを作成し、そこに必要なコマンドを記載してください。
たとえば、PATHにbison用のパスを追加したいのであれば、以下を含むファイルを作成してください。
</p><pre class="programlisting">$ENV{PATH}=$ENV{PATH} . ';c:\some\where\bison\bin';</pre><p>
 </p><p>Visual Studioビルドコマンド(msbuildまたはvcbuild)に追加のコマンドライン引数を渡すには次のようにします。
</p><pre class="programlisting">$ENV{MSBFLAGS}="/m";</pre><p>
 </p><div class="sect2" id="id-1.6.4.8.8"><div class="titlepage"><div><div><h3 class="title">17.1.1. 必要条件</h3></div></div></div><p><span class="productname">PostgreSQL</span>を構築するには以下の追加製品が必要です。
<code class="filename">config.pl</code>ファイルを使用してライブラリを利用できるディレクトリを指定してください。

   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="productname">Microsoft Windows SDK</span></span></dt><dd><p>もしあなたの構築環境がサポートされている<span class="productname">Microsoft Windows SDK</span>のバージョンを搭載していないのであれば、入手可能な最新版(現在はバージョン7.1)までアップグレードすることを推奨します。
<a class="ulink" href="https://www.microsoft.com/download" target="_top">https://www.microsoft.com/download</a>からダウンロードできます。
     </p><p>SDKの<span class="application">Windows Headers and Libraries</span>を常にインクルードしなければなりません。
<span class="application">Visual C++ Compilers</span>に含まれる<span class="productname">Windows SDK</span>をインストールしている場合、構築のために<span class="productname">Visual Studio</span>は必要ありません。
バージョン8.0aでは、Windows SDKは完全なコマンドライン構築環境を提供していないことに注意してください。
     </p></dd><dt><span class="term"><span class="productname">ActiveState Perl</span></span></dt><dd><p>ActiveState Perlが構築生成スクリプトを実行するために必要です。
MinGWまたはCygwinのPerlでは動作しません。
また、PATH内に含められていなければなりません。
<a class="ulink" href="http://www.activestate.com" target="_top">http://www.activestate.com</a>からバイナリをダウンロードできます
（注意：バージョン5.8.3以降が必要です。フリー版の標準配布で十分です）。
     </p></dd></dl></div><p>
  </p><p>使用できるようになることが目的であれば以下の追加製品は必要ありませんが、完全なパッケージを構築する場合には必要です。
<code class="filename">config.pl</code>を使用してライブラリが利用できるディレクトリを指定してください。

   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="productname">ActiveState TCL</span></span></dt><dd><p><span class="application">PL/Tcl</span>を構築する時に必要です
（注意：バージョン8.4が必要です。フリー版の標準配布で十分です）。
     </p></dd><dt><span class="term"><span class="productname">Bison</span>および<span class="productname">Flex</span></span></dt><dd><p>Gitから構築する場合は<span class="productname">Bison</span>および<span class="productname">Flex</span>が必要です。
しかしリリースファイルから構築する場合は不要です。
<span class="productname">Bison</span> 1.875またはバージョン2.2以降のみで動作します。
<span class="productname">Flex</span>はバージョン2.5.31以降でなければなりません。
     </p><p><span class="productname">Bison</span>および<span class="productname">Flex</span>の両方が、<span class="productname">MinGW</span>コンパイラ一式の一部として<a class="ulink" href="http://www.mingw.org/wiki/MSYS" target="_top">http://www.mingw.org/wiki/MSYS</a>から入手できる、<span class="productname">msys</span>ツール一式に含まれています。
     </p><p>すでにPATHが通っていない場合は、<code class="filename">buildenv.pl</code>の中で<code class="filename">flex.exe</code>および<code class="filename">bison.exe</code>があるディレクトリをPATH環境変数に追加する必要があります。
MinGWの場合、このディレクトリはMinGWのインストールディレクトリの<code class="filename">\msys\1.0\bin</code>サブディレクトリです。
     </p><div class="note"><h3 class="title">Note</h3><p>GnuWin32からのBisonディストリビューションでは、<code class="filename">C:\Program Files\GnuWin32</code>の様に名前に空白を持つディレクトリにインストールされると正常に機能しないというバグがあります。
代わりに<code class="filename">C:\GnuWin32</code>へのインストール、または、PATH環境設定におけるGnuWin32へのNTFSショートネームパスの使用（例えば<code class="filename">C:\PROGRA~1\GnuWin32</code>）を検討してください。
       </p></div><div class="note"><h3 class="title">Note</h3><p>PostgreSQL FTPサイトで配布され、古い文書で参照していた古い<code class="literal">winflex</code>は、64ビットWindowsホストでは<span class="quote">“<span class="quote">flex: fatal internal error, exec failed</span>”</span>で失敗します。
代わりにMSYSからのflexを使用してください。
       </p></div></dd><dt><span class="term"><span class="productname">Diff</span></span></dt><dd><p>リグレッションテストを実行するにはdiffが必要です。
<a class="ulink" href="http://gnuwin32.sourceforge.net" target="_top">http://gnuwin32.sourceforge.net</a>からダウンロードできます。
     </p></dd><dt><span class="term"><span class="productname">Gettext</span></span></dt><dd><p>NLSサポート付きで構築する場合はgettextが必要です。
<a class="ulink" href="http://gnuwin32.sourceforge.net" target="_top">http://gnuwin32.sourceforge.net</a>からダウンロードできます。
バイナリ、依存物、開発用ファイルすべてが必要であることに注意してください。
     </p></dd><dt><span class="term"><span class="productname">MIT Kerberos</span></span></dt><dd><p>GSSAPI認証をサポートする場合に必要です。
MIT Kerberosは<a class="ulink" href="http://web.mit.edu/Kerberos/dist/index.html" target="_top">http://web.mit.edu/Kerberos/dist/index.html</a>からダウンロードできます。
     </p></dd><dt><span class="term"><span class="productname">libxml2</span>および<span class="productname">libxslt</span></span></dt><dd><p>XMLサポートのために必要です。
バイナリは<a class="ulink" href="http://zlatkovic.com/pub/libxml" target="_top">http://zlatkovic.com/pub/libxml</a>から、ソースは<a class="ulink" href="http://xmlsoft.org" target="_top">http://xmlsoft.org</a>からダウンロードできます。
libxml2はiconvを必要とすることに注意してください。
同じ場所からダウンロードできます。
     </p></dd><dt><span class="term"><span class="productname">openssl</span></span></dt><dd><p>SSLサポートのために必要です。
バイナリは<a class="ulink" href="http://www.slproweb.com/products/Win32OpenSSL.html" target="_top">http://www.slproweb.com/products/Win32OpenSSL.html</a>から、ソースは<a class="ulink" href="http://www.openssl.org" target="_top">http://www.openssl.org</a>からダウンロードできます。
     </p></dd><dt><span class="term"><span class="productname">ossp-uuid</span></span></dt><dd><p>UUID-OSSPサポート（contribのみ）で必要です。
ソースは<a class="ulink" href="http://www.ossp.org/pkg/lib/uuid/" target="_top">http://www.ossp.org/pkg/lib/uuid/</a>にあります。
     </p></dd><dt><span class="term"><span class="productname">Python</span></span></dt><dd><p><span class="application">PL/Python</span>を構築する場合に必要です。
バイナリは<a class="ulink" href="http://www.python.org" target="_top">http://www.python.org</a>からダウンロードできます。
     </p></dd><dt><span class="term"><span class="productname">zlib</span></span></dt><dd><p><span class="application">pg_dump</span>および<span class="application">pg_restore</span>における圧縮をサポートするために必要です。
バイナリは<a class="ulink" href="http://www.zlib.net" target="_top">http://www.zlib.net</a>からダウンロードできます。
     </p></dd></dl></div><p>
  </p></div><div class="sect2" id="id-1.6.4.8.9"><div class="titlepage"><div><div><h3 class="title">17.1.2. 64ビット版のWindowsにおける特別な考慮事項</h3></div></div></div><p>64ビット版Windowsにおいてx64アーキテクチャのみでPostgreSQLを構築することができます。
Itaniumプロセッサをサポートしていません。
  </p><p>同じ構築用ツリーで32ビット版と64ビット版を混在させることはサポートされません。
構築システムは32ビット環境で動作しているか64ビット環境で動作しているかを自動的に検出し、それにしたがってPostgreSQLを構築します。
このため構築作業を始める前に正しいコマンドプロンプトを開始することが重要です。
  </p><p><span class="productname">python</span>や<span class="productname">openssl</span>などのサーバサイドのサードパーティ製ライブラリを使用するためには、ライブラリも64ビット版である<span class="emphasis"><em>必要があります</em></span>。
64ビット版のサーバで32ビット版のライブラリをロードすることはサポートされていません。
PostgreSQLがサポートするサードパーティ製のライブラリで32ビット版しか利用できないものが複数あります。
こうした場合、64ビット版のPostgreSQLで使用することはできません。
  </p></div><div class="sect2" id="id-1.6.4.8.10"><div class="titlepage"><div><div><h3 class="title">17.1.3. 構築</h3></div></div></div><p>リリース条件（デフォルト）でPostgreSQLをすべて構築するためには、以下のコマンドを実行してください。
</p><pre class="screen"><strong class="userinput"><code>build</code></strong></pre><p>
デバッグ条件でPostgreSQLをすべて構築するためには、以下のコマンドを実行してください。
</p><pre class="screen"><strong class="userinput"><code>build DEBUG</code></strong></pre><p>
単一のプロジェクトのみを構築するためには、たとえばpsqlであれば、以下のコマンドを実行してください。
</p><pre class="screen"><strong class="userinput"><code>build psql</code></strong>
<strong class="userinput"><code>build DEBUG psql</code></strong></pre><p>
デバッグのためにデフォルトの構築条件を変更するためには、以下を<code class="filename">buildenv.pl</code>ファイルに記載してください。
</p><pre class="programlisting">$ENV{CONFIG}="Debug";</pre><p>
  </p><p>また、Visual Studio GUI内から構築することも可能です。
この場合はコマンドプロンプトから以下を実行しなければなりません。
</p><pre class="screen"><strong class="userinput"><code>perl mkvcbuild.pl</code></strong></pre><p>
その後に、生成された<code class="filename">pgsql.sln</code>（ソースツリーのトップディレクトリに存在します。）をVisual Studioで開いてください。
  </p></div><div class="sect2" id="id-1.6.4.8.11"><div class="titlepage"><div><div><h3 class="title">17.1.4. 整理およびインストール</h3></div></div></div><p>ほとんどの場合、Visual Studioの持つ自動依存関係追跡により変更されたファイルが扱われます。
しかし、大規模な変更が行われた場合、インストレーションを整理する必要があるかもしれません。
このためには、<code class="filename">clean.bat</code>コマンドを実行してください。
これにより、生成されたファイルがすべて自動的に消去されます。
また、<em class="parameter"><code>dist</code></em>パラメータを使用して実行することも可能です。
この場合、<strong class="userinput"><code>make distclean</code></strong>のように振舞い、flex/bisonの出力ファイルも削除します。
  </p><p>デフォルトで、すべてのファイルは<code class="filename">debug</code>または<code class="filename">release</code>ディレクトリ以下のサブディレクトリに書き出されます。
これらのファイルを標準レイアウトでインストールし、データベースの初期化や使用に必要なファイルを生成するためには、以下のコマンドを実行してください。
</p><pre class="screen"><strong class="userinput"><code>install c:\destination\directory</code></strong></pre><p>
  </p><p>クライアントアプリケーションとインタフェースライブラリだけをインストールしたいのであれば、以下のコマンドが使えます。
</p><pre class="screen"><strong class="userinput"><code>install c:\destination\directory client</code></strong></pre><p>
  </p></div><div class="sect2" id="id-1.6.4.8.12"><div class="titlepage"><div><div><h3 class="title">17.1.5. リグレッションテストの実行</h3></div></div></div><p>リグレッションテストを実行するためには、まず必要なすべての部品の構築が完了していることを確認してください。
また、システムのすべての部品で必要とするDLL（手続き言語用のPerlのDLLやPythonのDLLなど）がシステムパスに含まれていることを確認してください。
もし含まれていなければ、<code class="filename">buildenv.pl</code>ファイルを介して設定してください。
試験を実行するためには、以下のコマンドのいずれかを<code class="filename">src\tools\msvc</code>ディレクトリから実行してください。
</p><pre class="screen"><strong class="userinput"><code>vcregress check</code></strong>
<strong class="userinput"><code>vcregress installcheck</code></strong>
<strong class="userinput"><code>vcregress plcheck</code></strong>
<strong class="userinput"><code>vcregress contribcheck</code></strong>
<strong class="userinput"><code>vcregress modulescheck</code></strong>
<strong class="userinput"><code>vcregress ecpgcheck</code></strong>
<strong class="userinput"><code>vcregress isolationcheck</code></strong>
<strong class="userinput"><code>vcregress bincheck</code></strong>
<strong class="userinput"><code>vcregress recoverycheck</code></strong>
<strong class="userinput"><code>vcregress upgradecheck</code></strong></pre><p>

使用するスケジュール（デフォルトはparallelです）を変更するためには、コマンドラインに以下のように追加してください。
</p><pre class="screen"><strong class="userinput"><code>vcregress check serial</code></strong></pre><p>

リグレッションテストの詳細については<a class="xref" href="regress.html" title="Chapter 32. リグレッションテスト">Chapter 32</a>を参照してください。
  </p><p>クライアントプログラムで<code class="command">vcregress bincheck</code>によりリグレッションテストを実行したり、<code class="command">vcregress recoverycheck</code>によりリカバリテストを実行したりするには、追加のPerlモジュールをインストールしておかなければなりません。
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="productname">IPC::Run</span></span></dt><dd><p>これを書いている時点では、<code class="literal">IPC::Run</code>はActiveState PerlインストレーションにもActiveState Perl Package Manager(PPM)ライブラリにも含まれていません。
インストールするためには、<a class="ulink" href="https://metacpan.org/release/IPC-Run/" target="_top">https://metacpan.org/release/IPC-Run/</a>でCPANから<code class="filename">IPC-Run-&lt;version&gt;.tar.gz</code>ソースアーカイブをダウンロードして、展開してください。
<code class="filename">buildenv.pl</code>を編集して、取り出されたアーカイブから<code class="filename">lib</code>サブディレクトリを指すように変数PERL5LIBを追加してください。
例えば以下の通りです。
</p><pre class="programlisting">$ENV{PERL5LIB}=$ENV{PERL5LIB} . ';c:\IPC-Run-0.94\lib';</pre><p>
     </p></dd></dl></div><p>
  </p></div><div class="sect2" id="id-1.6.4.8.13"><div class="titlepage"><div><div><h3 class="title">17.1.6. 文書の構築</h3></div></div></div><p>PostgreSQLの文書をHTML書式で構築するためには、いくつかツールやファイルが必要です。
これらのファイルをすべて格納するためのトップディレクトリを作成し、以下のリストに記載したサブディレクトリに格納してください。
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">OpenJade 1.3.1-2</span></dt><dd><p><a class="ulink" href="http://sourceforge.net/projects/openjade/files/openjade/1.3.1/openjade-1_3_1-2-bin.zip/download" target="_top">http://sourceforge.net/projects/openjade/files/openjade/1.3.1/openjade-1_3_1-2-bin.zip/download</a>からダウンロードし、<code class="filename">openjade-1.3.1</code>サブディレクトリで伸長してください。
     </p></dd><dt><span class="term">DocBook DTD 4.2</span></dt><dd><p><a class="ulink" href="http://www.oasis-open.org/docbook/sgml/4.2/docbook-4.2.zip" target="_top">http://www.oasis-open.org/docbook/sgml/4.2/docbook-4.2.zip</a>からダウンロードし、<code class="filename">docbook</code>サブディレクトリで伸長してください。
     </p></dd><dt><span class="term">ISO文字エンティティ</span></dt><dd><p><a class="ulink" href="http://www.oasis-open.org/cover/ISOEnts.zip" target="_top">http://www.oasis-open.org/cover/ISOEnts.zip</a>からダウンロードし、<code class="filename">docbook</code>サブディレクトリで伸長してください。
     </p></dd></dl></div><p>
<code class="filename">buildenv.pl</code>ファイルを編集し、このトップディレクトリの場所を示す変数を追加してください。
例を示します。
</p><pre class="programlisting">$ENV{DOCROOT}='c:\docbook';</pre><p>
文書を構築するためには、<code class="filename">builddoc.bat</code>コマンドを実行してください。
これは実際にはインデックスを作成するために、2回構築を行うことに注意してください。
生成されたHTMLファイルは<code class="filename">doc\src\sgml</code>に格納されます。
  </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="install-windows.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="install-windows.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="runtime.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 17. <span class="productname">Windows</span>におけるソースコードからのインストール </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 18. サーバの準備と運用</td></tr></table></div></body></html>