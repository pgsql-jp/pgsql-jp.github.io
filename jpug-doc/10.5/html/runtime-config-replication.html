<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>19.6. レプリケーション</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="runtime-config-wal.html" title="19.5. ログ先行書き込み（WAL）" /><link rel="next" href="runtime-config-query.html" title="19.7. 問い合わせ計画" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">19.6. レプリケーション</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="runtime-config-wal.html" title="19.5. ログ先行書き込み（WAL）">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="runtime-config.html" title="Chapter 19. サーバの設定">Up</a></td><th width="60%" align="center">Chapter 19. サーバの設定</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="runtime-config-query.html" title="19.7. 問い合わせ計画">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="RUNTIME-CONFIG-REPLICATION"><div class="titlepage"><div><div><h2 class="title" style="clear: both">19.6. レプリケーション</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="runtime-config-replication.html#RUNTIME-CONFIG-REPLICATION-SENDER">19.6.1. 送出サーバ群</a></span></dt><dt><span class="sect2"><a href="runtime-config-replication.html#RUNTIME-CONFIG-REPLICATION-MASTER">19.6.2. マスターサーバ</a></span></dt><dt><span class="sect2"><a href="runtime-config-replication.html#RUNTIME-CONFIG-REPLICATION-STANDBY">19.6.3. スタンバイサーバ</a></span></dt><dt><span class="sect2"><a href="runtime-config-replication.html#RUNTIME-CONFIG-REPLICATION-SUBSCRIBER">19.6.4. サブスクライバー</a></span></dt></dl></div><p>    
     これらの設定は組み込みの<em class="firstterm">ストリーミングレプリケーション</em>機能の動作を制御します（<a class="xref" href="warm-standby.html#STREAMING-REPLICATION" title="26.2.5. ストリーミングレプリケーション">Section 26.2.5</a>を参照ください）。
      サーバ群のサーバはマスターかスタンバイのいずれかです。マスターはデータを送出する一方、複数のスタンバイは複製されたデータを常に受け取ります。カスケードレプリケーション（<a class="xref" href="warm-standby.html#CASCADING-REPLICATION" title="26.2.7. カスケードレプリケーション">Section 26.2.7</a>を参照）が使用されている場合、スタンバイサーバ群は受け取り手でもあり、送り手でもあります。
      パラメータは主として送出サーバとスタンバイサーバ用ですが、いくつかのパラメータはマスターサーバのみに効力を発します。
      必要とあればクラスターに渡って問題なく設定を変化させることができます。
    </p><div class="sect2" id="RUNTIME-CONFIG-REPLICATION-SENDER"><div class="titlepage"><div><div><h3 class="title">19.6.1. 送出サーバ群</h3></div></div></div><p>     
      これらのパラメータはレプリケーションデータを１つ、またはそれ以上複数のスタンバイサーバに送るいかなるサーバ上で設定することができます。マスターは常に送出サーバであるため、パラメータは常にマスター上に設定されなければなりません。これらのパラメータの役割と意味はスタンバイが後にマスターに昇格しても変わりません。
     </p><div class="variablelist"><dl class="variablelist"><dt id="GUC-MAX-WAL-SENDERS"><span class="term"><code class="varname">max_wal_senders</code> (<code class="type">integer</code>)
       <a id="id-1.6.6.9.3.3.1.1.3" class="indexterm"></a>
       </span></dt><dd><p>       
複数のスタンバイサーバあるいは、ストリーミングを使ったベースバックアップクライアントからの同時接続を受ける接続最大値を設定します（つまり、同時に稼動するWAL送信プロセスの最大値です）。
デフォルトは10です。
0ならば、レプリケーションは無効であるという意味になります。
WAL送出プロセスは接続の総数カウントに考慮されるため、パラメータは<a class="xref" href="runtime-config-connection.html#GUC-MAX-CONNECTIONS">max_connections</a>より大きくは設定できません。
クライアント接続が突然切断されると、タイムアウトするまで孤児接続スロットが残ってしまうかもしれません。
ですから、このパラメータは想定されるクライアント数の最大値よりも少し大きめにして、切断されたクライアントが直ちに再接続できるようにした方が良いでしょう。
このパラメータはサーバ起動時のみ設定可能です。
スタンバイサーバからの接続を許可するには、<code class="varname">wal_level</code>を<code class="literal">replica</code>以上に設定しておかなければなりません。
       </p></dd><dt id="GUC-MAX-REPLICATION-SLOTS"><span class="term"><code class="varname">max_replication_slots</code> (<code class="type">integer</code>)
       <a id="id-1.6.6.9.3.3.2.1.3" class="indexterm"></a>
       </span></dt><dd><p>サーバが使用できるレプリケーションスロット(<a class="xref" href="warm-standby.html#STREAMING-REPLICATION-SLOTS" title="26.2.6. レプリケーションスロット">Section 26.2.6</a>参照)の最大数を指定します。
デフォルトは10です。
このパラメータはサーバ起動時のみ設定可能です。
レプリケーションスロットが使用できるためには、<code class="varname">wal_level</code>を<code class="literal">replica</code>以上に設定しなければなりません。
現在存在しているレプリケーションスロットの数よりも少ない値を設定すると、サーバは起動しません。
        </p></dd><dt id="GUC-WAL-KEEP-SEGMENTS"><span class="term"><code class="varname">wal_keep_segments</code> (<code class="type">integer</code>)
       <a id="id-1.6.6.9.3.3.3.1.3" class="indexterm"></a>
       </span></dt><dd><p>       
ストリーミングレプリケーションにおいて、スタンバイサーバが過去のファイルセグメントを取得する必要がある場合に備え、<code class="filename">pg_wal</code>ディレクトリに保持しておくファイルセグメント数の最小値を指定します。
それぞれのセグメントは通常16メガバイトです。
もし送出サーバに接続しているスタンバイサーバが<code class="varname">wal_keep_segments</code>セグメントを越えて遅延した場合、送出サーバはスタンバイサーバが今後とも必要とするWALセグメントを削除する可能性があります。
この場合、レプリケーション接続は終了させられます。結果として下流に対する接続も結局は終了されることがあります。（しかし、WALアーカイブが使用されていれば、スタンバイサーバはアーカイブからセグメントを取り出し、復旧することができます。）
       </p><p>       
<code class="filename">pg_wal</code>に保持され続けるセグメントの最小値のみを設定します。
システムはWALアーカイブのため、またはチェックポイントからの復旧のため、より多くのセグメント保持が必要となることがあります。
もし<code class="varname">wal_keep_segments</code>が（デフォルトの）ゼロの場合、システムはスタンバイサーバのために追加セグメントを保持することはしません。
従って、スタンバイサーバが使用できる古いWALセグメントの数は、直前のチェックポイントの場所とWALアーカイブの状況によって算出されます。
このパラメータは、<code class="filename">postgresql.conf</code>ファイル、もしくはサーバコマンドラインでのみ設定可能です。
       </p></dd><dt id="GUC-WAL-SENDER-TIMEOUT"><span class="term"><code class="varname">wal_sender_timeout</code> (<code class="type">integer</code>)
      <a id="id-1.6.6.9.3.3.4.1.3" class="indexterm"></a>
      </span></dt><dd><p>       
       指定されたミリ秒単位の値より長く非活動のレプリケーション接続を停止します。
       スタンバイサーバのクラッシュ、またはネットワークの停止を送出サーバが検出することにこれが役立ちます。
       値ゼロはタイムアウト機能を無効にします。
       このパラメータは、<code class="filename">postgresql.conf</code>ファイル、もしくはサーバコマンドラインでのみ設定可能です。
       デフォルトの値は60秒です。
       </p></dd><dt id="GUC-TRACK-COMMIT-TIMESTAMP"><span class="term"><code class="varname">track_commit_timestamp</code> (<code class="type">boolean</code>)
      <a id="id-1.6.6.9.3.3.5.1.3" class="indexterm"></a>
      </span></dt><dd><p>トランザクションのコミットタイムを記録します。
このパラメータは、<code class="filename">postgresql.conf</code>ファイル、もしくはサーバコマンドラインでのみ設定可能です。
デフォルトは<code class="literal">off</code>です。
       </p></dd></dl></div></div><div class="sect2" id="RUNTIME-CONFIG-REPLICATION-MASTER"><div class="titlepage"><div><div><h3 class="title">19.6.2. マスターサーバ</h3></div></div></div><p>      
      これらのパラメータはレプリケーションデータを１つ、またはそれ以上複数のスタンバイサーバに送るマスター/プライマリサーバ上で設定することができます。
      これらパラメータに加え、<a class="xref" href="runtime-config-wal.html#GUC-WAL-LEVEL">wal_level</a>はマスターサーバ上で適切に設定される必要があり、オプションとしてWALアーカイブを有効にしてもかまいません（<a class="xref" href="runtime-config-wal.html#RUNTIME-CONFIG-WAL-ARCHIVING" title="19.5.3. アーカイビング">Section 19.5.3</a>を参照してください）。
      スタンバイサーバがマスターサーバになるかもしれない状況に備え、それらのパラメータをスタンバイサーバで設定したいと考えたとしても、スタンバイサーバ上でのパラメータの値は意味をなしません。
     </p><div class="variablelist"><dl class="variablelist"><dt id="GUC-SYNCHRONOUS-STANDBY-NAMES"><span class="term"><code class="varname">synchronous_standby_names</code> (<code class="type">string</code>)
      <a id="id-1.6.6.9.4.3.1.1.3" class="indexterm"></a>
      </span></dt><dd><p><a class="xref" href="warm-standby.html#SYNCHRONOUS-REPLICATION" title="26.2.8. 同期レプリケーション">Section 26.2.8</a>で説明されているように、<em class="firstterm">同期レプリケーション</em>をサポート可能なスタンバイサーバのリストを指定します。
活動中の同期スタンバイサーバは1つまたはそれ以上です。
コミットを待機しているトランザクションは、このスタンバイサーバがそのデータの受信を確認してから処理の継続が許可されます。
同期スタンバイサーバはこのリストに名前が挙げられていており、現時点で接続され、そしてデータをリアルタイムでストリーミングしているものです（<a class="link" href="monitoring-stats.html#PG-STAT-REPLICATION-VIEW" title="Table 28.5. pg_stat_replicationビュー"><code class="literal">pg_stat_replication</code></a> ビューにおいて<code class="literal">streaming</code>状態として示されています）。
このリストの後の方に記載されているその他のスタンバイサーバは潜在的に同期スタンバイサーバになることを示しています。
二つ以上の同期スタンバイサーバ名を指定することで、かなりの高可用性とデータ損失に対する保護が得られます。
       </p><p>この目的のためのスタンバイサーバ名は、スタンバイの接続情報で指定された、スタンバイの<code class="varname">application_name</code>設定です。
物理レプリケーションスタンバイでは、<code class="filename">recovery.conf</code>中の<code class="varname">primary_conninfo</code>設定です。
デフォルトは<code class="literal">walreceiver</code>です。
論理レプリケーションでは、サブスクリプションの接続情報でで設定でき、デフォルトはサブスクリプション名です。
それ以外のレプリケーションストリームコンシューマーについては、それぞれのドキュメントをご覧ください。
       </p><p>このパラメータは、以下の構文のいずれかを用いてスタンバイサーバのリストを指定します。
</p><pre class="synopsis">[FIRST] <em class="replaceable"><code>num_sync</code></em> ( <em class="replaceable"><code>standby_name</code></em> [, ...] )
ANY <em class="replaceable"><code>num_sync</code></em> ( <em class="replaceable"><code>standby_name</code></em> [, ...] )
<em class="replaceable"><code>standby_name</code></em> [, ...]</pre><p>
ここで、<em class="replaceable"><code>num_sync</code></em>は、トランザクションが応答を待機する必要のある同期スタンバイの数です。
<em class="replaceable"><code>standby_name</code></em>は、スタンバイサーバの名前です。
<code class="literal">FIRST</code>と<code class="literal">ANY</code>は、リスト中のサーバーから同期スタンバイを選ぶ方法を指定します。
       </p><p>キーワード<code class="literal">FIRST</code>を<em class="replaceable"><code>num_sync</code></em>と組み合わせると、優先度に基づく同期レプリケーションを指定し、優先度に基づいて選ばれた<em class="replaceable"><code>num_sync</code></em>個の同期スタンバイにWALレコードがレプリケーションされるまで、トランザクションのコミットは待機します。
たとえば<code class="literal">FIRST 3 (s1, s2, s3, s4)</code>とすると、<code class="literal">s1</code>、<code class="literal">s2</code>、<code class="literal">s3</code>、<code class="literal">s4</code>の中から選ばれた優先順位の高い3つのスタンバイサーバが応答を返すまでコミットは待機します。
リストの中で前の方に名前が出現するスタンバイには高い優先度が与えられ、同期と見なされます。
それ以外のリストの中で後の方に名前が上がっているスタンバイサーバーは、潜在的な同期スタンバイであることを表しています。
どんな理由であれ、現在の同期スタンバイが切断されると、次に高い優先度を持つスタンバイに直ちに取って代わられます。
キーワード<code class="literal">FIRST</code>はオプションです。
       </p><p>キーワード<code class="literal">ANY</code>と組わせると、<em class="replaceable"><code>num_sync</code></em>はクォーラムに基づく同期レプリケーションを指定し、優先度に基づいて選ばれた<span class="emphasis"><em>少なくとも</em></span><em class="replaceable"><code>num_sync</code></em>個の同期スタンバイにWALレコードがレプリケーションされるまで、トランザクションのコミットを待たせます。
たとえば<code class="literal">ANY 3 (s1, s2, s3, s4)</code>とすると、<code class="literal">s1</code>、<code class="literal">s2</code>、<code class="literal">s3</code>の3つのうちのどれかが応答を返した時点でコミットが進行します。
       </p><p><code class="literal">FIRST</code>と<code class="literal">ANY</code>は、大文字小文字を区別しません。
もしこれらのキーワードをスタンバイサーバの名前に使う場合は、<em class="replaceable"><code>standby_name</code></em>は二重引用符で囲わなければなりません。
       </p><p>3番目の構文は、<span class="productname">PostgreSQL</span>9.6よりも前のバージョンで用いられていたもので、依然としてサポートされています。
最初の構文で、<code class="literal">FIRST</code>、<em class="replaceable"><code>num_sync</code></em>を1とした時と同じです。
たとえば、<code class="literal">FIRST 1 (s1, s2)</code>と<code class="literal">s1, s2</code>は同じ意味です。
<code class="literal">s1</code>か<code class="literal">s2</code>が同期スタンバイとして選ばれます。
       </p><p>特別なエントリ<code class="literal">*</code>は、すべてのスタンバイ名に一致します。
       </p><p>スタンバイの一意性を強要する仕組みはありません。
重複があった場合、一致したスタンバイは優先順位が高いと見なされますが、どれが選ばれるかは非決定的です。
        </p><div class="note"><h3 class="title">Note</h3><p>各々の<em class="replaceable"><code>standby_name</code></em>は、<code class="literal">*</code>である場合を除き、SQL識別子の形式を取らなければなりません。
二重引用符を用いることもできます。
しかし、二重引用符の有無に関わらず、<em class="replaceable"><code>standby_name</code></em>とスタンバイのアプリケーション名の比較は、大文字小文字の区別なしに行われることに注意してください。
        </p></div><p>       
       ここに同期スタンバイ名が指定されていない場合、同期レプリケーションは有効とはならず、トランザクションコミットはレプリケーションを待機しません。これがデフォルトの設定です。同期レプリケーションが有効であっても、<a class="xref" href="runtime-config-wal.html#GUC-SYNCHRONOUS-COMMIT">synchronous_commit</a>パラメータを<code class="literal">local</code> または <code class="literal">off</code>に設定することにより、個別のトランザクションをレプリケーションに対して待機しないように設定できます。
       </p><p>       
       このパラメータは、<code class="filename">postgresql.conf</code>ファイル、もしくはサーバコマンドラインでのみ設定可能です。
       </p></dd><dt id="GUC-VACUUM-DEFER-CLEANUP-AGE"><span class="term"><code class="varname">vacuum_defer_cleanup_age</code> (<code class="type">integer</code>)
      <a id="id-1.6.6.9.4.3.2.1.3" class="indexterm"></a>
      </span></dt><dd><p>       
<code class="command">VACUUM</code> および <acronym class="acronym">HOT</acronym>更新が不要行バージョンの回収を決めるのを延期するトランザクションの数を指定します。
デフォルトはゼロトランザクションで、つまり、開いている全てのトランザクションから不可視になった不要行バージョンは速やかに削除されうることを意味します。
<a class="xref" href="hot-standby.html" title="26.5. ホットスタンバイ">Section 26.5</a>に記載されているように、ホットスタンバイサーバをサポートしている場合、プライマリサーバ上で非ゼロ値に設定したい場合があります。
そうすることで、スタンバイ上での問い合わせが、行の早期回収によるコンフリクトを被ることなく完了するように時間を与えます。
しかし、値はプライマリーサーバ上で発生している書き込みトランザクションの観点から計測されるため、スタンバイの問い合わせにたいして猶予時間がどのくらい有効となるかは予測できません。
このパラメータは、<code class="filename">postgresql.conf</code>ファイル、もしくはサーバコマンドラインでのみ設定可能です。
       </p><p>       
このパラメータを使う代わりにスタンバイサーバ上に <code class="varname">hot_standby_feedback</code>の設定を考慮する必要もあります。
       </p><p><code class="varname">old_snapshot_threshold</code>で指定された年齢に達した無効行のクリーンアップを妨げることはありません。
       </p></dd></dl></div></div><div class="sect2" id="RUNTIME-CONFIG-REPLICATION-STANDBY"><div class="titlepage"><div><div><h3 class="title">19.6.3. スタンバイサーバ</h3></div></div></div><p>     
      これらの設定はレプリケーションデータを受け取るスタンバイサーバの動作を管理します。
      マスターサーバ上のこれらの値は無意味です。
     </p><div class="variablelist"><dl class="variablelist"><dt id="GUC-HOT-STANDBY"><span class="term"><code class="varname">hot_standby</code> (<code class="type">boolean</code>)
      <a id="id-1.6.6.9.5.3.1.1.3" class="indexterm"></a>
      </span></dt><dd><p>       
       <a class="xref" href="hot-standby.html" title="26.5. ホットスタンバイ">Section 26.5</a>に記載されている通り、リカバリの最中に接続し、そして問い合わせを実行できるか否かを設定します。デフォルト値は<code class="literal">on</code>です。
       このパラメータはサーバ起動時のみ設定可能です。これは、アーカイブリカバリ期間、又はスタンバイモードにある場合にのみ効果をもたらします。
       </p></dd><dt id="GUC-MAX-STANDBY-ARCHIVE-DELAY"><span class="term"><code class="varname">max_standby_archive_delay</code> (<code class="type">integer</code>)
      <a id="id-1.6.6.9.5.3.2.1.3" class="indexterm"></a>
      </span></dt><dd><p>       
ホットスタンバイが稼動している場合、このパラメータは<a class="xref" href="hot-standby.html#HOT-STANDBY-CONFLICT" title="26.5.2. 問い合わせコンフリクトの処理">Section 26.5.2</a>で記載されているように、まさに適用されようとしているWALエントリと衝突するスタンバイサーバの問い合わせをキャンセルするにはどれだけ待機しなければならないかを設定します。
<code class="varname">max_standby_archive_delay</code>はWALデータをWALアーカイブ（すなわち最新ではありません）から読み込んでいる時に適用されます。
デフォルトは30秒です。
特に指定が無ければ単位はミリ秒です。
値-1は衝突する問い合わせが完了するまでスタンバイサーバが待ち続けられるようにします。
このパラメータは、<code class="filename">postgresql.conf</code>ファイル、もしくはサーバコマンドラインでのみ設定可能です。
       </p><p>       
<code class="varname">max_standby_archive_delay</code>はキャンセル前に問い合わせが実行できる最大の時間の長さと同じでないことに注意してください。
むしろ、任意の１つのWALセグメントのデータの適用のために許される最大合計時間です。
従って、ある問い合わせによりWALセグメント内の前の部分で大幅な遅延となった場合、その後の衝突する問い合わせの猶予時間はずっと短くなります。
       </p></dd><dt id="GUC-MAX-STANDBY-STREAMING-DELAY"><span class="term"><code class="varname">max_standby_streaming_delay</code> (<code class="type">integer</code>)
      <a id="id-1.6.6.9.5.3.3.1.3" class="indexterm"></a>
      </span></dt><dd><p>       
ホットスタンバイが稼動している場合、このパラメータは<a class="xref" href="hot-standby.html#HOT-STANDBY-CONFLICT" title="26.5.2. 問い合わせコンフリクトの処理">Section 26.5.2</a>で記載されているように、まさに適用されようとしているWALエントリと衝突するスタンバイサーバの問い合わせをキャンセルするにはどれだけ待機しなければならないかを設定します。
<code class="varname">max_standby_streaming_delay</code>はWALデータをストリーミングレプリケーションから受け取っている時に適用されます。
デフォルトは30秒です。
特に指定が無ければ単位はミリ秒です。
値-1は衝突する問い合わせが完了するまでスタンバイサーバが待ち続けられるようにします。
このパラメータは、<code class="filename">postgresql.conf</code>ファイル、もしくはサーバコマンドラインでのみ設定可能です。
       </p><p>       
<code class="varname">max_standby_streaming_delay</code>はキャンセル前に問い合わせが実行できる最大の時間の長さと同じでないことに注意してください。
むしろ、プライマリサーバから一度受け取られたWALデータを適用するために許される最大合計時間です。
従って、ある問い合わせが大幅な遅延を起こした場合、その後の衝突する問い合わせは、スタンバイサーバがふたたび遅れを取り戻すまでの間、猶予時間はずっと短くなります。
       </p></dd><dt id="GUC-WAL-RECEIVER-STATUS-INTERVAL"><span class="term"><code class="varname">wal_receiver_status_interval</code> (<code class="type">integer</code>)
      <a id="id-1.6.6.9.5.3.4.1.3" class="indexterm"></a>
      </span></dt><dd><p>      
スタンバイサーバ上のWAL受信プロセスがプライマリー、または上位サーバに対してレプリケーションの進捗情報を送信する最小頻度を指定します。
送信された進捗情報は<a class="link" href="monitoring-stats.html#PG-STAT-REPLICATION-VIEW" title="Table 28.5. pg_stat_replicationビュー"><code class="literal">pg_stat_replication</code></a>ビューにより確認することが可能です。
スタンバイサーバは書き込みがされた直近の先行書き込みログ位置、ディスクにフラッシュされた直近のログ位置、およびリカバリ適用された直近のログ位置を報告します。
このパラメータの値がそれぞれの報告間における秒単位の最大の時間間隔です。
書き込み、またはフラッシュ位置が変更される毎、あるいは最低でもこのパラメータで設定された頻度で更新情報が送信されます。
従って、適用位置は真の位置よりも少し後ろにずれることがあります。
このパラメータをゼロに設定すると、ステータスの更新を完全に無効化します。
このパラメータは、<code class="filename">postgresql.conf</code>ファイル、もしくはサーバコマンドラインでのみ設定可能です。
デフォルトの値は10秒です。
      </p></dd><dt id="GUC-HOT-STANDBY-FEEDBACK"><span class="term"><code class="varname">hot_standby_feedback</code> (<code class="type">boolean</code>)
      <a id="id-1.6.6.9.5.3.5.1.3" class="indexterm"></a>
      </span></dt><dd><p>       
       ホットスタンバイがスタンバイサーバ上で現在処理を行っている問い合わせについて、プライマリーまたは上位サーバにフィードバックを送るか否かを指定します。
       このパラメータはレコードの回収に起因する問い合わせの取り消しを排除するために使用することができます。
       しかし、いくつかのワークロードに対してはプライマリーサーバ上でのデータベース肥大の原因となります。
       フィードバックメッセージは<code class="varname">wal_receiver_status_interval</code>毎に、2回以上送信されません。
       デフォルトの値は<code class="literal">off</code>です。
        このパラメータは、<code class="filename">postgresql.conf</code>ファイル、もしくはサーバコマンドラインでのみ設定可能です。
       </p><p>       
       カスケードレプリケーションが使用されている場合、フィードバックは最終的にプライマリーに到達するまで上位サーバに転送されます。スタンバイは上位に転送する以外、受け取ったフィードバックを他に使用しません。
       </p><p>この設定は、プライマリの<code class="varname">old_snapshot_threshold</code>の挙動を上書きしません。
プライマリの年齢上限を超えたスタンバイ上のスナップショットは無効となる可能性があり、その場合スタンバイにおいてトランザクションのキャンセルを引き起こします。
これは、<code class="varname">old_snapshot_threshold</code>が、無効行によってデータ溢れが起こる時刻の絶対的な制限を提供することを意図しているからです。
そうでなければ、スタンバイの設定によってこの目的は成立しなくなってしまいます。
       </p></dd><dt id="GUC-WAL-RECEIVER-TIMEOUT"><span class="term"><code class="varname">wal_receiver_timeout</code> (<code class="type">integer</code>)
      <a id="id-1.6.6.9.5.3.6.1.3" class="indexterm"></a>
      </span></dt><dd><p>       
指定されたミリ秒より長い間、活動していないレプリケーション接続は停止します。
このことは受信するスタンバイサーバがプライマリノードの機能停止、またはネットワーク停止を検出するのに便利です。
値ゼロは時間切れメカニズムを無効にします。
このパラメータは<code class="filename">postgresql.conf</code>ファイルまたはサーバのコマンドラインのみで設定可能です。
デフォルト値は60秒です。
       </p></dd><dt id="GUC-WAL-RETRIEVE-RETRY-INTERVAL"><span class="term"><code class="varname">wal_retrieve_retry_interval</code> (<code class="type">integer</code>)
      <a id="id-1.6.6.9.5.3.7.1.3" class="indexterm"></a>
      </span></dt><dd><p>WALデータがソース(ストリーミングレプリケーション、ローカルの<code class="filename">pg_wal</code>、またはWALアーカイブ)から取得できない時に、スタンバイサーバがWALデータ受信をリトライするまでにどの位の時間待つべきかを指定します。
このパラメータは、<code class="filename">postgresql.conf</code>ファイル、もしくはサーバコマンドラインでのみ設定可能です。
デフォルト値は5秒です。
特に指定がなければ単位はミリ秒です。
       </p><p>このパラメータは、リカバリ対象のノードにおいて、新しいWALデータが読み込み可能になるまでの待ち時間を制御する必要のある時に有用です。
たとえば、アーカイブリカバリにおいては、このパラメータの値を小さくすることにより、新しいWALログファイルを検出する際にリカバリの応答を早くすることができます。
WALの生成頻度が少ないシステムでは、この値を大きくすることにより、WALアーカイブへのアクセス頻度を減らすことができます。
これは、たとえば基盤へのアクセス回数が課金対象になるクラウド環境において、有用です。
       </p></dd></dl></div></div><div class="sect2" id="RUNTIME-CONFIG-REPLICATION-SUBSCRIBER"><div class="titlepage"><div><div><h3 class="title">19.6.4. サブスクライバー</h3></div></div></div><p>これらの設定項目は、論理レプリケーションのサブスクライバーの挙動を制御します。
パブリッシャーにおける設定値とは無関係です。
     </p><p><code class="varname">wal_receiver_timeout</code>、<code class="varname">wal_receiver_status_interval</code>そして<code class="varname">wal_retrieve_retry_interval</code>設定パラメータは、論理レプリケーションワーカーにも影響することに注意してください。
     </p><div class="variablelist"><dl class="variablelist"><dt id="GUC-MAX-LOGICAL-REPLICATION-WORKERS"><span class="term"><code class="varname">max_logical_replication_workers</code> (<code class="type">int</code>)
      <a id="id-1.6.6.9.6.4.1.1.3" class="indexterm"></a>
      </span></dt><dd><p>論理レプリケーションワーカーの最大数を指定します。
適用ワーカーと、テーブル同期ワーカーの両方が含まれます。
       </p><p>論理レプリケーションワーカーは、<code class="varname">max_worker_processes</code>で定義されたプールから取得されます。
       </p><p>デフォルト値は4です。
       </p></dd><dt id="GUC-MAX-SYNC-WORKERS-PER-SUBSCRIPTION"><span class="term"><code class="varname">max_sync_workers_per_subscription</code> (<code class="type">integer</code>)
      <a id="id-1.6.6.9.6.4.2.1.3" class="indexterm"></a>
      </span></dt><dd><p>サブスクリプションごとの同期ワーカーの最大数です。
このパラメータは、サブスクリプションの初期化中、あるいは新しいテーブルが追加されたときの初期データコピーの並列度を制御します。
       </p><p>今のところ、一つのテーブルにつき、同期ワーカーは一つだけです。
       </p><p>同期ワーカーは、<code class="varname">max_logical_replication_workers</code>で定義されたプールから取得されます。
       </p><p>デフォルト値は2です。
       </p></dd></dl></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="runtime-config-wal.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="runtime-config.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="runtime-config-query.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">19.5. ログ先行書き込み（WAL） </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 19.7. 問い合わせ計画</td></tr></table></div></body></html>