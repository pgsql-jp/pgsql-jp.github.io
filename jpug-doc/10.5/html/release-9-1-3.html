<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>E.124. リリース9.1.3</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="release-9-1-4.html" title="E.123. リリース9.1.4" /><link rel="next" href="release-9-1-2.html" title="E.125. リリース9.1.2" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">E.124. リリース9.1.3</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="release-9-1-4.html" title="E.123. リリース9.1.4">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="release.html" title="Appendix E. リリースノート">Up</a></td><th width="60%" align="center">Appendix E. リリースノート</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="release-9-1-2.html" title="E.125. リリース9.1.2">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="RELEASE-9-1-3"><div class="titlepage"><div><div><h2 class="title" style="clear: both">E.124. リリース9.1.3</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="release-9-1-3.html#id-1.11.6.128.4">E.124.1. バージョン9.1.3への移行</a></span></dt><dt><span class="sect2"><a href="release-9-1-3.html#id-1.11.6.128.5">E.124.2. 変更点</a></span></dt></dl></div><p><strong>リリース日: </strong>2012-02-27</p><p>このリリースは9.1.2に対し、各種不具合を修正したものです。
9.1メジャーリリースにおける新機能については<a class="xref" href="release-9-1.html" title="E.127. リリース9.1">Section E.127</a>を参照してください。
  </p><div class="sect2" id="id-1.11.6.128.4"><div class="titlepage"><div><div><h3 class="title">E.124.1. バージョン9.1.3への移行</h3></div></div></div><p>9.1.Xからの移行ではダンプ/リストアは不要です。
   </p><p>しかしながら、9.1.2より前のバージョンからアップグレードする場合は、<a class="xref" href="release-9-1-2.html" title="E.125. リリース9.1.2">Section E.125</a>を参照してください。
   </p></div><div class="sect2" id="id-1.11.6.128.5"><div class="titlepage"><div><div><h3 class="title">E.124.2. 変更点</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="command">CREATE TRIGGER</code>においてトリガ関数に対する実行権限が必要になりました。(Robert Haas)
     </p><p>この検査が無かったため、別のユーザが自身が所有するテーブルにその関数をインストールすることで、偽造した入力データでトリガ関数を実行することができました。
<code class="literal">SECURITY DEFINER</code>が付いたトリガ関数でのみ重大です。
その他のトリガ関数ではとにかくテーブル所有者として実行されるためです。(CVE-2012-0866)
     </p></li><li class="listitem"><p>SSL証明書内のコモンネームにおける独断的な長さ制限を取り除きました。(Heikki Linnakangas)
     </p><p><span class="application">libpq</span>とサーバの両方ともSSL証明書から取り出したコモンネームを32バイトで切り詰めていました。
通常想定外の検証エラー以上のことを引き起こしませんが、ある証明書の所有者が他者になりすますことができるという、多少怪しいシナリオがあります。
被害を受けるにはコモンネームが正確に32バイト長でなければならず、また、攻撃者は信頼されたCAに対してコモンネームが接頭辞としてその文字列を持つ証明書を発行するように説得しなければなりません。
またサーバになりすますには、さらにクライアントからの接続を中継するための攻撃が必要です。(CVE-2012-0867)
     </p></li><li class="listitem"><p><span class="application">pg_dump</span>のコメントに記述された名前の中の改行を空白に変換します。(Robert Haas)
     </p><p><span class="application">pg_dump</span>は、その出力スクリプトにおけるSQLコメント内で発行されるオブジェクト名のサニタイズに関して注意を払っていませんでした。
改行を含む名前は少なくともそのスクリプトを構文的に不正にさせます。
悪意をもって組み立てられたオブジェクト名によって、スクリプトがリロードする時にSQLインジェクションの危険性があり得ました。(CVE-2012-0868)
     </p></li><li class="listitem"><p>バキューム処理と同時に挿入を行った場合のbtreeインデックス破損を修正しました。(Tom Lane)
     </p><p>挿入によって発生するインデックスページ分割によって、同時実行中の<code class="command">VACUUM</code>が削除すべきインデックス項目を削除し損なうことが時々発生することがありました。
対応するテーブル行が削除された後、対応先が無いインデックス項目によってエラー（<span class="quote">“<span class="quote">could not read block N in file ...</span>”</span>など）、最悪は、解放されたテーブル位置に再挿入された関係がない行にちなんだ、警告のない間違った問い合わせ結果が引き起こされます。
この不具合は8.2から存在していましたが、あまり頻発に発生しませんでしたので、これまで究明されませんでした。
使用中のデータベースで発生していたのではと疑わしければ、対象のインデックスを再インデックス付けすることで修正されます。
     </p></li><li class="listitem"><p>WAL再生中の一時的な共有バッファのゼロ化を修正しました。(Tom Lane)
     </p><p>再生ロジックでは時々共有バッファをゼロ化し再度書き込んでいました。
このためその内容は一時的に無効になります。
ホットスタンバイモードではこの結果、並行して実行される問い合わせがゴミデータを参照することになり得ました。
いろいろな兆候が現れますが、もっとも良くある兆候は<span class="quote">“<span class="quote">invalid memory alloc request size</span>”</span>です。
     </p></li><li class="listitem"><p><code class="literal">READ COMMITTED</code>再検査において、データを変更する<code class="literal">WITH</code>副計画の取り扱いを修正しました。(Tom Lane)
     </p><p><code class="command">INSERT</code>/<code class="command">UPDATE</code>/<code class="command">DELETE</code>を含む<code class="literal">WITH</code>は、<code class="literal">READ COMMITTED</code>モードにおける同時更新のために、親の<code class="command">UPDATE</code>または<code class="command">DELETE</code>コマンドが１つ以上の行を再評価しなければならない場合に、クラッシュしました。
     </p></li><li class="listitem"><p>SSIトランザクションの整理における境界問題を修正しました。(Dan Ports)
     </p><p>読み書きのあるシリアライザブルトランザクションを完了させるときに、残存する有効なシリアライザブルトランザクションがすべて読み取り専用であった場合にクラッシュすることがありました。
     </p></li><li class="listitem"><p>ホットスタンバイのクラッシュの後、postmasterの再起動を試みるように修正しました。(Tom Lane)
     </p><p>ホットスタンバイモードで操作している時に任意のバックエンドプロセスがクラッシュした場合、ロジックエラーのため、クラスタを再起動させようとはせずにpostmasterを終了させました。
     </p></li><li class="listitem"><p>最近更新された行によって所有されるTOAST値に対する<code class="command">CLUSTER</code>/<code class="command">VACUUM FULL</code>の取り扱いを修正しました。(Tom Lane)
     </p><p>この見落としにより、これらのコマンドのいずれかを実行している時に、TOASTテーブルのインデックスに対して<span class="quote">“<span class="quote">duplicate key value violates unique constraint</span>”</span>エラーが報告されることがあり得ました。
     </p></li><li class="listitem"><p>テーブル所有者を変更する時に、テーブル単位の権限だけではなく列単位の権限も更新します。(Tom Lane)
     </p><p>この失敗は、事前に付与された列権限が古い所有者により付与されたものとして表示されることを意味します。
つまり新しい所有者またはスーパーユーザであってもテーブル所有者を追跡できなくなった権限を取り除くことができないことを意味します。
     </p></li><li class="listitem"><p><code class="command">REASSIGN OWNED</code>において外部データラッパおよび外部サーバをサポートします。(Alvaro Herrera)
     </p><p>これらのオブジェクトの所有権を変更しなければならなかった場合に、このコマンドは<span class="quote">“<span class="quote">unexpected classid</span>”</span>エラーで失敗しました。
     </p></li><li class="listitem"><p><code class="command">ALTER USER/DATABASE SET</code>における一部の設定で存在しない値を許可します。 (Heikki Linnakangas)
     </p><p><code class="varname">default_text_search_config</code>、<code class="varname">default_tablespace</code>、<code class="varname">temp_tablespaces</code>を未知の名前に設定することができます。
これらが実際に使用されている別のデータベースでは既知であるかもしれませんし、またテーブル空間の場合はまだテーブル空間が作成されていないかもしれないからです。
過去<code class="varname">search_path</code>においても同じ問題がありましたが、これらの設定も同様に動作するようにしました。
     </p></li><li class="listitem"><p><code class="command">INSERT</code>式内の<code class="literal">COLLATE</code>により引き起こる<span class="quote">“<span class="quote">unsupported node type</span>”</span>エラーを修正しました。(Tom Lane)
     </p></li><li class="listitem"><p>コミット後のテーブルファイルの削除に問題があった場合のクラッシュを防止します。(Tom Lane)
     </p><p>テーブル削除は、そのトランザクションがコミットした後にのみ背後のディスク上のファイルを削除しなければなりません。
（例えばファイルの権限の誤設定のため）失敗した場合、トランザクションをアボートするには遅すぎますので、コードは単に警告メッセージを出力し継続するものと考えられます。
リリース8.4においてこのロジックが壊れ、こうした状況でPANICが発生し、再起動できないデータベースとなりました。
     </p></li><li class="listitem"><p><code class="command">DROP TABLESPACE</code>のWAL再生中に発生したエラーから修復します。(Tom Lane)
     </p><p>再生はテーブル空間ディレクトリの削除を試みますが、（対象ディレクトリの所有者や権限が不正であったなど）失敗する可能性は多々あります。
これまでは再生コードはパニックし、手作業を介さなければ再起動できないデータベースになりました。
ディレクトリの削除に失敗したところで多少ディスク領域が無駄に使われるだけですので、問題を記録し、継続する方がより良いと考えました。
     </p></li><li class="listitem"><p>ホットスタンバイのAccessExclusiveLocksのログ記録における競合問題を修正しました。(Simon Riggs)
     </p><p>ロックが<span class="quote">“<span class="quote">transaction zero</span>”</span>によって保持されていると記録されることが時々ありました。
少なくともスレーブサーバでアサーションエラーが発生することが分かっていますが、もっと深刻な問題が起こる可能性があります。
     </p></li><li class="listitem"><p>WAL再生中にOIDカウンタを、たとえ周回していたとしても、正しく追跡します。(Tom Lane)
     </p><p>これまでは、OIDカウンタはシステムが再生モードを抜けるまで高値のままになりました。
実際にはほとんどnilという結果になりますが、マスタに昇格されるスタンバイサーバでは、値が必要になってから、OIDカウンタを合理的な値まで進めるために長時間かかる可能性がありました。
     </p></li><li class="listitem"><p>クラッシュリカバリの最初の、誤解を招く<span class="quote">“<span class="quote">consistent recovery state reached</span>”</span>ログメッセージの発行を抑制します。(Heikki Linnakangas)
     </p></li><li class="listitem"><p><code class="structname">pg_stat_replication</code>.<code class="structfield">replay_location</code>の初期値を修正しました。(Fujii Masao)
     </p><p>これまでは、少なくとも1つのWALレコードが再生されるまで、表示される値は間違っていました。
     </p></li><li class="listitem"><p><code class="literal">*</code>が付いた正規表現の後方参照を修正しました。(Tom Lane)
     </p><p>コードでは、正確な文字列一致を強制せずに、実質後方参照シンボルで参照されるパターン副式を満たす任意の文字列を受け付けました。
     </p><p>同様の問題はまだ、直接量指定子のサブジェクトとならない、より大きく量化された式に埋め込まれた後方参照でも残っています。
こちらは将来のリリースの<span class="productname">PostgreSQL</span>で対応予定です。
     </p></li><li class="listitem"><p><code class="type">inet</code>/<code class="type">cidr</code>値の処理に最近入ったメモリリークを修正しました。(Heikki Linnakangas)
     </p><p>2011年12月の<span class="productname">PostgreSQL</span>リリース内のパッチによって、これらの操作にメモリリークが発生しました。
これらの列に対するbtreeインデックス等で重大な問題になる可能性がありました。
     </p></li><li class="listitem"><p><code class="literal">UNION ALL</code>を通してインデックス式制限をプッシュダウンするプランナの機能を修正しました。(Tom Lane)
     </p><p>9.1.2において別の問題を修正する際に、この種の最適化が意図せず無効になりました。
     </p></li><li class="listitem"><p>継承テーブルに対する<code class="command">UPDATE</code>/<code class="command">DELETE</code>において参照される<code class="literal">WITH</code>句の計画作成を修正しました。(Tom Lane)
     </p><p>この不具合により<span class="quote">“<span class="quote">could not find plan for CTE</span>”</span>失敗が発生しました。
     </p></li><li class="listitem"><p><code class="literal">column IN (...)</code>インデックス条件を扱うためのGINコスト推定を修正しました。(Marti Raudsepp)
     </p><p>この見落としにより、こうした条件がGINインデックスを用いて使用される場合によくクラッシュするようになりました。
     </p></li><li class="listitem"><p>既存のセッションが開いたままの失敗トランザクションを持つ場合のアサーション失敗を防止します。
     </p><p>この不具合は、アサートが有効ではない通常の構築では影響はありません。
     </p></li><li class="listitem"><p>SQL言語関数内の<code class="command">CREATE TABLE AS</code>/<code class="command">SELECT INTO</code>の後に対応先がなくなったポインタを修正しました。(Tom Lane)
     </p><p>ほとんどの場合、これはアサートが有効な構築におけるアサーション失敗という結果になるだけですが、もっと悪い結果になる可能性がありました。
     </p></li><li class="listitem"><p>Windowsのsysloggerにおけるファイルハンドルの二重クローズを防ぎます。(MauMau）
     </p><p>通常はこのエラーは表面化しませんが、Windowsのデバッグ版を実行している場合は例外が引き起こります。
     </p></li><li class="listitem"><p>plpgsqlにおけるI/O変換関連のメモリリークを修正しました。(Andres Freund、Jan Urbanski、Tom Lane)
     </p><p>現在の関数が終わるまで、特定の操作がメモリリークしました。
     </p></li><li class="listitem"><p>perlのSvPVutf8()関数の不具合を回避しました。(Andrew Dunstan)
     </p><p>この関数はtypeglobまたは特定の読み取り専用のオブジェクトが渡された場合にクラッシュします。
plperlでこれらを渡さないようにしました。
     </p></li><li class="listitem"><p><span class="application">pg_dump</span>において、拡張自体がダンプ対象でない場合に拡張の設定テーブルの内容をダンプしません。(Tom Lane)
     </p></li><li class="listitem"><p>継承されたテーブル列に対する<span class="application">pg_dump</span>の取り扱いを改良しました。(Tom Lane)
     </p><p><span class="application">pg_dump</span>は、子の列が親の列と異なるデフォルト式を持つという状況を間違って扱いました。
デフォルトがテキストとして親のデフォルトと同一であるが、実際は同一ではない場合（例えば、スキーマ検索パスの違いのため）、異なるものとして認識せず、そのため、ダンプしリストアした後、子は親のデフォルトを継承することができました。
子の列が<code class="literal">NOT NULL</code>であり親がそうではなかった場合も、微妙に間違ってリストアされました。
     </p></li><li class="listitem"><p>INSERT形式のテーブルデータに対する<span class="application">pg_restore</span>の直接データベースにリストアするモードを修正しました。(Tom Lane)
     </p><p>他の問題に対する修正における見落としの結果、2011年9月または12月付けのリリースに含まれる<span class="application">pg_restore</span>では、<code class="option">--inserts</code>または<code class="option">--column-inserts</code>オプションを付けて作成されたアーカイブファイルを直接データベースにリストアすることができませんでした。
アーカイブファイル自体には失敗はなく、テキストモード出力では問題ありませんでした。
     </p></li><li class="listitem"><p><span class="application">plpython</span>の共有ライブラリの名称変更を扱うよう<span class="application">pg_upgrade</span>を変更しました。(Bruce Momjian)
     </p><p>この見落としのため、plpythonを含む9.1より前のデータベースをアップグレードすることができませんでした。
     </p></li><li class="listitem"><p><span class="application">pg_upgrade</span>が<code class="type">regclass</code>列を含むテーブルを処理できるようにしました。(Bruce Momjian)
     </p><p><span class="application">pg_upgrade</span>が<code class="structname">pg_class</code> OIDの保護に注意を払うようになりましたので、この制限を続ける理由はなくなりました。
     </p></li><li class="listitem"><p>SSLクライアント証明書ファイルを検索するときに、<span class="application">libpq</span>が<code class="literal">ENOTDIR</code>エラーを無視するようにしました。(Magnus Hagander)
     </p><p>これによりユーザのホームディレクトリが<code class="literal">/dev/null</code>のようなものに設定されていたとしても、証明書なしですが、SSL接続を確立できます。
     </p></li><li class="listitem"><p><span class="application">ecpg</span>のSQLDA領域におけるフィールド整列問題を修正しました。 (Zoltan Boszormenyi)
     </p></li><li class="listitem"><p><span class="application">ecpg</span>の<code class="literal">DEALLOCATE</code>文において<code class="literal">AT</code>オプションを可能にしました。(Michael Meskes)
     </p><p>これをサポートする基盤は少し前から存在しましたが、見落としのため、エラー検査でこの状況を拒絶していました。
     </p></li><li class="listitem"><p>ecpgにおいてvarchar構造体を定義するときに変数名を使用しません。(Michael Meskes)
     </p></li><li class="listitem"><p><code class="filename">contrib/auto_explain</code>のJSON出力モードが有効なJSONを生成するように修正しました。(Andrew Dunstan)
     </p><p>この出力では、本来括弧を使用しなければならない最上位で、角括弧を使用していました。
     </p></li><li class="listitem"><p><code class="filename">contrib/intarray</code>の<code class="literal">int[] &amp; int[]</code>演算子のエラーを修正しました。 (Guillaume Lelarge)
     </p><p>２つの入力配列が共通して持つ最小の整数が１であり、どちらかの配列により小さな値があった場合、１が結果から間違って省かれました。
     </p></li><li class="listitem"><p><code class="filename">contrib/pgcrypto</code>の<code class="function">encrypt_iv()</code>および<code class="function">decrypt_iv()</code>の誤判定を修正しました。(Marko Kreen)
     </p><p>これらの関数は特定の種類の無効入力エラーの通知に失敗し、不正な入力に対してランダムなゴミの値を代わりに返しました。
     </p></li><li class="listitem"><p><code class="filename">contrib/test_parser</code>における1バイトのバッファオーバーランを修正しました。(Paul Guyot)
     </p><p>コードでは必要より1バイト多く読み取ろうとし、境界条件ではクラッシュします。
<code class="filename">contrib/test_parser</code>は単なるサンプルコードであり、これ自体はセキュリティ問題ではありませんが、例のコードとしては良くありません。
     </p></li><li class="listitem"><p>ARMにおいて可能ならばスピンロックに<code class="function">__sync_lock_test_and_set()</code>を使用します。(Martin Pitt)
     </p><p>この関数は、以前の廃止予定でARMv6以降では使用できなくなった<code class="literal">SWPB</code>命令の使用を置き換えるものです。
最近のARMボードでも古いコードは明白な方法で失敗することはありませんが、単に同時アクセスのインターロックを行わず、マルチプロセス操作において奇妙な失敗をもたらすと報告されています。
     </p></li><li class="listitem"><p>受け付け可能なバージョンのgccを用いて構築する場合に<code class="option">-fexcess-precision=standard</code>オプションを使用します。(Andrew Dunstan)
     </p><p>最近のバージョンのgccは独創的な結果を生成するというさまざまなシナリオを防ぎます。
     </p></li><li class="listitem"><p>FreeBSDにおいてスレッド化されたPythonを使用できるようにしました。(Chris Rees)
     </p><p>configureスクリプトはこれまで、この組み合わせは動作しないと前提していました。
しかしFreeBSDではこの問題が修正されましたので、エラー検査を取り除きました。
     </p></li><li class="listitem"><p>MinGWが標準的な名前のOpenSSLライブラリを使用して構築できるようにしました。(Tomasz Ostrowski)
     </p></li></ul></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="release-9-1-4.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="release.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="release-9-1-2.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">E.123. リリース9.1.4 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> E.125. リリース9.1.2</td></tr></table></div></body></html>