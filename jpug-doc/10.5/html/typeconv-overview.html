<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>10.1. 概要</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="typeconv.html" title="Chapter 10. 型変換" /><link rel="next" href="typeconv-oper.html" title="10.2. 演算子" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">10.1. 概要</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="typeconv.html" title="Chapter 10. 型変換">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="typeconv.html" title="Chapter 10. 型変換">Up</a></td><th width="60%" align="center">Chapter 10. 型変換</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="typeconv-oper.html" title="10.2. 演算子">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="TYPECONV-OVERVIEW"><div class="titlepage"><div><div><h2 class="title" style="clear: both">10.1. 概要</h2></div></div></div><p><acronym class="acronym">SQL</acronym>は強く型付けされた言語です。
つまり、各データ項目は、その動作と許される使用方法を決定するデータ型を所有しています。
<span class="productname">PostgreSQL</span>には、他の<acronym class="acronym">SQL</acronym>の実装よりもより一般的で柔軟性のある、拡張可能な型システムがあります。
このために、<span class="productname">PostgreSQL</span>でのほとんどの型変換の動作は、特定の目的について<span class="foreignphrase"><em class="foreignphrase">勝手に作り上げられる</em></span>ことなく一般的な規則で管理されています。
これにより、ユーザ定義型についても型の混在する式を使用できます。</p><p><span class="productname">PostgreSQL</span>のスキャナ/パーサは字句要素を、整数、非整数値、文字列、識別子、キーワードという5個の基礎カテゴリに分解します。
ほとんどの非数値型定数は、まず文字列にクラス分けされます。
<acronym class="acronym">SQL</acronym>言語定義では、文字列で型の名前を指定することを許していて、パーサが正しい手順に沿って処理を始められるように<span class="productname">PostgreSQL</span>も採用しています。
例えば、以下のような問い合わせを考えてみましょう。

</p><pre class="screen">SELECT text 'Origin' AS "label", point '(0,0)' AS "value";

 label  | value
--------+-------
 Origin | (0,0)
(1 row)</pre><p>

この問い合わせは、<code class="type">text</code>と<code class="type">point</code>という2つの型を指定したリテラル定数を持ちます。
文字列リテラルに型が指定されていない場合、後述するように、後の段階で解決されるようにとりあえず場所を確保するための型である<code class="type">unknown</code>が割り当てられます。</p><p><span class="productname">PostgreSQL</span>のパーサには、個別の型変換規則が必要な4つの基礎的な<acronym class="acronym">SQL</acronym>構成要素があります。

</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">関数呼び出し</span></dt><dd><p><span class="productname">PostgreSQL</span>型システムの大部分は、高度な関数群によって構築されています。
関数は複数の引数を取ることができます。
<span class="productname">PostgreSQL</span>では関数のオーバーロードが可能ですので、関数名だけでは呼び出すべき関数を一意に識別できません。
パーサは、提供される引数のデータ型に基づいて、正しい関数を選択しなければなりません。</p></dd><dt><span class="term">演算子</span></dt><dd><p><span class="productname">PostgreSQL</span>では、（引数が2つの）二項演算子と同様に、（引数が1つの）前置、後置単項演算子を持つ式が使用できます。
関数と同様、演算子もオーバーロード可能ですので、正しい演算子を選択する時に同じ問題が存在します。</p></dd><dt><span class="term">値の格納</span></dt><dd><p><acronym class="acronym">SQL</acronym>の<code class="command">INSERT</code>と<code class="command">UPDATE</code>文は式の結果をテーブルの中に格納します。
文内の式は対象となる列の型に一致する、または、変換できるものである必要があります。</p></dd><dt><span class="term"><code class="literal">UNION</code>、<code class="literal">CASE</code>、および関連する構文</span></dt><dd><p>UNIONを構成する<code class="command">SELECT</code>文からの選択結果は全て、ある1つの列集合として現れなければいけませんので、各<code class="literal">SELECT</code>句の結果型は統一された集合に一致し変換できる必要があります。
同様に、<code class="command">CASE</code>構文が全体として既知の出力型を持つようになるために、<code class="literal">CASE</code>構文の結果式は共通の型に変換される必要があります。
これは<code class="literal">ARRAY</code>構文でも<code class="function">GREATEST</code>関数、<code class="function">LEAST</code>関数でも同じです。</p></dd></dl></div><p>システムカタログには、どのデータ型の間にどのような変換、すなわち<em class="firstterm">キャスト</em>があるのか、また、その変換をどのように実行するのかに関する情報を格納します。
ユーザは<a class="xref" href="sql-createcast.html" title="CREATE CAST"><span class="refentrytitle">CREATE CAST</span></a>コマンドを使用してキャストを追加できます。
（これは通常新しいデータ型を定義する時にまとめて行われます。
組み込み型間のキャスト集合は注意深く作成されており、変更しないことが最善です。）</p><a id="id-1.5.9.6.6" class="indexterm"></a><p>暗黙のキャストを持つデータ型間の処理において、適切なキャスト処理のより良い決定を行えるようパーサは追加の自律機構を備えています。
データ型は、<code class="type">boolean</code>、<code class="type">numeric</code>、<code class="type">string</code>、<code class="type">bitstring</code>、<code class="type">datetime</code>、<code class="type">timespan</code>、<code class="type">geometric</code>、<code class="type">network</code>、及びユーザ定義を含むいくつかの基本的な<em class="firstterm">型カテゴリ</em>に分けられます。
(一覧は<a class="xref" href="catalog-pg-type.html#CATALOG-TYPCATEGORY-TABLE" title="Table 51.63. typcategoryのコード">Table 51.63</a>を参照してください。ですが、独自の型カテゴリを作成するのも可能なことに注意して下さい。)
各カテゴリには、候補となる型の選択があった場合に、優先される1つ以上の<em class="firstterm">優先される型</em>がある場合があります。
優先される型と利用可能な暗黙のキャストを注意して選択すれば、曖昧な式(複数の解析結果候補を持つもの)が有効な方法で解決されることを保証することが可能です。</p><p>全ての型変換規則は次のようないくつかの基本的な考え方に基づいて設計されています。

</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>暗黙的な変換は、意外な、あるいは予想できない結果を決して生成させてはなりません。</p></li><li class="listitem"><p>暗黙的な型変換を必要としない問い合わせの場合、パーサやエクゼキュータに余計なオーバーヘッドがあるべきではありません。
つまり、問い合わせ文がきちんとまとめられ、型が既に一致するものになっていれば、パーサ内で余計な時間を費やさず、また、問い合わせに不要な暗黙的な型変換関数が使用されないように、問い合わせは処理されるべきです。</p></li><li class="listitem"><p>さらに、もし問い合わせが関数のために暗黙的な変換を通常要求しており、そして、ユーザが正しい引数型を持つ関数を新しく定義した場合、パーサはこの新しい関数を使うべきであり、もはや古い関数を使うために暗黙的な変換を行わないようすべきです。</p></li></ul></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="typeconv.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="typeconv.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="typeconv-oper.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 10. 型変換 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 10.2. 演算子</td></tr></table></div></body></html>