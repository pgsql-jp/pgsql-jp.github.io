<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>9.20. 集約関数</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="functions-range.html" title="9.19. 範囲関数と演算子" /><link rel="next" href="functions-window.html" title="9.21. ウィンドウ関数" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">9.20. 集約関数</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="functions-range.html" title="9.19. 範囲関数と演算子">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="functions.html" title="Chapter 9. 関数と演算子">Up</a></td><th width="60%" align="center">Chapter 9. 関数と演算子</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="functions-window.html" title="9.21. ウィンドウ関数">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="FUNCTIONS-AGGREGATE"><div class="titlepage"><div><div><h2 class="title" style="clear: both">9.20. 集約関数</h2></div></div></div><a id="id-1.5.8.25.2" class="indexterm"></a><p><em class="firstterm">集約関数</em>は入力値の集合から単一の結果を計算します。
<a class="xref" href="functions-aggregate.html#FUNCTIONS-AGGREGATE-TABLE" title="Table 9.52. 汎用集約関数">Table 9.52</a>に組み込みの汎用的な集約関数を、<a class="xref" href="functions-aggregate.html#FUNCTIONS-AGGREGATE-STATISTICS-TABLE" title="Table 9.53. 統計処理用の集約関数">Table 9.53</a>に統計集約関数を示します。
<a class="xref" href="functions-aggregate.html#FUNCTIONS-ORDEREDSET-TABLE" title="Table 9.54. 順序集合集約関数">Table 9.54</a>には組み込みのグループ内順序集合集約関数を、一方<a class="xref" href="functions-aggregate.html#FUNCTIONS-HYPOTHETICAL-TABLE" title="Table 9.55. 仮想集合集約関数">Table 9.55</a>には組み込みのグループ内仮想集合用の順序集約関数を示します。
<a class="xref" href="functions-aggregate.html#FUNCTIONS-GROUPING-TABLE" title="Table 9.56. グループ化演算">Table 9.56</a>には、集約関数と密接に関係するグループ化演算を示します。
集約関数の特殊な構文に関する考察は<a class="xref" href="sql-expressions.html#SYNTAX-AGGREGATES" title="4.2.7. 集約式">Section 4.2.7</a>で説明されています。
また、初歩的な情報については<a class="xref" href="tutorial-agg.html" title="2.7. 集約関数">Section 2.7</a>を参照して下さい。
  </p><div class="table" id="FUNCTIONS-AGGREGATE-TABLE"><p class="title"><strong>Table 9.52. 汎用集約関数</strong></p><div class="table-contents"><table class="table" summary="汎用集約関数" border="1"><colgroup><col /><col /><col /><col /><col /></colgroup><thead><tr><th>関数</th><th>引数のデータ型</th><th>戻り値型</th><th>部分モード</th><th>説明</th></tr></thead><tbody><tr><td>       <a id="id-1.5.8.25.4.2.2.1.1.1" class="indexterm"></a>
       <code class="function">array_agg(<em class="replaceable"><code>expression</code></em>)</code>
      </td><td>配列以外の任意の型
      </td><td>       引数の型の配列
      </td><td>不可</td><td>NULLを含めて入力値が結合された配列</td></tr><tr><td>       <code class="function">array_agg(<em class="replaceable"><code>expression</code></em>)</code>
      </td><td>任意の配列型
      </td><td>引数と同じデータ型
      </td><td>不可</td><td>入力配列が結合された、1次元高い配列（入力はすべて同じ次元であり、空やNULLではないこと）</td></tr><tr><td>       <a id="id-1.5.8.25.4.2.2.3.1.1" class="indexterm"></a>
       <a id="id-1.5.8.25.4.2.2.3.1.2" class="indexterm"></a>
       <code class="function">avg(<em class="replaceable"><code>expression</code></em>)</code>
      </td><td>       <code class="type">smallint</code>、<code class="type">int</code>、<code class="type">bigint</code>、<code class="type">real</code>、<code class="type">double precision</code>、<code class="type">numeric</code>、または<code class="type">interval</code>
      </td><td>       整数型の引数であれば全て<code class="type">numeric</code>、浮動小数点の引数であれば<code class="type">double precision</code>、それ以外は引数のデータ型と同じ
      </td><td>可</td><td>全ての入力値の平均値（算術平均）</td></tr><tr><td>       <a id="id-1.5.8.25.4.2.2.4.1.1" class="indexterm"></a>
       <code class="function">bit_and(<em class="replaceable"><code>expression</code></em>)</code>
      </td><td>       <code class="type">smallint</code>、<code class="type">int</code>、<code class="type">bigint</code>、または<code class="type">bit</code>
      </td><td>        引数のデータ型と同じ
      </td><td>可</td><td>全ての非NULLの入力値のビット積、非NULLの入力値がなければNULL</td></tr><tr><td>       <a id="id-1.5.8.25.4.2.2.5.1.1" class="indexterm"></a>
       <code class="function">bit_or(<em class="replaceable"><code>expression</code></em>)</code>
      </td><td>       <code class="type">smallint</code>、<code class="type">int</code>、<code class="type">bigint</code>、または
       <code class="type">bit</code>
      </td><td>        引数のデータ型と同じ
      </td><td>可</td><td>全ての非NULLの入力値のビット和、非NULLの入力値がなければNULL</td></tr><tr><td>       <a id="id-1.5.8.25.4.2.2.6.1.1" class="indexterm"></a>
       <code class="function">bool_and(<em class="replaceable"><code>expression</code></em>)</code>
      </td><td>       <code class="type">bool</code>
      </td><td>       <code class="type">bool</code>
      </td><td>可</td><td>全ての入力が真ならば真、そうでなければ偽</td></tr><tr><td>       <a id="id-1.5.8.25.4.2.2.7.1.1" class="indexterm"></a>
       <code class="function">bool_or(<em class="replaceable"><code>expression</code></em>)</code>
      </td><td>       <code class="type">bool</code>
      </td><td>       <code class="type">bool</code>
      </td><td>可</td><td>少なくとも1つの入力値が真ならば真。そうでなければ偽</td></tr><tr><td>       <a id="id-1.5.8.25.4.2.2.8.1.1" class="indexterm"></a>
       <code class="function">count(*)</code>
      </td><td> </td><td><code class="type">bigint</code></td><td>可</td><td>入力行の数</td></tr><tr><td><code class="function">count(<em class="replaceable"><code>expression</code></em>)</code></td><td>任意の型</td><td><code class="type">bigint</code></td><td>可</td><td>       <em class="replaceable"><code>expression</code></em>が非NULL値を持つ入力行の個数
      </td></tr><tr><td>       <a id="id-1.5.8.25.4.2.2.10.1.1" class="indexterm"></a>
       <code class="function">every(<em class="replaceable"><code>expression</code></em>)</code>
      </td><td>       <code class="type">bool</code>
      </td><td>       <code class="type">bool</code>
      </td><td>可</td><td><code class="function">bool_and</code>と等価</td></tr><tr><td>       <a id="id-1.5.8.25.4.2.2.11.1.1" class="indexterm"></a>
       <code class="function">json_agg(<em class="replaceable"><code>expression</code></em>)</code>
      </td><td>       <code class="type">any</code>
      </td><td>       <code class="type">json</code>
      </td><td>不可</td><td>JSON配列として値を集約</td></tr><tr><td>       <a id="id-1.5.8.25.4.2.2.12.1.1" class="indexterm"></a>
       <code class="function">jsonb_agg(<em class="replaceable"><code>expression</code></em>)</code>
      </td><td>       <code class="type">any</code>
      </td><td>       <code class="type">jsonb</code>
      </td><td>不可</td><td>値をJSON配列として集約する</td></tr><tr><td>       <a id="id-1.5.8.25.4.2.2.13.1.1" class="indexterm"></a>
       <code class="function">json_object_agg(<em class="replaceable"><code>name</code></em>, <em class="replaceable"><code>value</code></em>)</code>
      </td><td>       <code class="type">(any, any)</code>
      </td><td>       <code class="type">json</code>
      </td><td>不可</td><td>名前／値の対をJSONオブジェクトとして集約</td></tr><tr><td>       <a id="id-1.5.8.25.4.2.2.14.1.1" class="indexterm"></a>
       <code class="function">jsonb_object_agg(<em class="replaceable"><code>name</code></em>, <em class="replaceable"><code>value</code></em>)</code>
      </td><td>       <code class="type">(any, any)</code>
      </td><td>       <code class="type">jsonb</code>
      </td><td>不可</td><td>名前／値のペアをJSONオブジェクトとして集約</td></tr><tr><td>       <a id="id-1.5.8.25.4.2.2.15.1.1" class="indexterm"></a>
       <code class="function">max(<em class="replaceable"><code>expression</code></em>)</code>
      </td><td>任意の数値型、文字列型、日付時刻型、ネットワーク型、列挙型、あるいはそれらの配列</td><td>引数の型と同じ</td><td>可</td><td>       全ての入力値にわたり<em class="replaceable"><code>expression</code></em>の最大値
      </td></tr><tr><td>       <a id="id-1.5.8.25.4.2.2.16.1.1" class="indexterm"></a>
       <code class="function">min(<em class="replaceable"><code>expression</code></em>)</code>
      </td><td>任意の数値型、文字列型、日付時刻型、ネットワーク型、列挙型、あるいはそれらの配列</td><td>引数の型と同じ</td><td>可</td><td>       全ての入力値にわたり<em class="replaceable"><code>expression</code></em>の最小値
      </td></tr><tr><td>       <a id="id-1.5.8.25.4.2.2.17.1.1" class="indexterm"></a>
       <code class="function">         string_agg(<em class="replaceable"><code>expression</code></em>,
                    <em class="replaceable"><code>delimiter</code></em>)
       </code>
      </td><td>       (<code class="type">text</code>, <code class="type">text</code>)または(<code class="type">bytea</code>, <code class="type">bytea</code>)
      </td><td>       引数と同じ型
      </td><td>不可</td><td>入力された値が指定したデリミタで区切られた一つの文字列に連結されます。</td></tr><tr><td>       <a id="id-1.5.8.25.4.2.2.18.1.1" class="indexterm"></a>
       <code class="function">sum(<em class="replaceable"><code>expression</code></em>)</code>
      </td><td>       <code class="type">smallint</code>、<code class="type">int</code>、<code class="type">bigint</code>、<code class="type">real</code>、<code class="type">double precision</code>、<code class="type">numeric</code>、<code class="type">interval</code>または<code class="type">money</code>
      </td><td>       <code class="type">smallint</code>または<code class="type">int</code>型の引数であれば<code class="type">bigint</code>、<code class="type">bigint</code>型の引数であれば<code class="type">numeric</code>、それ以外は引数のデータ型と同じ
      </td><td>可</td><td>全ての入力値に渡り<em class="replaceable"><code>expression</code></em>の和</td></tr><tr><td>       <a id="id-1.5.8.25.4.2.2.19.1.1" class="indexterm"></a>
       <code class="function">xmlagg(<em class="replaceable"><code>expression</code></em>)</code>
      </td><td>       <code class="type">xml</code>
      </td><td>       <code class="type">xml</code>
      </td><td>不可</td><td>XML値の連結（ <a class="xref" href="functions-xml.html#FUNCTIONS-XML-XMLAGG" title="9.14.1.7. xmlagg">Section 9.14.1.7</a>も参照）</td></tr></tbody></table></div></div><br class="table-break" /><p>上記の関数は、<code class="function">count</code>関数を除き、1行も選択されなかった場合NULL値を返すことに注意してください。
特に、行の選択がない<code class="function">sum</code>関数は、予想されるであろうゼロではなくNULLを返し、そして<code class="function">array_agg</code>は、入力行が存在しない場合に、空配列ではなくNULLを返します。
必要であれば、NULLをゼロまたは空配列と置換する目的で<code class="function">coalesce</code>関数を使うことができます。
  </p><p><em class="firstterm">部分モード</em>をサポートする集約関数は並列集約など、様々な最適化に参加することができます。
  </p><div class="note"><h3 class="title">Note</h3><a id="id-1.5.8.25.7.1" class="indexterm"></a><a id="id-1.5.8.25.7.2" class="indexterm"></a><p><code class="function">bool_and</code>、<code class="function">bool_or</code>論理集約関数は標準SQLの集約関数<code class="function">every</code>、<code class="function">any</code>または<code class="function">some</code>に対応します。
<code class="function">any</code>と<code class="function">some</code>についてですが、標準の構文には曖昧さがあるようです。
</p><pre class="programlisting">SELECT b1 = ANY((SELECT b2 FROM t2 ...)) FROM t1 ...;</pre><p>
ここで、副問い合わせが論理値での１行を返す場合、<code class="function">ANY</code>は副問い合わせを導入するもの、もしくは集約関数であるものいずれかとみなすことができます。
従って、これらの集約関数に標準の名前を付けることはできません。
    </p></div><div class="note"><h3 class="title">Note</h3><p>他のSQLデータベース管理システムでの作業に親しんだユーザは、<code class="function">count</code>集約関数がテーブル全体に適用される場合の性能に失望するかも知れません。
</p><pre class="programlisting">SELECT count(*) FROM sometable;</pre><p>
のような問い合わせはテーブルサイズに比例した労力が必要です。<span class="productname">PostgreSQL</span>はテーブル全体か、そのテーブルの全ての行を含んだインデックス全体のスキャンを必要とします。

   </p></div><p>集約関数<code class="function">array_agg</code>、<code class="function">json_agg</code>、<code class="function">jsonb_agg</code>、<code class="function">json_object_agg</code>、<code class="function">jsonb_object_agg</code>、<code class="function">string_agg</code>、および<code class="function">xmlagg</code>、そして類似のユーザ定義の集約関数は、入力値の順序に依存した意味のある別の結果値を生成します。
この並び順はデフォルトでは指定されませんが、<a class="xref" href="sql-expressions.html#SYNTAX-AGGREGATES" title="4.2.7. 集約式">Section 4.2.7</a>に記述されているように、集計呼び出し中に<code class="literal">ORDER BY</code>句を書くことで制御可能となります。別の方法として、並び替えられた副問い合わせから入力値を供給することでも上手くいきます。
例をあげます。

</p><pre class="screen">SELECT xmlagg(x) FROM (SELECT x FROM test ORDER BY y DESC) AS tab;</pre><p>

外側の問い合わせのレベルで結合などの追加処理がある場合、この方法は失敗するかもしれないことに注意して下さい。
なぜなら、集約の計算の前に副問い合わせの出力を並べ替える必要があるかも知れないからです。
  </p><p>統計解析処理によく使用される集約関数を<a class="xref" href="functions-aggregate.html#FUNCTIONS-AGGREGATE-STATISTICS-TABLE" title="Table 9.53. 統計処理用の集約関数">Table 9.53</a>に示します。
（これらは、より一般的に使用される集約関数との混乱を防ぐために別出ししました。）
説明の部分における<em class="replaceable"><code>N</code></em>は、すべての入力式が非NULLの入力行の個数を表します。
すべての場合にて、例えば<em class="replaceable"><code>N</code></em>が0の時など計算が無意味である場合にはNULLが返されます。
  </p><a id="id-1.5.8.25.11" class="indexterm"></a><a id="id-1.5.8.25.12" class="indexterm"></a><div class="table" id="FUNCTIONS-AGGREGATE-STATISTICS-TABLE"><p class="title"><strong>Table 9.53. 統計処理用の集約関数</strong></p><div class="table-contents"><table class="table" summary="統計処理用の集約関数" border="1"><colgroup><col /><col /><col /><col /><col /></colgroup><thead><tr><th>関数</th><th>引数の型</th><th>戻り値の型</th><th>部分モード</th><th>説明</th></tr></thead><tbody><tr><td>       <a id="id-1.5.8.25.13.2.2.1.1.1" class="indexterm"></a>
       <a id="id-1.5.8.25.13.2.2.1.1.2" class="indexterm"></a>
       <code class="function">corr(<em class="replaceable"><code>Y</code></em>, <em class="replaceable"><code>X</code></em>)</code>
      </td><td>       <code class="type">double precision</code>
      </td><td>       <code class="type">double precision</code>
      </td><td>可</td><td>相関係数</td></tr><tr><td>       <a id="id-1.5.8.25.13.2.2.2.1.1" class="indexterm"></a>
       <a id="id-1.5.8.25.13.2.2.2.1.2" class="indexterm"></a>
       <code class="function">covar_pop(<em class="replaceable"><code>Y</code></em>, <em class="replaceable"><code>X</code></em>)</code>
      </td><td>       <code class="type">double precision</code>
      </td><td>       <code class="type">double precision</code>
      </td><td>可</td><td>母共分散</td></tr><tr><td>       <a id="id-1.5.8.25.13.2.2.3.1.1" class="indexterm"></a>
       <a id="id-1.5.8.25.13.2.2.3.1.2" class="indexterm"></a>
       <code class="function">covar_samp(<em class="replaceable"><code>Y</code></em>, <em class="replaceable"><code>X</code></em>)</code>
      </td><td>       <code class="type">double precision</code>
      </td><td>       <code class="type">double precision</code>
      </td><td>可</td><td>標本共分散</td></tr><tr><td>       <a id="id-1.5.8.25.13.2.2.4.1.1" class="indexterm"></a>
       <code class="function">regr_avgx(<em class="replaceable"><code>Y</code></em>, <em class="replaceable"><code>X</code></em>)</code>
      </td><td>       <code class="type">double precision</code>
      </td><td>       <code class="type">double precision</code>
      </td><td>可</td><td>独立変数の平均値
      (<code class="literal">sum(<em class="replaceable"><code>X</code></em>)/<em class="replaceable"><code>N</code></em></code>)</td></tr><tr><td>       <a id="id-1.5.8.25.13.2.2.5.1.1" class="indexterm"></a>
       <code class="function">regr_avgy(<em class="replaceable"><code>Y</code></em>, <em class="replaceable"><code>X</code></em>)</code>
      </td><td>       <code class="type">double precision</code>
      </td><td>       <code class="type">double precision</code>
      </td><td>可</td><td>従属変数の平均値
      (<code class="literal">sum(<em class="replaceable"><code>Y</code></em>)/<em class="replaceable"><code>N</code></em></code>)</td></tr><tr><td>       <a id="id-1.5.8.25.13.2.2.6.1.1" class="indexterm"></a>
       <code class="function">regr_count(<em class="replaceable"><code>Y</code></em>, <em class="replaceable"><code>X</code></em>)</code>
      </td><td>       <code class="type">double precision</code>
      </td><td>       <code class="type">bigint</code>
      </td><td>可</td><td>両式が非NULLとなる入力行の個数</td></tr><tr><td>       <a id="id-1.5.8.25.13.2.2.7.1.1" class="indexterm"></a>
       <a id="id-1.5.8.25.13.2.2.7.1.2" class="indexterm"></a>
       <code class="function">regr_intercept(<em class="replaceable"><code>Y</code></em>, <em class="replaceable"><code>X</code></em>)</code>
      </td><td>       <code class="type">double precision</code>
      </td><td>       <code class="type">double precision</code>
      </td><td>可</td><td>(<em class="replaceable"><code>X</code></em>, <em class="replaceable"><code>Y</code></em>)の組み合わせで決まる、最小二乗法による線形方程式のY切片</td></tr><tr><td>       <a id="id-1.5.8.25.13.2.2.8.1.1" class="indexterm"></a>
       <code class="function">regr_r2(<em class="replaceable"><code>Y</code></em>, <em class="replaceable"><code>X</code></em>)</code>
      </td><td>       <code class="type">double precision</code>
      </td><td>       <code class="type">double precision</code>
      </td><td>可</td><td>相関係数の二乗</td></tr><tr><td>       <a id="id-1.5.8.25.13.2.2.9.1.1" class="indexterm"></a>
       <a id="id-1.5.8.25.13.2.2.9.1.2" class="indexterm"></a>
       <code class="function">regr_slope(<em class="replaceable"><code>Y</code></em>, <em class="replaceable"><code>X</code></em>)</code>
      </td><td>       <code class="type">double precision</code>
      </td><td>       <code class="type">double precision</code>
      </td><td>可</td><td><em class="replaceable"><code>X</code></em>, <em class="replaceable"><code>Y</code></em>)の組み合わせで決まる、最小二乗法による線型方程式の傾き</td></tr><tr><td>       <a id="id-1.5.8.25.13.2.2.10.1.1" class="indexterm"></a>
       <code class="function">regr_sxx(<em class="replaceable"><code>Y</code></em>, <em class="replaceable"><code>X</code></em>)</code>
      </td><td>       <code class="type">double precision</code>
      </td><td>       <code class="type">double precision</code>
      </td><td>可</td><td><code class="literal">sum(<em class="replaceable"><code>X</code></em>^2) - sum(<em class="replaceable"><code>X</code></em>)^2/<em class="replaceable"><code>N</code></em></code>
     （従属変数の<span class="quote">“<span class="quote">二乗和</span>”</span>）
     </td></tr><tr><td>       <a id="id-1.5.8.25.13.2.2.11.1.1" class="indexterm"></a>
       <code class="function">regr_sxy(<em class="replaceable"><code>Y</code></em>, <em class="replaceable"><code>X</code></em>)</code>
      </td><td>       <code class="type">double precision</code>
      </td><td>       <code class="type">double precision</code>
      </td><td>可</td><td><code class="literal">sum(<em class="replaceable"><code>X</code></em>*<em class="replaceable"><code>Y</code></em>) - sum(<em class="replaceable"><code>X</code></em>) * sum(<em class="replaceable"><code>Y</code></em>)/<em class="replaceable"><code>N</code></em></code>
     （従属変数と独立変数の<span class="quote">“<span class="quote">積の和</span>”</span>）
      </td></tr><tr><td>       <a id="id-1.5.8.25.13.2.2.12.1.1" class="indexterm"></a>
       <code class="function">regr_syy(<em class="replaceable"><code>Y</code></em>, <em class="replaceable"><code>X</code></em>)</code>
      </td><td>       <code class="type">double precision</code>
      </td><td>       <code class="type">double precision</code>
      </td><td>可</td><td><code class="literal">sum(<em class="replaceable"><code>Y</code></em>^2) - sum(<em class="replaceable"><code>Y</code></em>)^2/<em class="replaceable"><code>N</code></em></code>
     （独立変数の<span class="quote">“<span class="quote">二乗和</span>”</span>）</td></tr><tr><td>       <a id="id-1.5.8.25.13.2.2.13.1.1" class="indexterm"></a>
       <a id="id-1.5.8.25.13.2.2.13.1.2" class="indexterm"></a>
       <code class="function">stddev(<em class="replaceable"><code>expression</code></em>)</code>
      </td><td>       <code class="type">smallint</code>、<code class="type">int</code>、
       <code class="type">bigint</code>、<code class="type">real</code>、<code class="type">double
       precision</code>、または<code class="type">numeric</code>
      </td><td>       浮動小数点型の引数では<code class="type">double precision</code>。それ以外では<code class="type">numeric</code>
      </td><td>可</td><td><code class="function">stddev_samp</code>の歴史的な別名</td></tr><tr><td>       <a id="id-1.5.8.25.13.2.2.14.1.1" class="indexterm"></a>
       <a id="id-1.5.8.25.13.2.2.14.1.2" class="indexterm"></a>
       <code class="function">stddev_pop(<em class="replaceable"><code>expression</code></em>)</code>
      </td><td>       <code class="type">smallint</code>、<code class="type">int</code>、
       <code class="type">bigint</code>、<code class="type">real</code>、<code class="type">double
       precision</code>、または<code class="type">numeric</code>
      </td><td>       浮動小数点型の引数では<code class="type">double precision</code>。それ以外では<code class="type">numeric</code>
      </td><td>可</td><td>入力値に対する母標準偏差</td></tr><tr><td>       <a id="id-1.5.8.25.13.2.2.15.1.1" class="indexterm"></a>
       <a id="id-1.5.8.25.13.2.2.15.1.2" class="indexterm"></a>
       <code class="function">stddev_samp(<em class="replaceable"><code>expression</code></em>)</code>
      </td><td>       <code class="type">smallint</code>、<code class="type">int</code>、
       <code class="type">bigint</code>、<code class="type">real</code>、<code class="type">double
       precision</code>、または<code class="type">numeric</code>
      </td><td>       浮動小数点型の引数では<code class="type">double precision</code>。それ以外では<code class="type">numeric</code>
      </td><td>可</td><td>入力値に対する標本標準偏差</td></tr><tr><td>       <a id="id-1.5.8.25.13.2.2.16.1.1" class="indexterm"></a>
       <code class="function">variance</code>(<em class="replaceable"><code>expression</code></em>)
      </td><td>       <code class="type">smallint</code>、<code class="type">int</code>、
       <code class="type">bigint</code>、<code class="type">real</code>、<code class="type">double
       precision</code>、または<code class="type">numeric</code>
      </td><td>       浮動小数点型の引数では<code class="type">double precision</code>。それ以外では<code class="type">numeric</code>
      </td><td>可</td><td><code class="function">var_samp</code>の歴史的な別名</td></tr><tr><td>       <a id="id-1.5.8.25.13.2.2.17.1.1" class="indexterm"></a>
       <a id="id-1.5.8.25.13.2.2.17.1.2" class="indexterm"></a>
       <code class="function">var_pop</code>(<em class="replaceable"><code>expression</code></em>)
      </td><td>       <code class="type">smallint</code>、<code class="type">int</code>、
       <code class="type">bigint</code>、<code class="type">real</code>、<code class="type">double
       precision</code>、または<code class="type">numeric</code>
      </td><td>       浮動小数点型の引数では<code class="type">double precision</code>。それ以外では<code class="type">numeric</code>
      </td><td>可</td><td>入力値に対する母分散（母標準偏差の二乗）</td></tr><tr><td>       <a id="id-1.5.8.25.13.2.2.18.1.1" class="indexterm"></a>
       <a id="id-1.5.8.25.13.2.2.18.1.2" class="indexterm"></a>
       <code class="function">var_samp</code>(<em class="replaceable"><code>expression</code></em>)
      </td><td>       <code class="type">smallint</code>、<code class="type">int</code>、
       <code class="type">bigint</code>、<code class="type">real</code>、<code class="type">double
       precision</code>、または<code class="type">numeric</code>
      </td><td>       浮動小数点型の引数では<code class="type">double precision</code>。それ以外では<code class="type">numeric</code>
      </td><td>可</td><td>入力値に対する標本分散（標本標準偏差の二乗）</td></tr></tbody></table></div></div><br class="table-break" /><p><a class="xref" href="functions-aggregate.html#FUNCTIONS-ORDEREDSET-TABLE" title="Table 9.54. 順序集合集約関数">Table 9.54</a>に<em class="firstterm">順序集合集約</em>構文を使う集約関数を示します。
これらの関数は<span class="quote">“<span class="quote">逆分散</span>”</span>関数として参照されることがあります。
  </p><a id="id-1.5.8.25.15" class="indexterm"></a><a id="id-1.5.8.25.16" class="indexterm"></a><div class="table" id="FUNCTIONS-ORDEREDSET-TABLE"><p class="title"><strong>Table 9.54. 順序集合集約関数</strong></p><div class="table-contents"><table class="table" summary="順序集合集約関数" border="1"><colgroup><col /><col /><col /><col /><col /><col /></colgroup><thead><tr><th>関数</th><th>直接引数型</th><th>集約された引数型</th><th>戻り値型</th><th>部分モード</th><th>説明</th></tr></thead><tbody><tr><td>       <a id="id-1.5.8.25.17.2.2.1.1.1" class="indexterm"></a>
       <code class="function">mode() WITHIN GROUP (ORDER BY <em class="replaceable"><code>sort_expression</code></em>)</code>
      </td><td>      </td><td>       ソート可能な型
      </td><td>       ソート式と同じ
      </td><td>不可</td><td>       入力の最頻値を返す(複数の同じ度数の結果があれば、任意に選んだ最初のもの)
      </td></tr><tr><td>       <a id="id-1.5.8.25.17.2.2.2.1.1" class="indexterm"></a>
       <code class="function">percentile_cont(<em class="replaceable"><code>fraction</code></em>) WITHIN GROUP (ORDER BY <em class="replaceable"><code>sort_expression</code></em>)</code>
      </td><td>       <code class="type">double precision</code>
      </td><td>       <code class="type">double precision</code>または<code class="type">interval</code>
      </td><td>       ソート式と同じ
      </td><td>不可</td><td>       連続百分位数: 入力項目を並べて必要であれば隣り合うものを補間して指定された割合に対応する値を返す
      </td></tr><tr><td>       <code class="function">percentile_cont(<em class="replaceable"><code>fractions</code></em>) WITHIN GROUP (ORDER BY <em class="replaceable"><code>sort_expression</code></em>)</code>
      </td><td>       <code class="type">double precision[]</code>
      </td><td>       <code class="type">double precision</code>または<code class="type">interval</code>
      </td><td>       ソート式の型の配列
      </td><td>不可</td><td>       複数の連続百分位数: 各非NULL要素をその百分位数に対応する値で置き換えて、<em class="replaceable"><code>fractions</code></em>パラメータの形に一致する結果の配列を返す
      </td></tr><tr><td>       <a id="id-1.5.8.25.17.2.2.4.1.1" class="indexterm"></a>
       <code class="function">percentile_disc(<em class="replaceable"><code>fraction</code></em>) WITHIN GROUP (ORDER BY <em class="replaceable"><code>sort_expression</code></em>)</code>
      </td><td>       <code class="type">double precision</code>
      </td><td>       ソート可能な型
      </td><td>       ソート式と同じ
      </td><td>不可</td><td>       離散百分位数: 並べた時のその位置が指定された割合と等しいもしくは越える最初の入力値を返す
      </td></tr><tr><td>       <code class="function">percentile_disc(<em class="replaceable"><code>fractions</code></em>) WITHIN GROUP (ORDER BY <em class="replaceable"><code>sort_expression</code></em>)</code>
      </td><td>       <code class="type">double precision[]</code>
      </td><td>       ソート可能な型
      </td><td>       ソート式の型の配列
      </td><td>不可</td><td>       複数の離散百分位数: 各非NULL要素をその百分位数に対応する値で置き換えて、<em class="replaceable"><code>fractions</code></em>パラメータの形に一致する結果の配列を返す
      </td></tr></tbody></table></div></div><br class="table-break" /><p><a class="xref" href="functions-aggregate.html#FUNCTIONS-ORDEREDSET-TABLE" title="Table 9.54. 順序集合集約関数">Table 9.54</a>に列挙された集約はすべて整列された入力内のNULL値を無視します。
<em class="replaceable"><code>fraction</code></em>パラメータを取るものでは、fraction（割合）の値は0と1の間でなければなりません。そうでなければエラーが投げられます。
しかしながら、franctionの値がNULLなら単にNULLという結果になります。
  </p><a id="id-1.5.8.25.19" class="indexterm"></a><p><a class="xref" href="functions-aggregate.html#FUNCTIONS-HYPOTHETICAL-TABLE" title="Table 9.55. 仮想集合集約関数">Table 9.55</a>に列挙されている集約は、それぞれ<a class="xref" href="functions-window.html" title="9.21. ウィンドウ関数">Section 9.21</a>で定義されている同じ名前のウィンドウ関数と関連します。
どの場合も、集約結果は、<em class="replaceable"><code>args</code></em>から構築される<span class="quote">“<span class="quote">仮想的な</span>”</span>行に対して、関連するウィンドウ関数が返す値で、そのような行が<em class="replaceable"><code>sorted_args</code></em>から計算されるソートされた行のグループに追加される場合を想定します。
  </p><div class="table" id="FUNCTIONS-HYPOTHETICAL-TABLE"><p class="title"><strong>Table 9.55. 仮想集合集約関数</strong></p><div class="table-contents"><table class="table" summary="仮想集合集約関数" border="1"><colgroup><col /><col /><col /><col /><col /><col /></colgroup><thead><tr><th>関数</th><th>直接引数型</th><th>集約された引数型</th><th>戻り値型</th><th>部分モード</th><th>説明</th></tr></thead><tbody><tr><td>       <a id="id-1.5.8.25.21.2.2.1.1.1" class="indexterm"></a>
       <code class="function">rank(<em class="replaceable"><code>args</code></em>) WITHIN GROUP (ORDER BY <em class="replaceable"><code>sorted_args</code></em>)</code>
      </td><td>       <code class="literal">VARIADIC</code> <code class="type">"any"</code>
      </td><td>       <code class="literal">VARIADIC</code> <code class="type">"any"</code>
      </td><td>       <code class="type">bigint</code>
      </td><td>不可</td><td>       重複する行のギャップを含む仮想の行の順位
      </td></tr><tr><td>       <a id="id-1.5.8.25.21.2.2.2.1.1" class="indexterm"></a>
       <code class="function">dense_rank(<em class="replaceable"><code>args</code></em>) WITHIN GROUP (ORDER BY <em class="replaceable"><code>sorted_args</code></em>)</code>
      </td><td>       <code class="literal">VARIADIC</code> <code class="type">"any"</code>
      </td><td>       <code class="literal">VARIADIC</code> <code class="type">"any"</code>
      </td><td>       <code class="type">bigint</code>
      </td><td>不可</td><td>       ギャップを含まない仮想の行の順位
      </td></tr><tr><td>       <a id="id-1.5.8.25.21.2.2.3.1.1" class="indexterm"></a>
       <code class="function">percent_rank(<em class="replaceable"><code>args</code></em>) WITHIN GROUP (ORDER BY <em class="replaceable"><code>sorted_args</code></em>)</code>
      </td><td>       <code class="literal">VARIADIC</code> <code class="type">"any"</code>
      </td><td>       <code class="literal">VARIADIC</code> <code class="type">"any"</code>
      </td><td>       <code class="type">double precision</code>
      </td><td>不可</td><td>       仮想の行の相対順位、0から1まで
      </td></tr><tr><td>       <a id="id-1.5.8.25.21.2.2.4.1.1" class="indexterm"></a>
       <code class="function">cume_dist(<em class="replaceable"><code>args</code></em>) WITHIN GROUP (ORDER BY <em class="replaceable"><code>sorted_args</code></em>)</code>
      </td><td>       <code class="literal">VARIADIC</code> <code class="type">"any"</code>
      </td><td>       <code class="literal">VARIADIC</code> <code class="type">"any"</code>
      </td><td>       <code class="type">double precision</code>
      </td><td>不可</td><td>       仮想の行の相対順位、1/<em class="replaceable"><code>N</code></em>から1まで
      </td></tr></tbody></table></div></div><br class="table-break" /><p>各仮想集合集約に対して<em class="replaceable"><code>args</code></em>で与えられる直接引数のリストは、<em class="replaceable"><code>sorted_args</code></em>で与えられる集約された引数の数と型と一致しなければなりません。
ほとんどの組み込み集約とは異なり、この集約はSTRICTではありません、すなわち、NULLを含む入力行を落としません。
NULL値は<code class="literal">ORDER BY</code>節で指定されるルールに従って並べられます。
  </p><div class="table" id="FUNCTIONS-GROUPING-TABLE"><p class="title"><strong>Table 9.56. グループ化演算</strong></p><div class="table-contents"><table class="table" summary="グループ化演算" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>関数</th><th>戻り値型</th><th>説明</th></tr></thead><tbody><tr><td>       <a id="id-1.5.8.25.23.2.2.1.1.1" class="indexterm"></a>
       <code class="function">GROUPING(<em class="replaceable"><code>args...</code></em>)</code>
      </td><td>       <code class="type">integer</code>
      </td><td>どの引数が現在のグループ化セットに含まれないかを示す整数のビットマスク
      </td></tr></tbody></table></div></div><br class="table-break" /><p>グループ化演算はグループ化セット（<a class="xref" href="queries-table-expressions.html#QUERIES-GROUPING-SETS" title="7.2.4. GROUPING SETS、CUBE、ROLLUP">Section 7.2.4</a>参照）と一緒に使われ、結果の行を区別するものです。
<code class="literal">GROUPING</code>演算の引数は実際には評価されませんが、関連する問い合わせの<code class="literal">GROUP BY</code>句にある式と正確に一致する必要があります。
最も右側の引数が最下位ビットになるようにビットが割り当てられます。
各ビットは、対応する式が結果の行を生成するグループ化セットのグループ化条件に含まれていれば0、そうでなければ1です。
例えば以下のようになります。
</p><pre class="screen"><code class="prompt">=&gt;</code> <strong class="userinput"><code>SELECT * FROM items_sold;</code></strong>
 make  | model | sales
-------+-------+-------
 Foo   | GT    |  10
 Foo   | Tour  |  20
 Bar   | City  |  15
 Bar   | Sport |  5
(4 rows)

<code class="prompt">=&gt;</code> <strong class="userinput"><code>SELECT make, model, GROUPING(make,model), sum(sales) FROM items_sold GROUP BY ROLLUP(make,model);</code></strong>
 make  | model | grouping | sum
-------+-------+----------+-----
 Foo   | GT    |        0 | 10
 Foo   | Tour  |        0 | 20
 Bar   | City  |        0 | 15
 Bar   | Sport |        0 | 5
 Foo   |       |        1 | 30
 Bar   |       |        1 | 20
       |       |        3 | 50
(7 rows)</pre><p>
   </p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="functions-range.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="functions.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="functions-window.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">9.19. 範囲関数と演算子 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 9.21. ウィンドウ関数</td></tr></table></div></body></html>