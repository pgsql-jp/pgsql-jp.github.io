<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>pg_dumpall</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="app-pgdump.html" title="pg_dump" /><link rel="next" href="app-pg-isready.html" title="pg_isready" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center"><span xmlns="http://www.w3.org/1999/xhtml" class="application">pg_dumpall</span></th></tr><tr><td width="10%" align="left"><a accesskey="p" href="app-pgdump.html" title="pg_dump">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="reference-client.html" title="PostgreSQLクライアントアプリケーション">Up</a></td><th width="60%" align="center">PostgreSQLクライアントアプリケーション</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="app-pg-isready.html" title="pg_isready">Next</a></td></tr></table><hr></hr></div><div class="refentry" id="APP-PG-DUMPALL"><div class="titlepage"></div><a id="id-1.9.4.13.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle"><span class="application">pg_dumpall</span></span></h2><p>pg_dumpall — <span class="productname">PostgreSQL</span>のデータベースクラスタをスクリプトファイルへ抽出する</p></div><div class="refsynopsisdiv"><h2>Synopsis</h2><div class="cmdsynopsis"><p id="id-1.9.4.13.4.1"><code class="command">pg_dumpall</code> [<em class="replaceable"><code>connection-option</code></em>...] [<em class="replaceable"><code>option</code></em>...]</p></div></div><div class="refsect1" id="APP-PG-DUMPALL-DESCRIPTION"><h2>説明</h2><p><span class="application">pg_dumpall</span>はクラスタの全ての<span class="productname">PostgreSQL</span>データベースを、1つのスクリプトファイルに書き出す（<span class="quote">“<span class="quote">ダンプする</span>”</span>）ためのユーティリティです。
スクリプトファイルには、データベースのリストアのために<a class="xref" href="app-psql.html" title="psql"><span class="refentrytitle"><span class="application">psql</span></span></a>への入力として使うことのできる<acronym class="acronym">SQL</acronym>コマンドが含まれています。
これはクラスタ内の各データベースに対して<a class="xref" href="app-pgdump.html" title="pg_dump"><span class="refentrytitle">pg_dump</span></a>を呼び出すことで行われます。
さらに、<span class="application">pg_dumpall</span>は、全てのデータベースに共通するグローバルオブジェクトもダンプします
（<span class="application">pg_dump</span>はこれらのオブジェクトを保存しません）。
現時点では、これにはデータベースユーザとグループ、テーブル空間、データベース全体に適用するアクセス制限などの属性に関する情報が含まれています。
  </p><p><span class="application">pg_dumpall</span>は全てのデータベースからテーブルを読み込むため、完全なダンプを作成するには、おそらくデータベーススーパーユーザとして接続する必要がある可能性が高いでしょう。
さらに、保存されたスクリプトを実行する時には、ユーザとグループを追加したり、データベースを作成したりするので、スーパーユーザ権限が必要になるでしょう。
  </p><p>SQLスクリプトは標準出力に書き込まれます。
それをファイルにリダイレクトするためには、[-f|file]オプションまたはシェルの演算子を使用して下さい。
  </p><p><span class="application">pg_dumpall</span>は、<span class="productname">PostgreSQL</span>サーバに何度か接続しなければなりません（データベースごとに接続することになります）。
パスワード認証を使用している場合、その度にパスワード入力が促されます。
そのような場合は<code class="filename">~/.pgpass</code>ファイルを用意しておくと便利です。
詳細は<a class="xref" href="libpq-pgpass.html" title="33.15. パスワードファイル">Section 33.15</a>を参照してください。
  </p></div><div class="refsect1" id="id-1.9.4.13.6"><h2>オプション</h2><p>以下のコマンドラインオプションは出力内容や形式を制御します。

    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-a</code><br /></span><span class="term"><code class="option">--data-only</code></span></dt><dd><p>データのみをダンプし、スキーマ（データ定義）をダンプしません。
       </p></dd><dt><span class="term"><code class="option">-c</code><br /></span><span class="term"><code class="option">--clean</code></span></dt><dd><p>データベースを再作成するコマンドの前に、データベースのクリーンアップ（削除）するコマンドを書き出します。
ロールおよびテーブル空間用の<code class="command">DROP</code>コマンドも同様に追加されます。
       </p></dd><dt><span class="term"><code class="option">-f <em class="replaceable"><code>filename</code></em></code><br /></span><span class="term"><code class="option">--file=<em class="replaceable"><code>filename</code></em></code></span></dt><dd><p>出力を指定したファイルに送ります。
これが省略されると標準出力が使用されます。
       </p></dd><dt><span class="term"><code class="option">-g</code><br /></span><span class="term"><code class="option">--globals-only</code></span></dt><dd><p>グローバルオブジェクト（ロールとテーブル空間）のみをダンプし、データベースのダンプを行いません。
       </p></dd><dt><span class="term"><code class="option">-o</code><br /></span><span class="term"><code class="option">--oids</code></span></dt><dd><p>各テーブルのオブジェクト識別子（<acronym class="acronym">OID</acronym>）をデータの一部としてダンプします。
アプリケーションで<acronym class="acronym">OID</acronym>列を（外部キー制約など）何らかの形で使用している場合は、このオプションを使用してください。
そうでなければ、このオプションは使用しないでください。
       </p></dd><dt><span class="term"><code class="option">-O</code><br /></span><span class="term"><code class="option">--no-owner</code></span></dt><dd><p>オブジェクトの所有権を元のデータベースに一致させるためのコマンドを出力しません。
デフォルトでは、<span class="application">pg_dumpall</span>は<code class="command">ALTER OWNER</code>文または<code class="command">SET SESSION AUTHORIZATION</code>文を発行して作成したスキーマ要素の所有権を設定します。
スーパーユーザ（もしくは、スクリプト内の全てのオブジェクトを所有するユーザ）以外のユーザがスクリプトを実行した場合、これらの文は失敗します。
任意のユーザがリストアできるスクリプトを作成するには、<code class="option">-O</code>を指定してください。ただし、この場合は、全てのオブジェクトの所有者がリストアしたユーザとなってしまいます。
       </p></dd><dt><span class="term"><code class="option">-r</code><br /></span><span class="term"><code class="option">--roles-only</code></span></dt><dd><p>ロールのみをダンプし、データベースやテーブル空間のダンプを行いません。
       </p></dd><dt><span class="term"><code class="option">-s</code><br /></span><span class="term"><code class="option">--schema-only</code></span></dt><dd><p>オブジェクト定義（スキーマ）のみをダンプし、データをダンプしません。
       </p></dd><dt><span class="term"><code class="option">-S <em class="replaceable"><code>username</code></em></code><br /></span><span class="term"><code class="option">--superuser=<em class="replaceable"><code>username</code></em></code></span></dt><dd><p>トリガを無効にする際に使用するスーパーユーザのユーザ名を指定します。
これは<code class="option">--disable-triggers</code>を使用する場合にのみ使用されます
（通常はこのオプションを使うよりも、出力されたスクリプトをスーパーユーザ権限で実行する方が良いでしょう）。
       </p></dd><dt><span class="term"><code class="option">-t</code><br /></span><span class="term"><code class="option">--tablespaces-only</code></span></dt><dd><p>テーブル空間のみをダンプし、データベースやロールのダンプを行いません。
       </p></dd><dt><span class="term"><code class="option">-v</code><br /></span><span class="term"><code class="option">--verbose</code></span></dt><dd><p>冗長モードを指定します。
これを指定すると、<span class="application">pg_dumpall</span>は開始時刻と終了時刻をダンプファイルに、進行メッセージを標準エラーに出力するようになります。
また、これにより<span class="application">pg_dump</span>の冗長出力が有効になります。
       </p></dd><dt><span class="term"><code class="option">-V</code><br /></span><span class="term"><code class="option">--version</code></span></dt><dd><p><span class="application">pg_dumpall</span>のバージョンを表示し、終了します。
       </p></dd><dt><span class="term"><code class="option">-x</code><br /></span><span class="term"><code class="option">--no-privileges</code><br /></span><span class="term"><code class="option">--no-acl</code></span></dt><dd><p>アクセス権限のダンプ（grant/revokeコマンド）を行いません。
       </p></dd><dt><span class="term"><code class="option">--binary-upgrade</code></span></dt><dd><p>このオプションは現位置でのアップグレード用のユーティリティにより使用されるものです。
他の目的での使用は推奨されませんし、サポートもされません。
このオプションの動作は、将来通知することなく変更される可能性があります。
       </p></dd><dt><span class="term"><code class="option">--column-inserts</code><br /></span><span class="term"><code class="option">--attribute-inserts</code></span></dt><dd><p>明示的に列名を付けた<code class="command">INSERT</code>コマンド（<code class="literal">INSERT INTO <em class="replaceable"><code>table</code></em> (<em class="replaceable"><code>column</code></em>, ...) VALUES...</code>）としてダンプします。
これによりリストアは非常に遅くなります。
主に、<span class="productname">PostgreSQL</span>以外のデータベースにロード可能なダンプを作成する時に有用です。
       </p></dd><dt><span class="term"><code class="option">--disable-dollar-quoting</code></span></dt><dd><p>このオプションは、関数本体用のドル引用符の使用を無効にし、強制的に標準SQLの文字列構文を使用した引用符付けを行います。
       </p></dd><dt><span class="term"><code class="option">--disable-triggers</code></span></dt><dd><p>このオプションは、データのみのダンプを作成する場合だけに使用します。
データのリロード中に、対象とするテーブル上のトリガを一時的に使用不可にするためのコマンドを出力するよう<span class="application">pg_dumpall</span>に指示します。
このオプションは、データのリロード中には呼び出したくない参照整合性検査やその他のトリガがテーブル上にある場合に使用します。
       </p><p>現在のところ、<code class="option">--disable-triggers</code>を指定してコマンドを実行するのは、スーパーユーザでなければなりません。
そのため、<code class="option">-S</code>でスーパーユーザの名前を指定するか、あるいは、可能であれば、スーパーユーザ権限でスクリプトを開始するよう注意する必要があります。
       </p></dd><dt><span class="term"><code class="option">--if-exists</code></span></dt><dd><p>データベースおよび他のオブジェクトを初期化するときに、条件コマンドを追加します(つまり<code class="literal">IF EXISTS</code>句を追加します)。
このオプションは、<code class="option">--clean</code>も指定されているのでなければ、有効にはなりません。
       </p></dd><dt><span class="term"><code class="option">--inserts</code></span></dt><dd><p>データを（<code class="command">COPY</code>ではなく）<code class="command">INSERT</code>コマンドとしてダンプします。
これを行うとリストアが非常に遅くなります。
主に<span class="productname">PostgreSQL</span>以外のデータベースにロード可能なダンプを作成する時に有用です。
列の順序を変更した場合はリストアが失敗する可能性があることに注意してください。
さらに低速になりますが、<code class="option">--column-inserts</code>オプションの方が安全です。
       </p></dd><dt><span class="term"><code class="option">--lock-wait-timeout=<em class="replaceable"><code>timeout</code></em></code></span></dt><dd><p>ダンプ開始時に共有テーブルロックの獲得のために永遠に待機しません。
指定した<em class="replaceable"><code>timeout</code></em>の間にテーブルをロックすることができない場合は失敗します。
タイムアウトは<code class="command">SET statement_timeout</code>で受け付けられる任意の書式で指定することができます。
許される値はダンプ元のサーババージョンに依存して変わります。
しかし、7.3以降のすべてのバージョンでミリ秒単位の整数値は受け付けられます。
このオプションは7.3より前のサーバからダンプされた場合、無視されます。
       </p></dd><dt><span class="term"><code class="option">--no-publications</code></span></dt><dd><p>パブリケーションをダンプしません。
       </p></dd><dt><span class="term"><code class="option">--no-role-passwords</code></span></dt><dd><p>ロールのパスワードをダンプしません。
リストア時にロールのパスワードはNULLになるため、パスワードが設定されるまでは、パスワード認証は常に失敗します。
このオプションが指定された場合、パスワードの値が不要となるので、ロール情報は<code class="structname">pg_authid</code>ではなく、カタログビューの<code class="structname">pg_roles</code>から読み取られます。
従って、<code class="structname">pg_authid</code>へのアクセスが何らかのセキュリティーポリシーによって制限されている場合にも、このオプションは役立ちます。
       </p></dd><dt><span class="term"><code class="option">--no-security-labels</code></span></dt><dd><p>セキュリティラベルをダンプしません。
       </p></dd><dt><span class="term"><code class="option">--no-subscriptions</code></span></dt><dd><p>サブスクリプションをダンプしません。
       </p></dd><dt><span class="term"><code class="option">--no-sync</code></span></dt><dd><p>デフォルトでは、<code class="command">pg_dumpall</code>はすべてのファイルが確実にディスクに書き込まれるまで待機します。
このオプションを使うと<code class="command">pg_dumpall</code>は待機せずに戻るため、より高速になりますが、これは、その後にオペレーティングシステムがクラッシュすると、ダンプが破損する可能性があることを意味します。
一般的に言って、このオプションはテスト用には有用ですが、実運用の環境からデータをダンプするときには使用しないほうが良いでしょう。
       </p></dd><dt><span class="term"><code class="option">--no-tablespaces</code></span></dt><dd><p>オブジェクト用にテーブル空間を作成または選択するコマンドを出力しません。
このオプションを付けると、すべてのオブジェクトはリストア時のデフォルトのテーブル空間内に作成されます。
       </p></dd><dt><span class="term"><code class="option">--no-unlogged-table-data</code></span></dt><dd><p>ログを取らないテーブルの内容をダンプしません。
このオプションはテーブル定義（スキーマ）をダンプするかどうかには影響しません。
そのテーブルデータのダンプを抑制するだけです。
       </p></dd><dt><span class="term"><code class="option">--quote-all-identifiers</code></span></dt><dd><p>強制的にすべての識別子に引用符を付与します。
このオプションは、<span class="application">pg_dumpall</span>のメジャーバージョンとは異なるメジャーバージョンの<span class="productname">PostgreSQL</span>のサーバーからデータベースをダンプするとき、あるいは出力を異なるメジャーバージョンのサーバにロードする予定であるときに推奨されます。
デフォルトでは、<span class="application">pg_dumpall</span>は、それ自身のメジャーバージョンにおける予約語である識別子に対してのみ引用符を付与します。
これは、他のバージョンのサーバを処理するときに互換性の問題を引き起こす場合があります。
他のバージョンのサーバでは予約語の集合が多少、異なる場合があるからです。
<code class="option">--quote-all-identifiers</code>を使用することで、ダンプのスクリプトが読みにくくなりますが、このような問題を防ぐことができます。
       </p></dd><dt><span class="term"><code class="option">--use-set-session-authorization</code></span></dt><dd><p><code class="command">ALTER OWNER</code>コマンドの代わりに標準SQLの<code class="command">SET SESSION AUTHORIZATION</code>コマンドを出力します。
これにより、ダンプの標準への互換性が高まりますが、ダンプ内のオブジェクトの履歴によっては正しくリストアされない可能性があります。
       </p></dd><dt><span class="term"><code class="option">-?</code><br /></span><span class="term"><code class="option">--help</code></span></dt><dd><p><span class="application">pg_dumpall</span>コマンドライン引数の使用方法を表示し、終了します。
       </p></dd></dl></div><p>
   </p><p>以下のコマンドラインオプションは、データベース接続パラメータを制御します。

   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-d <em class="replaceable"><code>connstr</code></em></code><br /></span><span class="term"><code class="option">--dbname=<em class="replaceable"><code>connstr</code></em></code></span></dt><dd><p>サーバに接続するために使用されるパラメータを接続文字列として指定します。
詳しくは<a class="xref" href="libpq-connect.html#LIBPQ-CONNSTRING" title="33.1.1. 接続文字列">Section 33.1.1</a>を参照してください。
       </p><p>このオプションは、他のクライアントアプリケーションとの一貫性のために<code class="literal">--dbname</code>と呼ばれます。
しかし<span class="application">pg_dumpall</span>は多くのデータベースに接続しなければなりませんので、接続文字列内のデータベース名は無視されます。
グローバルオブジェクトをダンプするために使用されるデータベースの名前を指定するため、または他のどのデータベースをダンプしなければならないかを見つけるためには<code class="literal">-l</code>を使用してください。
       </p></dd><dt><span class="term"><code class="option">-h <em class="replaceable"><code>host</code></em></code><br /></span><span class="term"><code class="option">--host=<em class="replaceable"><code>host</code></em></code></span></dt><dd><p>データベースサーバが稼働しているマシンのホスト名を指定します。
この値がスラッシュから始まる場合、Unixドメインソケット用のディレクトリとして使用されます。
デフォルトは、設定されていれば環境変数<code class="envar">PGHOST</code>から取得されます。設定されていなければ、Unixドメインソケット接続とみなされます。
       </p></dd><dt><span class="term"><code class="option">-l <em class="replaceable"><code>dbname</code></em></code><br /></span><span class="term"><code class="option">--database=<em class="replaceable"><code>dbname</code></em></code></span></dt><dd><p>グローバルオブジェクトをダンプし、他のどのデータベースをダンプすべきかを見つけるために接続するデータベースの名前を指定します。
指定されなかった場合、<code class="literal">postgres</code>が使用されます。
もしこれも存在しない場合は<code class="literal">template1</code>が使用されます。
       </p></dd><dt><span class="term"><code class="option">-p <em class="replaceable"><code>port</code></em></code><br /></span><span class="term"><code class="option">--port=<em class="replaceable"><code>port</code></em></code></span></dt><dd><p>サーバが接続を監視するTCPポートもしくはローカルUnixドメインソケットファイルの拡張子を指定します。
デフォルトは、設定されている場合、環境変数<code class="envar">PGPORT</code>の値になります。設定されていなければ、コンパイル時のデフォルト値となります。
       </p></dd><dt><span class="term"><code class="option">-U <em class="replaceable"><code>username</code></em></code><br /></span><span class="term"><code class="option">--username=<em class="replaceable"><code>username</code></em></code></span></dt><dd><p>接続ユーザ名です。
       </p></dd><dt><span class="term"><code class="option">-w</code><br /></span><span class="term"><code class="option">--no-password</code></span></dt><dd><p>パスワードの入力を促しません。
サーバがパスワード認証を必要とし、かつ、<code class="filename">.pgpass</code>ファイルなどの他の方法が利用できない場合、接続試行は失敗します。
バッチジョブやスクリプトなどパスワードを入力するユーザが存在しない場合にこのオプションは有用かもしれません。
       </p></dd><dt><span class="term"><code class="option">-W</code><br /></span><span class="term"><code class="option">--password</code></span></dt><dd><p>データベースに接続する前に、<span class="application">pg_dumpall</span>は強制的にパスワード入力を促します。
       </p><p>サーバがパスワード認証を要求する場合<span class="application">pg_dumpall</span>は自動的にパスワード入力を促しますので、これが重要になることはありません。
しかし、<span class="application">pg_dumpall</span>は、サーバにパスワードが必要かどうかを判断するための接続試行を無駄に行います。
こうした余計な接続試行を防ぐために<code class="option">-W</code>の入力が有意となる場合もあります。
       </p><p>パスワードの入力はダンプするデータベース毎に繰り返し促されます。
通常は、手作業のパスワード入力に依存するよりも<code class="filename">~/.pgpass</code>を設定する方が良いでしょう。
       </p></dd><dt><span class="term"><code class="option">--role=<em class="replaceable"><code>rolename</code></em></code></span></dt><dd><p>ダンプを作成する際に使用するロール名を指定します。
このオプションにより<span class="application">pg_dumpall</span>はデータベースに接続した後に<code class="command">SET ROLE</code> <em class="replaceable"><code>rolename</code></em>コマンドを発行するようになります。
認証に使用したユーザ（<code class="option">-U</code>で指定されたユーザ）が<span class="application">pg_dumpall</span>で必要とされる権限を持たないが、必要な権限を持つロールに切り替えることができる場合に有用です。
一部のインストレーションではスーパーユーザとして直接ログインさせないポリシーを取ることがありますが、このオプションを使用することでポリシーに反することなくダンプを作成することができます。
       </p></dd></dl></div><p>
  </p></div><div class="refsect1" id="id-1.9.4.13.7"><h2>環境</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="envar">PGHOST</code><br /></span><span class="term"><code class="envar">PGOPTIONS</code><br /></span><span class="term"><code class="envar">PGPORT</code><br /></span><span class="term"><code class="envar">PGUSER</code></span></dt><dd><p>      デフォルトの接続パラメータです。
     </p></dd></dl></div><p>また、このユーティリティは、他のほとんどの<span class="productname">PostgreSQL</span>ユーティリティと同様、<span class="application">libpq</span>でサポートされる環境変数を使用します（<a class="xref" href="libpq-envars.html" title="33.14. 環境変数">Section 33.14</a>を参照してください）。
  </p></div><div class="refsect1" id="id-1.9.4.13.8"><h2>注釈</h2><p><span class="application">pg_dumpall</span>は、内部で<span class="application">pg_dump</span>を呼び出すので、診断メッセージの一部では<span class="application">pg_dump</span>を参照しています。
  </p><p>オプティマイザが正確な統計情報を使用できるように、リストア後は、リストアしたテーブルそれぞれに対して<code class="command">ANALYZE</code>を実行することを勧めます。
また、<code class="command">vacuumdb -a -z</code>を実行すると、全てのデータベースを解析することができます。
  </p><p><span class="application">pg_dumpall</span>では、必要なテーブル空間用のディレクトリがリストア前に存在していることを要求します。
存在しないと、デフォルト以外の場所にあるデータベースに関して、そのデータベース生成が失敗します。
  </p></div><div class="refsect1" id="APP-PG-DUMPALL-EX"><h2>例</h2><p>全てのデータベースを書き出す場合、以下のようにします。

</p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>pg_dumpall &gt; db.out</code></strong></pre><p>
  </p><p>上記のファイルからデータベースを読み込む場合、以下のようにします。
</p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>psql -f db.out postgres</code></strong></pre><p>
（ここではどのデータベースに接続するかということは重要ではありません。
なぜなら<span class="application">pg_dumpall</span>が作成するスクリプトファイルには、保存されたデータベースの作成および接続のためのコマンドが含まれているからです。）
  </p></div><div class="refsect1" id="id-1.9.4.13.10"><h2>関連項目</h2><p>発生し得るエラーの原因については、<a class="xref" href="app-pgdump.html" title="pg_dump"><span class="refentrytitle">pg_dump</span></a>を参照してください。
  </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="app-pgdump.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="reference-client.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="app-pg-isready.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">pg_dump </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> <span class="application">pg_isready</span></td></tr></table></div></body></html>