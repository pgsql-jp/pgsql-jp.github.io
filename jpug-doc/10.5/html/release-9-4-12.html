<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>E.40. リリース9.4.12</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="release-9-4-13.html" title="E.39. リリース9.4.13" /><link rel="next" href="release-9-4-11.html" title="E.41. リリース9.4.11" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">E.40. リリース9.4.12</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="release-9-4-13.html" title="E.39. リリース9.4.13">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="release.html" title="Appendix E. リリースノート">Up</a></td><th width="60%" align="center">Appendix E. リリースノート</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="release-9-4-11.html" title="E.41. リリース9.4.11">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="RELEASE-9-4-12"><div class="titlepage"><div><div><h2 class="title" style="clear: both">E.40. リリース9.4.12</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="release-9-4-12.html#id-1.11.6.44.4">E.40.1. バージョン9.4.12への移行</a></span></dt><dt><span class="sect2"><a href="release-9-4-12.html#id-1.11.6.44.5">E.40.2. 変更点</a></span></dt></dl></div><p><strong>リリース日: </strong>2017-05-11</p><p>このリリースは9.4.11に対し、各種不具合を修正したものです。
9.4メジャーリリースにおける新機能については、<a class="xref" href="release-9-4.html" title="E.52. リリース9.4">Section E.52</a>を参照してください。
  </p><div class="sect2" id="id-1.11.6.44.4"><div class="titlepage"><div><div><h3 class="title">E.40.1. バージョン9.4.12への移行</h3></div></div></div><p>9.4.Xからの移行ではダンプ/リストアは不要です。
   </p><p>しかしながら、認証にユーザパスワードを利用する外部データサーバを使っている場合には、以下の変更点の1番目の項目を参照してください。
   </p><p>また、<span class="quote">“<span class="quote">ロジカルデコーディング</span>”</span>に依存したサードパーティレプリケーションツールを使っている場合には、以下の変更点の4番目の項目を参照してください。
   </p><p>また、9.4.11よりも前のリリースからアップグレードする場合は、<a class="xref" href="release-9-4-11.html" title="E.41. リリース9.4.11">Section E.41</a>を参照して下さい。
   </p></div><div class="sect2" id="id-1.11.6.44.5"><div class="titlepage"><div><div><h3 class="title">E.40.2. 変更点</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>ユーザマッピングオプションとして格納されたパスワードを保護するため、<code class="structname">pg_user_mappings</code>.<code class="structfield">umoptions</code>の可視性を厳格化しました。
(Michael Paquier, Feike Steenbergen)
     </p><p>これまでのコードは、外部サーバオブジェクトの所有者やサーバの<code class="literal">USAGE</code>権限を付与されているユーザに、そのサーバに関連した全てのユーザマッピングのオプションを参照することを許していました。
これには他のユーザのパスワードがしっかり含まれているかもしれません。
<code class="structname">information_schema.user_mapping_options</code>の振る舞いと一致するように、すなわち、これらオプションがマップされているユーザに、またはマッピングが<code class="literal">PUBLIC</code>で現在ユーザがサーバ所有者の場合に、あるいは現在ユーザがスーパーユーザである場合に、可視であるようにビュー定義を修正しました。
(CVE-2017-7486)
     </p><p>このパッチのみでは新たにinitdbされたデータベースでの動作しか修正しません。
この変更を既存のデータベースに適用するには、<a class="xref" href="release-9-4-13.html" title="E.39. リリース9.4.13">Section E.39</a>にあるCVE-2017-7547に対する変更点に示した正しい手順に従ってください。
     </p></li><li class="listitem"><p>漏洩のある演算子を通した統計情報の露出を防止しました。
(Peter Eisentraut)
     </p><p>プランナの一部の選択率見積関数は、ユーザ定義演算子を頻出値やヒストグラム項目のような<code class="structname">pg_statistic</code>から取得された値に適用します。
これはテーブル権限がチェックされる前に行われるので、悪意のユーザがこの振る舞いを読み取り権限を持たないテーブル列の値を取得するために悪用するおそれがありました。
修正するため、演算子の実装関数が漏洩防止を保証されておらず、呼び出しているユーザが統計情報を要するテーブル列の読み取り権限を持っていない場合には、デフォルトの見積で代用するようにしました。
実際はたいていのケースでこれら基準のうち少なくとも一つを満たします。
(CVE-2017-7484)
     </p></li><li class="listitem"><p><span class="application">libpq</span>の<code class="envar">PGREQUIRESSL</code>環境変数の認識が復旧されました。
(Daniel Gustafsson)
     </p><p>環境変数の処理が<span class="productname">PostgreSQL</span> 9.3で意図せず外されていましたが、
ドキュメントはそのままでした。
ユーザがSSL暗号化接続を強制するために、もはや保証されないであろうこの環境変数に依存しているかもしれず、これはセキュリティ上の危険を生じさせます。
この環境変数の処理を復旧しましたが、9.3以降のコードで正しく動作している設定を壊さないように、<code class="envar">PGSSLMODE</code>よりも低い優先順位を与えました。
(CVE-2017-7485)
     </p></li><li class="listitem"><p>ロジカルデコーディング中の初期スナップショットが無効になる可能性があり、これを修正しました。
(Petr Jelinek, Andres Freund)
     </p><p>ロジカルデコーディングのレプリケーションスロットむけに作られた初期スナップショットが潜在的に不正となりえました。
これによりロジカルデコーディングを使うサードパーティツールが不完全あるいは不正な初期データのコピーをする可能性があります。
ソースサーバがスロットを作るときに高負荷特の場合、または、他のロジカルスロットが既に存在している場合に特に発生しやすい現象です。
     </p><p>ロジカルデコーディングに依存したレプリケーションツールを使っていて、レプリケーション開始時に空でないデータセットをコピーしたであろう場合には、アップグレードを導入した後にレプリカを再作成するか、ソースサーバと比較してその内容を検証することが推奨されます。
     </p></li><li class="listitem"><p>ログをとらないインデックスの<span class="quote">“<span class="quote">初期フォーク</span>”</span>の破損を修正しました。
(Robert Haas, Michael Paquier)
     </p><p>これによりクラッシュと再起動の後に、ログをとらないインデックスが不正な状態になるおそれがありました。
この問題はインデックスが削除、再構築されるまで持続するでしょう。
     </p></li><li class="listitem"><p>スタンバイサーバが、準備されているけれどコミットされていない2相トランザクションを再生するときの<code class="structname">pg_subtrans</code>の項目の誤った再構築を修正しました。
(Tom Lane)
     </p><p>大抵の場合は目に見える悪影響には至りませんが、稀な場合に<code class="structname">pg_subtrans</code>で循環参照になり、2相トランザクションで修正された行を検査する問い合わせで潜在的に無限ループをひき起こす可能性がありました。
     </p></li><li class="listitem"><p>文字列バッファ初期化の失敗による<span class="application">walsender</span>でのクラッシュの可能性を回避しました。
(Stas Kelvich, Fujii Masao)
     </p></li><li class="listitem"><p>バックグラウンドワーカプロセスについての<code class="function">fork()</code>失敗に対するpostmasterの処理が修正されました。
(Tom Lane)
     </p><p>これまでは、postmasterはプロセスが正常に起動されたかのようにワーカ状態の一部を更新していて、結果としてその後に混乱が生じていました。
     </p></li><li class="listitem"><p>拡張のスクリプトで問い合わせの構文解析に直前のDDLの結果が見えることを保証しました。
(Julien Rouhaud, Tom Lane)
     </p><p>拡張のスクリプトファイル内のコマンド間でキャッシュをフラッシュする手順が欠けていたため、ユーティリティ以外の問い合わせには直前の<code class="command">ALTER TABLE ... RENAME</code>のようなカタログ変更の結果が見えないかもしれませんでした。
     </p></li><li class="listitem"><p><code class="command">ALTER TABLE ... ALTER COLUMN TYPE</code>が既存インデックスを再構築するときのテーブルスペースの権限検査を省略しました。
(Noah Misch)
     </p><p>呼び出すユーザがインデックスを含むテーブルスペースに対する<code class="literal">CREATE</code>権限をそのとき持っていなかった場合、コマンドは失敗していました。
この振る舞いは役に立たないと考えられるので、検査を省略し、ここではインデックスを再構築できるようにしました。
     </p></li><li class="listitem"><p>制約が<code class="literal">NO INHERIT</code>と印付けされているときには、<code class="command">ALTER TABLE ... VALIDATE CONSTRAINT</code>が子テーブルに再帰処理をしないように修正しました。
(Amit Langote)
     </p><p>この修正は一致する制約が子テーブルに無いときに望まれない<span class="quote">“<span class="quote">constraint does not exist（制約がありません）</span>”</span>エラーになるのを防ぎます。
     </p></li><li class="listitem"><p>ページピンの競合によりスキャンできなかったページを適切に計算するように<code class="command">VACUUM</code>を修正しました。
(Andrew Gierth)
     </p><p>これはテーブルのタプル数の過小見積をもたらす傾向がありました。
小さくて競合が激しいテーブルという最悪の場合には、<code class="command">VACUUM</code>がテーブルにはタプルが一切含まれないという不正な報告をして、非常に悪いプラン選択をもたらす可能性がありました。
     </p></li><li class="listitem"><p>ハッシュ結合の中での大量タプル転送ループを問い合わせキャンセル要求により確実に割り込みできるようにしました。
(Tom Lane, Thomas Munro)
     </p></li><li class="listitem"><p><code class="type">interval</code>の比較で整数オーバーフロー問題を修正しました。
(Kyotaro Horiguchi, Tom Lane)
     </p><p>約296000年より大きい期間に対して<code class="type">interval</code>型の比較演算子が誤った答えを生み出す可能性がありました。
このような大きい値を含む列のインデックスは壊れているかもしれないので、インデックス再構築をしたほうがよいです。
     </p></li><li class="listitem"><p><em class="replaceable"><code>tableforest</code></em> = falseのとき、<code class="function">cursor_to_xml()</code>が正しいな出力をするように修正しました。
(Thomas Munro, Peter Eisentraut)
     </p><p>これまでは<code class="literal">&lt;table&gt;</code>要素の囲みを生成していませんでした。
     </p></li><li class="listitem"><p><code class="function">float8_timestamptz()</code>と<code class="function">make_interval()</code>で端数丸めの問題を修正しました。
(Tom Lane)
     </p><p>これら関数は浮動小数点の値から整数のマイクロ秒に変換するときに丸めでなく、切り捨てをしていました。これにより予期せずひとつ少ない結果がもたらされる可能性がありました。
     </p></li><li class="listitem"><p><code class="structname">pg_timezone_names</code>ビューの性能を改善しました。
(Tom Lane, David Rowley)
     </p></li><li class="listitem"><p>多数の大きいブロックを含むコンテキストについてメモリ管理オーバーヘッドを軽減しました。
(Tom Lane)
     </p></li><li class="listitem"><p><code class="function">lseek()</code>と<code class="function">close()</code>の稀な場合のエラーに対するいいかげんな処理を修正しました。
(Tom Lane)
     </p><p>どちらも通常ではあまり失敗しないシステムコールですが、失敗した場合には<code class="filename">fd.c</code>がかなり混乱する可能性がありました。
     </p></li><li class="listitem"><p>postmasterがWindowsサービスとして実行しているかどうかの誤った検査を修正しました。
(Michael Paquier)
     </p><p>これは、アクセス不能であるときにイベントログに書き出しを試みて、そのため全くログが書かれない結果をもたらしました。
     </p></li><li class="listitem"><p><code class="command">COMMIT PREPARED</code>と<code class="command">ROLLBACK PREPARED</code>に対応するように<span class="application">ecpg</span>を修正しました。
(Masahiko Sawada)
     </p></li><li class="listitem"><p><span class="application">ecpg</span>で、$でクォートされた文字列リテラルを処理する際の二重解放エラーを修正しました。
(Michael Meskes)
     </p></li><li class="listitem"><p><span class="application">pg_dump</span>で、コメントとデータベースオブジェクトのいくつかのタイプのセキュリティラベルに対する、誤ったスキーマと所有者の印付けを修正しました。
(Giuseppe Broccolo, Tom Lane)
     </p><p>単純な使い方の場合には悪影響はありませんが、例えばスキーマを指定したリストアでは含まれるべきコメントが無視される可能性がありました。これはダンプ時にそれらが関連するオブジェクトのスキーマに属するという印付けがされなかったためです。
     </p></li><li class="listitem"><p><code class="literal">pg_restore -l</code>で、SQLオブジェクト名に改行が含まれるときに無効なリストファイルが出力されるのを回避しました。
(Tom Lane)
     </p><p>改行を空白で置き換えました。出力を<code class="literal">pg_restore -L</code>の用途に使えるようにするにはこれで十分です。
     </p></li><li class="listitem"><p><span class="quote">“<span class="quote">ラージオブジェクト</span>”</span>(BLOB)に付けられたコメントとセキュリティラベルを移行するように<span class="application">pg_upgrade</span>を修正しました。
(Stephen Frost)
     </p><p>これまで、ラージオブジェクトは新データベースに正しく移行されていましたが、それに付加されたコメントとセキュリティラベルが失われていました。
     </p></li><li class="listitem"><p><code class="filename">contrib/adminpack</code>の<code class="function">pg_file_write()</code>関数でエラー処理を改善しました。
(Noah Misch)
     </p><p>特に<code class="function">fclose()</code>から報告されたエラーを検知していませんでした。
     </p></li><li class="listitem"><p><code class="filename">contrib/dblink</code>で新たな無名接続を確立するときに、前の無名接続がリークするのを回避しました。
(Joe Conway)
     </p></li><li class="listitem"><p><code class="filename">contrib/pg_trgm</code>の正規表現からのトライグラム抽出を修正しました。
(Tom Lane)
     </p><p>場合によっては、何にも決してマッチしない壊れたデータ構造を生み出し、トライグラムインデックスを使うGINまたはGiSTのインデックススキャンが正規表現へのマッチを何も見つけられない結果になります。
     </p></li><li class="listitem"><p><code class="filename">contrib/postgres_fdw</code>にて、リモートサーバに問い合わせキャンセル要求を伝播するようにしました。
(Michael Paquier, Etsuro Fujita)
     </p><p>これまでは、ローカル問い合わせのキャンセル要求は送信済みのリモート問い合わせを早く終了させませんでした。
これは元々9.6で行われた作業のバックパッチです。
     </p></li><li class="listitem"><p>OpenSSL 1.1.0に対応しました。
(Heikki Linnakangas, Andreas Karlsson, Tom Lane)
     </p><p>これはより新しいブランチで以前行なわれた作業のバックパッチです。多くのプラットフォームがOpenSSLの新しいバージョンを採用しているため、必要です。
     </p></li><li class="listitem"><p>MSVCビルドでTcl 8.6に対応しました。
(Álvaro Herrera)
     </p></li><li class="listitem"><p>私たちのタイムゾーンライブラリのコピーをIANA release tzcode2017bに同期しました。
(Tom Lane)
     </p><p>これは、2038年1月の一部の夏時間遷移に影響するバグを修正します。
     </p></li><li class="listitem"><p>タイムゾーンデータファイルを<span class="application">tzdata</span> release 2017bに更新しました。チリ、ハイチ、モンゴルの夏時間法の変更、エクアドル、カザフスタン、リベリア、スペインの歴史的修正が含まれます。
南米、太平洋、インド洋、および、一部アジア・中東の国々における多数のタイムゾーンを、数字による省略形に切り替えました。
     </p><p>IANAタイムゾーンデータベースはこれまで全てのタイムゾーンについて文字による省略形を提供しましたが、地元の人々の間でほとんど、あるいは全く通用していない省略形をしばしば作成していました。
IANAは英語の省略形が現実に使われている形跡がないゾーンにおいてはUTCオフセット数値を使うことを選ぶという方針に転換しようとしてるところです。
少なくともしばらくの間、<span class="productname">PostgreSQL</span>はタイムスタンプの入力に、このような削除された省略形を引き続き受け入れます。
しかし、それらは<code class="structname">pg_timezone_names</code>ビューには現れず、出力にも使用されなくなります。
     </p></li><li class="listitem"><p>MSVC ビルドにおいて、POSIX形式のタイムゾーン名に対して正しい夏時間規則を使用するようにしました。
(David Rowley)
     </p><p>MicrosoftのMSVCビルドスクリプトは<code class="filename">posixrules</code>ファイルをタイムゾーンディレクトリツリーにインストールするのを怠っていました。
この結果、POSIX形式のタイムゾーン名に対し想定される夏時間の振る舞いについて、タイムゾーンコードがビルトインの規則に退行してしまっていました。
歴史的な理由により、その組み込み規則は、米国が2007年より前に使っていた夏時間規則（すなわち、4月最初の日曜日と 10月最終の日曜日の変更）に引き続き対応しています。
この修正にともない、POSIX形式のゾーン名は<code class="literal">US/Eastern</code>ゾーンの現在および歴史的な夏時間遷移日を使います。
そのようにしたくない場合には、<code class="filename">posixrules</code>ファイルを削除するか、他のゾーンファイルのコピーで置き換えてください（<a class="xref" href="datatype-datetime.html#DATATYPE-TIMEZONES" title="8.5.3. 時間帯">Section 8.5.3</a>参照）。
キャッシュ利用のため、このような変更を反映させるにはサーバの再起動が必要であることに注意してください。
     </p></li></ul></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="release-9-4-13.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="release.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="release-9-4-11.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">E.39. リリース9.4.13 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> E.41. リリース9.4.11</td></tr></table></div></body></html>