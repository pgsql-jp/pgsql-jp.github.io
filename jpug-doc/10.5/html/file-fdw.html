<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>F.15. file_fdw</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="earthdistance.html" title="F.14. earthdistance" /><link rel="next" href="fuzzystrmatch.html" title="F.16. fuzzystrmatch" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">F.15. file_fdw</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="earthdistance.html" title="F.14. earthdistance">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="contrib.html" title="Appendix F. 追加で提供されるモジュール">Up</a></td><th width="60%" align="center">Appendix F. 追加で提供されるモジュール</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="fuzzystrmatch.html" title="F.16. fuzzystrmatch">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="FILE-FDW"><div class="titlepage"><div><div><h2 class="title" style="clear: both">F.15. file_fdw</h2></div></div></div><a id="id-1.11.7.24.2" class="indexterm"></a><p><code class="filename">file_fdw</code>モジュールは、サーバのファイルシステムにあるデータファイルにアクセスするのに使用できる外部データラッパ<code class="function">file_fdw</code>を提供します。
サーバのファイルにアクセスしたり、サーバ上のプログラムを実行して出力を読み取ったりできます。
データファイルは<code class="command">COPY FROM</code>で読むことのできるフォーマットでなければなりません。
詳細は <a class="xref" href="sql-copy.html" title="COPY"><span class="refentrytitle">COPY</span></a> を参照してください。
データファイルへのアクセスは現時点では読み取り専用です。
 </p><p>このラッパーで作成された外部テーブルには以下のオプションを設定することができます。
 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">filename</code></span></dt><dd><p>読み取るファイルを指定します。
絶対パスでなければなりません。
<code class="literal">filename</code>か<code class="literal">program</code>のどちらかを指定できますが、両方は指定できません。
    </p></dd><dt><span class="term"><code class="literal">program</code></span></dt><dd><p>実行するコマンドを指定します。
このコマンドの標準出力を<code class="command">COPY FROM PROGRAM</code>が使用されたかのように読み込みます。
<code class="literal">program</code>か<code class="literal">filename</code>のどちらかを指定できますが、両方は指定できません。
    </p></dd><dt><span class="term"><code class="literal">format</code></span></dt><dd><p>データフォーマットを指定するもので、<code class="command">COPY</code>の<code class="literal">FORMAT</code>オプションと同じです。
    </p></dd><dt><span class="term"><code class="literal">header</code></span></dt><dd><p>データがヘッダ行を持つか指定するもので、<code class="command">COPY</code>の<code class="literal">HEADER</code>オプションと同じです。
    </p></dd><dt><span class="term"><code class="literal">delimiter</code></span></dt><dd><p>データの区切り文字を指定するもので、<code class="command">COPY</code>の<code class="literal">DELIMITER</code>オプションと同じです。
    </p></dd><dt><span class="term"><code class="literal">quote</code></span></dt><dd><p>データの引用符文字を指定するもので、<code class="command">COPY</code>の<code class="literal">QUOTE</code>オプションと同じです。
    </p></dd><dt><span class="term"><code class="literal">escape</code></span></dt><dd><p>データのエスケープ文字を指定するもので、<code class="command">COPY</code>の<code class="literal">ESCAPE</code>オプションと同じです。
    </p></dd><dt><span class="term"><code class="literal">null</code></span></dt><dd><p>データのNULL文字列を指定するもので、<code class="command">COPY</code>の<code class="literal">NULL</code>オプションと同じです。
    </p></dd><dt><span class="term"><code class="literal">encoding</code></span></dt><dd><p>データのエンコーディングを指定するもので、<code class="command">COPY</code>の<code class="literal">ENCODING</code>オプションと同じです。
    </p></dd></dl></div><p><code class="command">COPY</code>では<code class="literal">HEADER</code>といったオプションを対応する値なしで指定できるのに対して、外部データラッパの構文では全ての場合において値を指定する必要がある点に注意してください。
通常の値なしで指定される<code class="command">COPY</code>オプションを有効にするには、そのようなオプションはすべてbooleanであるため、代わりにTRUEを渡すことができます。
 </p><p>このラッパーを使って作られた外部テーブルのカラムは、以下のオプションを持つことができます。
 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">force_not_null</code></span></dt><dd><p>これはbooleanオプションです。
真の場合は、このカラムの値はNULL文字列(これはテーブルレベルの<code class="literal">null</code>オプションです)と比較されません。
これは、<code class="command">COPY</code>の<code class="literal">FORCE_NOT_NULL</code>オプションに列名を指定するのと同じ効果があります。
    </p></dd><dt><span class="term"><code class="literal">force_null</code></span></dt><dd><p>これはbooleanオプションです。
真の場合、NULL文字列と一致するこのカラムの値は、たとえ引用符で括られていたとしても<code class="literal">NULL</code>と返されます。
このオプションがなければ、NULL文字列と一致する引用符で括られていない値のみが<code class="literal">NULL</code>と返されます。
これは、<code class="command">COPY</code>の<code class="literal">FORCE_NULL</code>オプションに列名を指定するのと同じ効果があります。
    </p></dd></dl></div><p><code class="command">COPY</code>の<code class="literal">OIDS</code>、<code class="literal">FORCE_QUOTE</code>の各オプションは<code class="literal">file_fdw</code>では現在サポートされていません。
 </p><p>これらのオプションは外部テーブルまたはその列にのみ指定可能で、<code class="literal">file_fdw</code>外部データラッパやそれを使用するサーバ、ユーザマッピングのオプションには指定できません。
 </p><p>どのファイルから読み込むか、又はプログラムを実行するかをコントロールできるのはスーパーユーザーのみでなければならない、というセキュリティ上の理由から、テーブルレベルのオプションを変更するにはスーパーユーザ権限が必要です。
原則としては非スーパーユーザはその他のオプションを変更することを許されてもよいのですが、現時点ではサポートされていません。
 </p><p><code class="literal">program</code>オプションが指定されたとき、オプションの文字列がシェルによって実行されることに注意してください。
信頼できないソースをコマンド引数に渡す場合、シェルにとって特別な意味を持つ可能性のある文字を取り除くかエスケープするように注意する必要があります。
セキュリティ上の理由から、固定のコマンド文字列を使用するか、少なくともユーザー入力を渡さないようにすることをお勧めします。
 </p><p><code class="literal">file_fdw</code>を使用する外部テーブルでは、<code class="command">EXPLAIN</code>は読み込むファイルの名前又は実行しているプログラムを表示します。
<code class="literal">COSTS OFF</code>が指定されない場合は(バイト単位の)ファイルサイズも表示されます。
 </p><div class="example" id="id-1.11.7.24.14"><p class="title"><strong>Example F.1. PostgreSQL CSV ログ用の外部テーブル作成</strong></p><div class="example-contents"><p><code class="literal">file_fdw</code>の明確な用途の一つはPostgreSQLの活動ログをテーブルとして検索できるようにすることです。
これを実現するには、ここでは<code class="literal">pglog.csv</code>と呼ぶCSVファイルにログを記録している必要があります。
まず、<code class="literal">file_fdw</code>を拡張機能としてインストールします。
  </p><pre class="programlisting">CREATE EXTENSION file_fdw;</pre><p>続いて外部サーバを作成します。

</p><pre class="programlisting">CREATE SERVER pglog FOREIGN DATA WRAPPER file_fdw;</pre><p>
  </p><p>これで外部テーブルを作成する準備ができました。
<code class="command">CREATE FOREIGN TABLE</code>コマンドを使って、テーブルのカラム、CSVファイル名とそのフォーマットを定義する必要があるでしょう。

</p><pre class="programlisting">CREATE FOREIGN TABLE pglog (
  log_time timestamp(3) with time zone,
  user_name text,
  database_name text,
  process_id integer,
  connection_from text,
  session_id text,
  session_line_num bigint,
  command_tag text,
  session_start_time timestamp with time zone,
  virtual_transaction_id text,
  transaction_id bigint,
  error_severity text,
  sql_state_code text,
  message text,
  detail text,
  hint text,
  internal_query text,
  internal_query_pos integer,
  context text,
  query text,
  query_pos integer,
  location text,
  application_name text
) SERVER pglog
OPTIONS ( filename '/home/josh/data/log/pglog.csv', format 'csv' );</pre><p>
  </p><p>これで全てです。
もうあなたはログに直接検索を実行することができます。
実運用においては、もちろんログローテーションを処理する方法を定義する必要があるでしょう。
  </p></div></div><br class="example-break" /></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="earthdistance.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="contrib.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="fuzzystrmatch.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">F.14. earthdistance </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> F.16. fuzzystrmatch</td></tr></table></div></body></html>