<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>pg_restore</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="app-pgrecvlogical.html" title="pg_recvlogical" /><link rel="next" href="app-psql.html" title="psql" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">pg_restore</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="app-pgrecvlogical.html" title="pg_recvlogical">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="reference-client.html" title="PostgreSQLクライアントアプリケーション">Up</a></td><th width="60%" align="center">PostgreSQLクライアントアプリケーション</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="app-psql.html" title="psql">Next</a></td></tr></table><hr></hr></div><div class="refentry" id="APP-PGRESTORE"><div class="titlepage"></div><a id="id-1.9.4.17.1" class="indexterm"></a><div class="refnamediv"><h2><span class="refentrytitle">pg_restore</span></h2><p>pg_restore — <span class="application">pg_dump</span>によって作成されたアーカイブファイルから<span class="productname">PostgreSQL</span>データベースをリストアする
  </p></div><div class="refsynopsisdiv"><h2>Synopsis</h2><div class="cmdsynopsis"><p id="id-1.9.4.17.4.1"><code class="command">pg_restore</code> [<em class="replaceable"><code>connection-option</code></em>...] [<em class="replaceable"><code>option</code></em>...] [<em class="replaceable"><code>filename</code></em>]</p></div></div><div class="refsect1" id="APP-PGRESTORE-DESCRIPTION"><h2>説明</h2><p><span class="application">pg_restore</span>は、<a class="xref" href="app-pgdump.html" title="pg_dump"><span class="refentrytitle">pg_dump</span></a>によって作成された平文形式以外のアーカイブファイルを使って、<span class="productname">PostgreSQL</span>データベースをリストアするためのユーティリティです。
このコマンドは、データベースを再構成して保存された時点の状態にするために必要なコマンドを発行します。
また、<span class="application">pg_restore</span>は、アーカイブファイルから、リストアする内容を選択したり、リストアする前にアイテムの並び替えを行うこともできます。
アーカイブファイルはアーキテクチャに依存しない移植性を持つように設計されています。
  </p><p><span class="application">pg_restore</span>の操作には2つのモードがあります。
データベース名が指定された場合、<span class="application">pg_restore</span>はそのデータベースに接続し、アーカイブを直接そのデータベースにリストアします。
データベース名が指定されなかった場合は、データベースを再構築するために必要となるSQLコマンドが含まれたスクリプトが作成されます（ファイルもしくは標準出力に書き出されます）。
このスクリプトの出力は<span class="application">pg_dump</span>の平文形式の出力と同じです。
従って、出力を制御するオプションの中には、<span class="application">pg_dump</span>のオプションに類似したものがあります。
  </p><p>当然ながら、<span class="application">pg_restore</span>によって、アーカイブファイルに存在しない情報をリストアすることはできません。
例えば、アーカイブが<span class="quote">“<span class="quote"><code class="command">INSERT</code>コマンドの形式でデータダンプ</span>”</span>を行うオプションを使用して作成されたものであった場合、<span class="application">pg_restore</span>は<code class="command">COPY</code>文を使用してデータを読み込むことはできません。
  </p></div><div class="refsect1" id="APP-PGRESTORE-OPTIONS"><h2>オプション</h2><p><code class="command">pg_restore</code>は以下のコマンドライン引数を受け付けます。

    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><em class="replaceable"><code>filename</code></em></span></dt><dd><p>リストアするアーカイブファイル（ディレクトリ書式アーカイブの場合はディレクトリ）の場所を指定します。
指定がない場合は、標準入力が使用されます。
       </p></dd><dt><span class="term"><code class="option">-a</code><br /></span><span class="term"><code class="option">--data-only</code></span></dt><dd><p>データのみをリストアし、スキーマ（データ定義）はリストアしません。
アーカイブ内にある、テーブルデータ、ラージオブジェクト、シーケンス値がリストアされます。
       </p><p>このオプションは<code class="option">--section=data</code>を指定することと似ていますが、歴史的な理由により同一ではありません。
       </p></dd><dt><span class="term"><code class="option">-c</code><br /></span><span class="term"><code class="option">--clean</code></span></dt><dd><p>再作成前にデータベースオブジェクトを整理（削除）します。
（<code class="option">--if-exists</code>が使われなければ、対象のデータベースの中にオブジェクトがない場合に、害のないメッセージをいくつか出力するかもしれません。）
       </p></dd><dt><span class="term"><code class="option">-C</code><br /></span><span class="term"><code class="option">--create</code></span></dt><dd><p>リストア前にデータベースを作成します。
<code class="option">--clean</code>も同時に指定されている場合、接続する前に対象データベースを削除し再作成します。
       </p><p>このオプションがある場合、<code class="option">-d</code>で指定したデータベースは最初の<code class="command">DROP DATABASE</code>と<code class="command">CREATE DATABASE</code>コマンドの発行時にのみ使用されます。
そして、すべてのデータはアーカイブ内に記述された名前のデータベースにリストアされます。
       </p></dd><dt><span class="term"><code class="option">-d <em class="replaceable"><code>dbname</code></em></code><br /></span><span class="term"><code class="option">--dbname=<em class="replaceable"><code>dbname</code></em></code></span></dt><dd><p><em class="replaceable"><code>dbname</code></em>データベースに接続し、このデータベースに直接リストアします。
       </p></dd><dt><span class="term"><code class="option">-e</code><br /></span><span class="term"><code class="option">--exit-on-error</code></span></dt><dd><p>データベースにSQLコマンドを送信中にエラーが発生した場合、処理を終了します。
デフォルトでは、処理を続行し、リストア処理の最後に発生したエラーの数を表示します。
       </p></dd><dt><span class="term"><code class="option">-f <em class="replaceable"><code>filename</code></em></code><br /></span><span class="term"><code class="option">--file=<em class="replaceable"><code>filename</code></em></code></span></dt><dd><p>作成するスクリプト（<code class="option">-l</code>を使用した場合はアーカイブの一覧）の出力ファイルを指定します。
デフォルトは標準出力です。
       </p></dd><dt><span class="term"><code class="option">-F <em class="replaceable"><code>format</code></em></code><br /></span><span class="term"><code class="option">--format=<em class="replaceable"><code>format</code></em></code></span></dt><dd><p>アーカイブの形式を指定します。
<span class="application">pg_restore</span>は形式を自動認識するので、このオプションは必須ではありません。
指定する値は以下のいずれかになります。

       </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">c</code><br /></span><span class="term"><code class="literal">custom</code></span></dt><dd><p>アーカイブが<span class="application">pg_dump</span>のカスタム形式であることを表します。
          </p></dd><dt><span class="term"><code class="literal">d</code><br /></span><span class="term"><code class="literal">directory</code></span></dt><dd><p>アーカイブがディレクトリアーカイブであることを表します。
          </p></dd><dt><span class="term"><code class="literal">t</code><br /></span><span class="term"><code class="literal">tar</code></span></dt><dd><p>アーカイブが<code class="command">tar</code>アーカイブであることを表します。
          </p></dd></dl></div></dd><dt><span class="term"><code class="option">-I <em class="replaceable"><code>index</code></em></code><br /></span><span class="term"><code class="option">--index=<em class="replaceable"><code>index</code></em></code></span></dt><dd><p>指定したインデックスの定義のみをリストアします。
複数の<code class="option">-I</code>スイッチをつけることで複数のインデックスを指定できます。
       </p></dd><dt><span class="term"><code class="option">-j <em class="replaceable"><code>number-of-jobs</code></em></code><br /></span><span class="term"><code class="option">--jobs=<em class="replaceable"><code>number-of-jobs</code></em></code></span></dt><dd><p><span class="application">pg_restore</span>のもっとも時間がかかる部分、つまり、データのロード、インデックスの作成、制約の作成部分を複数の同時実行ジョブを使用して実行します。
このオプションは、複数プロセッサマシンで稼働するサーバに大規模なデータベースをリストアする時間を劇的に減らすことができます。
       </p><p>各ジョブは1プロセスまたは1スレッド(オペレーティングシステムに依存)です。
各ジョブはサーバへの別々の接続を使用します。
       </p><p>このオプションの最適値はサーバ、クライアント、ネットワークのハードウェア構成に依存します。
要素にはCPUコア数やディスク構成も含まれます。
試行する最初の値としてサーバのCPUコア数を勧めます。
しかし、多くの場合これより大きな値でもリストア時間を高速化することができます。
当然ながらあまりに大きな値を使用すると、スラッシングのために性能が劣化することになります。
       </p><p>カスタムアーカイブ書式およびディレクトリアーカイブ書式のみがこのオプションをサポートします。
入力ファイルは通常のファイルまたはディレクトリでなければなりません（例えばパイプはいけません）。
このオプションは、直接データベースサーバに接続するのではなく、スクリプトを生成する場合に無視されます。
また、複数ジョブは<code class="option">--single-transaction</code>オプションといっしょに使用することはできません。
       </p></dd><dt><span class="term"><code class="option">-l</code><br /></span><span class="term"><code class="option">--list</code></span></dt><dd><p>アーカイブの内容を一覧表として出力します。
このコマンドが出力する一覧は、<code class="option">-L</code>オプションに対する入力として使用することができます。
<code class="option">-n</code>や<code class="option">-t</code>などのフィルタオプションを<code class="option">-l</code>といっしょに使用すると、一覧出力する項目が制限されます。
       </p></dd><dt><span class="term"><code class="option">-L <em class="replaceable"><code>list-file</code></em></code><br /></span><span class="term"><code class="option">--use-list=<em class="replaceable"><code>list-file</code></em></code></span></dt><dd><p><em class="replaceable"><code>list-file</code></em>内で指定したアーカイブ要素のみをリストアします。
また、それらはそのファイルの出現順にリストアされます。
<code class="option">-n</code>や<code class="option">-t</code>などのフィルタオプションを<code class="option">-L</code>といっしょに使用すると、リストアする項目がさらに制限されます。
       </p><p><em class="replaceable"><code>list-file</code></em>は通常、事前に行った<code class="option">-l</code>操作の出力を編集して作成されます。
行の移動や削除、または、行の先頭にセミコロン(<code class="literal">;</code>)を付けてコメントアウトすることが可能です。
後述の例を参照してください。
       </p></dd><dt><span class="term"><code class="option">-n <em class="replaceable"><code>schema</code></em></code><br /></span><span class="term"><code class="option">--schema=<em class="replaceable"><code>schema</code></em></code></span></dt><dd><p>指定されたスキーマ内のオブジェクトのみをリストアします。
複数の<code class="option">-n</code>スイッチをつけることで複数のスキーマを指定できます。
これは特定のテーブルのみをリストアするために<code class="option">-t</code>オプションと組み合わせることができます。
       </p></dd><dt><span class="term"><code class="option">-N <em class="replaceable"><code>schema</code></em></code><br /></span><span class="term"><code class="option">--exclude-schema=<em class="replaceable"><code>schema</code></em></code></span></dt><dd><p>指定したスキーマ内にあるオブジェクトをリストアしません。
<code class="option">-N</code>オプションを複数回指定することで、複数のスキーマを除外することができます。
       </p><p>同じスキーマ名が<code class="option">-n</code>と<code class="option">-N</code>の両方で指定された場合は、<code class="option">-N</code>オプションが優先し、そのスキーマは除外されます。
       </p></dd><dt><span class="term"><code class="option">-O</code><br /></span><span class="term"><code class="option">--no-owner</code></span></dt><dd><p>オブジェクトの所有者を元のデータベースに合わせるためのコマンドを出力しません。
デフォルトでは、<span class="application">pg_restore</span>は、<code class="command">ALTER OWNER</code>または<code class="command">SET SESSION AUTHORIZATION</code>を発行して、作成したスキーマ要素の所有者を設定します。
データベースに最初に接続したのがスーパーユーザ（もしくは、そのスクリプト内の全てのオブジェクトを所有するユーザ）でない場合、これらの文は失敗します。
<code class="option">-O</code>を付与すると、初期接続に任意のユーザ名を使用できるようになります。ただし、この場合は、全てのオブジェクトの所有者がリストアしたユーザになります。
       </p></dd><dt><span class="term"><code class="option">-P <em class="replaceable"><code>function-name(argtype [, ...])</code></em></code><br /></span><span class="term"><code class="option">--function=<em class="replaceable"><code>function-name(argtype [, ...])</code></em></code></span></dt><dd><p>指定した関数のみをリストアします。
関数や引数の名前は、ダンプファイルの一覧で出力される通りのスペルで正確に入力するよう注意してください。
複数の<code class="option">-P</code>スイッチをつけることで複数の関数を指定できます。
       </p></dd><dt><span class="term"><code class="option">-R</code><br /></span><span class="term"><code class="option">--no-reconnect</code></span></dt><dd><p>このオプションは廃止されました。後方互換性を保持するために受け入れられています。
       </p></dd><dt><span class="term"><code class="option">-s</code><br /></span><span class="term"><code class="option">--schema-only</code></span></dt><dd><p>アーカイブ内にあるスキーマ項目の範囲でスキーマ（データ定義）のみをリストアし、データ（テーブルの内容）をリストアしません。

       </p><p>このオプションは<code class="option">--data-only</code>の逆です。
このオプションは<code class="option">--section=pre-data --section=post-data</code>を指定することと似ていますが、歴史的な理由により同一ではありません。
       </p><p>（これと<code class="option">--schema</code>オプションと混同しないでください。<span class="quote">“<span class="quote">schema</span>”</span>という単語を異なる意味で使用しています。）
       </p></dd><dt><span class="term"><code class="option">-S <em class="replaceable"><code>username</code></em></code><br /></span><span class="term"><code class="option">--superuser=<em class="replaceable"><code>username</code></em></code></span></dt><dd><p>トリガを無効にする場合に使用する、スーパーユーザのユーザ名を指定します。
これは<code class="option">--disable-triggers</code>を使う場合にのみ使用されます。
       </p></dd><dt><span class="term"><code class="option">-t <em class="replaceable"><code>table</code></em></code><br /></span><span class="term"><code class="option">--table=<em class="replaceable"><code>table</code></em></code></span></dt><dd><p>指定されたテーブルのみについて、定義、データまたはその両方をリストアします。
この目的において、<span class="quote">“<span class="quote">テーブル</span>”</span>にはビュー、マテリアライズドビュー、シーケンス、外部テーブルが含まれます。
複数の<code class="option">-t</code>スイッチを指定することで複数のテーブルを指定することができます。
<code class="option">-n</code>オプションと組み合わせることでスキーマを指定することができます。
       </p><div class="note"><h3 class="title">Note</h3><p><code class="option">-t</code>が指定された場合、<span class="application">pg_restore</span>は選択されたテーブルが依存するその他のデータベースオブジェクトについてリストアしようとはしません。
そのため、初期化されたデータベースに特定のテーブルをリストアすることが成功する保証はありません。
        </p></div><div class="note"><h3 class="title">Note</h3><p>このフラグは<span class="application">pg_dump</span>の<code class="option">-t</code>フラグと同じ動作をするわけではありません。
現在のところ、<span class="application">pg_restore</span>でワイルドカードマッチを提供する予定はありませんし、<code class="option">-t</code>でスキーマ名を含めることもできません。
        </p></div><div class="note"><h3 class="title">Note</h3><p><span class="productname">PostgreSQL</span>の9.6より前のバージョンでは、このフラグはテーブルにのみマッチし、その他の種類のリレーションとはマッチしませんでした。
        </p></div></dd><dt><span class="term"><code class="option">-T <em class="replaceable"><code>trigger</code></em></code><br /></span><span class="term"><code class="option">--trigger=<em class="replaceable"><code>trigger</code></em></code></span></dt><dd><p>指定されたトリガだけをリストアします。
複数の<code class="option">-T</code>スイッチをつけることで、複数のトリガを指定できます。
       </p></dd><dt><span class="term"><code class="option">-v</code><br /></span><span class="term"><code class="option">--verbose</code></span></dt><dd><p>冗長モードを指定します。
       </p></dd><dt><span class="term"><code class="option">-V</code><br /></span><span class="term"><code class="option">--version</code></span></dt><dd><p><span class="application">pg_restore</span>のバージョンを表示し、終了します。
       </p></dd><dt><span class="term"><code class="option">-x</code><br /></span><span class="term"><code class="option">--no-privileges</code><br /></span><span class="term"><code class="option">--no-acl</code></span></dt><dd><p>アクセス権限（grant/revokeコマンド）のリストアを行いません。
       </p></dd><dt><span class="term"><code class="option">-1</code><br /></span><span class="term"><code class="option">--single-transaction</code></span></dt><dd><p>リストアを単一トランザクションとして実行します（つまり発行するコマンドを<code class="command">BEGIN</code>/<code class="command">COMMIT</code>で囲みます）。
これにより確実に、すべてのコマンドが完全に成功するか、まったく変更がなされないかのどちらかになります。
このオプションは<code class="option">--exit-on-error</code>を意味します。
       </p></dd><dt><span class="term"><code class="option">--disable-triggers</code></span></dt><dd><p>このオプションは、データのみのダンプからリストアする際にしか適用されません。
データの再ロード中、<span class="application">pg_restore</span>に対し、対象テーブル上のトリガを一時的に無効にするコマンドを実行するよう指示します。
このオプションは、データの再ロード中には呼び出したくない参照整合性検査やその他のトリガがある場合に使用します。
       </p><p>現在のところ、<code class="option">--disable-triggers</code>が生成するコマンドを実行するのは、スーパーユーザでなければなりません。
そのため、<code class="option">-S</code>でスーパーユーザの名前を指定するか、あるいは、可能であれば、<span class="productname">PostgreSQL</span>のスーパーユーザ権限で<span class="application">pg_restore</span>を実行する必要があります。
       </p></dd><dt><span class="term"><code class="option">--enable-row-security</code></span></dt><dd><p>このオプションは、行セキュリティのあるテーブルの内容をリストアするときにのみ意味を持ちます。
デフォルトでは<span class="application">pg_restore</span>は<a class="xref" href="runtime-config-client.html#GUC-ROW-SECURITY">row_security</a>をoffに設定し、すべてのデータが確実にテーブルにリストアされるようにします。
ユーザが行セキュリティを回避できるだけの十分な権限がないときはエラーが発生します。
このパラメータは<span class="application">pg_restore</span>が<a class="xref" href="runtime-config-client.html#GUC-ROW-SECURITY">row_security</a>をonに設定するようにし、ユーザが行セキュリティが有効なテーブルの内容をリストアできるようにします。
それでも、ユーザがダンプからテーブルに行を挿入する権限を持っていなければ、これは失敗します。
       </p><p><code class="command">COPY FROM</code>は行セキュリティをサポートしないので、このオプションは今のところ、ダンプが<code class="command">INSERT</code>形式である必要があることに注意してください。
       </p></dd><dt><span class="term"><code class="option">--if-exists</code></span></dt><dd><p>データベースオブジェクトを初期化するときに、条件コマンドを使います(つまり<code class="literal">IF EXISTS</code>句を追加します)。
このオプションは、<code class="option">--clean</code>も指定されているのでなければ有効にはなりません。
       </p></dd><dt><span class="term"><code class="option">--no-data-for-failed-tables</code></span></dt><dd><p>デフォルトでは、関連するテーブルの作成に失敗した（たとえば、既に存在するなどの理由により）としてもテーブルデータオブジェクトはリストアされます。
このオプションにより、こうしたテーブルデータは単に無視されるようになります。
これは対象のデータベースに目的のテーブルの中身が含まれている時に便利です。
たとえば<span class="productname">PostGIS</span>などの<span class="productname">PostgreSQL</span>拡張用の補助テーブルが既に対象のデータベース内に存在する可能性があります。
このオプションを指定すれば、二重ロードや古いデータのロードを防ぐことができます。

       </p><p>このオプションは直接データベースにリストアする時にのみ有効で、SQLスクリプト出力を生成する時は無効です。
       </p></dd><dt><span class="term"><code class="option">--no-publications</code></span></dt><dd><p>アーカイブにパブリケーションが含まれていたとしても、それをリストアするコマンドを出力しません。
       </p></dd><dt><span class="term"><code class="option">--no-security-labels</code></span></dt><dd><p>アーカイブにセキュリティラベルが含まれている場合であっても、セキュリティラベルを戻すコマンドを出力しません。
       </p></dd><dt><span class="term"><code class="option">--no-subscriptions</code></span></dt><dd><p>アーカイブにサブスクリプションが含まれていたとしても、それをリストアするコマンドを出力しません。
       </p></dd><dt><span class="term"><code class="option">--no-tablespaces</code></span></dt><dd><p>テーブル空間を選択するコマンドを出力しません。
このオプションを付けると、すべてのオブジェクトはリストア時にデフォルトとなっているテーブル空間内に作成されます。
       </p></dd><dt><span class="term"><code class="option">--section=<em class="replaceable"><code>sectionname</code></em></code></span></dt><dd><p>指定された部分のみをリストアします。
部分名は<code class="option">pre-data</code>、<code class="option">data</code>、<code class="option">post-data</code>のいずれかを取ることができます。
複数の部分を選択するために、このオプションを複数指定することができます。
デフォルトではすべての部分をリストアします。
         </p><p>data部分には、実際のテーブルデータやラージオブジェクト定義が含まれます。
post-data項目は、インデックス定義、トリガ定義、ルール定義、有効化された検査制約以外の制約定義から構成されます。
pre-data項目は、他のすべてのデータ定義項目から構成されます。
         </p></dd><dt><span class="term"><code class="option">--strict-names</code></span></dt><dd><p>スキーマ指定(<code class="option">-n</code>/<code class="option">--schema</code>)およびテーブル指定(<code class="option">-t</code>/<code class="option">--table</code>)がバックアップファイル内の少なくとも1つのスキーマあるいはテーブルにマッチすることを必要とします。
       </p></dd><dt><span class="term"><code class="option">--use-set-session-authorization</code></span></dt><dd><p><code class="command">ALTER OWNER</code>コマンドの代わりに、標準SQLの<code class="command">SET SESSION AUTHORIZATION</code>コマンドを出力して、オブジェクトの所有権を決定します。
これにより、ダンプの標準への互換性が高まりますが、ダンプ内のオブジェクトの履歴によっては正しくリストアされない可能性が生じます。
       </p></dd><dt><span class="term"><code class="option">-?</code><br /></span><span class="term"><code class="option">--help</code></span></dt><dd><p><span class="application">pg_restore</span>コマンドライン引数の使用方法を表示し、終了します。
       </p></dd></dl></div><p>

   </p><p><span class="application">pg_restore</span>はさらに以下のコマンドライン引数を接続パラメータとして受け付けます。

    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">-h <em class="replaceable"><code>host</code></em></code><br /></span><span class="term"><code class="option">--host=<em class="replaceable"><code>host</code></em></code></span></dt><dd><p>サーバが稼働しているマシンのホスト名を指定します。
この値がスラッシュから始まる場合、Unixドメインソケット用のディレクトリとして使用されます。
デフォルトは、設定されていれば環境変数<code class="envar">PGHOST</code>から取得されます。
設定されていなければ、Unixドメインソケット接続とみなされます。
       </p></dd><dt><span class="term"><code class="option">-p <em class="replaceable"><code>port</code></em></code><br /></span><span class="term"><code class="option">--port=<em class="replaceable"><code>port</code></em></code></span></dt><dd><p>サーバが接続を監視するTCPポートもしくはローカルUnixドメインソケットファイルの拡張子を指定します。
デフォルトは、設定されている場合、環境変数<code class="envar">PGPORT</code>の値となります。設定されていなければ、コンパイル時のデフォルト値となります。
        </p></dd><dt><span class="term"><code class="option">-U <em class="replaceable"><code>username</code></em></code><br /></span><span class="term"><code class="option">--username=<em class="replaceable"><code>username</code></em></code></span></dt><dd><p>接続ユーザ名です。
       </p></dd><dt><span class="term"><code class="option">-w</code><br /></span><span class="term"><code class="option">--no-password</code></span></dt><dd><p>パスワードの入力を促しません。
サーバがパスワード認証を必要とし、かつ、<code class="filename">.pgpass</code>ファイルなどの他の方法が利用できない場合、接続試行は失敗します。
バッチジョブやスクリプトなどパスワードを入力するユーザが存在しない場合にこのオプションは有用かもしれません。
       </p></dd><dt><span class="term"><code class="option">-W</code><br /></span><span class="term"><code class="option">--password</code></span></dt><dd><p>データベースに接続する前に、<span class="application">pg_restore</span>は強制的にパスワード入力を促します。
       </p><p>サーバがパスワード認証を要求する場合<span class="application">pg_restore</span>は自動的にパスワード入力を促しますので、これが重要になることはありません。
しかし、<span class="application">pg_restore</span>は、サーバにパスワードが必要かどうかを判断するための接続試行を無駄に行います。
こうした余計な接続試行を防ぐために<code class="option">-W</code>の入力が有意となる場合もあります。
       </p></dd><dt><span class="term"><code class="option">--role=<em class="replaceable"><code>rolename</code></em></code></span></dt><dd><p>リストアを実行する際に使用するロール名を指定します。
このオプションにより<span class="application">pg_restore</span>はデータベースに接続した後に<code class="command">SET ROLE</code> <em class="replaceable"><code>rolename</code></em>コマンドを発行するようになります。
認証に使用したユーザ（<code class="option">-U</code>で指定されたユーザ）が<span class="application">pg_restore</span>で必要とされる権限を持たないが、必要な権限を持つロールに切り替えることができる場合に有用です。
一部のインストレーションではスーパーユーザとして直接ログインさせないポリシーを取ることがありますが、このオプションを使用することでポリシーに反することなくリストアを行うことができます。
       </p></dd></dl></div><p>
   </p></div><div class="refsect1" id="id-1.9.4.17.7"><h2>環境</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="envar">PGHOST</code><br /></span><span class="term"><code class="envar">PGOPTIONS</code><br /></span><span class="term"><code class="envar">PGPORT</code><br /></span><span class="term"><code class="envar">PGUSER</code></span></dt><dd><p>      デフォルトの接続パラメータです。
     </p></dd></dl></div><p>また、このユーティリティは、他のほとんどの<span class="productname">PostgreSQL</span>ユーティリティと同様、<span class="application">libpq</span>でサポートされる環境変数を使用します（<a class="xref" href="libpq-envars.html" title="33.14. 環境変数">Section 33.14</a>を参照してください）。
しかしデータベース名が指定されていない場合は<code class="envar">PGDATABASE</code>は読み取られません。
  </p></div><div class="refsect1" id="APP-PGRESTORE-DIAGNOSTICS"><h2>診断</h2><p><code class="option">-d</code>オプションによってデータベースに直接接続するよう指定されている場合、<span class="application">pg_restore</span>は内部で<acronym class="acronym">SQL</acronym>文を実行します。
<span class="application">pg_restore</span>の実行時に問題が発生する場合は、<a class="xref" href="app-psql.html" title="psql"><span class="refentrytitle"><span class="application">psql</span></span></a>などを使用して、そのデータベースから情報を選択できることを確認してください。
また、<span class="application">libpq</span>フロントエンドライブラリで使用されるデフォルト接続設定や環境変数もすべて適用されます。
  </p></div><div class="refsect1" id="APP-PGRESTORE-NOTES"><h2>注釈</h2><p><code class="literal">template1</code>データベースに対し独自の変更を行っている場合、<span class="application">pg_restore</span>の出力は、確実に空のデータベースにロードするよう注意してください。
そうしないと、おそらく追加されたオブジェクトの重複定義によってエラーが発生します。
独自の追加が反映されていない空のデータベースを作成するには、<code class="literal">template1</code>ではなく<code class="literal">template0</code>をコピーしてください。
以下に例を示します。

</p><pre class="programlisting">CREATE DATABASE foo WITH TEMPLATE template0;</pre><p>
  </p><p><span class="application">pg_restore</span>の制限を以下に示します。

   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>既存のテーブルにデータをリストアする際に<code class="option">--disable-triggers</code>オプションを使用すると、<span class="application">pg_restore</span>は、データを挿入する前に、ユーザテーブル上のトリガを無効にするコマンドを発行し、データの挿入が完了した後で、それらを再び有効にする問い合わせを発行します。
リストアが途中で停止した場合、システムカタログが不適切な状態のままになっている可能性があります。
     </p></li><li class="listitem"><p><span class="application">pg_restore</span>は特定のテーブルのみのラージオブジェクトなどといった、ラージオブジェクトを選択してリストアすることはできません。
アーカイブにラージオブジェクトが含まれる場合、すべてのラージオブジェクトをリストアします。
もし<code class="option">-L</code>、<code class="option">-t</code>などのオプションで除外が指定されていた場合は、全くリストアしません。
     </p></li></ul></div><p>
  </p><p><span class="application">pg_dump</span>の制限についての詳細は、<a class="xref" href="app-pgdump.html" title="pg_dump"><span class="refentrytitle">pg_dump</span></a>の文書も参照してください。
  </p><p>リストア後は、オプティマイザが有用な統計情報を持つように、リストアしたテーブルそれぞれに対して<code class="command">ANALYZE</code>を実行することをお勧めします。
詳しくは<a class="xref" href="routine-vacuuming.html#VACUUM-FOR-STATISTICS" title="24.1.3. プランナ用の統計情報の更新">Section 24.1.3</a>および<a class="xref" href="routine-vacuuming.html#AUTOVACUUM" title="24.1.6. 自動バキュームデーモン">Section 24.1.6</a>を参照してください。
  </p></div><div class="refsect1" id="APP-PGRESTORE-EXAMPLES"><h2>例</h2><p><code class="literal">mydb</code>という名前のデータベースをカスタム形式のダンプファイルにダンプしているものと仮定します。

</p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>pg_dump -Fc mydb &gt; db.dump</code></strong></pre><p>
  </p><p>データベースを削除し、ダンプファイルから再作成します。

</p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>dropdb mydb</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>pg_restore -C -d postgres db.dump</code></strong></pre><p>

<code class="option">-d</code>オプションのデータベース名は、クラスタに存在する任意のデータベースで良いです。
<span class="application">pg_restore</span>は、<code class="literal">mydb</code>に対する<code class="command">CREATE DATABASE</code>コマンドを発行するためだけに、このデータベース名を使用します。
<code class="option">-C</code>を付けると、データは常にダンプファイル内に記載された名前のデータベースにリストアされます。
  </p><p><code class="literal">newdb</code>という新しいデータベースにダンプファイルをリストアします。

</p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>createdb -T template0 newdb</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>pg_restore -d newdb db.dump</code></strong></pre><p>

<code class="option">-C</code>を使用していないことに注意してください。
代わりにリストアするデータベースに直接接続しています。
また、新しいデータベースを<code class="literal">template1</code>ではなく<code class="literal">template0</code>からコピーして作成している点にも注意してください。
確実に初期状態を空にするためです。
  </p><p>データベースのアイテムを並び換えるには、まずこのアーカイブの内容の一覧をダンプしなければなりません。
</p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>pg_restore -l db.dump &gt; db.list</code></strong></pre><p>
一覧ファイルは、ヘッダと各アイテムを1行で表したものから構成されます。

</p><pre class="programlisting">;
; Archive created at Mon Sep 14 13:55:39 2009
;     dbname: DBDEMOS
;     TOC Entries: 81
;     Compression: 9
;     Dump Version: 1.10-0
;     Format: CUSTOM
;     Integer: 4 bytes
;     Offset: 8 bytes
;     Dumped from database version: 8.3.5
;     Dumped by pg_dump version: 8.3.8
;
;
; Selected TOC Entries:
;
3; 2615 2200 SCHEMA - public pasha
1861; 0 0 COMMENT - SCHEMA public pasha
1862; 0 0 ACL - public pasha
317; 1247 17715 TYPE public composite pasha
319; 1247 25899 DOMAIN public domain0 pasha</pre><p>
セミコロンで始まる行はコメントです。
行の先頭の番号は、各アイテムに割り当てられた内部アーカイブIDを示します。

  </p><p>このファイルの各行に対して、コメントアウト、削除、並び替えを行うことができます。
以下に例を示します。

</p><pre class="programlisting">10; 145433 TABLE map_resolutions postgres
;2; 145344 TABLE species postgres
;4; 145359 TABLE nt_header postgres
6; 145402 TABLE species_records postgres
;8; 145416 TABLE ss_old postgres</pre><p>
このファイルを<code class="command">pg_restore</code>の入力として利用すれば、アイテム10と6だけを、この順番でリストアすることができます。
</p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>pg_restore -L db.list db.dump</code></strong></pre></div><div class="refsect1" id="id-1.9.4.17.11"><h2>関連項目</h2><span class="simplelist"><a class="xref" href="app-pgdump.html" title="pg_dump"><span class="refentrytitle">pg_dump</span></a>, <a class="xref" href="app-pg-dumpall.html" title="pg_dumpall"><span class="refentrytitle"><span class="application">pg_dumpall</span></span></a>, <a class="xref" href="app-psql.html" title="psql"><span class="refentrytitle"><span class="application">psql</span></span></a></span></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="app-pgrecvlogical.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="reference-client.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="app-psql.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top"><span class="application">pg_recvlogical</span> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> <span class="application">psql</span></td></tr></table></div></body></html>