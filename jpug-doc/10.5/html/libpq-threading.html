<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>33.19. スレッド化プログラムの振舞い</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="libpq-ssl.html" title="33.18. SSLサポート" /><link rel="next" href="libpq-build.html" title="33.20. libpqプログラムの構築" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">33.19. スレッド化プログラムの振舞い</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="libpq-ssl.html" title="33.18. SSLサポート">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="libpq.html" title="Chapter 33. libpq - C ライブラリ">Up</a></td><th width="60%" align="center">Chapter 33. <span xmlns="http://www.w3.org/1999/xhtml" class="application">libpq</span> - C ライブラリ</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="libpq-build.html" title="33.20. libpqプログラムの構築">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="LIBPQ-THREADING"><div class="titlepage"><div><div><h2 class="title" style="clear: both">33.19. スレッド化プログラムの振舞い</h2></div></div></div><a id="id-1.7.3.26.2" class="indexterm"></a><p>デフォルトで<span class="application">libpq</span>は再入可能、かつ、スレッドセーフです。
アプリケーションコードをコンパイルする時にコンパイラの特殊なコマンドラインオプションを使う必要があるかもしれません。
スレッドを有効にしたアプリケーションの構築方法についての情報は、使用するシステムの文書を参照してください。
また、<code class="literal">PTHREAD_CFLAGS</code>と<code class="literal">PTHREAD_LIBS</code>に関して<code class="filename">src/Makefile.global</code>も一読してください。
以下の関数により、<span class="application">libpq</span>のスレッドセーフ状態を確認することができます。
  </p><div class="variablelist"><dl class="variablelist"><dt id="LIBPQ-PQISTHREADSAFE"><span class="term">     <code class="function">PQisthreadsafe</code>
     <a id="id-1.7.3.26.4.1.1.2" class="indexterm"></a>
    </span></dt><dd><p><span class="application">libpq</span>ライブラリのスレッドセーフ状態を返します。
</p><pre class="synopsis">int PQisthreadsafe();</pre><p>
     </p><p><span class="application">libpq</span>がスレッドセーフの場合1が、さもなくば0が返ります。
     </p></dd></dl></div><p>スレッドに関する1つの制限として、異なるスレッドから同時に同一の<code class="structname">PGconn</code>オブジェクトを操作することはできません。
具体的には、異なるスレッドから同一接続オブジェクトを介してコマンドを同時に発行することができません。
(コマンドの同時実行が必要な場合、接続を複数使用してください。)
  </p><p><code class="structname">PGresult</code>オブジェクトは生成後、読み込み専用であり、そのためスレッド間で自由に渡すことができます。
しかし<a class="xref" href="libpq-misc.html" title="33.11. 雑多な関数">Section 33.11</a>や<a class="xref" href="libpq-events.html" title="33.13. イベントシステム">Section 33.13</a>で説明する<code class="structname">PGresult</code>を変更する関数のいずれかを使用している場合、同一の<code class="structname">PGresult</code>に対する同時操作を防ぐことも、作成者の責任です。
  </p><p>非推奨の関数、<code class="function">PQrequestCancel</code>や<code class="function">PQoidStatus</code>はスレッドセーフではありませんので、マルチスレッドプログラムでは使用してはなりません。
<code class="function">PQrequestCancel</code>は<code class="function">PQcancel</code>に、<code class="function">PQoidStatus</code>は<code class="function">PQoidValue</code>に置き換えることができます。
  </p><p>(<span class="application">libpq</span>の内部に加えて)アプリケーション中でKerberosを利用している場合、Kerberos関数はスレッドセーフではありませんのでKerberos呼び出しの前後をロックする必要があるでしょう。
<span class="application">libpq</span>とアプリケーション間のロック処理を協調させる方法として<span class="application">libpq</span>のソースコードの<code class="function">PQregisterThreadLock</code>関数を参照してください。
  </p><p>スレッドアプリケーションで問題が起きた場合、<code class="filename">src/tools/thread</code>内のプログラムを実行して、プラットフォームがスレッドセーフではない関数を持っていないかどうか確認してください。
このプログラムは<code class="filename">configure</code>より実行されますが、バイナリ配布物の場合は、バイナリ構築時のライブラリとシステムのライブラリが一致しない可能性があります。
  </p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="libpq-ssl.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="libpq.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="libpq-build.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">33.18. SSLサポート </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 33.20. <span class="application">libpq</span>プログラムの構築</td></tr></table></div></body></html>