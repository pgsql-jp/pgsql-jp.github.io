<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>27.3. スタンバイサーバの設定</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="recovery-target-settings.html" title="27.2. リカバリ対象の設定" /><link rel="next" href="monitoring.html" title="Chapter 28. データベース活動状況の監視" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">27.3. スタンバイサーバの設定</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="recovery-target-settings.html" title="27.2. リカバリ対象の設定">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="recovery-config.html" title="Chapter 27. リカバリの設定">Up</a></td><th width="60%" align="center">Chapter 27. リカバリの設定</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="monitoring.html" title="Chapter 28. データベース活動状況の監視">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="STANDBY-SETTINGS"><div class="titlepage"><div><div><h2 class="title" style="clear: both">27.3. スタンバイサーバの設定</h2></div></div></div><div class="variablelist"><dl class="variablelist"><dt id="STANDBY-MODE"><span class="term"><code class="varname">standby_mode</code> (<code class="type">boolean</code>)
        <a id="id-1.6.14.8.2.1.1.3" class="indexterm"></a>
        </span></dt><dd><p><span class="productname">PostgreSQL</span>サーバをスタンバイとして起動するかどうかを指定します。
このパラメータが<code class="literal">on</code>の場合、サーバはアーカイブWALファイルの最後に到達してもリカバリを終了せず、<code class="varname">restore_command</code>の実行、および/あるいは、<code class="varname">primary_conninfo</code>で指定されたプライマリサーバへ接続することによって、新しいWALセグメントの取得を継続しようとします。
         </p></dd><dt id="PRIMARY-CONNINFO"><span class="term"><code class="varname">primary_conninfo</code> (<code class="type">string</code>)
        <a id="id-1.6.14.8.2.2.1.3" class="indexterm"></a>
        </span></dt><dd><p>スタンバイサーバがプライマリサーバに接続するための接続文字列を指定します。
この文字列は、<a class="xref" href="libpq-connect.html#LIBPQ-CONNSTRING" title="33.1.1. 接続文字列">Section 33.1.1</a>で説明されている書式で記述されます。
この文字列に何のオプションも指定されていない場合、これに対応する環境変数 (<a class="xref" href="libpq-envars.html" title="33.14. 環境変数">Section 33.14</a> 参照) が確認されます。
もし、環境変数も設定されていない場合、デフォルトの値が使われます。
         </p><p>接続文字列では、プライマリサーバのホスト名（またはアドレス）、スタンバイサーバのデフォルトと異なるのであればポート番号も指定する必要があります。
また、プライマリサーバ上で適切な権限を保有するロールのユーザを指定しなければなりません (<a class="xref" href="warm-standby.html#STREAMING-REPLICATION-AUTHENTICATION" title="26.2.5.1. 認証">Section 26.2.5.1</a> 参照)。
プライマリサーバが要求するのであれば、パスワードも記述される必要があります。
パスワードは <code class="varname">primary_conninfo</code>に記述することもできますし、スタンバイサーバ上の分離されたファイル<code class="filename">~/.pgpass</code>に記述することもできます (データベース名には <code class="literal">replication</code> を使います)。
<code class="varname">primary_conninfo</code>文字列の中には、データベース名を指定しないでください。
         </p><p><code class="varname">standby_mode</code> が <code class="literal">off</code> になっている場合、この設定は無効です。
         </p></dd><dt id="PRIMARY-SLOT-NAME"><span class="term"><code class="varname">primary_slot_name</code> (<code class="type">string</code>)
        <a id="id-1.6.14.8.2.3.1.3" class="indexterm"></a>
        </span></dt><dd><p>上流ノードのリソース削除を制御するためにストリーミングレプリケーション経由でプライマリに接続した場合、既存のレプリケーションスロットを使うように、必要に応じて指定します（<a class="xref" href="warm-standby.html#STREAMING-REPLICATION-SLOTS" title="26.2.6. レプリケーションスロット">Section 26.2.6</a>を参照）。
<code class="varname">primary_conninfo</code>が設定されていない場合、この設定は無効です。
         </p></dd><dt id="TRIGGER-FILE"><span class="term"><code class="varname">trigger_file</code> (<code class="type">string</code>)
        <a id="id-1.6.14.8.2.4.1.3" class="indexterm"></a>
        </span></dt><dd><p>スタンバイサーバにおいて、リカバリの完了を示すトリガファイルを指定します。
もしこの値が設定されていない場合、<code class="command">pg_ctl promote</code>を使ってスタンバイサーバを昇格させることができます。
<code class="varname">standby_mode</code> が <code class="literal">off</code> の時には、この設定は無効です。
         </p></dd><dt id="RECOVERY-MIN-APPLY-DELAY"><span class="term"><code class="varname">recovery_min_apply_delay</code> (<code class="type">integer</code>)
      <a id="id-1.6.14.8.2.5.1.3" class="indexterm"></a>
      </span></dt><dd><p>デフォルトでは、スタンバイサーバは可能な限り早くプライマリからWALレコードをリストアします。
時間遅れのデータのコピーを持つことで、データ損失エラーを修正する機会を提供するのは有用かもしれません。
このパラメータを使う事で、一定時間リカバリを遅らせることができます。単位を指定しない場合、ミリ秒として扱われます。
例えば、パラメータに<code class="literal">5min</code>と指定した場合、各トランザクションについて、スタンバイのシステム時刻が、マスターから報告されたコミット時刻より5分以上経過している場合のみ、スタンバイサーバはコミットを再生します。
       </p><p>サーバ間のレプリケーション遅延はパラメータの値を上回る可能性があり、その場合には遅延は追加されません。
遅延は、マスタサーバで書かれたWALのタイムスタンプと、スタンバイサーバの現在時刻を使って計算されていることに注意してください。
ネットワークのラグやカスケーディングレプリケーション構成によるデータ転送の遅延は、実際の待ち時間を大幅に減らすかもしれません。
もし、マスタサーバとスタンバイサーバのシステムクロックが同期されていない場合、期待値よりも早くレコードのリカバリを始めるかもしれません。
しかし、このパラメータの有用な設定値は典型的なサーバ間の時間のずれよりもずっと大きいので、それらは大きな問題ではありません。
       </p><p>遅延はトランザクションコミットのWALレコードだけで発生します。
他のレコードは可能な限り早く再生されるでしょう。
対応する（トランザクション）コミットレコードが適用されるまではその効果が不可視であることがMVCCの可視ルールによって保証されているため、他のレコードが可能な限り早く再生されることは問題にはなりません。
       </p><p>ひとたびリカバリ中のデータベースが整合性のとれた状態になれば、スタンバイサーバが昇格またはトリガーになるまで、遅延が発生します。
その後、スタンバイサーバはそれ以上待たずにリカバリを終了します。
       </p><p>このパラメータはストリーミングレプリケーション配信で使われることを目的としていますが、パラメータが指定されていると、すべてのケースで使用されます。
この機能を使うことによって<code class="varname">hot_standby_feedback</code>が遅延され、マスタサーバの肥大化に繋がる可能性があります。両方同時に使う場合には注意して使ってください。

        </p><div class="warning"><h3 class="title">Warning</h3><p><code class="varname">synchronous_commit</code>が<code class="literal">remote_apply</code>に設定されていれば、同期レプリケーションは、この設定に影響を受けます。各<code class="literal">COMMIT</code>は適用されるのを待つことが必要です。
         </p></div><p>
       </p></dd></dl></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="recovery-target-settings.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="recovery-config.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="monitoring.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">27.2. リカバリ対象の設定 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 28. データベース活動状況の監視</td></tr></table></div></body></html>