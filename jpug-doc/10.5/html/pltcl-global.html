<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>43.4. PL/Tclにおけるグローバルデータ</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="pltcl-data.html" title="43.3. PL/Tclにおけるデータの値" /><link rel="next" href="pltcl-dbaccess.html" title="43.5. PL/Tclからのデータベースアクセス" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">43.4. PL/Tclにおけるグローバルデータ</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="pltcl-data.html" title="43.3. PL/Tclにおけるデータの値">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="pltcl.html" title="Chapter 43. PL/Tcl - Tcl手続き言語">Up</a></td><th width="60%" align="center">Chapter 43. PL/Tcl - Tcl手続き言語</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="pltcl-dbaccess.html" title="43.5. PL/Tclからのデータベースアクセス">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="PLTCL-GLOBAL"><div class="titlepage"><div><div><h2 class="title" style="clear: both">43.4. PL/Tclにおけるグローバルデータ</h2></div></div></div><a id="id-1.8.9.8.2" class="indexterm"></a><p>ある関数の複数の呼び出し間で保持される、もしくは、異なる関数間で共有されるような、いくつかのグローバルデータを持つことが有意な場合があります。
これはPL/Tclで簡単に実現できますが、理解する必要がある制限がいくつかあります。
    </p><p>セキュリティ上の理由のため、PL/Tclは、任意のSQLロールによって呼び出された関数をそのロール用の別のTclインタプリタで実行します。
これにより、他のユーザのPL/Tcl関数の処理によってあるユーザへの事故または悪意の干渉を防止します。
こうしたインタプリタはそれぞれ任意の<span class="quote">“<span class="quote">グローバル</span>”</span>なTcl変数を持ちます。
したがって、同じSQLロールにより実行されていれば、２つのPL/Tcl関数は同じグローバル変数を共有します。
単一セッション内で（<code class="literal">SECURITY DEFINER</code>関数または<code class="command">SET ROLE</code>などを通して）複数のSQLロールでコードを実行するアプリケーションでは、PL/Tcl関数が確実にデータを共有できるように明示的な処理を行う必要があるかもしれません。
このためには、通信しなければならない関数が同一ユーザで所有されていること、および、それが<code class="literal">SECURITY DEFINER</code>として印がついていることを確実にしてください。
当然ながら、こうした関数が意図しない動作を行うために使われることのないよう注意しなければなりません。
    </p><p>セッション内で使用されるすべてのPL/TclU関数は、当然ながらPL/Tcl関数とは別のインタプリタですが、同一のTclインタプリタ内で実行されます。
このためPL/TclU関数間ではグローバルデータは自動的に共有されます。
すべてのPL/TclU関数は同じ信頼レベル、すなわちデータベーススーパーユーザで実行されますので、これはセキュリティ上危険とはみなされません。
    </p><p>PL/Tcl関数が予期しない相互作用に巻き込まれないようにするために、<code class="function">upvar</code>コマンドを使用することによって、各関数でアクセスできるグローバルな配列を作成することができます。
この変数のグローバル名は関数の内部名で、ローカル名は<code class="literal">GD</code>となります。
関数の永続局所データでは<code class="literal">GD</code>を使用することを推奨します。
複数の関数で共用させる予定の値に対してのみ、通常のTclのグローバル変数を使用してください。
（<code class="literal">GD</code>配列が特定のインタプリタ内のみでグローバルであることに注意してください。
このため、これらは上記のセキュリティ制限を迂回することはありません。）
    </p><p>後述の<code class="function">spi_execp</code>の例の中に<code class="literal">GD</code>の使用例があります。
    </p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="pltcl-data.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="pltcl.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="pltcl-dbaccess.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">43.3. PL/Tclにおけるデータの値 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 43.5. PL/Tclからのデータベースアクセス</td></tr></table></div></body></html>