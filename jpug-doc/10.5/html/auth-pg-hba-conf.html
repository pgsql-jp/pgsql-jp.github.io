<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>20.1. pg_hba.confファイル</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="client-authentication.html" title="Chapter 20. クライアント認証" /><link rel="next" href="auth-username-maps.html" title="20.2. ユーザ名マップ" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">20.1. <code xmlns="http://www.w3.org/1999/xhtml" class="filename">pg_hba.conf</code>ファイル</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="client-authentication.html" title="Chapter 20. クライアント認証">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="client-authentication.html" title="Chapter 20. クライアント認証">Up</a></td><th width="60%" align="center">Chapter 20. クライアント認証</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="auth-username-maps.html" title="20.2. ユーザ名マップ">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="AUTH-PG-HBA-CONF"><div class="titlepage"><div><div><h2 class="title" style="clear: both">20.1. <code class="filename">pg_hba.conf</code>ファイル</h2></div></div></div><a id="id-1.6.7.8.2" class="indexterm"></a><p>クライアント認証はデータベースクラスタのデータディレクトリ内の、伝統的に<code class="filename">pg_hba.conf</code>という名前の設定ファイルで管理されています
（<acronym class="acronym">HBA</acronym>とは、host-based authentication: ホストベース認証の略です）。
デフォルトの<code class="filename">pg_hba.conf</code>ファイルは、データディレクトリが<code class="command">initdb</code>で初期化される時にインストールされます。
しかし、この認証設定ファイルを他の場所に設置することができます。
<a class="xref" href="runtime-config-file-locations.html#GUC-HBA-FILE">hba_file</a>設定パラメータを参照してください。
  </p><p><code class="filename">pg_hba.conf</code>ファイルの一般的な書式は、1行につき1つのレコードというレコードの集合です。
空行はコメント用の<code class="literal">#</code>文字以降の文字と同じく無視されます。
レコードは行をまたいで続けることはできません。
レコードはスペースもしくはタブ、もしくはその両方で区切られた、複数のフィールドで構成されています。
フィールドには、フィールド値が二重引用符付きの場合空白文字を含むことができます。
データベース、ユーザもしくはアドレスフィールド内のキーワード(例：<code class="literal">all</code>または<code class="literal">replication</code>)の一つを引用するとその特別な意味が失われ、その名称のデータベース、ユーザもしくはホストと一致するようになります。
  </p><p>それぞれのレコードは接続形式、（接続形式に対して意味を持つのであれば）クライアントのIPアドレス範囲、データベースの名前、ユーザ名およびこれらのパラメータに一致する接続で使用される認証方法を指定します。
接続形式、クライアントアドレス、要求されたデータベース、およびユーザ名に一致する最初のレコードが認証処理に使用されます。
<span class="quote">“<span class="quote">失敗時の継続</span>”</span>や、 あるいは<span class="quote">“<span class="quote">バックアップ</span>”</span>はありません。
これは、もしあるレコードが選択されて認証に失敗した場合、後続のレコードは考慮されないということです。
どのレコードも一致しない時はアクセスが拒否されます。
  </p><p>レコードは7つの書式のうちの1つの形式を取ります。
</p><pre class="synopsis">local      <em class="replaceable"><code>database</code></em>  <em class="replaceable"><code>user</code></em>  <em class="replaceable"><code>auth-method</code></em>  [<span class="optional"><em class="replaceable"><code>auth-options</code></em></span>]
host       <em class="replaceable"><code>database</code></em>  <em class="replaceable"><code>user</code></em>  <em class="replaceable"><code>address</code></em>  <em class="replaceable"><code>auth-method</code></em>  [<span class="optional"><em class="replaceable"><code>auth-options</code></em></span>]
hostssl    <em class="replaceable"><code>database</code></em>  <em class="replaceable"><code>user</code></em>  <em class="replaceable"><code>address</code></em>  <em class="replaceable"><code>auth-method</code></em>  [<span class="optional"><em class="replaceable"><code>auth-options</code></em></span>]
hostnossl  <em class="replaceable"><code>database</code></em>  <em class="replaceable"><code>user</code></em>  <em class="replaceable"><code>address</code></em>  <em class="replaceable"><code>auth-method</code></em>  [<span class="optional"><em class="replaceable"><code>auth-options</code></em></span>]
host       <em class="replaceable"><code>database</code></em>  <em class="replaceable"><code>user</code></em>  <em class="replaceable"><code>IP-address</code></em>  <em class="replaceable"><code>IP-mask</code></em>  <em class="replaceable"><code>auth-method</code></em>  [<span class="optional"><em class="replaceable"><code>auth-options</code></em></span>]
hostssl    <em class="replaceable"><code>database</code></em>  <em class="replaceable"><code>user</code></em>  <em class="replaceable"><code>IP-address</code></em>  <em class="replaceable"><code>IP-mask</code></em>  <em class="replaceable"><code>auth-method</code></em>  [<span class="optional"><em class="replaceable"><code>auth-options</code></em></span>]
hostnossl  <em class="replaceable"><code>database</code></em>  <em class="replaceable"><code>user</code></em>  <em class="replaceable"><code>IP-address</code></em>  <em class="replaceable"><code>IP-mask</code></em>  <em class="replaceable"><code>auth-method</code></em>  [<span class="optional"><em class="replaceable"><code>auth-options</code></em></span>]</pre><p>
フィールドの意味は以下のようになっています。

   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">local</code></span></dt><dd><p>このレコードはUnixドメインソケットを使用する接続に対応します。
この種類のレコードを使用しないと、Unixドメインソケット経由の接続は拒否されます。
      </p></dd><dt><span class="term"><code class="literal">host</code></span></dt><dd><p>このレコードは、TCP/IPを使用した接続に対応します。
<code class="literal">host</code>レコードは、<acronym class="acronym">SSL</acronym>もしくは非<acronym class="acronym">SSL</acronym>接続のいずれかに対応します。
      </p><div class="note"><h3 class="title">Note</h3><p>サーバのデフォルトの動作は、ローカルループバックアドレスである<code class="literal">localhost</code>のみTCP/IP接続を監視しています。
よってサーバにおいて<a class="xref" href="runtime-config-connection.html#GUC-LISTEN-ADDRESSES">listen_addresses</a>パラメータが適切な値に設定された状態で起動されていない限り、リモートのTCP/IP接続はできません。
      </p></div></dd><dt><span class="term"><code class="literal">hostssl</code></span></dt><dd><p>このレコードは、接続が<acronym class="acronym">SSL</acronym>で暗号化されている場合にのみTCP/IPネットワークを使用する接続に対応します。
      </p><p>このオプションを使用するためには、サーバは<acronym class="acronym">SSL</acronym>サポートができるように構築されていなければいけません。
また、 <acronym class="acronym">SSL</acronym>は<a class="xref" href="runtime-config-connection.html#GUC-SSL">ssl</a>パラメータを設定することによりサーバの起動時に有効になっていなくてはなりません（詳細は<a class="xref" href="ssl-tcp.html" title="18.9. SSLによる安全なTCP/IP接続">Section 18.9</a>を参照してください）。
そうでなければ、どのような接続にも対応していないという警告が表示されることを除き、<code class="literal">hostssl</code>レコードは無視されます。
      </p></dd><dt><span class="term"><code class="literal">hostnossl</code></span></dt><dd><p>このレコードは、<code class="literal">hostssl</code>と反対の動作で、<acronym class="acronym">SSL</acronym>を使用していないTCP/IPの接続のみに対応します。
      </p></dd><dt><span class="term"><em class="replaceable"><code>database</code></em></span></dt><dd><p>このレコードで対応するデータベース名を指定します。
<code class="literal">all</code> という値は、全てのデータベースと対応することを指定します。
<code class="literal">sameuser</code>という値は、要求されたデータベースが要求ユーザと同じ名前を持つ場合にレコードが対応することを指定します。
<code class="literal">samerole</code>という値は、要求ユーザが要求されたデータベースと同じ名前のロールのメンバでなければならないことを指定します。
（以前は<code class="literal">samegroup</code>と書いていましたが、<code class="literal">samerole</code>と記述してください）
スーパーユーザは、直接的であれ間接的であれ、明示的にsameroleのメンバでない限りsameroleのメンバとはみなされません。
また、スーパーユーザであるからといって<code class="literal">samerole</code>のメンバとはみなされません。
<code class="literal">replication</code>の値は、もし物理レプリケーション接続が要求された場合（レプリケーション接続は特定のデータベースを指定しないことに注意して下さい）にレコードが一致することを指定します。
それ以外の場合には、特定の<span class="productname">PostgreSQL</span>データベースの名前になります。
データベースの名前はカンマで区切ることで複数指定できます。
データベース名を含む別のファイルを、そのファイル名の前に<code class="literal">@</code>を付けることで指定できます。
      </p></dd><dt><span class="term"><em class="replaceable"><code>user</code></em></span></dt><dd><p>このレコードで対応するデータベースユーザを指定します。
<code class="literal">all</code>という値は、全てのユーザが対応することを指定します。
それ以外の場合には特定のデータベースユーザの名前もしくは<code class="literal">+</code>で始まるグループ名のどちらかになります。
（<span class="productname">PostgreSQL</span>ではユーザとグループの明確な区別がないことを思い出してください。
<code class="literal">+</code>のマークは、<span class="quote">“<span class="quote">このロールの直接的もしくは間接的なメンバのどちらかに一致していること</span>”</span>を意味しています。
一方、<code class="literal">+</code>のマークのない名前は特定のロールにのみ一致します）
このため、スーパーユーザは、直接的であれ間接的であれ明示的にロールのメンバである場合にのみ、ロールのメンバとみなされます。
スーパーユーザであるからといってロールのメンバとはみなされません。
ユーザ名は、カンマで区切ることで複数指定できます。
ユーザ名を含む別のファイルを、そのファイル名の前に<code class="literal">@</code>を付けることで指定できます。
      </p></dd><dt><span class="term"><em class="replaceable"><code>address</code></em></span></dt><dd><p>このレコードに対応しているクライアントマシンのアドレス。
このフィールドはホスト名、IPアドレスの範囲、もしくは下記の特別なキーワードの1つを含んでいます。
      </p><p>IPアドレスの範囲は、範囲の開始アドレス、続いてスラッシュ(<code class="literal">/</code>)と<acronym class="acronym">CIDR</acronym>マスクの長さという標準の数値表記で指定されます。
CIDRマスク長とは、クライアントIPアドレスが一致しなければならない、高位のビット数を表すものです。
指定するIPアドレスのこれより右側のビットには、0を指定しなければなりません。
IPアドレスと<code class="literal">/</code>、およびCIDRマスク長の間には空白を入れてはいけません。
      </p><p>典型的なIPv4アドレス範囲の例は、単一のホストでは<code class="literal">172.20.143.89/32</code>、小規模ネットワークでは<code class="literal">172.20.143.0/24</code>、大規模ネットワークでは<code class="literal">10.6.0.0/16</code>のようなものです。
IPv6アドレスの範囲は、単一のホストでは<code class="literal">::1/128</code>(この場合はIPv6ループバックアドレス)、小規模ネットワークでは<code class="literal">fe80::7a31:c1ff:0000:0000/96</code>のようなものです。
<code class="literal">0.0.0.0/0</code>は全てのIPv4アドレスを意味します。また、<code class="literal">::0/0</code>は全てのIPv6アドレスを意味しています。
単一ホストを指定するには、IPv4では32、IPv6では128というマスク長を使用してください。
ネットワークアドレスでは末尾の0を省略できません。
      </p><p>IPv4書式で与えられたエントリは、IPv4接続のみに対応し、IPv6書式で与えられた項目は、たとえそのアドレスがIPv6内のIPv4の範囲内であったとしてもIPv6接続のみに対応します。
IPv6書式の項目は、システムのCライブラリがIPv6アドレスをサポートしていない場合拒絶されることに注意してください。
      </p><p>どのIPアドレスにも一致するように<code class="literal">all</code>と書くこともできますし、
サーバ自身のどのIPアドレスにも一致するように<code class="literal">samehost</code>と書くこともできます。
もしくは、サーバが直接接続されているサブネット内のどのアドレスにも一致するように<code class="literal">samenet</code>と書くことができます。
      </p><p>もし、ホスト名（IPアドレスの範囲ではない場合の全て、もしくはホスト名として処理される特別なキーワード）が指定されている場合は、その名前は、クライアントのIPアドレスの逆引き名前解決の結果と比較されます（例えば、もしDNSが使用されている場合は逆引きDNS検索により解決されます）。
ホスト名の比較は、大文字小文字が区別されます。
もし一致するものがあった場合は、解決された、どのアドレスもクライアントのIPアドレスと等しいか否かをチェックするために（例えば、正引きDNS検索のような）ホスト名の正引き名前解決が実行されます。
もし正引き、逆引きの両方で一致した場合は、エントリは一致するものとみなされます。
（<code class="filename">pg_hba.conf</code>内で使用されているホスト名は、クライアントのIPアドレスのアドレス-名前解決が返すホスト名の1つでなければいけません。
もしそうでなければこの行は一致しません。
1つのIPアドレスを複数のホスト名に関連付けるホスト名データベースもありますが、IPアドレスの解決を要求された場合にオペレーティングシステムは1つのホスト名のみを返します。）
      </p><p>ドット（<code class="literal">.</code>）で始まるホスト名の特定は実際のホスト名のサフィックスに一致します。
よって、<code class="literal">.example.com</code>は、<code class="literal">foo.example.com</code>に一致します
（<code class="literal">example.com</code>だけでは一致しません）。
      </p><p>ホスト名が<code class="filename">pg_hba.conf</code>内で指定されている場合、名前解決が適度に早いことを
確かめてください。<code class="command">nscd</code>のようなローカル名前解決のキャッシュを設定することによる恩恵です。
また、クライアントのIPアドレスの代わりにホスト名がログで見られるように、<code class="varname">log_hostname</code>の
設定パラメータを有効化することもできます。
      </p><p>このフィールドは<code class="literal">host</code>および<code class="literal">hostssl</code>、<code class="literal">hostnossl</code>レコードにのみ適用されます。
      </p><div class="note"><h3 class="title">Note</h3><p>時折、ユーザは、クライアントのIPアドレスの逆引きを含む2つの名前解決が必要になる、というような一見複雑に見える方法でなぜホスト名が扱われるのか不思議に思うことがあります。
このため、クライアントの逆引きDNSエントリが設定されていなかったり、いくつかの望ましくないホスト名を生成する場合にこの機能の使用が複雑になります。
これは主に効率のために行なわれます。このように、接続要求では最大2つのリゾルバの検索、1つは逆引き、1つは正引き、が必要になります。
もしリゾルバにおいて、アドレスに問題があった場合、クライアントのみの問題となります。
正引き検索のみを行うような実装を仮に行っていると、全ての接続要求において<code class="filename">pg_hba.conf</code>内に記載された全てのホスト名を解決しなくてはいけなくなります。
これは、多くの名前が列挙されていた場合にかなり遅くなります。
また、リゾルバにおいて1つのホスト名に問題があった場合、全員の問題となってしまいます。
       </p><p>さらに、逆引き検索はサフィックス一致の機能を実装するために必要です。というのも実際のクライアントのホスト名は
ホスト名がパターンに対して一致するために、知られる必要があるためです。
       </p><p>このふるまいは、Apache HTTPサーバやTCPラッパーのような他のよくあるホスト名ベースのアクセス制御の実装と
一致していることに注意して下さい。
       </p></div></dd><dt><span class="term"><em class="replaceable"><code>IP-address</code></em><br /></span><span class="term"><em class="replaceable"><code>IP-mask</code></em></span></dt><dd><p>この2つのフィールドは<em class="replaceable"><code>IP-address</code></em><code class="literal">/</code><em class="replaceable"><code>mask-length</code></em>表記の代替として使用可能です。
マスク長を指定する代わりに、実際のマスクを分離した列で指定します。
例えば<code class="literal">255.0.0.0</code>はIPv4のCIDRマスク長8を意味し、<code class="literal">255.255.255.255</code>はCIDRマスク長32を意味しています。
      </p><p>このフィールドは<code class="literal">host</code>および<code class="literal">hostssl</code>、<code class="literal">hostnossl</code>レコードにのみ適用されます。
      </p></dd><dt><span class="term"><em class="replaceable"><code>auth-method</code></em></span></dt><dd><p>接続がこのレコードに一致する場合に使用する認証方式を指定します。
使用できる選択肢は以下にまとめていますが、詳しくは<a class="xref" href="auth-methods.html" title="20.3. 認証方式">Section 20.3</a>を参照してください。

       </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">trust</code></span></dt><dd><p>接続を無条件で許可します。
この方式は、<span class="productname">PostgreSQL</span>データベースサーバに接続できる全てのユーザが、任意の<span class="productname">PostgreSQL</span>ユーザとしてパスワードや他の認証なしでログインすることを許可します。
詳細は<a class="xref" href="auth-methods.html#AUTH-TRUST" title="20.3.1. trust認証">Section 20.3.1</a>を参照してください。
         </p></dd><dt><span class="term"><code class="literal">reject</code></span></dt><dd><p>接続を無条件に拒否します。
特定のホストをあるグループから<span class="quote">“<span class="quote">除外</span>”</span>するために便利です。
例えば、1行の<code class="literal">reject</code>は特定のホストが接続することを拒否します。一方、
後ろの行では特定のネットワーク内の残りのホストが接続することを許可します。
         </p></dd><dt><span class="term"><code class="literal">scram-sha-256</code></span></dt><dd><p>ユーザのパスワードを検証するためにSCRAM-SHA-256認証を実行します。
詳細は<a class="xref" href="auth-methods.html#AUTH-PASSWORD" title="20.3.2. パスワード認証">Section 20.3.2</a>をご覧ください。
         </p></dd><dt><span class="term"><code class="literal">md5</code></span></dt><dd><p>ユーザのパスワードを検証するために、SCRAM-SHA-256あるいはMD5認証を実行します。
詳細は<a class="xref" href="auth-methods.html#AUTH-PASSWORD" title="20.3.2. パスワード認証">Section 20.3.2</a>を参照してください。
         </p></dd><dt><span class="term"><code class="literal">password</code></span></dt><dd><p>クライアントに対して認証時に平文のパスワードを要求します。
パスワードはネットワークを通じて普通のテキスト形式で送られますので、信頼されていないネットワークでは使用しないでください。
詳細は<a class="xref" href="auth-methods.html#AUTH-PASSWORD" title="20.3.2. パスワード認証">Section 20.3.2</a>を参照してください。
         </p></dd><dt><span class="term"><code class="literal">gss</code></span></dt><dd><p>ユーザの認証にGSSAPIを使用します。
これはTCP/IP接続を使用するときのみ使用可能です。
詳細は<a class="xref" href="auth-methods.html#GSSAPI-AUTH" title="20.3.3. GSSAPI認証">Section 20.3.3</a>を参照してください。
         </p></dd><dt><span class="term"><code class="literal">sspi</code></span></dt><dd><p>ユーザの認証にSSPIを使用します。
これはWindowsを使用するときのみ使用可能です。
詳細は<a class="xref" href="auth-methods.html#SSPI-AUTH" title="20.3.4. SSPI認証">Section 20.3.4</a>を参照してください。
         </p></dd><dt><span class="term"><code class="literal">ident</code></span></dt><dd><p>クライアントのオペレーティングシステムにおけるユーザ名をクライアント上のidentサーバに尋ねてユーザ名が要求されたデータベースユーザ名と一致するか検査します。
ident認証は、TCP/IP接続でのみ使用可能です。ローカル接続が指定されている場合は、peer認証が代わりに使用されます。
詳細は<a class="xref" href="auth-methods.html#AUTH-IDENT" title="20.3.5. Ident認証">Section 20.3.5</a>を参照してください。
         </p></dd><dt><span class="term"><code class="literal">peer</code></span></dt><dd><p>クライアントのオペレーティングシステムにおけるユーザ名をオペレーティングシステムから取得し、ユーザ名が要求されたデータベースユーザ名と一致するか検査します。
これはローカル接続の時にのみ使用可能です。詳細は<a class="xref" href="auth-methods.html#AUTH-PEER" title="20.3.6. Peer認証">Section 20.3.6</a>を参照してください。
         </p></dd><dt><span class="term"><code class="literal">ldap</code></span></dt><dd><p><acronym class="acronym">LDAP</acronym>サーバを使用して認証します。
詳細は<a class="xref" href="auth-methods.html#AUTH-LDAP" title="20.3.7. LDAP認証">Section 20.3.7</a>を参照してください。
         </p></dd><dt><span class="term"><code class="literal">radius</code></span></dt><dd><p>RADIUSサーバを使用して認証します。
詳細は<a class="xref" href="auth-methods.html#AUTH-RADIUS" title="20.3.8. RADIUS認証">Section 20.3.8</a>を参照してください。
         </p></dd><dt><span class="term"><code class="literal">cert</code></span></dt><dd><p>SSLクライアント証明書を使用して認証します。
詳細は<a class="xref" href="auth-methods.html#AUTH-CERT" title="20.3.9. 証明書認証">Section 20.3.9</a>を参照してください。
         </p></dd><dt><span class="term"><code class="literal">pam</code></span></dt><dd><p>オペレーティングシステムによって提供されるPAM（Pluggable Authentication Modules）サービスを使用した認証です。
詳細は<a class="xref" href="auth-methods.html#AUTH-PAM" title="20.3.10. PAM認証">Section 20.3.10</a>を参照してください。
         </p></dd><dt><span class="term"><code class="literal">bsd</code></span></dt><dd><p>オペレーティングシステムによって提供されたBSD認証サービスを使用して認証します。
詳細は<a class="xref" href="auth-methods.html#AUTH-BSD" title="20.3.11. BSD認証">Section 20.3.11</a>を参照してください。
         </p></dd></dl></div><p>

      </p></dd><dt><span class="term"><em class="replaceable"><code>auth-options</code></em></span></dt><dd><p><em class="replaceable"><code>auth-method</code></em>フィールドの後ろに、
認証方式のオプションを指定する、<em class="replaceable"><code>name</code></em><code class="literal">=</code><em class="replaceable"><code>value</code></em>の形式のフィールドが存在する可能性があります。
どのオプションがどの認証方式に使用できるのか、についての詳細は以下で説明します。
      </p><p>以下に示された方式特定のオプションに加えて、方式に依存しないのひとつの認証オプション<code class="literal">clientcert</code>があり、<code class="literal">hostssl</code>レコードで指定することができます。
オプションを<code class="literal">1</code>にセットした時、このオプションはその認証方式で必要な他の事項を要求することに加えて、クライアントに有効な（信頼された）SSL証明書の提出を要求します。
      </p></dd></dl></div><p>
  </p><p><code class="literal">@</code>式により含められるファイルは、空白文字あるいはカンマのどちらかで区切られた名前の列挙として読み込まれます。
コメントは、<code class="filename">pg_hba.conf</code>と同様に<code class="literal">#</code>から始まります。
また、<code class="literal">@</code>式を入れ子にすることもできます。
<code class="literal">@</code>の後のファイル名が絶対パスでない限り、参照元ファイルが存在するディレクトリから見た相対パスであるとみなされます。
  </p><p><code class="filename">pg_hba.conf</code>レコードは接続が試みられる度に順番に検査されますので、レコードの順序はとても大切です。
典型的には、始めの方のレコードには厳しい接続照合パラメータと緩い認証方式があるのに対し、終わりの方のレコードにはより緩い照合パラメータとより厳しい認証方式があります。
例えば、ローカルTCP接続では<code class="literal">trust</code>認証方式、リモートTCP接続に対してはパスワードを要求したいとします。
この場合、広範囲にわたって許可されるクライアントのIPアドレスに対するパスワード認証を指定するレコードの前に127.0.0.1からの接続に対する<code class="literal">trust</code>認証指定のレコードが置かれなければなりません。
  </p><p><code class="filename">pg_hba.conf</code>ファイルは起動時と、主サーバプロセスが<span class="systemitem">SIGHUP</span>シグナルを受け取った時に読み込まれます。<a id="id-1.6.7.8.9.3" class="indexterm"></a>
稼働中のシステムでファイルを編集した場合は、（<code class="literal">pg_ctl reload</code>あるいは<code class="literal">kill -HUP</code>を使用して）postmasterにファイルをもう一度読み込むようにシグナルを出さなければなりません。
  </p><div class="note"><h3 class="title">Note</h3><p>上記はマイクロソフトWindowsに対しては当てはまりません。
つまり、<code class="filename">pg_hba.conf</code>に対する変更は、ただちにそれ以降の新しい接続に反映されます。
   </p></div><p><code class="filename">pg_hba.conf</code>に対する変更をテストする際、あるいはそのファイルをロードしても期待していた結果が得られなかった場合には、
システムビュー<a class="link" href="view-pg-hba-file-rules.html" title="51.71. pg_hba_file_rules"><code class="structname">pg_hba_file_rules</code></a>が役に立ちます。
そのビューの<code class="structfield">error</code>フィールドがNULLでない行は、そのファイルの該当行に問題があることを示しています。
  </p><div class="tip"><h3 class="title">Tip</h3><p>特定のデータベースに接続するためには、ユーザは<code class="filename">pg_hba.conf</code>による検査を通過しなければならない他、そのデータベースに対する<code class="literal">CONNECT</code>権限を持たなければなりません。
どのユーザがどのデータベースに接続できるかを制限したければ、通常、<code class="filename">pg_hba.conf</code>項目に規則を追加するよりも、<code class="literal">CONNECT</code>権限の付与・削除を行う方が簡単です。
   </p></div><p><code class="filename">pg_hba.conf</code>ファイルの例をいくつか<a class="xref" href="auth-pg-hba-conf.html#EXAMPLE-PG-HBA.CONF" title="Example 20.1. pg_hba.confの項目の例">Example 20.1</a>に示します。
各種認証方式の詳細についてはその後で説明します。
  </p><div class="example" id="EXAMPLE-PG-HBA.CONF"><p class="title"><strong>Example 20.1. <code class="filename">pg_hba.conf</code>の項目の例</strong></p><div class="example-contents"><pre class="programlisting"># ローカルシステム上の全てのユーザが、任意のデータベースに
# 任意のデータベースユーザ名でUnixドメインソケットを使用して接続することを許可
# （ローカル接続ではデフォルト）。
#
# TYPE  DATABASE        USER            ADDRESS                 METHOD
local   all             all                                     trust

# 上記と同じことをローカルループバックのTCP/IP接続を使って行なう。
#
# TYPE  DATABASE        USER            ADDRESS                 METHOD
host    all             all             127.0.0.1/32            trust

# 上記と同じだが、独立したネットマスク列を使用する
#
# TYPE  DATABASE        USER            IP-ADDRESS      IP-MASK             METHOD
host    all             all             127.0.0.1       255.255.255.255     trust

# IPv6で上記と同じことを行なう。
#
# TYPE  DATABASE        USER            ADDRESS                 METHOD
host    all             all             ::1/128                 trust

# ホスト名を使用して上記と同じことを行なう（通常はIPv4とIPv6の両方をカバーします）。
#
# TYPE  DATABASE        USER            ADDRESS                 METHOD
host    all             all             localhost               trust

# IPアドレス192.168.93.xを持つ全てのホストの全てのユーザが、
# identがその接続について報告するのと同じユーザ名（典型的にはオペレーティングシステムのユーザ名）で
# データベース「postgres」へ接続することを許可。
#
# TYPE  DATABASE        USER            ADDRESS                 METHOD
host    postgres        all             192.168.93.0/24         ident

# ユーザのパスワードが正しく入力された場合、
# ホスト192.168.12.10からのどのようなユーザでもデータベース「postgres」へ接続することを許可。
#
# TYPE  DATABASE        USER            ADDRESS                 METHOD
host    postgres        all             192.168.12.10/32        scram-sha-256

# ユーザのパスワードが正しく指定された場合は、
# example.comドメイン内のホストからの、どのユーザからのデータベース接続も許可する。
#
# Require SCRAM authentication for most users, but make an exception
# for user 'mike', who uses an older client that doesn't support SCRAM
# authentication.
#
# TYPE  DATABASE        USER            ADDRESS                 METHOD
host    all             mike            .example.com            md5
host    all             all             .example.com            scram-sha-256

# 先行する「host」行がなければ、これら2行によって192.168.54.1からの接続
# の試みを全て拒否（この項目が最初に照合されるため）。
# ただし、インターネット上の他の全ての場所からのGSSAPI接続は許可。
# ゼロマスクは、ホストIPアドレスのビットが考慮されずに
# どのホストでも照合できることになる。
#
# TYPE  DATABASE        USER            ADDRESS                 METHOD
host    all             all             192.168.54.1/32         reject
host    all             all             0.0.0.0/0               gss

# 192.168.x.xホストからのユーザが、ident検査に通る場合、
# どのデータベースにでも接続を許可。もし、例えば、identが「bryanh」と認定し
# 「bryanh」がPostgreSQLのユーザ「guest1」として
# 接続要求を出す場合、「bryanh」は「guest1」として接続が許可されるという
# マップ「omicron」に対する記載事項がpg_ident.confにあれば接続を許可。
#
# TYPE  DATABASE        USER            ADDRESS                 METHOD
host    all             all             192.168.0.0/16          ident map=omicron

# ローカル接続に対して、以下のたった3行しか記載がない場合、ローカルユーザは
# 自分のデータベース（データベースユーザ名と同じ名前のデータベース）にのみ接続許可。
# ただし管理者とロール「support」のメンバは全てのデータベースに接続可能。
# $PGDATA/adminsファイルは管理者のリストを含む。
# 全ての場合にパスワードが必要。
#
# TYPE  DATABASE        USER            ADDRESS                 METHOD
local   sameuser        all                                     md5
local   all             @admins                                 md5
local   all             +support                                md5

# 上記の最後の2行は1つの行にまとめることが可能。
local   all             @admins,+support                        md5

# データベースの列にはリストやファイル名も使用できる。
local   db1,db2,@demodbs  all                                   md5</pre></div></div><br class="example-break" /></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="client-authentication.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="client-authentication.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="auth-username-maps.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 20. クライアント認証 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 20.2. ユーザ名マップ</td></tr></table></div></body></html>