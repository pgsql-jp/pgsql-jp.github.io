<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>9.26. システム管理関数</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="functions-info.html" title="9.25. システム情報関数" /><link rel="next" href="functions-trigger.html" title="9.27. トリガ関数" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">9.26. システム管理関数</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="functions-info.html" title="9.25. システム情報関数">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="functions.html" title="Chapter 9. 関数と演算子">Up</a></td><th width="60%" align="center">Chapter 9. 関数と演算子</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="functions-trigger.html" title="9.27. トリガ関数">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="FUNCTIONS-ADMIN"><div class="titlepage"><div><div><h2 class="title" style="clear: both">9.26. システム管理関数</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="functions-admin.html#FUNCTIONS-ADMIN-SET">9.26.1. 構成設定関数</a></span></dt><dt><span class="sect2"><a href="functions-admin.html#FUNCTIONS-ADMIN-SIGNAL">9.26.2. サーバシグナル送信関数</a></span></dt><dt><span class="sect2"><a href="functions-admin.html#FUNCTIONS-ADMIN-BACKUP">9.26.3. バックアップ制御関数</a></span></dt><dt><span class="sect2"><a href="functions-admin.html#FUNCTIONS-RECOVERY-CONTROL">9.26.4. リカバリ制御関数</a></span></dt><dt><span class="sect2"><a href="functions-admin.html#FUNCTIONS-SNAPSHOT-SYNCHRONIZATION">9.26.5. スナップショット同期関数</a></span></dt><dt><span class="sect2"><a href="functions-admin.html#FUNCTIONS-REPLICATION">9.26.6. レプリケーション関数</a></span></dt><dt><span class="sect2"><a href="functions-admin.html#FUNCTIONS-ADMIN-DBOBJECT">9.26.7. データベースオブジェクト管理関数</a></span></dt><dt><span class="sect2"><a href="functions-admin.html#FUNCTIONS-ADMIN-INDEX">9.26.8. インデックス保守関数</a></span></dt><dt><span class="sect2"><a href="functions-admin.html#FUNCTIONS-ADMIN-GENFILE">9.26.9. 汎用ファイルアクセス関数</a></span></dt><dt><span class="sect2"><a href="functions-admin.html#FUNCTIONS-ADVISORY-LOCKS">9.26.10. 勧告的ロック用関数</a></span></dt></dl></div><p>本節で説明する関数は、<span class="productname">PostgreSQL</span>インストレーションの制御と監視を行うために使用されます。
   </p><div class="sect2" id="FUNCTIONS-ADMIN-SET"><div class="titlepage"><div><div><h3 class="title">9.26.1. 構成設定関数</h3></div></div></div><p><a class="xref" href="functions-admin.html#FUNCTIONS-ADMIN-SET-TABLE" title="Table 9.77. 構成設定関数">Table 9.77</a>は、実行時設定パラメータの問い合わせや変更に使用できる関数を示しています。
   </p><div class="table" id="FUNCTIONS-ADMIN-SET-TABLE"><p class="title"><strong>Table 9.77. 構成設定関数</strong></p><div class="table-contents"><table class="table" summary="構成設定関数" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>名前</th><th>戻り型</th><th>説明</th></tr></thead><tbody><tr><td>        <a id="id-1.5.8.31.3.3.2.2.1.1.1" class="indexterm"></a>
        <code class="literal"><code class="function">current_setting(<em class="parameter"><code>setting_name</code></em> [, <em class="parameter"><code>missing_ok</code></em> ])</code></code>
       </td><td><code class="type">text</code></td><td>現在の設定値の取得</td></tr><tr><td>        <a id="id-1.5.8.31.3.3.2.2.2.1.1" class="indexterm"></a>
        <code class="literal"><code class="function">set_config(<em class="parameter"><code>setting_name</code></em>,
                             <em class="parameter"><code>new_value</code></em>,
                             <em class="parameter"><code>is_local</code></em>)</code></code>
       </td><td><code class="type">text</code></td><td>パラメータを設定し、新規値を返す</td></tr></tbody></table></div></div><br class="table-break" /><a id="id-1.5.8.31.3.4" class="indexterm"></a><a id="id-1.5.8.31.3.5" class="indexterm"></a><a id="id-1.5.8.31.3.6" class="indexterm"></a><p>関数<code class="function">current_setting</code>は、設定<em class="parameter"><code>setting_name</code></em>の現在の値を返します。
この関数は、<acronym class="acronym">SQL</acronym>の<code class="command">SHOW</code>コマンドと同じです。
以下に例を示します。
</p><pre class="programlisting">SELECT current_setting('datestyle');

 current_setting
-----------------
 ISO, MDY
(1 row)</pre><p>

<em class="parameter"><code>setting_name</code></em>という名前の設定がない場合、<em class="parameter"><code>missing_ok</code></em>が渡され、かつ、それが<code class="literal">true</code>のときを除き、<code class="function">current_setting</code>はエラーを発生させます。
   </p><p><code class="function">set_config</code>関数は、パラメータ<em class="parameter"><code>setting_name</code></em>を<em class="parameter"><code>new_value</code></em>に設定します。
ただし、<em class="parameter"><code>is_local</code></em>が<code class="literal">true</code>の場合、新規値は現在のトランザクションにのみ適用されます。
新規値を現在のセッションに適用する場合は、代わりに<code class="literal">false</code>を使用してください。
この関数は、SQLの<code class="command">SET</code>コマンドと同じです。
以下に例を示します。
</p><pre class="programlisting">SELECT set_config('log_statement_stats', 'off', false);

 set_config
------------
 off
(1 row)</pre><p>
   </p></div><div class="sect2" id="FUNCTIONS-ADMIN-SIGNAL"><div class="titlepage"><div><div><h3 class="title">9.26.2. サーバシグナル送信関数</h3></div></div></div><a id="id-1.5.8.31.4.2" class="indexterm"></a><a id="id-1.5.8.31.4.3" class="indexterm"></a><a id="id-1.5.8.31.4.4" class="indexterm"></a><a id="id-1.5.8.31.4.5" class="indexterm"></a><a id="id-1.5.8.31.4.6" class="indexterm"></a><p><a class="xref" href="functions-admin.html#FUNCTIONS-ADMIN-SIGNAL-TABLE" title="Table 9.78. サーバシグナル送信関数">Table 9.78</a>に示す関数は、制御用シグナルを他のサーバプロセスに送信します。
これらの関数の使用は、デフォルトでスーパーユーザのみに制限されていますが、注記された例外を除き、<code class="command">GRANT</code>を使用して他のユーザにアクセスを許可できます。
   </p><div class="table" id="FUNCTIONS-ADMIN-SIGNAL-TABLE"><p class="title"><strong>Table 9.78. サーバシグナル送信関数</strong></p><div class="table-contents"><table class="table" summary="サーバシグナル送信関数" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>名前</th><th>戻り型</th><th>説明</th></tr></thead><tbody><tr><td>        <code class="literal"><code class="function">pg_cancel_backend(<em class="parameter"><code>pid</code></em> <code class="type">int</code>)</code></code>
        </td><td><code class="type">boolean</code></td><td>バックエンドの現在の問い合わせを取り消す。
       関数を呼ぶユーザが取り消す対象のバックエンドのロールのメンバーであるとき、あるいは<code class="literal">pg_signal_backend</code>の権限を与えられているときも実行できます。
       ただし、スーパーユーザのバックエンドはスーパーユーザのみが取り消せます。
        </td></tr><tr><td>        <code class="literal"><code class="function">pg_reload_conf()</code></code>
        </td><td><code class="type">boolean</code></td><td>サーバプロセスに構成ファイルの再読み込みをさせる</td></tr><tr><td>        <code class="literal"><code class="function">pg_rotate_logfile()</code></code>
        </td><td><code class="type">boolean</code></td><td>サーバログファイルを循環させる</td></tr><tr><td>        <code class="literal"><code class="function">pg_terminate_backend(<em class="parameter"><code>pid</code></em> <code class="type">int</code>)</code></code>
        </td><td><code class="type">boolean</code></td><td>バックエンドを終了する。
       関数を呼ぶユーザが終了対象のバックエンドのロールのメンバーであるとき、あるいは<code class="literal">pg_signal_backend</code>の権限を与えられているときも実行できます。
       ただし、スーパーユーザのバックエンドはスーパーユーザのみが終了できます。
       </td></tr></tbody></table></div></div><br class="table-break" /><p>これらのそれぞれの関数は成功の場合<code class="literal">true</code>（真）を返し、そうでない場合は<code class="literal">false</code>（偽）を返します。
   </p><p><code class="function">pg_cancel_backend</code>と<code class="function">pg_terminate_backend</code>は（それぞれ、<span class="systemitem">SIGINT</span>または<span class="systemitem">SIGTERM</span>）シグナルをプロセス識別子で特定されたバックエンドプロセスに送ります。
使用中のバックエンドのプロセス識別子は<code class="structname">pg_stat_activity</code>ビューの<code class="structfield">pid</code>列から、もしくは、（Unixでは<span class="application">ps</span>、<span class="productname">Windows</span>では<span class="application">Task Manager</span>により）サーバ上の<code class="command">postgres</code>プロセスをリストすることで見つけられます。
実行中のバックエンドのロールは<code class="structname">pg_stat_activity</code>の<code class="structfield">usename</code>列から確認することができます。
   </p><p><code class="function">pg_reload_conf</code>は<span class="systemitem">SIGHUP</span>シグナルをサーバに送り、その結果全てのサーバプロセスが構成ファイルを再読み込みすることになります。
   </p><p><code class="function">pg_rotate_logfile</code>はログファイルマネージャに即座に新規出力ファイルに切替えるようシグナルを送ります。
これは組み込みログ取得が起動している場合のみ有効です。起動していない場合はログファイルマネージャの子プロセスが存在しない理由からです。
   </p></div><div class="sect2" id="FUNCTIONS-ADMIN-BACKUP"><div class="titlepage"><div><div><h3 class="title">9.26.3. バックアップ制御関数</h3></div></div></div><a id="id-1.5.8.31.5.2" class="indexterm"></a><a id="id-1.5.8.31.5.3" class="indexterm"></a><a id="id-1.5.8.31.5.4" class="indexterm"></a><a id="id-1.5.8.31.5.5" class="indexterm"></a><a id="id-1.5.8.31.5.6" class="indexterm"></a><a id="id-1.5.8.31.5.7" class="indexterm"></a><a id="id-1.5.8.31.5.8" class="indexterm"></a><a id="id-1.5.8.31.5.9" class="indexterm"></a><a id="id-1.5.8.31.5.10" class="indexterm"></a><a id="id-1.5.8.31.5.11" class="indexterm"></a><a id="id-1.5.8.31.5.12" class="indexterm"></a><a id="id-1.5.8.31.5.13" class="indexterm"></a><a id="id-1.5.8.31.5.14" class="indexterm"></a><p><a class="xref" href="functions-admin.html#FUNCTIONS-ADMIN-BACKUP-TABLE" title="Table 9.79. バックアップ制御関数">Table 9.79</a>に示す関数はオンラインバックアップの作成を支援するものです。
これらの関数は、リカバリ中には実行できません(<code class="function">pg_is_in_backup</code>、<code class="function">pg_backup_start_time</code>、および<code class="function">pg_wal_location_diff</code>は除く)。
   </p><div class="table" id="FUNCTIONS-ADMIN-BACKUP-TABLE"><p class="title"><strong>Table 9.79. バックアップ制御関数</strong></p><div class="table-contents"><table class="table" summary="バックアップ制御関数" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>名前</th><th>戻り型</th><th>説明</th></tr></thead><tbody><tr><td>        <code class="literal"><code class="function">pg_create_restore_point(<em class="parameter"><code>name</code></em> <code class="type">text</code>)</code></code>
        </td><td><code class="type">pg_lsn</code></td><td>リストア実行用に名前付けされたポイントを作成(デフォルトではスーパーユーザのみ実施可能、ただし他のユーザにも関数を実行するEXECUTE権限を与えることができる)</td></tr><tr><td>        <code class="literal"><code class="function">pg_current_wal_flush_lsn()</code></code>
        </td><td><code class="type">pg_lsn</code></td><td>先行書き込みログの現在のフラッシュ位置を取得する</td></tr><tr><td>        <code class="literal"><code class="function">pg_current_wal_insert_lsn()</code></code>
        </td><td><code class="type">pg_lsn</code></td><td>現在の先行書き込みログの挿入位置の取得</td></tr><tr><td>        <code class="literal"><code class="function">pg_current_wal_lsn()</code></code>
        </td><td><code class="type">pg_lsn</code></td><td>現在の先行書き込みログの書き込み位置を取得</td></tr><tr><td>        <code class="literal"><code class="function">pg_start_backup(<em class="parameter"><code>label</code></em> <code class="type">text</code> [<span class="optional">, <em class="parameter"><code>fast</code></em> <code class="type">boolean</code> [<span class="optional">, <em class="parameter"><code>exclusive</code></em> <code class="type">boolean</code> </span>]</span>])</code></code>
        </td><td><code class="type">pg_lsn</code></td><td>オンラインバックアップの実行準備(デフォルトではスーパーユーザでのみ実施可能、ただし他のユーザにも関数を実行するEXECUTE権限を与えることができる)</td></tr><tr><td>        <code class="literal"><code class="function">pg_stop_backup()</code></code>
        </td><td><code class="type">pg_lsn</code></td><td>排他的オンラインバックアップの実行の終了(デフォルトではスーパーユーザでのみ実施可能、ただし他のユーザにも関数を実行するEXECUTE権限を与えることができる)</td></tr><tr><td>        <code class="literal"><code class="function">pg_stop_backup(<em class="parameter"><code>exclusive</code></em> <code class="type">boolean</code> [<span class="optional">, <em class="parameter"><code>wait_for_archive</code></em> <code class="type">boolean</code> </span>])</code></code>
        </td><td><code class="type">setof record</code></td><td>排他的、あるいは非排他的オンラインバックアップの実行の終了（デフォルトではスーパーユーザでのみ実行可能、ただし他のユーザにも関数を実行するEXECUTE権限を与えることができる）</td></tr><tr><td>        <code class="literal"><code class="function">pg_is_in_backup()</code></code>
        </td><td><code class="type">bool</code></td><td>オンラインでの排他的バックアップが実行中は真。</td></tr><tr><td>        <code class="literal"><code class="function">pg_backup_start_time()</code></code>
        </td><td><code class="type">timestamp with time zone</code></td><td>実行中のオンライン排他的バックアップの開始時刻を取得。</td></tr><tr><td>        <code class="literal"><code class="function">pg_switch_wal()</code></code>
        </td><td><code class="type">pg_lsn</code></td><td>新しい先行書き込みログファイルへの強制移行(デフォルトではスーパーユーザのみ実行可能、ただし他のユーザにも関数を実行するEXECUTE権限を与えることができる)</td></tr><tr><td>        <code class="literal"><code class="function">pg_walfile_name(<em class="parameter"><code>lsn</code></em> <code class="type">pg_lsn</code>)</code></code>
        </td><td><code class="type">text</code></td><td>先行書き込みログの位置をファイル名に変換</td></tr><tr><td>        <code class="literal"><code class="function">pg_walfile_name_offset(<em class="parameter"><code>lsn</code></em> <code class="type">pg_lsn</code>)</code></code>
        </td><td><code class="type">text</code>, <code class="type">integer</code></td><td>先行書き込みログの位置を、ファイル名とファイル内の10進のバイトオフセットに変換</td></tr><tr><td>        <code class="literal"><code class="function">pg_wal_lsn_diff(<em class="parameter"><code>lsn</code></em> <code class="type">pg_lsn</code>, <em class="parameter"><code>lsn</code></em> <code class="type">pg_lsn</code>)</code></code>
       </td><td><code class="type">numeric</code></td><td>2つの先行書き込みログの位置差分を算出</td></tr></tbody></table></div></div><br class="table-break" /><p><code class="function">pg_start_backup</code>は、ユーザが任意に定義したバックアップラベルを受け付けます。
（通常、格納に使用するバックアップダンプファイルにちなんだ名前が付けられます。）
排他モードで使用される場合、この関数は、データベースクラスタのデータディレクトリにバックアップラベルファイル（<code class="filename">backup_label</code>）および<code class="filename">pg_tblspc/</code>ディレクトリにリンクがあるならテーブル空間マップファイル（<code class="filename">tablespace_map</code>）を書き出し、チェックポイントを実行し、先行書き込みログのバックアップ開始位置をテキスト形式で返します。
ユーザはこの結果値を無視することができますが、便利なこともあるので提供されています。
非排他モードで使用される場合は、排他モードとは違い、これらのファイルの内容が<code class="function">pg_stop_backup</code>関数によって戻され、呼び出しユーザはそれをバックアップに書き込む必要があります。

</p><pre class="programlisting">postgres=# select pg_start_backup('label_goes_here');
 pg_start_backup
-----------------
 0/D4445B8
(1 row)</pre><p>
オプションの<code class="type">boolean</code>型パラメータがあります。
<code class="literal">true</code>であれば、できる限り高速に<code class="function">pg_start_backup</code>を実行します。
これは、即時のチェックポイントを強制するため、I/O 操作の急激な増加を引き起こし、実行中の問い合わせ全てを遅延させることがあります。
   </p><p>排他的バックアップでは、<code class="function">pg_stop_backup</code>は、<code class="function">pg_start_backup</code>で作成されたラベルファイルおよび、もしあれば<code class="filename">tablespace_map</code>ファイルを削除します。
非排他的バックアップでは、<code class="filename">backup_label</code>および<code class="filename">tablespace_map</code>の内容が関数の結果として返され、それをバックアップ内のファイルに書き込む必要があります（データディレクトリ内のファイルに書いてはいけません）。
2番目のパラメータは<code class="type">boolean</code>型で省略可能です。
falseの場合、<code class="function">pg_stop_backup</code>はバックアップの完了後、WALがアーカイブされるのを待たずに、即座に戻ります。
この動作はWALのアーカイブを独立して監視するバックアップソフトウェアに対してのみ有用でしょう。
それ以外の場合、バックアップを一貫性のあるものにするために必要なWALが欠けていて、バックアップが役立たなくなるかもしれません。
このパラメータがtrueのとき、アーカイブが有効なら、<code class="function">pg_stop_backup</code>はWALがアーカイブされるまで待機します。
スタンバイでは、これはつまり<code class="varname">archive_mode = always</code>のときのみ待機するということです。
プライマリでの書き込み活動が少ないときは、セグメントの変更を即座に起こさせるためにプライマリで<code class="function">pg_switch_wal</code>を実行するのが有効かもしれません。
   </p><p>プライマリで実行された場合、この関数はまた、先行書き込みログの格納領域にバックアップ履歴ファイルを作成します。
履歴ファイルには<code class="function">pg_start_backup</code>で付与されたラベル、バックアップの先行書き込みログの位置の開始位置、終了位置、バックアップ開始時刻、終了時刻が含まれます。
戻り値は、バックアップの終了先行書き込みログの位置です（これもまた無視可能です）。
終了位置を記録した後、現在の先行書き込みログの挿入位置は自動的に、次の先行書き込みログファイルに進みます。
従って、終了先行書き込みログファイルをすぐにアーカイブし、バックアップを完了させることができます。
   </p><p><code class="function">pg_switch_wal</code>は次の先行書き込みログファイルに移動し、現在のファイルがアーカイブできるようにします（継続的アーカイブを使用している場合）。
戻り値は完了したばかりの先行書き込みログの終了書き込みログ位置に1を加えたものです。
最後に先行書き込みログを変更したときから先行書き込みログの活動がなかった場合は、<code class="function">pg_switch_wal</code>は何もせずに、現在使用中の先行書き込みログファイルの開始位置を返します。
   </p><p><code class="function">pg_create_restore_point</code>はリカバリターゲットとして使用可能な名前付けされた先行書き込みログレコードを生成し、それに該当するログ位置を返します。
与えられた名前は、どこまでリカバリをするかを明示的に指定する<a class="xref" href="recovery-target-settings.html#RECOVERY-TARGET-NAME">recovery_target_name</a>パラメータに使用することができます。
リカバリ処理はリカバリターゲットに指定した名前と一致した最初の時点で終了するため、同じ名前で複数のリストアポイントを作成することは避けてください。
   </p><p><code class="function">pg_current_wal_lsn</code>は、上記の関数で使用されるのと同じ書式で現在の先行書き込みログの書き込み位置を表示します。
同様に<code class="function">pg_current_wal_insert_lsn</code>は、現在の先行書き込みログの挿入位置を表示し、<code class="function">pg_current_wal_flush_lsn</code>はトランザクションログの現在のフラッシュ位置を表示します。
挿入位置は <span class="quote">“<span class="quote">論理的</span>”</span>な任意の時点の先行書き込みログの終了位置です。
一方、書き込み位置は、サーバの内部バッファから書き出された実際の終了位置、またフラッシュ位置は永続的ストレージへの書き込みが保証される位置です。
書き込み位置はサーバ外部から検証可能なものの終端です。通常は、部分的に完了した先行書き込みログファイルのアーカイブ処理を行いたい場合に必要とされるものです。
挿入およびフラッシュ位置はサーバをデバッグする際に主に使用されます。
これらはどちらも読み取りのみの操作であり、スーパーユーザ権限を必要としません。
   </p><p><code class="function">pg_walfile_name_offset</code>を使用して、上記いずれの関数の結果からも、対応する先行書き込みログファイルとバイトオフセットを取り出すことができます。
以下に例を示します。
</p><pre class="programlisting">postgres=# SELECT * FROM pg_walfile_name_offset(pg_stop_backup());
        file_name         | file_offset 
--------------------------+-------------
 00000001000000000000000D |     4039624
(1 row)</pre><p>
同様に、<code class="function">pg_walfile_name</code>は、先行書き込みログファイル名のみを取り出します。
指定した先行書き込みログの位置が正確に先行書き込みログファイルの境界であった場合、これらの両関数は前の先行書き込みログファイルの名前を返します。
通常これは、先行書き込みログファイルのアーカイブ動作では好まれる動作です。
前のファイルが現在のアーカイブで必要とする最後のファイルであるからです。
   </p><p><code class="function">pg_wal_lsn_diff</code>は、2つの先行書き込みログの位置の差分をバイト数で算出します。
この関数は<code class="structname">pg_stat_replication</code>や<a class="xref" href="functions-admin.html#FUNCTIONS-ADMIN-BACKUP-TABLE" title="Table 9.79. バックアップ制御関数">Table 9.79</a>に示される関数と併用することで、レプリケーションの遅延の確認に使用できます。
   </p><p>これらの関数の正しい使用方法については、<a class="xref" href="continuous-archiving.html" title="25.3. 継続的アーカイブとポイントインタイムリカバリ（PITR）">Section 25.3</a>を参照してください。
   </p></div><div class="sect2" id="FUNCTIONS-RECOVERY-CONTROL"><div class="titlepage"><div><div><h3 class="title">9.26.4. リカバリ制御関数</h3></div></div></div><a id="id-1.5.8.31.6.2" class="indexterm"></a><a id="id-1.5.8.31.6.3" class="indexterm"></a><a id="id-1.5.8.31.6.4" class="indexterm"></a><a id="id-1.5.8.31.6.5" class="indexterm"></a><p><a class="xref" href="functions-admin.html#FUNCTIONS-RECOVERY-INFO-TABLE" title="Table 9.80. リカバリ情報関数">Table 9.80</a>に示される関数は、スタンバイサーバの現在のステータス情報を提供します。
これらの関数はリカバリ中、および通常稼動時に実行することができるでしょう。
   </p><div class="table" id="FUNCTIONS-RECOVERY-INFO-TABLE"><p class="title"><strong>Table 9.80. リカバリ情報関数</strong></p><div class="table-contents"><table class="table" summary="リカバリ情報関数" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>名前</th><th>戻り型</th><th>説明</th></tr></thead><tbody><tr><td>        <code class="literal"><code class="function">pg_is_in_recovery()</code></code>
        </td><td><code class="type">bool</code></td><td>まだリカバリ実施中であれば真を返します。
       </td></tr><tr><td>        <code class="literal"><code class="function">pg_last_wal_receive_lsn()</code></code>
        </td><td><code class="type">pg_lsn</code></td><td>ストリーミングレプリケーションにより受信されディスクに書き込みされた、先行書き込みログの最後の位置を取得します。ストリーミングレプリケーションが実施されている場合は、この値が単調に増加していくでしょう。リカバリが完了した場合、受信されディスクに書き込まれた最後のWALレコードの位置の値がそのまま残ります。ストリーミングレプリケーションが無効、もしくは開始されていない場合、この関数はNULLを返します。
       </td></tr><tr><td>        <code class="literal"><code class="function">pg_last_wal_replay_lsn()</code></code>
        </td><td><code class="type">pg_lsn</code></td><td>リカバリ中に再生された最後の先行書き込みログの位置を取得します。リカバリが実施されている場合は、この値が単調に増加していくでしょう。リカバリが完了した場合は、リカバリ時に適用された最後のWALレコードの値がそのまま残ります。もしサーバがリカバリ無しで普通に起動された場合、この関数はNULLを返します。
       </td></tr><tr><td>        <code class="literal"><code class="function">pg_last_xact_replay_timestamp()</code></code>
        </td><td><code class="type">timestamp with time zone</code></td><td>リカバリ中に再生された最後のトランザクションのタイムスタンプを取得します。
このタイムスタンプは、プライマリにて該当するトランザクションがコミット、もしくはアボートされた際のWALレコードが生成された時間です。
リカバリ中に何のトランザクションも再生されていない場合、この関数はNULLを返します。
リカバリがまだ実行中の場合、この関数の戻り値は単調に増加します。
リカバリが完了している場合、この関数の戻り値はリカバリ中に再生した最後のトランザクションの時間のまま変化しません。
サーバがリカバリ処理無しに正常に開始された場合、この関数はNULLを返します。
       </td></tr></tbody></table></div></div><br class="table-break" /><a id="id-1.5.8.31.6.8" class="indexterm"></a><a id="id-1.5.8.31.6.9" class="indexterm"></a><a id="id-1.5.8.31.6.10" class="indexterm"></a><p><a class="xref" href="functions-admin.html#FUNCTIONS-RECOVERY-CONTROL-TABLE" title="Table 9.81. リカバリ制御関数">Table 9.81</a>に示す関数は、リカバリの進行を制御する関数です。
これらの関数はリカバリ中のみ実行することが可能です。
   </p><div class="table" id="FUNCTIONS-RECOVERY-CONTROL-TABLE"><p class="title"><strong>Table 9.81. リカバリ制御関数</strong></p><div class="table-contents"><table class="table" summary="リカバリ制御関数" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>名前</th><th>戻り型</th><th>説明</th></tr></thead><tbody><tr><td>        <code class="literal"><code class="function">pg_is_wal_replay_paused()</code></code>
        </td><td><code class="type">bool</code></td><td>リカバリが停止中であれば真を返す
       </td></tr><tr><td>        <code class="literal"><code class="function">pg_wal_replay_pause()</code></code>
        </td><td><code class="type">void</code></td><td>即座にリカバリを停止する(デフォルトではスーパーユーザのみ実行可能、ただし他のユーザにも関数を実行するEXECUTE権限を与えることができる)
       </td></tr><tr><td>        <code class="literal"><code class="function">pg_wal_replay_resume()</code></code>
        </td><td><code class="type">void</code></td><td>もしリカバリ停止中であれば再開する(デフォルトではスーパーユーザのみ実行可能、ただし他のユーザにも関数を実行するEXECUTE権限を与えることができる)
       </td></tr></tbody></table></div></div><br class="table-break" /><p>リカバリ停止中は、それ以降のデータベースへの変更は適用されません。
ホットスタンバイ側では、新しい問い合わせはすべて、同じ一貫性を持ったデータベースのスナップショットを参照することになります。
そしてリカバリが再開されるまで、これ以上の問い合わせの競合は発生しません。
   </p><p>ストリーミングレプリケーションが無効の場合、停止状態はいつまでも問題なく継続するでしょう。
ストリーミングレプリケーションの実行中は、WALレコードの受信が継続され、停止時間、WALの生成速度、ディスクの残存容量によりますが、ディスク溢れが発生する可能性があります。
   </p></div><div class="sect2" id="FUNCTIONS-SNAPSHOT-SYNCHRONIZATION"><div class="titlepage"><div><div><h3 class="title">9.26.5. スナップショット同期関数</h3></div></div></div><a id="id-1.5.8.31.7.2" class="indexterm"></a><p><span class="productname">PostgreSQL</span>はデータベースのセッションに対して、それらのスナップショットを同期させることが可能です。
<em class="firstterm">スナップショット</em>は、そのスナップショットを使用しているトランザクションにどのデータが可視かを決定します。
同期スナップショットは、2つ以上のセッションにおいて、全く同じデータベース内容を見たい場合に必要となります。
単に2つのセッションが独立してそれぞれのトランザクションを開始するだけでは、第3のトランザクションのコミットが、2つのトランザクションの<code class="command">START TRANSACTION</code>の狭間で実行され、そのため一方のトランザクションではそのコミット結果が見え、他方では見えないという可能性が常にあります。
   </p><p>このような問題を解決するため、<span class="productname">PostgreSQL</span>ではトランザクションが使用しているスナップショットを<em class="firstterm">エクスポート</em>できるようになっています。エクスポートしたトランザクションが開かれ続けている限り、他のトランザクションがそれを<em class="firstterm">インポート</em>することができ、
そしてこれにより最初のトランザクションと正確に同じとなるデータベースの可視性を保証されます。ただし、これらの(スナップショットを共有している)トランザクションによって発生したデータベースへの変更は、コミットされていないトランザクションによる変更と同様に、(スナップショットを共有している)他のトランザクションには見えないままです。
つまり、既存データに対しては同期されますが、それら自身による変更については通常の振る舞いをします。
   </p><p>スナップショットは、<a class="xref" href="functions-admin.html#FUNCTIONS-SNAPSHOT-SYNCHRONIZATION-TABLE" title="Table 9.82. スナップショット同期関数">Table 9.82</a>に示す<code class="function">pg_export_snapshot</code>関数を用いてエクスポートされ、<a class="xref" href="sql-set-transaction.html" title="SET TRANSACTION"><span class="refentrytitle">SET TRANSACTION</span></a>コマンドを用いてインポートされます。
   </p><div class="table" id="FUNCTIONS-SNAPSHOT-SYNCHRONIZATION-TABLE"><p class="title"><strong>Table 9.82. スナップショット同期関数</strong></p><div class="table-contents"><table class="table" summary="スナップショット同期関数" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>名前</th><th>戻り値型</th><th>説明</th></tr></thead><tbody><tr><td>        <code class="literal"><code class="function">pg_export_snapshot()</code></code>
       </td><td><code class="type">text</code></td><td>現在のスナップショットを保存し、その識別子を返す</td></tr></tbody></table></div></div><br class="table-break" /><p><code class="function">pg_export_snapshot</code>関数は現在のスナップショットを保存し、そのスナップショットを識別する<code class="type">text</code>文字列を返します。
この文字列はスナップショットをインポートしたい(データベース外の)クライアントに渡されなければなりません。
エクスポートしたトランザクションが終わるまでの間のみ、そのスナップショットをインポートすることができます。
必要ならばトランザクションは複数のスナップショットをエクスポートできます。
<code class="literal">REPEATABLE READ</code>や上位の隔離レベルでは、トランザクションはその有効期間の間同じスナップショットを使用しますので、これは<code class="literal">READ COMMITTED</code>トランザクションでのみ有用であることに注意してください。
一旦スナップショットをエクスポートしたトランザクションでは、<a class="xref" href="sql-prepare-transaction.html" title="PREPARE TRANSACTION"><span class="refentrytitle">PREPARE TRANSACTION</span></a>による準備を使用することができなくなります。
   </p><p>エクスポートしたトランザクションの使用方法の詳細については<a class="xref" href="sql-set-transaction.html" title="SET TRANSACTION"><span class="refentrytitle">SET TRANSACTION</span></a>を参照してください。
   </p></div><div class="sect2" id="FUNCTIONS-REPLICATION"><div class="titlepage"><div><div><h3 class="title">9.26.6. レプリケーション関数</h3></div></div></div><p><a class="xref" href="functions-admin.html#FUNCTIONS-REPLICATION-TABLE" title="Table 9.83. レプリケーションSQL関数">Table 9.83</a>に示す関数はレプリケーション機能を制御したり、情報を取得したりするためのものです。
基盤となっている機能の情報に関しては<a class="xref" href="warm-standby.html#STREAMING-REPLICATION" title="26.2.5. ストリーミングレプリケーション">Section 26.2.5</a>、<a class="xref" href="warm-standby.html#STREAMING-REPLICATION-SLOTS" title="26.2.6. レプリケーションスロット">Section 26.2.6</a>、<a class="xref" href="replication-origins.html" title="Chapter 49. レプリケーション進捗の追跡">Chapter 49</a>を参照してください。
これらの関数の使用はスーパーユーザに限定されています。
   </p><p>これらの関数の多くには、レプリケーションプロトコルに等価なコマンドがあります。
<a class="xref" href="protocol-replication.html" title="52.4. ストリーミングレプリケーションプロトコル">Section 52.4</a>を参照してください。
   </p><p><a class="xref" href="functions-admin.html#FUNCTIONS-ADMIN-BACKUP" title="9.26.3. バックアップ制御関数">Section 9.26.3</a>、<a class="xref" href="functions-admin.html#FUNCTIONS-RECOVERY-CONTROL" title="9.26.4. リカバリ制御関数">Section 9.26.4</a>、<a class="xref" href="functions-admin.html#FUNCTIONS-SNAPSHOT-SYNCHRONIZATION" title="9.26.5. スナップショット同期関数">Section 9.26.5</a>に書かれている関数もレプリケーションに関係するものです。
   </p><div class="table" id="FUNCTIONS-REPLICATION-TABLE"><p class="title"><strong>Table 9.83. レプリケーション<acronym class="acronym">SQL</acronym>関数</strong></p><div class="table-contents"><table class="table" summary="レプリケーションSQL関数" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>関数</th><th>戻り値型</th><th>説明</th></tr></thead><tbody><tr><td>        <a id="id-1.5.8.31.8.5.2.2.1.1.1" class="indexterm"></a>
        <code class="literal"><code class="function">pg_create_physical_replication_slot(<em class="parameter"><code>slot_name</code></em> <code class="type">name</code> [<span class="optional">, <em class="parameter"><code>immediately_reserve</code></em> <code class="type">boolean</code>, <em class="parameter"><code>temporary</code></em> <code class="type">boolean</code></span>])</code></code>
       </td><td>        (<em class="parameter"><code>slot_name</code></em> <code class="type">name</code>, <em class="parameter"><code>lsn</code></em> <code class="type">pg_lsn</code>)
       </td><td>
<em class="parameter"><code>slot_name</code></em>という名前の新しい物理レプリケーションスロットを作成します。
2番目のパラメータはオプションで、<code class="literal">true</code>の場合、このレプリケーションスロットの<acronym class="acronym">LSN</acronym>が即座に予約されることを指定します。
それ以外の場合は<acronym class="acronym">LSN</acronym>はストリーミングレプリケーションのクライアントから最初に接続された時に予約されます。
物理スロットからのストリーミングの変更はストリーミングレプリケーションプロトコルでのみ可能です。<a class="xref" href="protocol-replication.html" title="52.4. ストリーミングレプリケーションプロトコル">Section 52.4</a>を参照してください。
3番目のパラメータ<em class="parameter"><code>temporary</code></em>はオプションで、trueに設定されるとそのスロットは永続的にディスクに保存されるものではなく、現在のセッションによってのみ用いられることを意図していることを指定します。
一時的なスロットはエラーが発生したときも解放されます。
この関数は、レプリケーションプロトコルコマンド<code class="literal">CREATE_REPLICATION_SLOT ... PHYSICAL</code>に対応するものです。
       </td></tr><tr><td>        <a id="id-1.5.8.31.8.5.2.2.2.1.1" class="indexterm"></a>
        <code class="literal"><code class="function">pg_drop_replication_slot(<em class="parameter"><code>slot_name</code></em> <code class="type">name</code>)</code></code>
       </td><td>        <code class="type">void</code>
       </td><td><em class="parameter"><code>slot_name</code></em>という名前の物理もしくは論理レプリケーションスロットを削除します。
レプリケーションプロトコルコマンド<code class="literal">DROP_REPLICATION_SLOT</code>と同じです。
論理スロットの場合、この関数はスロットが作成されたのと同じデータベースに接続している時に呼ばなければなりません。
       </td></tr><tr><td>        <a id="id-1.5.8.31.8.5.2.2.3.1.1" class="indexterm"></a>
        <code class="literal"><code class="function">pg_create_logical_replication_slot(<em class="parameter"><code>slot_name</code></em> <code class="type">name</code>, <em class="parameter"><code>plugin</code></em> <code class="type">name</code> [<span class="optional">, <em class="parameter"><code>temporary</code></em> <code class="type">boolean</code></span>])</code></code>
       </td><td>        (<em class="parameter"><code>slot_name</code></em> <code class="type">name</code>, <em class="parameter"><code>lsn</code></em> <code class="type">pg_lsn</code>)
       </td><td>出力プラグイン<em class="parameter"><code>plugin</code></em>を使用して、<em class="parameter"><code>slot_name</code></em>という名前の新しい論理(デコード)レプリケーションスロットを作成します。
3番目のパラメータ<em class="parameter"><code>temporary</code></em>はオプションで、trueに設定されるとそのスロットは永続的にディスクに保存されるものではなく、現在のセッションによってのみ用いられることを意図していることを指定します。
一時的なスロットはエラーが発生したときも解放されます。
この関数を呼び出すのはレプリケーションプロトコルコマンド<code class="literal">CREATE_REPLICATION_SLOT ... LOGICAL</code>と同じ効果があります。
       </td></tr><tr><td>        <a id="id-1.5.8.31.8.5.2.2.4.1.1" class="indexterm"></a>
        <code class="literal"><code class="function">pg_logical_slot_get_changes(<em class="parameter"><code>slot_name</code></em> <code class="type">name</code>, <em class="parameter"><code>upto_lsn</code></em> <code class="type">pg_lsn</code>, <em class="parameter"><code>upto_nchanges</code></em> <code class="type">int</code>, VARIADIC <em class="parameter"><code>options</code></em> <code class="type">text[]</code>)</code></code>
       </td><td>        (<em class="parameter"><code>lsn</code></em> <code class="type">pg_lsn</code>, <em class="parameter"><code>xid</code></em> <code class="type">xid</code>, <em class="parameter"><code>data</code></em> <code class="type">text</code>)
       </td><td>変更が最後に消費された時点から開始して、スロット<em class="parameter"><code>slot_name</code></em>の変更を返します。
<em class="parameter"><code>upto_lsn</code></em>と<em class="parameter"><code>upto_nchanges</code></em>がNULLならば論理デコードはWALの最後まで続きます。
<em class="parameter"><code>upto_lsn</code></em>が非NULLであれば、デコードは指定されたLSNより前にコミットされたトランザクションのみを含みます。
<em class="parameter"><code>upto_nchanges</code></em>が非NULLであれば、デコードにより生成された行の数が指定された値を越えたときに、デコードは止まります。
しかしながら、新しいトランザクションの各コミットをデコードして生成された行を追加した後でしかこの制限は確認されませんので、実際に返される行の数は大きいかもしれないことに注意してください。
       </td></tr><tr><td>        <a id="id-1.5.8.31.8.5.2.2.5.1.1" class="indexterm"></a>
        <code class="literal"><code class="function">pg_logical_slot_peek_changes(<em class="parameter"><code>slot_name</code></em> <code class="type">name</code>, <em class="parameter"><code>upto_lsn</code></em> <code class="type">pg_lsn</code>, <em class="parameter"><code>upto_nchanges</code></em> <code class="type">int</code>, VARIADIC <em class="parameter"><code>options</code></em> <code class="type">text[]</code>)</code></code>
       </td><td>        (<em class="parameter"><code>lsn</code></em> <code class="type">pg_lsn</code>, <em class="parameter"><code>xid</code></em> <code class="type">xid</code>, <em class="parameter"><code>data</code></em> <code class="type">text</code>)
       </td><td>        変更が消費されないということを除いて、<code class="function">pg_logical_slot_get_changes()</code>関数と同じように振る舞います。すなわち、将来の呼び出しでは再び同じものが返ります。
       </td></tr><tr><td>        <a id="id-1.5.8.31.8.5.2.2.6.1.1" class="indexterm"></a>
        <code class="literal"><code class="function">pg_logical_slot_get_binary_changes(<em class="parameter"><code>slot_name</code></em> <code class="type">name</code>, <em class="parameter"><code>upto_lsn</code></em> <code class="type">pg_lsn</code>, <em class="parameter"><code>upto_nchanges</code></em> <code class="type">int</code>, VARIADIC <em class="parameter"><code>options</code></em> <code class="type">text[]</code>)</code></code>
       </td><td>        (<em class="parameter"><code>lsn</code></em> <code class="type">pg_lsn</code>, <em class="parameter"><code>xid</code></em> <code class="type">xid</code>, <em class="parameter"><code>data</code></em> <code class="type">bytea</code>)
       </td><td>        変更は<code class="type">bytea</code>として返されるということを除いて<code class="function">pg_logical_slot_get_changes()</code>関数と同じように振る舞います。
       </td></tr><tr><td>        <a id="id-1.5.8.31.8.5.2.2.7.1.1" class="indexterm"></a>
        <code class="literal"><code class="function">pg_logical_slot_peek_binary_changes(<em class="parameter"><code>slot_name</code></em> <code class="type">name</code>, <em class="parameter"><code>upto_lsn</code></em> <code class="type">pg_lsn</code>, <em class="parameter"><code>upto_nchanges</code></em> <code class="type">int</code>, VARIADIC <em class="parameter"><code>options</code></em> <code class="type">text[]</code>)</code></code>
       </td><td>        (<em class="parameter"><code>lsn</code></em> <code class="type">pg_lsn</code>, <em class="parameter"><code>xid</code></em> <code class="type">xid</code>, <em class="parameter"><code>data</code></em> <code class="type">bytea</code>)
       </td><td>        変更は<code class="type">bytea</code>として返され消費されないということを除いて<code class="function">pg_logical_slot_get_changes()</code>関数と同じように振る舞います。すなわち、将来の呼び出しでは再び同じものが返ります。
       </td></tr><tr><td id="PG-REPLICATION-ORIGIN-CREATE">        <a id="id-1.5.8.31.8.5.2.2.8.1.1" class="indexterm"></a>
        <code class="literal"><code class="function">pg_replication_origin_create(<em class="parameter"><code>node_name</code></em> <code class="type">text</code>)</code></code>
       </td><td>        <code class="type">oid</code>
       </td><td>指定した外部名でレプリケーション起点を作成し、割り当てられた内部IDを返します。
       </td></tr><tr><td id="PG-REPLICATION-ORIGIN-DROP">        <a id="id-1.5.8.31.8.5.2.2.9.1.1" class="indexterm"></a>
        <code class="literal"><code class="function">pg_replication_origin_drop(<em class="parameter"><code>node_name</code></em> <code class="type">text</code>)</code></code>
       </td><td>        <code class="type">void</code>
       </td><td>以前に作成されたレプリケーション起点を、それに関連するすべての再生の進捗も含めて削除します。
       </td></tr><tr><td>        <a id="id-1.5.8.31.8.5.2.2.10.1.1" class="indexterm"></a>
        <code class="literal"><code class="function">pg_replication_origin_oid(<em class="parameter"><code>node_name</code></em> <code class="type">text</code>)</code></code>
       </td><td>        <code class="type">oid</code>
       </td><td>レプリケーション起点を名前で検索し、内部IDを返します。
相当するレプリケーション起点が見つからない場合はエラーが発生します。
       </td></tr><tr><td id="PG-REPLICATION-ORIGIN-SESSION-SETUP">        <a id="id-1.5.8.31.8.5.2.2.11.1.1" class="indexterm"></a>
        <code class="literal"><code class="function">pg_replication_origin_session_setup(<em class="parameter"><code>node_name</code></em> <code class="type">text</code>)</code></code>
       </td><td>        <code class="type">void</code>
       </td><td>現在のセッションに、指定の起点から再生中であると印を付け、再生の進捗が追跡できるようにします。
元に戻すには<code class="function">pg_replication_origin_session_reset</code>を使って下さい。
以前に起点が設定されていない場合にのみ使うことができます。
       </td></tr><tr><td>        <a id="id-1.5.8.31.8.5.2.2.12.1.1" class="indexterm"></a>
        <code class="literal"><code class="function">pg_replication_origin_session_reset()</code></code>
       </td><td>        <code class="type">void</code>
       </td><td><code class="function">pg_replication_origin_session_setup()</code>の効果を取り消します。
       </td></tr><tr><td>        <a id="id-1.5.8.31.8.5.2.2.13.1.1" class="indexterm"></a>
        <code class="literal"><code class="function">pg_replication_origin_session_is_setup()</code></code>
       </td><td>        <code class="type">bool</code>
       </td><td>現在のセッションで、レプリケーション起点が設定されたかどうかを返します。
       </td></tr><tr><td id="PG-REPLICATION-ORIGIN-SESSION-PROGRESS">        <a id="id-1.5.8.31.8.5.2.2.14.1.1" class="indexterm"></a>
        <code class="literal"><code class="function">pg_replication_origin_session_progress(<em class="parameter"><code>flush</code></em> <code class="type">bool</code>)</code></code>
       </td><td>        <code class="type">pg_lsn</code>
       </td><td>現在のセッションで設定されたレプリケーション起点の再生位置を返します。
パラメータ<em class="parameter"><code>flush</code></em>により、対応するローカルトランザクションがディスクにフラッシュされていることが保証されるかどうかを決定します。
       </td></tr><tr><td id="PG-REPLICATION-ORIGIN-XACT-SETUP">        <a id="id-1.5.8.31.8.5.2.2.15.1.1" class="indexterm"></a>
        <code class="literal"><code class="function">pg_replication_origin_xact_setup(<em class="parameter"><code>origin_lsn</code></em> <code class="type">pg_lsn</code>, <em class="parameter"><code>origin_timestamp</code></em> <code class="type">timestamptz</code>)</code></code>
       </td><td>        <code class="type">void</code>
       </td><td>現在のトランザクションに、指定の<acronym class="acronym">LSN</acronym>およびタイムスタンプでコミットしたトランザクションを再生中であると印をつけます。
事前にレプリケーション起点が<code class="function">pg_replication_origin_session_setup()</code>を使って設定されている場合にのみ呼び出せます。
       </td></tr><tr><td id="PG-REPLICATION-ORIGIN-XACT-RESET">        <a id="id-1.5.8.31.8.5.2.2.16.1.1" class="indexterm"></a>
        <code class="literal"><code class="function">pg_replication_origin_xact_reset()</code></code>
       </td><td>        <code class="type">void</code>
       </td><td><code class="function">pg_replication_origin_xact_setup()</code>の効果を取り消します。
       </td></tr><tr><td id="PG-REPLICATION-ORIGIN-ADVANCE">        <a id="id-1.5.8.31.8.5.2.2.17.1.1" class="indexterm"></a>
        <code class="literal">pg_replication_origin_advance<code class="function">(<em class="parameter"><code>node_name</code></em> <code class="type">text</code>, <em class="parameter"><code>lsn</code></em> <code class="type">pg_lsn</code>)</code></code>
       </td><td>        <code class="type">void</code>
       </td><td>指定したノードのレプリケーションの進捗を、指定の位置に設定します。
これは主に設定変更の後で初期位置や新しい位置を設定するときなどに役立ちます。
この関数を不注意に使うと、レプリケーションデータが一貫性を失うかもしれないことに注意して下さい。
       </td></tr><tr><td id="PG-REPLICATION-ORIGIN-PROGRESS">        <a id="id-1.5.8.31.8.5.2.2.18.1.1" class="indexterm"></a>
        <code class="literal"><code class="function">pg_replication_origin_progress(<em class="parameter"><code>node_name</code></em> <code class="type">text</code>, <em class="parameter"><code>flush</code></em> <code class="type">bool</code>)</code></code>
       </td><td>        <code class="type">pg_lsn</code>
       </td><td>指定したレプリケーション起点の再生位置を返します。
パラメータ<em class="parameter"><code>flush</code></em>により、対応するローカルトランザクションがディスクにフラッシュされていることが保証されるかどうかを決定します。
       </td></tr><tr><td id="PG-LOGICAL-EMIT-MESSAGE-TEXT">        <a id="id-1.5.8.31.8.5.2.2.19.1.1" class="indexterm"></a>
        <code class="literal"><code class="function">pg_logical_emit_message(<em class="parameter"><code>transactional</code></em> <code class="type">bool</code>, <em class="parameter"><code>prefix</code></em> <code class="type">text</code>, <em class="parameter"><code>content</code></em> <code class="type">text</code>)</code></code>
       </td><td>        <code class="type">pg_lsn</code>
       </td><td>論理デコードのテキストのメッセージを送出します
これは汎用的なメッセージをWALを通して論理デコードのプラグインに渡すのに使うことができます。
パラメータ<em class="parameter"><code>transactional</code></em>は、メッセージが現在のトランザクションの一部なのか、あるいはすぐに書き込み、論理デコードがレコードを読んだらすぐにデコードされるべきものなのかを指定します。
<em class="parameter"><code>prefix</code></em>は文字通りの接頭辞で、論理デコードのプラグインが、自分にとって関心のあるメッセージを容易に認識できるように使われます。
<em class="parameter"><code>content</code></em>はメッセージのテキストです。
       </td></tr><tr><td id="PG-LOGICAL-EMIT-MESSAGE-BYTEA">        <code class="literal"><code class="function">pg_logical_emit_message(<em class="parameter"><code>transactional</code></em> <code class="type">bool</code>, <em class="parameter"><code>prefix</code></em> <code class="type">text</code>, <em class="parameter"><code>content</code></em> <code class="type">bytea</code>)</code></code>
       </td><td>        <code class="type">pg_lsn</code>
       </td><td>論理デコードのバイナリのメッセージを送出します
これは汎用的なメッセージをWALを通して論理デコードのプラグインに渡すのに使うことができます。
パラメータ<em class="parameter"><code>transactional</code></em>は、メッセージが現在のトランザクションの一部なのか、あるいはすぐに書き込み、論理デコードがレコードを読んだらすぐにデコードされるべきものなのかを指定します。
<em class="parameter"><code>prefix</code></em>は文字通りの接頭辞で、論理デコードのプラグインが、自分にとって関心のあるメッセージを容易に認識できるように使われます。
<em class="parameter"><code>content</code></em>はメッセージのバイナリの内容です。
       </td></tr></tbody></table></div></div><br class="table-break" /></div><div class="sect2" id="FUNCTIONS-ADMIN-DBOBJECT"><div class="titlepage"><div><div><h3 class="title">9.26.7. データベースオブジェクト管理関数</h3></div></div></div><p><a class="xref" href="functions-admin.html#FUNCTIONS-ADMIN-DBSIZE" title="Table 9.84. データベースオブジェクト容量関数">Table 9.84</a>で示された関数はデータベースオブジェクトのディスク領域を計算します。
   </p><a id="id-1.5.8.31.9.3" class="indexterm"></a><a id="id-1.5.8.31.9.4" class="indexterm"></a><a id="id-1.5.8.31.9.5" class="indexterm"></a><a id="id-1.5.8.31.9.6" class="indexterm"></a><a id="id-1.5.8.31.9.7" class="indexterm"></a><a id="id-1.5.8.31.9.8" class="indexterm"></a><a id="id-1.5.8.31.9.9" class="indexterm"></a><a id="id-1.5.8.31.9.10" class="indexterm"></a><a id="id-1.5.8.31.9.11" class="indexterm"></a><div class="table" id="FUNCTIONS-ADMIN-DBSIZE"><p class="title"><strong>Table 9.84. データベースオブジェクト容量関数</strong></p><div class="table-contents"><table class="table" summary="データベースオブジェクト容量関数" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>名前</th><th>戻り型</th><th>説明</th></tr></thead><tbody><tr><td><code class="literal"><code class="function">pg_column_size(<code class="type">any</code>)</code></code></td><td><code class="type">int</code></td><td>特定の値を格納するのに使用される（場合により圧縮された）バイト数</td></tr><tr><td>        <code class="literal"><code class="function">pg_database_size(<code class="type">oid</code>)</code></code>
        </td><td><code class="type">bigint</code></td><td>指定されたOIDのデータベースで使用されるディスク容量</td></tr><tr><td>        <code class="literal"><code class="function">pg_database_size(<code class="type">name</code>)</code></code>
        </td><td><code class="type">bigint</code></td><td>指定された名前のデータベースで使用されるディスク容量</td></tr><tr><td>        <code class="literal"><code class="function">pg_indexes_size(<code class="type">regclass</code>)</code></code>
        </td><td><code class="type">bigint</code></td><td>指定されテーブルに付与されたインデックスで使用される総ディスク容量。
       </td></tr><tr><td>        <code class="literal"><code class="function">pg_relation_size(<em class="parameter"><code>relation</code></em> <code class="type">regclass</code>, <em class="parameter"><code>fork</code></em> <code class="type">text</code>)</code></code>
        </td><td><code class="type">bigint</code></td><td>指定されたテーブルまたはインデックスの指定されたフォーク（<code class="literal">'main'</code>、<code class="literal">'fsm'</code>、<code class="literal">'vm'</code>または<code class="literal">'init'</code>）で使用されるディスク容量
       </td></tr><tr><td>        <code class="literal"><code class="function">pg_relation_size(<em class="parameter"><code>relation</code></em> <code class="type">regclass</code>)</code></code>
        </td><td><code class="type">bigint</code></td><td><code class="literal">pg_relation_size(..., 'main')</code>の省略表現
       </td></tr><tr><td>        <code class="literal"><code class="function">pg_size_bytes(<code class="type">text</code>)</code></code>
        </td><td><code class="type">bigint</code></td><td>単位付きの可読性の高い形式のサイズをバイトに変換
       </td></tr><tr><td>        <code class="literal"><code class="function">pg_size_pretty(<code class="type">bigint</code>)</code></code>
        </td><td><code class="type">text</code></td><td>64ビット整数で表現されたサイズ（バイト数）を、サイズの単位をつけた可読性が高い書式に変換
       </td></tr><tr><td>        <code class="literal"><code class="function">pg_size_pretty(<code class="type">numeric</code>)</code></code>
        </td><td><code class="type">text</code></td><td>numeric値で表現されたサイズ（バイト数）を、サイズの単位をつけた可読性が高い書式に変換
       </td></tr><tr><td>        <code class="literal"><code class="function">pg_table_size(<code class="type">regclass</code>)</code></code>
        </td><td><code class="type">bigint</code></td><td>指定されたテーブルで使用されるディスク容量、インデックスは除外する（しかしTOAST、空き領域マップ、可視性マップは含む）
       </td></tr><tr><td>        <code class="literal"><code class="function">pg_tablespace_size(<code class="type">oid</code>)</code></code>
        </td><td><code class="type">bigint</code></td><td>指定されたOIDを持つテーブル空間で使用されるディスク容量</td></tr><tr><td>        <code class="literal"><code class="function">pg_tablespace_size(<code class="type">name</code>)</code></code>
        </td><td><code class="type">bigint</code></td><td>指定された名前を持つテーブル空間で使用されるディスク容量</td></tr><tr><td>        <code class="literal"><code class="function">pg_total_relation_size(<code class="type">regclass</code>)</code></code>
        </td><td><code class="type">bigint</code></td><td>指定されたテーブルで使用される、すべてのインデックスと<acronym class="acronym">TOAST</acronym>データを含むディスク総容量
       </td></tr></tbody></table></div></div><br class="table-break" /><p>    <code class="function">pg_column_size</code>は任意の個別のデータ値を格納するのに使用されている領域を示します。
   </p><p><code class="function">pg_total_relation_size</code>は、テーブルまたはTOASTテーブルのOIDまたは名前を受け付け、指定されたテーブルと関連する全てのインデックスで使用される総ディスク容量を返します。
この関数は<code class="function">pg_table_size</code> <code class="literal">+</code> <code class="function">pg_indexes_size</code> の結果と等しいです。
   </p><p><code class="function">pg_table_size</code>は、テーブルのOIDまたは名前を受け付け、インデックスを除いたテーブルのみで使用されるディスク容量を返します。
(TOAST領域、空き領域マップ、可視性マップは含みます。)
   </p><p><code class="function">pg_indexes_size</code>は、テーブルのOIDまたは名前を受け付け、指定されたテーブル付与されている全てのインデックスで使用されるディスク容量を返します。
   </p><p><code class="function">pg_database_size</code>と<code class="function">pg_tablespace_size</code>はデータベースまたはテーブル空間の名前またはOIDを受付け、そこで使用される総容量を返します。
<code class="function">pg_database_size</code>を使うためには、指定されたデータベースに<code class="literal">CONNECT</code>権限(デフォルトで付与されている)を持っているか、あるいは<code class="literal">pg_read_all_stats</code>ロールのメンバーでなければなりません。
<code class="function">pg_tablespace_size</code>を使うためには、それが現在のデータベースのデフォルトテーブル空間でない限り、指定されたテーブル空間に<code class="literal">CREATE</code>権限を持っているか、あるいは<code class="literal">pg_read_all_stats</code>ロールのメンバーでなければなりません。
   </p><p><code class="function">pg_relation_size</code>は、テーブル、インデックス、またはTOASTテーブルのOIDまたは名前を受け付け、そのリレーションの1つのフォークのディスク容量をバイト単位で返します。
(たいていの目的には、高位の関数<code class="function">pg_total_relation_size</code>や<code class="function">pg_table_size</code>を使うのがより便利であることに注意してください。高位の関数はフォークすべての容量を合計します。)
引数1つでは、そのリレーションの主データフォークの容量を返します。
2番目の引数はどのフォークを調査するかを指定するために設定できます。
    </p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">'main'</code>を指定すると、そのリレーションの主データフォークの容量を返します。
      </p></li><li class="listitem"><p><code class="literal">'fsm'</code>を指定すると、リレーションに関連した空き領域マップ(<a class="xref" href="storage-fsm.html" title="66.3. 空き領域マップ">Section 66.3</a>を参照)を返します。
      </p></li><li class="listitem"><p><code class="literal">'vm'</code>を指定すると、リレーションに関連した可視性マップ(<a class="xref" href="storage-vm.html" title="66.4. 可視性マップ">Section 66.4</a>を参照)の容量を返します。
      </p></li><li class="listitem"><p><code class="literal">'init'</code>を指定すると、もしあれば、リレーションに関連した初期化フォークの容量を返します。
      </p></li></ul></div><p>
   </p><p><code class="function">pg_size_pretty</code>は、適切にbytes、kB、MB、GB、もしくはTB単位を使用して目で見て判るようにその他の関数の1つの結果を整形するのに使用可能です。
   </p><p><code class="function">pg_size_bytes</code>可読性の高い形式の文字列からバイト単位のサイズを取得するのに使用可能です。
入力はbytes、kB、MB、GB、TBの単位を使用可能で、大文字小文字を区別せずに解釈されます。
単位の指定がなければ、bytes（バイト）であるとみなされます。
   </p><div class="note"><h3 class="title">Note</h3><p><code class="function">pg_size_pretty</code>および<code class="function">pg_size_bytes</code>が利用するkB、MB、GB、TBの単位は10のべき乗ではなく2のべき乗として定義されているため、1kBは1024バイト、1MBは1024<sup>2</sup> = 1048576バイト、それ以上も同じようになります。
    </p></div><p>上記の関数において、テーブルやインデックスを<code class="type">regclass</code>引数として受け取って処理するものがありますが、この引数は単に<code class="structname">pg_class</code>システムカタログにあるテーブルやインデックスのOIDです。
ただし、<code class="type">regclass</code>データ型が自動で入力変換を行うため、ユーザが手動で該当するOIDを調べる必要はありません。リテラル定数のようにシングルクオートで囲んだテーブル名を記述するだけです。
通常のSQL名に対する処理互換のため、テーブル名をダブルクオートで囲わない限り、テーブル名として入力された文字列は小文字に変換されます。
   </p><p>上記の関数に対し、既存オブジェクトに該当するものがないOIDが渡された場合はNULLが返されます。
   </p><p><a class="xref" href="functions-admin.html#FUNCTIONS-ADMIN-DBLOCATION" title="Table 9.85. データベースオブジェクト位置関数">Table 9.85</a> に示される関数は、データベースオブジェクトに関連する特定のディスクファイルを確認する際の手助けとなります。
   </p><a id="id-1.5.8.31.9.25" class="indexterm"></a><a id="id-1.5.8.31.9.26" class="indexterm"></a><a id="id-1.5.8.31.9.27" class="indexterm"></a><div class="table" id="FUNCTIONS-ADMIN-DBLOCATION"><p class="title"><strong>Table 9.85. データベースオブジェクト位置関数</strong></p><div class="table-contents"><table class="table" summary="データベースオブジェクト位置関数" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>名前</th><th>戻り型</th><th>説明</th></tr></thead><tbody><tr><td>        <code class="literal"><code class="function">pg_relation_filenode(<em class="parameter"><code>relation</code></em> <code class="type">regclass</code>)</code></code>
        </td><td><code class="type">oid</code></td><td>        指定されたリレーションのファイルノード番号
       </td></tr><tr><td>        <code class="literal"><code class="function">pg_relation_filepath(<em class="parameter"><code>relation</code></em> <code class="type">regclass</code>)</code></code>
        </td><td><code class="type">text</code></td><td>        指定されたリレーションのファイルパス
       </td></tr><tr><td>        <code class="literal"><code class="function">pg_filenode_relation(<em class="parameter"><code>tablespace</code></em> <code class="type">oid</code>, <em class="parameter"><code>filenode</code></em> <code class="type">oid</code>)</code></code>
        </td><td><code class="type">regclass</code></td><td>        与えられたテーブル空間とファイルノードに関連するリレーションを見つける
       </td></tr></tbody></table></div></div><br class="table-break" /><p><code class="function">pg_relation_filenode</code>は、テーブル、インデックス、シーケンス、もしくはTOASTテーブルのOIDまたは名前を受け付け、現在それに充てられている<span class="quote">“<span class="quote">ファイルノード</span>”</span>番号を返します。
ファイルノードは、リレーションに使用しているファイル名の基礎部分です(詳しくは<a class="xref" href="storage-file-layout.html" title="66.1. データベースファイルのレイアウト">Section 66.1</a>を参照して下さい)。
ほとんどのテーブルについては、結果が<code class="structname">pg_class</code>.<code class="structfield">relfilenode</code>と同じになります。ただし、いくつかのシステムカタログでは<code class="structfield">relfilenode</code>が0になるため、これらのシステムカタログの正しいファイルノードを取得するには、この関数を使用しなければいけません。
この関数は、ビューの様にストレージに格納されないリレーションが指定された場合はNULLを返します。
   </p><p><code class="function">pg_relation_filepath</code>は<code class="function">pg_relation_filenode</code>と似ていますが、こちらはリレーションのファイルパス名(データベースクラスタのディレクトリである<code class="varname">PGDATA</code>からの相対パス)を返します。
   </p><p><code class="function">pg_filenode_relation</code>は<code class="function">pg_relation_filenode</code>の逆です。
<span class="quote">“<span class="quote">テーブル空間</span>”</span>OIDと<span class="quote">“<span class="quote">ファイルノード</span>”</span>を与えると、関連するリレーションのOIDを返します。
データベースのデフォルトテーブル空間内のテーブルに対しては、テーブル空間は0と指定できます。
   </p><p><a class="xref" href="functions-admin.html#FUNCTIONS-ADMIN-COLLATION" title="Table 9.86. 照合順序管理関数">Table 9.86</a>に照合順序の管理に使用される関数の一覧を示します。
    collations.
   </p><div class="table" id="FUNCTIONS-ADMIN-COLLATION"><p class="title"><strong>Table 9.86. 照合順序管理関数</strong></p><div class="table-contents"><table class="table" summary="照合順序管理関数" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>名前</th><th>戻り型</th><th>説明</th></tr></thead><tbody><tr><td>        <a id="id-1.5.8.31.9.33.2.2.1.1.1" class="indexterm"></a>
        <code class="literal"><code class="function">pg_collation_actual_version(<code class="type">oid</code>)</code></code>
       </td><td><code class="type">text</code></td><td>照合順序の実際のバージョンをオペレーティングシステムから返す</td></tr><tr><td>        <a id="id-1.5.8.31.9.33.2.2.2.1.1" class="indexterm"></a>
        <code class="literal"><code class="function">pg_import_system_collations(<em class="parameter"><code>schema</code></em> <code class="type">regnamespace</code>)</code></code>
       </td><td><code class="type">integer</code></td><td>オペレーティングシステムの照合順序をインポートする</td></tr></tbody></table></div></div><br class="table-break" /><p><code class="function">pg_collation_actual_version</code>は照合順序の実際のバージョンをオペレーティングシステムに現在インストールされている通りに返します。
これが<code class="literal">pg_collation.collversion</code>の値と異なる場合は、その照合順序に依存するオブジェクトは再構築が必要かもしれません。
<a class="xref" href="sql-altercollation.html" title="ALTER COLLATION"><span class="refentrytitle">ALTER COLLATION</span></a>も参照してください。
   </p><p><code class="function">pg_import_system_collations</code>は、オペレーティングシステム上にあるすべてのロケールに基づき、システムカタログ<code class="literal">pg_collation</code>に照合順序を追加します。
これは<code class="command">initdb</code>が使用しているもので、より詳細については<a class="xref" href="collation.html#COLLATION-MANAGING" title="23.2.2. 照合順序の管理">Section 23.2.2</a>を参照してください。
その後にオペレーティングシステムに追加のロケールをインストールした場合、この関数を再度実行して、その新しいロケールの照合順序を追加することができます。
<code class="literal">pg_collation</code>に既存のエントリにマッチするロケールはスキップされます。
（しかし、オペレーティングシステム上にもはや存在しなくなったロケールに基づく照合順序オブジェクトはこの関数では削除されません。）
<em class="parameter"><code>schema</code></em>パラメータは通常は<code class="literal">pg_catalog</code>ですが、必ずしもそうでなければならないわけではなく、照合順序をどれか他のスキーマにインストールすることもできます。
この関数は新しく作成された照合順序オブジェクトの数を返します。
   </p></div><div class="sect2" id="FUNCTIONS-ADMIN-INDEX"><div class="titlepage"><div><div><h3 class="title">9.26.8. インデックス保守関数</h3></div></div></div><a id="id-1.5.8.31.10.2" class="indexterm"></a><a id="id-1.5.8.31.10.3" class="indexterm"></a><a id="id-1.5.8.31.10.4" class="indexterm"></a><a id="id-1.5.8.31.10.5" class="indexterm"></a><p><a class="xref" href="functions-admin.html#FUNCTIONS-ADMIN-INDEX-TABLE" title="Table 9.87. インデックス保守関数">Table 9.87</a>にインデックスの保守タスクに使用可能な関数を示します。
これらの関数はリカバリ中は実行できません。
これらの関数の使用はスーパーユーザと対象のインデックスの所有者に限定されます。
   </p><div class="table" id="FUNCTIONS-ADMIN-INDEX-TABLE"><p class="title"><strong>Table 9.87. インデックス保守関数</strong></p><div class="table-contents"><table class="table" summary="インデックス保守関数" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>名前</th><th>戻り型</th><th>説明</th></tr></thead><tbody><tr><td>        <code class="literal"><code class="function">brin_summarize_new_values(<em class="parameter"><code>index</code></em> <code class="type">regclass</code>)</code></code>
       </td><td><code class="type">integer</code></td><td>まだ要約されていないページ範囲を要約する</td></tr><tr><td>        <code class="literal"><code class="function">brin_summarize_range(<em class="parameter"><code>index</code></em> <code class="type">regclass</code>, <em class="parameter"><code>blockNumber</code></em> <code class="type">bigint</code>)</code></code>
       </td><td><code class="type">integer</code></td><td>指定のブロックを含むページ範囲が、まだ要約されていなければ、要約する</td></tr><tr><td>        <code class="literal"><code class="function">brin_desummarize_range(<em class="parameter"><code>index</code></em> <code class="type">regclass</code>, <em class="parameter"><code>blockNumber</code></em> <code class="type">bigint</code>)</code></code>
       </td><td><code class="type">integer</code></td><td>指定のブロックを含むページ範囲が要約されていれば、要約されていない状態にする</td></tr><tr><td>        <code class="literal"><code class="function">gin_clean_pending_list(<em class="parameter"><code>index</code></em> <code class="type">regclass</code>)</code></code>
       </td><td><code class="type">bigint</code></td><td>GINの処理待ちリストのエントリをメインのインデックス構造に移動する</td></tr></tbody></table></div></div><br class="table-break" /><p><code class="function">brin_summarize_new_values</code>はBRINインデックスのOIDまたは名前を受け取り、インデックスを検査してベーステーブル内のインデックスによって現在要約されていないページ範囲を探します。
そのような範囲があれば、テーブルのページをスキャンして新しい要約インデックスタプルを作成します。
インデックスに挿入された新しいページ範囲要約の数を返します。
<code class="function">brin_summarize_range</code>も同じですが、ただし指定のブロック番号を含む範囲についてしか要約しません。
   </p><p><code class="function">gin_clean_pending_list</code>はGINインデックスのOIDまたは名前を受け取り、指定のインデックスの処理待ちリストのエントリをメインのGINデータ構造にまとめて移動することで、リストを削除します。
処理待ちリストから削除されたページ数が返されます。
引数が<code class="literal">fastupdate</code>オプションを無効にして構築されたGINインデックスの場合、インデックスには処理待ちリストがないため、削除は発生せず、戻り値は0になることに注意して下さい。
処理待ちリストおよび<code class="literal">fastupdate</code>の詳細については<a class="xref" href="gin-implementation.html#GIN-FAST-UPDATE" title="64.4.1. GIN高速更新手法">Section 64.4.1</a>および<a class="xref" href="gin-tips.html" title="64.5. GINの小技">Section 64.5</a>を参照して下さい。
   </p></div><div class="sect2" id="FUNCTIONS-ADMIN-GENFILE"><div class="titlepage"><div><div><h3 class="title">9.26.9. 汎用ファイルアクセス関数</h3></div></div></div><p><a class="xref" href="functions-admin.html#FUNCTIONS-ADMIN-GENFILE-TABLE" title="Table 9.88. 汎用ファイルアクセス関数">Table 9.88</a>で示されている関数はサーバをホスティングしているマシン上のファイルに対し、ネイティブのアクセスを提供します。
データベースクラスタディレクトリと<code class="varname">log_directory</code>に存在するファイルのみがアクセス可能です。
クラスタディレクトリ内のファイルに対して相対パスを、そしてログファイルに対しては<code class="varname">log_directory</code>構成設定に一致するパスを使用してください。
これらの関数は特に記述がある場合を除き、スーパーユーザだけが使用できます。
   </p><div class="table" id="FUNCTIONS-ADMIN-GENFILE-TABLE"><p class="title"><strong>Table 9.88. 汎用ファイルアクセス関数</strong></p><div class="table-contents"><table class="table" summary="汎用ファイルアクセス関数" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>名前</th><th>戻り型</th><th>説明</th></tr></thead><tbody><tr><td>        <code class="literal"><code class="function">pg_ls_dir(<em class="parameter"><code>dirname</code></em> <code class="type">text</code> [, <em class="parameter"><code>missing_ok</code></em> <code class="type">boolean</code>, <em class="parameter"><code>include_dot_dirs</code></em> <code class="type">boolean</code>])</code></code>
       </td><td><code class="type">setof text</code></td><td>ディレクトリの内容を一覧表示する
       </td></tr><tr><td>        <code class="literal"><code class="function">pg_ls_logdir()</code></code>
       </td><td><code class="type">setof record</code></td><td>ログディレクトリ内のファイルの名前、サイズ、最終更新時刻を一覧表示します。
<code class="literal">pg_monitor</code>ロールのメンバーにはアクセス権が付与されており、他の非スーパーユーザのロールにもアクセス権を付与することができます。
       </td></tr><tr><td>        <code class="literal"><code class="function">pg_ls_waldir()</code></code>
       </td><td><code class="type">setof record</code></td><td>WALディレクトリ内のファイルの名前、サイズ、最終更新時刻を一覧表示します。
<code class="literal">pg_monitor</code>ロールのメンバーにはアクセス権が付与されており、他の非スーパーユーザのロールにもアクセス権を付与することができます。
       </td></tr><tr><td>        <code class="literal"><code class="function">pg_read_file(<em class="parameter"><code>filename</code></em> <code class="type">text</code> [, <em class="parameter"><code>offset</code></em> <code class="type">bigint</code>, <em class="parameter"><code>length</code></em> <code class="type">bigint</code> [, <em class="parameter"><code>missing_ok</code></em> <code class="type">boolean</code>] ])</code></code>
       </td><td><code class="type">text</code></td><td>テキストファイルの内容を返す
       </td></tr><tr><td>        <code class="literal"><code class="function">pg_read_binary_file(<em class="parameter"><code>filename</code></em> <code class="type">text</code> [, <em class="parameter"><code>offset</code></em> <code class="type">bigint</code>, <em class="parameter"><code>length</code></em> <code class="type">bigint</code> [, <em class="parameter"><code>missing_ok</code></em> <code class="type">boolean</code>] ])</code></code>
       </td><td><code class="type">bytea</code></td><td>ファイルの内容を返す
       </td></tr><tr><td>        <code class="literal"><code class="function">pg_stat_file(<em class="parameter"><code>filename</code></em> <code class="type">text</code>[, <em class="parameter"><code>missing_ok</code></em> <code class="type">boolean</code>])</code></code>
       </td><td><code class="type">record</code></td><td>ファイルについての情報を返す
       </td></tr></tbody></table></div></div><br class="table-break" /><p>これらの関数の一部はオプションで<em class="parameter"><code>missing_ok</code></em>パラメータをとり、ファイルまたはディレクトリが存在しない場合の動作を指定できます。
<code class="literal">true</code>の場合、関数はNULLを返します（ただし、<code class="function">pg_ls_dir</code>は空の結果集合を返します）。
<code class="literal">false</code>の場合はエラーが発生します。
デフォルトは<code class="literal">false</code>です。
   </p><a id="id-1.5.8.31.11.5" class="indexterm"></a><p><code class="function">pg_ls_dir</code>は、指定されたディレクトリ内のすべてのファイル（およびディレクトリと他の特殊ファイル）の名前を返します。
<em class="parameter"><code>include_dot_dirs</code></em>は<span class="quote">“<span class="quote">.</span>”</span>と<span class="quote">“<span class="quote">..</span>”</span>が結果集合に含まれるかどうかを指定します。
デフォルト(<code class="literal">false</code>)ではそれらを除外しますが、それらを含めると、<em class="parameter"><code>missing_ok</code></em>が<code class="literal">true</code>の場合は、空のディレクトリと存在しないディレクトリを区別するために役立つでしょう。
   </p><a id="id-1.5.8.31.11.7" class="indexterm"></a><p><code class="function">pg_ls_logdir</code>はログディレクトリ内の各ファイルについて、名前、サイズ、最終更新時刻（mtime）を返します。
デフォルトでは、スーパーユーザと<code class="literal">pg_monitor</code>ロールのメンバーだけがこの関数を使用できます。
<code class="command">GRANT</code>を使って他のロールにアクセス権を付与することができます。
   </p><a id="id-1.5.8.31.11.9" class="indexterm"></a><p><code class="function">pg_ls_waldir</code>は先行書き込みログ（WAL）ディレクトリ内の各ファイルについて、名前、サイズ、最終更新時刻（mtime）を返します。
デフォルトでは、スーパーユーザと<code class="literal">pg_monitor</code>ロールのメンバーだけがこの関数を使用できます。
<code class="command">GRANT</code>を使って他のロールにアクセス権を付与することができます。
   </p><a id="id-1.5.8.31.11.11" class="indexterm"></a><p><code class="function">pg_read_file</code>は与えられた<em class="parameter"><code>offset</code></em>から始まり、最大<em class="parameter"><code>length</code></em>バイト（先にファイルの終りに到達すればこれより少なくなります）テキストファイルの一部分を返します。
<em class="parameter"><code>offset</code></em>が負の場合にはファイルの終りから数えた位置から読み出します。
<em class="parameter"><code>offset</code></em>と<em class="parameter"><code>length</code></em>が省略された場合、ファイル全体が返されます。
ファイルから読み込まれたバイトは、そのサーバの符号化方式での文字列として解釈されます。
読み込んだバイト列がその符号化方式において有効でない場合にはエラーが投げられます。
   </p><a id="id-1.5.8.31.11.13" class="indexterm"></a><p><code class="function">pg_read_binary_file</code>は、結果が<code class="type">bytea</code>値となり、従って符号化の検査がされないことを除き、<code class="function">pg_read_file</code>と似ています。
<code class="function">convert_from</code>関数と組み合わせることで、この関数を、指定した符号化方式でファイルの読み込むために使うことができます。
    
</p><pre class="programlisting">SELECT convert_from(pg_read_binary_file('file_in_utf8.txt'), 'UTF8');</pre><p>
   </p><a id="id-1.5.8.31.11.15" class="indexterm"></a><p><code class="function">pg_stat_file</code>はファイル容量、最終アクセス時刻、最終更新時刻、最後にファイルステータスを変更した時刻（これはUnixプラットフォームのみ）、ファイル作成時刻（Windowsのみ）および、ディレクトリかどうかを示す<code class="type">boolean</code>を返します。
典型的な使用方法を示します。
</p><pre class="programlisting">SELECT * FROM pg_stat_file('filename');
SELECT (pg_stat_file('filename')).modification;</pre><p>
   </p></div><div class="sect2" id="FUNCTIONS-ADVISORY-LOCKS"><div class="titlepage"><div><div><h3 class="title">9.26.10. 勧告的ロック用関数</h3></div></div></div><p><a class="xref" href="functions-admin.html#FUNCTIONS-ADVISORY-LOCKS-TABLE" title="Table 9.89. 勧告的ロック用関数">Table 9.89</a>に示す関数は勧告的ロックを管理します。
これらの関数の適切な使用方法についての詳細は、<a class="xref" href="explicit-locking.html#ADVISORY-LOCKS" title="13.3.5. 勧告的ロック">Section 13.3.5</a>を参照してください。
   </p><div class="table" id="FUNCTIONS-ADVISORY-LOCKS-TABLE"><p class="title"><strong>Table 9.89. 勧告的ロック用関数</strong></p><div class="table-contents"><table class="table" summary="勧告的ロック用関数" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>名前</th><th>戻り型</th><th>説明</th></tr></thead><tbody><tr><td>        <code class="literal"><code class="function">pg_advisory_lock(<em class="parameter"><code>key</code></em> <code class="type">bigint</code>)</code></code>
       </td><td><code class="type">void</code></td><td>セッションレベルの排他勧告的ロックを獲得</td></tr><tr><td>        <code class="literal"><code class="function">pg_advisory_lock(<em class="parameter"><code>key1</code></em> <code class="type">int</code>, <em class="parameter"><code>key2</code></em> <code class="type">int</code>)</code></code>
       </td><td><code class="type">void</code></td><td>セッションレベルの排他勧告的ロックを獲得</td></tr><tr><td>        <code class="literal"><code class="function">pg_advisory_lock_shared(<em class="parameter"><code>key</code></em> <code class="type">bigint</code>)</code></code>
       </td><td><code class="type">void</code></td><td>セッションレベルの共有勧告的ロックを獲得</td></tr><tr><td>        <code class="literal"><code class="function">pg_advisory_lock_shared(<em class="parameter"><code>key1</code></em> <code class="type">int</code>, <em class="parameter"><code>key2</code></em> <code class="type">int</code>)</code></code>
       </td><td><code class="type">void</code></td><td>セッションレベルの共有勧告的ロックを獲得</td></tr><tr><td>        <code class="literal"><code class="function">pg_advisory_unlock(<em class="parameter"><code>key</code></em> <code class="type">bigint</code>)</code></code>
       </td><td><code class="type">boolean</code></td><td>セッションレベルの排他勧告的ロックを解放</td></tr><tr><td>        <code class="literal"><code class="function">pg_advisory_unlock(<em class="parameter"><code>key1</code></em> <code class="type">int</code>, <em class="parameter"><code>key2</code></em> <code class="type">int</code>)</code></code>
       </td><td><code class="type">boolean</code></td><td>セッションレベルの排他勧告的ロックを解放</td></tr><tr><td>        <code class="literal"><code class="function">pg_advisory_unlock_all()</code></code>
       </td><td><code class="type">void</code></td><td>現在のセッションで保持している全てのセッションレベルの勧告的ロックを解放</td></tr><tr><td>        <code class="literal"><code class="function">pg_advisory_unlock_shared(<em class="parameter"><code>key</code></em> <code class="type">bigint</code>)</code></code>
       </td><td><code class="type">boolean</code></td><td>セッションレベルの共有勧告的ロックを解放</td></tr><tr><td>        <code class="literal"><code class="function">pg_advisory_unlock_shared(<em class="parameter"><code>key1</code></em> <code class="type">int</code>, <em class="parameter"><code>key2</code></em> <code class="type">int</code>)</code></code>
       </td><td><code class="type">boolean</code></td><td>セッションレベルの共有勧告的ロックの解放</td></tr><tr><td>        <code class="literal"><code class="function">pg_advisory_xact_lock(<em class="parameter"><code>key</code></em> <code class="type">bigint</code>)</code></code>
       </td><td><code class="type">void</code></td><td>トランザクションレベルの排他勧告的ロックの獲得</td></tr><tr><td>        <code class="literal"><code class="function">pg_advisory_xact_lock(<em class="parameter"><code>key1</code></em> <code class="type">int</code>, <em class="parameter"><code>key2</code></em> <code class="type">int</code>)</code></code>
       </td><td><code class="type">void</code></td><td>トランザクションレベルの排他勧告的ロックの獲得</td></tr><tr><td>        <code class="literal"><code class="function">pg_advisory_xact_lock_shared(<em class="parameter"><code>key</code></em> <code class="type">bigint</code>)</code></code>
       </td><td><code class="type">void</code></td><td>トランザクションレベルの共有勧告的ロックの獲得</td></tr><tr><td>        <code class="literal"><code class="function">pg_advisory_xact_lock_shared(<em class="parameter"><code>key1</code></em> <code class="type">int</code>, <em class="parameter"><code>key2</code></em> <code class="type">int</code>)</code></code>
       </td><td><code class="type">void</code></td><td>トランザクションレベルの共有勧告的ロックの獲得</td></tr><tr><td>        <code class="literal"><code class="function">pg_try_advisory_lock(<em class="parameter"><code>key</code></em> <code class="type">bigint</code>)</code></code>
       </td><td><code class="type">boolean</code></td><td>可能ならばセッションレベルの排他勧告的ロックを獲得</td></tr><tr><td>        <code class="literal"><code class="function">pg_try_advisory_lock(<em class="parameter"><code>key1</code></em> <code class="type">int</code>, <em class="parameter"><code>key2</code></em> <code class="type">int</code>)</code></code>
       </td><td><code class="type">boolean</code></td><td>可能ならばセッションレベルの排他勧告的ロックを獲得</td></tr><tr><td>        <code class="literal"><code class="function">pg_try_advisory_lock_shared(<em class="parameter"><code>key</code></em> <code class="type">bigint</code>)</code></code>
       </td><td><code class="type">boolean</code></td><td>可能ならばセッションレベルの共有勧告的ロックを獲得</td></tr><tr><td>        <code class="literal"><code class="function">pg_try_advisory_lock_shared(<em class="parameter"><code>key1</code></em> <code class="type">int</code>, <em class="parameter"><code>key2</code></em> <code class="type">int</code>)</code></code>
       </td><td><code class="type">boolean</code></td><td>可能ならばセッションレベルの共有勧告的ロックを獲得</td></tr><tr><td>        <code class="literal"><code class="function">pg_try_advisory_xact_lock(<em class="parameter"><code>key</code></em> <code class="type">bigint</code>)</code></code>
       </td><td><code class="type">boolean</code></td><td>可能ならばトランザクションレベルの排他勧告的ロックの獲得</td></tr><tr><td>        <code class="literal"><code class="function">pg_try_advisory_xact_lock(<em class="parameter"><code>key1</code></em> <code class="type">int</code>, <em class="parameter"><code>key2</code></em> <code class="type">int</code>)</code></code>
       </td><td><code class="type">boolean</code></td><td>可能ならばトランザクションレベルの排他勧告的ロックの獲得</td></tr><tr><td>        <code class="literal"><code class="function">pg_try_advisory_xact_lock_shared(<em class="parameter"><code>key</code></em> <code class="type">bigint</code>)</code></code>
       </td><td><code class="type">boolean</code></td><td>可能ならばトランザクションレベルの共有勧告的ロックの獲得</td></tr><tr><td>        <code class="literal"><code class="function">pg_try_advisory_xact_lock_shared(<em class="parameter"><code>key1</code></em> <code class="type">int</code>, <em class="parameter"><code>key2</code></em> <code class="type">int</code>)</code></code>
       </td><td><code class="type">boolean</code></td><td>可能ならばトランザクションレベルの共有勧告的ロックの獲得</td></tr></tbody></table></div></div><br class="table-break" /><a id="id-1.5.8.31.12.4" class="indexterm"></a><p><code class="function">pg_advisory_lock</code>は、アプリケーションが定義したリソースをロックします。キーは単一の64ビットキー値、または、２つの32ビットキー（この2つのキー空間は重複しないことに注意）によって識別されます。
もし、別のセッションが同一リソースに対するロックを保持している場合、関数はリソースが利用可能になるまで待機します。ロックは排他ロックです。
複数のロック要求があればスタックに積まれるため、同一リソースが３回ロックされた場合、他のセッションが使用できるように解放するためにはロック解除を３回行わなければなりません。
   </p><a id="id-1.5.8.31.12.6" class="indexterm"></a><p><code class="function">pg_advisory_lock_shared</code>の動作は<code class="function">pg_advisory_lock</code>と同じですが、他のセッションの共有ロックと共有できるロックである点が異なります。
排他ロック要求のみ締め出されます。
   </p><a id="id-1.5.8.31.12.8" class="indexterm"></a><p><code class="function">pg_try_advisory_lock</code>は<code class="function">pg_advisory_lock</code>と同様ですが、この関数の場合、ロックが利用可能になるまで待機しません。
ロックを即座に取得し<code class="literal">true</code>を返すか、ロックを即座に獲得できなかった場合に<code class="literal">false</code>を返すかのいずれかです。
   </p><a id="id-1.5.8.31.12.10" class="indexterm"></a><p><code class="function">pg_try_advisory_lock_shared</code>の動作は <code class="function">pg_try_advisory_lock</code>と同じですが、排他ロックではなく共有ロックの獲得を試みます。
   </p><a id="id-1.5.8.31.12.12" class="indexterm"></a><p><code class="function">pg_advisory_unlock</code>は、事前に獲得したセッションレベルの勧告的排他ロックを解放します。ロックの解放に成功した場合、<code class="literal">true</code>を返します。ロックを保持していない場合、<code class="literal">false</code>を返し、さらに、SQL警告がサーバから報告されます。
   </p><a id="id-1.5.8.31.12.14" class="indexterm"></a><p><code class="function">pg_advisory_unlock_shared</code>の動作は<code class="function">pg_advisory_unlock</code>と同じですが、セッションレベルの勧告的共有ロックを解放する点が異なります。
   </p><a id="id-1.5.8.31.12.16" class="indexterm"></a><p><code class="function">pg_advisory_unlock_all</code>は、現在のセッションで保持するセッションレベルの勧告的ロックをすべて解放します。
（この関数は、クライアントとの接続がぶざまに切れた場合でも、セッション終了時に暗黙的に呼び出されます。)
   </p><a id="id-1.5.8.31.12.18" class="indexterm"></a><p><code class="function">pg_advisory_xact_lock</code>の動作は<code class="function">pg_advisory_lock</code>と同じですが、現在のトランザクションの終了時に自動的にロックが解放され、明示的なロックの解放はできません。
   </p><a id="id-1.5.8.31.12.20" class="indexterm"></a><p><code class="function">pg_advisory_xact_lock_shared</code>の動作は<code class="function">pg_advisory_lock_shared</code>と同じですが、現在のトランザクションの終了時に自動的にロックが解放され、明示的なロックの解放はできません。
   </p><a id="id-1.5.8.31.12.22" class="indexterm"></a><p><code class="function">pg_try_advisory_xact_lock</code>の動作は<code class="function">pg_try_advisory_lock</code>と同じですが、ロックが獲得できた場合は現在のトランザクションの終了時に自動的にロックが解放され、明示的なロックの解放はできません。
   </p><a id="id-1.5.8.31.12.24" class="indexterm"></a><p><code class="function">pg_try_advisory_xact_lock_shared</code>の動作は<code class="function">pg_try_advisory_lock_shared</code>と同じですが、ロックが獲得できた場合は現在のトランザクションの終了時に自動的にロックが解放され、明示的なロックの解放はできません。
   </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="functions-info.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="functions.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="functions-trigger.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">9.25. システム情報関数 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 9.27. トリガ関数</td></tr></table></div></body></html>