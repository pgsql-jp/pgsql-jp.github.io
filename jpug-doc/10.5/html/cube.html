<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>F.10. cube</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="citext.html" title="F.9. citext" /><link rel="next" href="dblink.html" title="F.11. dblink" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">F.10. cube</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="citext.html" title="F.9. citext">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="contrib.html" title="Appendix F. 追加で提供されるモジュール">Up</a></td><th width="60%" align="center">Appendix F. 追加で提供されるモジュール</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="dblink.html" title="F.11. dblink">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="CUBE"><div class="titlepage"><div><div><h2 class="title" style="clear: both">F.10. cube</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="cube.html#id-1.11.7.19.4">F.10.1. 構文</a></span></dt><dt><span class="sect2"><a href="cube.html#id-1.11.7.19.5">F.10.2. 精度</a></span></dt><dt><span class="sect2"><a href="cube.html#id-1.11.7.19.6">F.10.3. 使用方法</a></span></dt><dt><span class="sect2"><a href="cube.html#id-1.11.7.19.7">F.10.4. デフォルト</a></span></dt><dt><span class="sect2"><a href="cube.html#id-1.11.7.19.8">F.10.5. 注釈</a></span></dt><dt><span class="sect2"><a href="cube.html#id-1.11.7.19.9">F.10.6. クレジット</a></span></dt></dl></div><a id="id-1.11.7.19.2" class="indexterm"></a><p>本モジュールは、多次元立体を表すための<code class="type">cube</code>データ型を実装します。
 </p><div class="sect2" id="id-1.11.7.19.4"><div class="titlepage"><div><div><h3 class="title">F.10.1. 構文</h3></div></div></div><p><a class="xref" href="cube.html#CUBE-REPR-TABLE" title="Table F.3. cubeの外部表現">Table F.3</a>は<code class="type">cube</code>型で有効な外部表現を示します。
<em class="replaceable"><code>x</code></em>、<em class="replaceable"><code>y</code></em>などは浮動小数点数を意味します。
  </p><div class="table" id="CUBE-REPR-TABLE"><p class="title"><strong>Table F.3. cubeの外部表現</strong></p><div class="table-contents"><table class="table" summary="cubeの外部表現" border="1"><colgroup><col /><col /></colgroup><thead><tr><th>外部構文</th><th>意味</th></tr></thead><tbody><tr><td><code class="literal"><em class="replaceable"><code>x</code></em></code></td><td>1次元の点。（または幅ゼロの一次元間隔）
      </td></tr><tr><td><code class="literal">(<em class="replaceable"><code>x</code></em>)</code></td><td>同上</td></tr><tr><td><code class="literal"><em class="replaceable"><code>x1</code></em>,<em class="replaceable"><code>x2</code></em>,...,<em class="replaceable"><code>xn</code></em></code></td><td>n次元空間の点。
内部的には体積0の立方体として表されます。
      </td></tr><tr><td><code class="literal">(<em class="replaceable"><code>x1</code></em>,<em class="replaceable"><code>x2</code></em>,...,<em class="replaceable"><code>xn</code></em>)</code></td><td>同上</td></tr><tr><td><code class="literal">(<em class="replaceable"><code>x</code></em>),(<em class="replaceable"><code>y</code></em>)</code></td><td><em class="replaceable"><code>x</code></em>から<em class="replaceable"><code>y</code></em>まで（またはその逆）の1次元の間隔。
順序は関係ありません。
      </td></tr><tr><td><code class="literal">[(<em class="replaceable"><code>x</code></em>),(<em class="replaceable"><code>y</code></em>)]</code></td><td>同上</td></tr><tr><td><code class="literal">(<em class="replaceable"><code>x1</code></em>,...,<em class="replaceable"><code>xn</code></em>),(<em class="replaceable"><code>y1</code></em>,...,<em class="replaceable"><code>yn</code></em>)</code></td><td>対角の組み合わせで表されるn次元の立体。
      </td></tr><tr><td><code class="literal">[(<em class="replaceable"><code>x1</code></em>,...,<em class="replaceable"><code>xn</code></em>),(<em class="replaceable"><code>y1</code></em>,...,<em class="replaceable"><code>yn</code></em>)]</code></td><td>同上</td></tr></tbody></table></div></div><br class="table-break" /><p>立体の対角の入力順序は関係ありません。
統一的な<span class="quote">“<span class="quote">左下 — 右上</span>”</span>という内部表現を作成するために必要ならば、<code class="type">cube</code>関数は自動的に値を交換します。
角が一致する場合、<code class="type">cube</code>型には無駄を省くために、<span class="quote">“<span class="quote">点である</span>”</span>フラグを加えた一つの角のみ格納されます。
  </p><p>空白文字は入力時に無視されます。
このため、<code class="literal">[(<em class="replaceable"><code>x</code></em>),(<em class="replaceable"><code>y</code></em>)]</code>は<code class="literal">[ ( <em class="replaceable"><code>x</code></em> ), ( <em class="replaceable"><code>y</code></em> ) ]</code>と同じです。
  </p></div><div class="sect2" id="id-1.11.7.19.5"><div class="titlepage"><div><div><h3 class="title">F.10.2. 精度</h3></div></div></div><p>値は内部的に64ビットの浮動小数点数値として格納されます。
つまり、有効桁が16より大きい数値は切り詰められることを意味します。
  </p></div><div class="sect2" id="id-1.11.7.19.6"><div class="titlepage"><div><div><h3 class="title">F.10.3. 使用方法</h3></div></div></div><p><a class="xref" href="cube.html#CUBE-OPERATORS-TABLE" title="Table F.4. Cubeの演算子">Table F.4</a>は、<code class="type">cube</code>型に提供されている演算子を示します。
  </p><div class="table" id="CUBE-OPERATORS-TABLE"><p class="title"><strong>Table F.4. Cubeの演算子</strong></p><div class="table-contents"><table class="table" summary="Cubeの演算子" border="1"><colgroup><col /><col /><col /></colgroup><thead><tr><th>演算子</th><th>戻り値</th><th>説明</th></tr></thead><tbody><tr><td><code class="literal">a = b</code></td><td><code class="type">boolean</code></td><td>立体aと立体bは同じです。</td></tr><tr><td><code class="literal">a &amp;&amp; b</code></td><td><code class="type">boolean</code></td><td>立体aと立体bには重なりがあります。</td></tr><tr><td><code class="literal">a @&gt; b</code></td><td><code class="type">boolean</code></td><td>立体aは立体bを含みます。</td></tr><tr><td><code class="literal">a &lt;@ b</code></td><td><code class="type">boolean</code></td><td>立体aは立体bに含まれます。</td></tr><tr><td><code class="literal">a &lt; b</code></td><td><code class="type">boolean</code></td><td>立体aは立体bより小さいです。</td></tr><tr><td><code class="literal">a &lt;= b</code></td><td><code class="type">boolean</code></td><td>立体aは立体bより小さいか同じです。</td></tr><tr><td><code class="literal">a &gt; b</code></td><td><code class="type">boolean</code></td><td>立体aは立体bより大きいです。</td></tr><tr><td><code class="literal">a &gt;= b</code></td><td><code class="type">boolean</code></td><td>立体aは立体bより大きいか同じです。</td></tr><tr><td><code class="literal">a &lt;&gt; b</code></td><td><code class="type">boolean</code></td><td>立体aは立体bと同じではありません。</td></tr><tr><td><code class="literal">a -&gt; n</code></td><td><code class="type">float8</code></td><td>立体の（1から数えた）<em class="replaceable"><code>n</code></em>次座標を取得します。</td></tr><tr><td><code class="literal">a ~&gt; n</code></td><td><code class="type">float8</code></td><td>以下のように立体の<em class="replaceable"><code>n</code></em>次座標を取得します。
n = 2 * k - 1 は<em class="replaceable"><code>k</code></em>次元の下界を、n = 2 * k は<em class="replaceable"><code>k</code></em>次元の上界を意味します。
この演算子はKNN-GiSTのサポートのために設計されています。
      </td></tr><tr><td><code class="literal">a &lt;-&gt; b</code></td><td><code class="type">float8</code></td><td>aとbのユークリッド距離。</td></tr><tr><td><code class="literal">a &lt;#&gt; b</code></td><td><code class="type">float8</code></td><td>aとbのタクシー（L-1メトリック）距離。</td></tr><tr><td><code class="literal">a &lt;=&gt; b</code></td><td><code class="type">float8</code></td><td>aとbのチェビシェフ（L-無限大メトリック）距離。</td></tr></tbody></table></div></div><br class="table-break" /><p>（PostgreSQL 8.2以前では、包含演算子<code class="literal">@&gt;</code>と<code class="literal">&lt;@</code>はそれぞれ<code class="literal">@</code>と<code class="literal">~</code>と呼ばれていました。
これらの名前はまだ利用できますが、廃止予定であり、最終的にはなくなります。
古い名前がコアの幾何データ型が従う規約と反対であることに注意してください。）
  </p><p>スカラー順序演算子（<code class="literal">&lt;</code>、<code class="literal">&gt;=</code>など）は、ソート以外では事実上意味を成しません。
これらの演算子は、まず最初の座標を比較し、それらが同一の場合は2番目の座標を比較し、と続けます。
それらは、主に<code class="type">cube</code>型のためのB-treeインデックス演算子クラスをサポートするために存在し、例えば<code class="type">cube</code>型の列にUNIQUE制約をつけたい場合に便利です。
  </p><p><code class="filename">cube</code>モジュールは、<code class="type">cube</code>型の値用にGiSTインデックス演算子クラスも提供します。
<code class="type">cube</code>型GiSTインデックスは、<code class="literal">WHERE</code>句内にて<code class="literal">=</code>、<code class="literal">&amp;&amp;</code>、<code class="literal">@&gt;</code>、<code class="literal">&lt;@</code>演算子を用いて値を検索するために使用することができます。
  </p><p>加えて、<code class="type">cube</code>型GiSTインデックスは、<code class="literal">ORDER BY</code>句内にて<code class="literal">&lt;-&gt;</code>、<code class="literal">&lt;#&gt;</code>、<code class="literal">&lt;=&gt;</code>のメトリック演算子を用いて近傍値を発見するために使用することができます。
例えば、3次元の点である(0.5, 0.5, 0.5)の最近傍点は、以下のように効率よく発見できます。
</p><pre class="programlisting">SELECT c FROM test ORDER BY c &lt;-&gt; cube(array[0.5,0.5,0.5]) LIMIT 1;</pre><p>
  </p><p><code class="literal">~&gt;</code>演算子でもこの方法で、選択された座標によってソートされた最初のいくつかの値を効率よく探査するために使用できます。
例えば、1番目の座標（左下隅）によって昇順に並べ替えられた最初のいくつかの立体を取得するために、以下のような問い合わせを使用することができます。
</p><pre class="programlisting">SELECT c FROM test ORDER BY c ~&gt; 1 LIMIT 5;</pre><p>
そして、右上の1番目の座標によって昇順に並び替えられた2次元の立体を取得するために、以下のようなクエリを使用することができます。
</p><pre class="programlisting">SELECT c FROM test ORDER BY c ~&gt; 3 DESC LIMIT 5;</pre><p>
  </p><p><a class="xref" href="cube.html#CUBE-FUNCTIONS-TABLE" title="Table F.5. cubeの関数">Table F.5</a>は有効な関数を示します。
  </p><div class="table" id="CUBE-FUNCTIONS-TABLE"><p class="title"><strong>Table F.5. cubeの関数</strong></p><div class="table-contents"><table class="table" summary="cubeの関数" border="1"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th>関数</th><th>戻り値</th><th>説明</th><th>例</th></tr></thead><tbody><tr><td><code class="literal">cube(float8)</code></td><td><code class="type">cube</code></td><td>同じ座標をもつ、1次元の立体を作成します。
      </td><td>       <code class="literal">cube(1) == '(1)'</code>
      </td></tr><tr><td><code class="literal">cube(float8, float8)</code></td><td><code class="type">cube</code></td><td>1次元の立体を作成します。
      </td><td>       <code class="literal">cube(1,2) == '(1),(2)'</code>
      </td></tr><tr><td><code class="literal">cube(float8[])</code></td><td><code class="type">cube</code></td><td>配列で定義される座標を使用した体積0の立体を作成します。
      </td><td>       <code class="literal">cube(ARRAY[1,2]) == '(1,2)'</code>
      </td></tr><tr><td><code class="literal">cube(float8[], float8[])</code></td><td><code class="type">cube</code></td><td>2つの配列で定義される右上および左下座標を持つ立体を作成します。
配列長は同じでなければなりません。
      </td><td>       <code class="literal">cube(ARRAY[1,2], ARRAY[3,4]) == '(1,2),(3,4)'
       </code>
      </td></tr><tr><td><code class="literal">cube(cube, float8)</code></td><td><code class="type">cube</code></td><td>既存の立体に次元を加え、新しい座標の同じ値の端点をもつ立体を新しく作成します。
これは計算した値で部品を追加しながら立体を構築する場合に有用です。
      </td><td>       <code class="literal">cube('(1,2),(3,4)'::cube, 5) == '(1,2,5),(3,4,5)'</code>
      </td></tr><tr><td><code class="literal">cube(cube, float8, float8)</code></td><td><code class="type">cube</code></td><td>既存の立体に次元を加えた立体を新しく作成します。
これは計算した値で部品を追加しながら立体を構築する場合に有用です。
      </td><td>       <code class="literal">cube('(1,2),(3,4)'::cube, 5, 6) == '(1,2,5),(3,4,6)'</code>
      </td></tr><tr><td><code class="literal">cube_dim(cube)</code></td><td><code class="type">integer</code></td><td>立体の次元数を返します。
      </td><td>       <code class="literal">cube_dim('(1,2),(3,4)') == '2'</code>
      </td></tr><tr><td><code class="literal">cube_ll_coord(cube, integer)</code></td><td><code class="type">float8</code></td><td>立体の左下隅のn次座標の値を返します。
      </td><td>       <code class="literal">cube_ll_coord('(1,2),(3,4)', 2) == '2'</code>
      </td></tr><tr><td><code class="literal">cube_ur_coord(cube, integer)</code></td><td><code class="type">float8</code></td><td>立体の右上隅のn次座標の値を返します。
      </td><td>       <code class="literal">cube_ur_coord('(1,2),(3,4)', 2) == '4'</code>
      </td></tr><tr><td><code class="literal">cube_is_point(cube)</code></td><td><code class="type">boolean</code></td><td>立体が点、つまり立体が定義する2つの隅が同一の場合真を返します。</td><td>      </td></tr><tr><td><code class="literal">cube_distance(cube, cube)</code></td><td><code class="type">float8</code></td><td>2つの立体間の距離を返します。
両方の立体が点の場合、これは通常の距離測定関数です。
      </td><td>      </td></tr><tr><td><code class="literal">cube_subset(cube, integer[])</code></td><td><code class="type">cube</code></td><td>配列内の次元インデックスの一覧を使用して、既存の立体から新しい立体を作成します。
単一次元の端点を展開するために使用したり、次元を除去したり、希望通りの順序に並び替えることができます。
      </td><td>       <code class="literal">cube_subset(cube('(1,3,5),(6,7,8)'), ARRAY[2]) == '(3),(7)'</code>
       <code class="literal">cube_subset(cube('(1,3,5),(6,7,8)'), ARRAY[3,2,1,1]) ==
        '(5,3,1,1),(8,7,6,6)'</code>
      </td></tr><tr><td><code class="literal">cube_union(cube, cube)</code></td><td><code class="type">cube</code></td><td>2つの立体の和集合を作成します。
      </td><td>      </td></tr><tr><td><code class="literal">cube_inter(cube, cube)</code></td><td><code class="type">cube</code></td><td>2つの立体の共通部分を作成します。
      </td><td>      </td></tr><tr><td><code class="literal">cube_enlarge(c cube, r double, n integer)</code></td><td><code class="type">cube</code></td><td>最小で<em class="replaceable"><code>n</code></em>次元において指定した径<em class="replaceable"><code>r</code></em>で立体のサイズを増加させます。
径が負の場合、立体は縮小されます。
定義済のすべての次元は径<em class="replaceable"><code>r</code></em>だけ変わります。
左下座標を<em class="replaceable"><code>r</code></em>だけ減少し、右上座標を<em class="replaceable"><code>r</code></em>だけ増加します。
左下座標が対応する右上座標よりも増加する場合（これは<em class="replaceable"><code>r</code></em> &lt; 0の場合にのみ発生します）、両方の座標はその平均値に設定されます。
<em class="replaceable"><code>n</code></em>が定義済の次元より多く、かつ、立体が拡大される（<em class="replaceable"><code>r</code></em> &gt;= 0）場合、<em class="replaceable"><code>n</code></em>次元すべてを作成するために余分な次元が追加されます。
余分な座標には、初期値として0が使用されます。
この関数は、近傍点を見つけるための点を囲む外接矩形を作成する際に有用です。
      </td><td>       <code class="literal">cube_enlarge('(1,2),(3,4)', 0.5, 3) ==
        '(0.5,1.5,-0.5),(3.5,4.5,0.5)'</code>
      </td></tr></tbody></table></div></div><br class="table-break" /></div><div class="sect2" id="id-1.11.7.19.7"><div class="titlepage"><div><div><h3 class="title">F.10.4. デフォルト</h3></div></div></div><p>  </p><pre class="programlisting">select cube_union('(0,5,2),(2,3,1)', '0');
cube_union
-------------------
(0, 0, 0),(2, 5, 2)
(1 row)</pre><p>この和集合および以下の共通集合は一般常識と矛盾しないと思います。
   </p><pre class="programlisting">select cube_inter('(0,-1),(1,1)', '(-2),(2)');
cube_inter
-------------
(0, 0),(1, 0)
(1 row)</pre><p>次元が異なる立体のバイナリ操作すべてにおいて、より低い次元の方がデカルト投影、つまり、文字列表現で省略された座標に0を持つものになると仮定します。
上の例は以下と同じです。
   </p><pre class="programlisting">cube_union('(0,5,2),(2,3,1)','(0,0,0),(0,0,0)');
cube_inter('(0,-1),(1,1)','(-2,0),(2,0)');</pre><p>以下の包含の述部は点構文を使用しますが、実際内部的には第2引数は矩形として表されます。
この構文により、別の点用の型や(box,point)という述部用の関数を定義することが不要になります。
   </p><pre class="programlisting">select cube_contains('(0,0),(1,1)', '0.5,0.5');
cube_contains
--------------
t
(1 row)</pre></div><div class="sect2" id="id-1.11.7.19.8"><div class="titlepage"><div><div><h3 class="title">F.10.5. 注釈</h3></div></div></div><p>使用例については、<code class="filename">sql/cube.sql</code>リグレッションテストを参照してください。
  </p><p>破壊防止のために立体の次元数に100までという制限を行いました。
これは<code class="filename">cubedata.h</code>で設定されており、必要に応じて多少大きくすることができます。
  </p></div><div class="sect2" id="id-1.11.7.19.9"><div class="titlepage"><div><div><h3 class="title">F.10.6. クレジット</h3></div></div></div><p>   原作者: Gene Selkov, Jr. <code class="email">&lt;<a class="email" href="mailto:selkovjr@mcs.anl.gov">selkovjr@mcs.anl.gov</a>&gt;</code>,
   Mathematics and Computer Science Division, Argonne National Laboratory.
  </p><p>GiST (<a class="ulink" href="http://gist.cs.berkeley.edu/" target="_top">http://gist.cs.berkeley.edu/</a>)の要点(gist)を説明してくださったJoe Hellerstein博士 (<a class="ulink" href="http://db.cs.berkeley.edu/jmh/" target="_top">http://db.cs.berkeley.edu/jmh/</a>) に感謝します。
また、Illustra用の例の作者である彼の以前の生徒Andy Dongに感謝します。
また、自分の世界を作成できるようにし、静かに生活できるようにしてもらった、過去から現在までのすべてのPostgres開発者に感謝します。
データベース研究を長年誠実にサポートしてくれたArgonne LabとU.S. Department of Energyにも感謝します。
  </p><p>2002年8月/9月にBruno Wolff III <code class="email">&lt;<a class="email" href="mailto:bruno@wolff.to">bruno@wolff.to</a>&gt;</code>による小規模な改修がこのパッケージになされました。
この改修には、単精度から倍精度への精度の変更といくつかの関数の追加が含まれます。
  </p><p>2006年7月にJoshua Reich <code class="email">&lt;<a class="email" href="mailto:josh@root.net">josh@root.net</a>&gt;</code>による改修がさらになされました。
この改修には<code class="literal">cube(float8[], float8[])</code>が含まれ、また、古いV0プロトコルからV1呼び出しプロトコルを使用するようコードが整理されました。
  </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="citext.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="contrib.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="dblink.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">F.9. citext </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> F.11. dblink</td></tr></table></div></body></html>