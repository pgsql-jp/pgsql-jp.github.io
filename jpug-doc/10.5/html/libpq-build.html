<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>33.20. libpqプログラムの構築</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="libpq-threading.html" title="33.19. スレッド化プログラムの振舞い" /><link rel="next" href="libpq-example.html" title="33.21. サンプルプログラム" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">33.20. <span xmlns="http://www.w3.org/1999/xhtml" class="application">libpq</span>プログラムの構築</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="libpq-threading.html" title="33.19. スレッド化プログラムの振舞い">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="libpq.html" title="Chapter 33. libpq - C ライブラリ">Up</a></td><th width="60%" align="center">Chapter 33. <span xmlns="http://www.w3.org/1999/xhtml" class="application">libpq</span> - C ライブラリ</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="libpq-example.html" title="33.21. サンプルプログラム">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="LIBPQ-BUILD"><div class="titlepage"><div><div><h2 class="title" style="clear: both">33.20. <span class="application">libpq</span>プログラムの構築</h2></div></div></div><a id="id-1.7.3.27.2" class="indexterm"></a><p><span class="application">libpq</span>を使用するプログラムの構築(つまり、コンパイルとリンク)を行うためには、以下をすべて実施する必要があります。

   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="filename">libpq-fe.h</code>ヘッダファイルをインクルードします。
</p><pre class="programlisting">#include &lt;libpq-fe.h&gt;</pre><p>
これを忘れると、通常コンパイラから以下のようなエラーメッセージが発生します。
</p><pre class="screen">foo.c: In function `main':
foo.c:34: `PGconn' undeclared (first use in this function)
foo.c:35: `PGresult' undeclared (first use in this function)
foo.c:54: `CONNECTION_BAD' undeclared (first use in this function)
foo.c:68: `PGRES_COMMAND_OK' undeclared (first use in this function)
foo.c:95: `PGRES_TUPLES_OK' undeclared (first use in this function)</pre><p>
     </p></li><li class="listitem"><p>コンパイラに<code class="literal">-I<em class="replaceable"><code>directory</code></em></code>オプションを付与することで、コンパイラに<span class="productname">PostgreSQL</span>ヘッダファイルをインストールしたディレクトリを通知します。
（デフォルトでこのディレクトリを検索するコンパイラもあります。
その場合はこのオプションを省くことができます。）
例えば、以下のようなコンパイルコマンドになります。
</p><pre class="programlisting">cc -c -I/usr/local/pgsql/include testprog.c</pre><p>
Makefileを使用しているのであれば、<code class="varname">CPPFLAGS</code>変数にこのオプションを追加してください。
</p><pre class="programlisting">CPPFLAGS += -I/usr/local/pgsql/include</pre><p>
     </p><p>他のユーザがそのプログラムをコンパイルする可能性がある場合は、上のようにディレクトリの場所を直接書き込むべきではありません。
その代わりに<code class="command">pg_config</code>ユーティリティを実行して、各システムにおけるヘッダファイルの在処を検索させることができます。
</p><pre class="screen"><code class="prompt">$</code> pg_config --includedir
<code class="computeroutput">/usr/local/include</code></pre><p>
     </p><p>もしも、<code class="command">pkg-config</code>がインストールされている場合、代わりとして以下を実行します。<a id="id-1.7.3.27.3.2.2.3.2" class="indexterm"></a>
</p><pre class="screen"><code class="prompt">$</code> pkg-config --cflags libpq
<code class="computeroutput">-I/usr/local/include</code></pre><p>
これは既にパスの最前部で<code class="option">-I</code>が含まれていることに注意してください。
     </p><p>正確なオプションを指定できなかった結果、コンパイラは以下のようなエラーメッセージを生成します。
</p><pre class="screen">testlibpq.c:8:22: libpq-fe.h: No such file or directory</pre><p>
     </p></li><li class="listitem"><p>最終的なプログラムのリンク時、<code class="literal">-lpq</code>オプションを指定して、<span class="application">libpq</span>ライブラリを組み込んでください。
同時に<code class="literal">-L<em class="replaceable"><code>directory</code></em></code>オプションを指定して、コンパイラに<span class="application">libpq</span>ライブラリの在処を通知してください。
（繰り返しますが、コンパイラはデフォルトでいくつかのディレクトリを検索します。）
移植性を最大にするために、<code class="option">-lpq</code>オプションの前に<code class="option">-L</code>を記述してください。
以下に例を示します。
</p><pre class="programlisting">cc -o testprog testprog1.o testprog2.o -L/usr/local/pgsql/lib -lpq</pre><p>
     </p><p>同様に<code class="command">pg_config</code>を使用してライブラリのあるディレクトリを見つけることもできます。
</p><pre class="screen"><code class="prompt">$</code> pg_config --libdir
<code class="computeroutput">/usr/local/pgsql/lib</code></pre><p>
     </p><p>さもなくば、この場合もやはり<code class="command">pkg-config</code>を使用します。
</p><pre class="screen"><code class="prompt">$</code> pkg-config --libs libpq
<code class="computeroutput">-L/usr/local/pgsql/lib -lpq</code></pre><p>
重ねて、これはパスのみならず全てのオプションを表示することに注意してください。
     </p><p>この部分で問題があった場合のエラーメッセージは以下のようなものになります。
</p><pre class="screen">testlibpq.o: In function `main':
testlibpq.o(.text+0x60): undefined reference to `PQsetdbLogin'
testlibpq.o(.text+0x71): undefined reference to `PQstatus'
testlibpq.o(.text+0xa4): undefined reference to `PQerrorMessage'</pre><p>
これは<code class="option">-lpq</code>の付け忘れを示します。
</p><pre class="screen">/usr/bin/ld: cannot find -lpq</pre><p>
これは<code class="option">-L</code>の付け忘れ、あるいは、ディレクトリ指定の間違いを示します。
     </p></li></ul></div><p>
  </p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="libpq-threading.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="libpq.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="libpq-example.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">33.19. スレッド化プログラムの振舞い </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 33.21. サンプルプログラム</td></tr></table></div></body></html>