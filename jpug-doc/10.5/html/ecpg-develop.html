<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>35.16. 内部</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="ecpg-informix-compat.html" title="35.15. Informix互換モード" /><link rel="next" href="information-schema.html" title="Chapter 36. 情報スキーマ" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">35.16. 内部</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="ecpg-informix-compat.html" title="35.15. Informix互換モード">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="ecpg.html" title="Chapter 35. ECPG - C言語による埋め込みSQL">Up</a></td><th width="60%" align="center">Chapter 35. <span xmlns="http://www.w3.org/1999/xhtml" class="application">ECPG</span> - C言語による埋め込み<acronym xmlns="http://www.w3.org/1999/xhtml" class="acronym">SQL</acronym></th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="information-schema.html" title="Chapter 36. 情報スキーマ">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="ECPG-DEVELOP"><div class="titlepage"><div><div><h2 class="title" style="clear: both">35.16. 内部</h2></div></div></div><p>本節では内部的な<span class="application">ECPG</span>の動作を説明します。
この情報は<span class="application">ECPG</span>の使用方法を理解する手助けとして有用なことがあります。
  </p><p><code class="command">ecpg</code>によって出力に書き込まれる最初の4行は固定されています。
2行はコメントで、残り2行はライブラリとのインタフェースのために必要なインクルード行です。
その後、プリプロセッサはファイル全体を読み取り、出力に書き出します。
通常は、単にすべてそのまま出力に書き出します。
   </p><p><code class="command">EXEC SQL</code>を検出すると、間に入り、それを変更します。
このコマンドは<code class="command">EXEC SQL</code>で始まり、<code class="command">;</code>で終わります。
この間のすべては<acronym class="acronym">SQL</acronym>文として扱われ、変数の置換のために解析されます。
   </p><p>変数置換は、シンボルがコロン（<code class="literal">:</code>）から始まる場合に発生します。
その名前の変数が、<code class="literal">EXEC SQL DECLARE</code>セクションで事前に宣言された変数の中から検索されます。
   </p><p>ライブラリ内で最も重要な関数は<code class="function">ECPGdo</code>です。
これが、ほとんどのコマンドの実行を管理します。
可変長の引数をとります。
すべてのプラットフォームで問題にならないことを祈っていますが、これは50程度の引数まで簡単に追加できます。
   </p><p>引数を以下に示します。

    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">行番号</span></dt><dd><p>元の行の行番号です。
エラーメッセージ内でのみ使用されます。
       </p></dd><dt><span class="term">文字列</span></dt><dd><p>発行すべき<acronym class="acronym">SQL</acronym>コマンドです。
入力変数、つまり、コンパイル時に未知だったがそのコマンド内に与えるべき変数によって変更されます。
変数が文字列内に挿入される箇所は<code class="literal">?</code>となっています。
       </p></dd><dt><span class="term">入力変数</span></dt><dd><p>        すべての入力変数は10個の引数を作成します（後述）。
       </p></dd><dt><span class="term"><em class="parameter"><code>ECPGt_EOIT</code></em></span></dt><dd><p>        入力変数がもうないことを表す<code class="type">enum</code>です。
       </p></dd><dt><span class="term">出力変数</span></dt><dd><p>すべての出力変数は10個の引数を作成します（後述）。
これらの変数は関数によって埋められます。
       </p></dd><dt><span class="term"><em class="parameter"><code>ECPGt_EORT</code></em></span></dt><dd><p>        変数がもうないことを表す<code class="type">enum</code>です。
       </p></dd></dl></div><p>
   </p><p><acronym class="acronym">SQL</acronym>コマンドの一部となるすべての変数に対して、この関数は以下の10個の引数を生成します。

    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>特別シンボルとしての型。
      </p></li><li class="listitem"><p>値へのポインタ、もしくはポインタのポインタ。
      </p></li><li class="listitem"><p>変数が<code class="type">char</code>か<code class="type">varchar</code>の場合はそのサイズ。
      </p></li><li class="listitem"><p>配列の要素数（配列取り出し用）。
      </p></li><li class="listitem"><p>配列の次の要素のオフセット（配列取り出し用）。
      </p></li><li class="listitem"><p>特別シンボルとしての指示子変数の型。
      </p></li><li class="listitem"><p>指示子変数へのポインタ。
      </p></li><li class="listitem"><p>       0
      </p></li><li class="listitem"><p>指示子配列内の要素数（配列取り出し用）。
      </p></li><li class="listitem"><p>指示子配列内の次要素へのオフセット（配列取り出し用）。
      </p></li></ol></div><p>
   </p><p>すべてのSQLコマンドがこの方法で扱われるわけではないことに注意してください。
例えば、以下のカーソルを開くSQL文は出力にコピーされません。
</p><pre class="programlisting">EXEC SQL OPEN <em class="replaceable"><code>cursor</code></em>;</pre><p>
その代わりにカーソルの<code class="command">DECLARE</code>コマンドが<code class="command">OPEN</code>コマンドの場所で使用されます。
実際にこのコマンドがカーソルを開くからです。
   </p><p>以下に、<code class="filename">foo.pgc</code>ファイルに対するプリプロセッサの出力を完全に説明する例を示します
（プリプロセッサのバージョンによって詳細が異なっているかもしれません）。
</p><pre class="programlisting">EXEC SQL BEGIN DECLARE SECTION;
int index;
int result;
EXEC SQL END DECLARE SECTION;
...
EXEC SQL SELECT res INTO :result FROM mytable WHERE index = :index;</pre><p>
これは以下に翻訳されます。
</p><pre class="programlisting">/* Processed by ecpg (2.6.0) */
/* These two include files are added by the preprocessor */
#include &lt;ecpgtype.h&gt;;
#include &lt;ecpglib.h&gt;;

/* exec sql begin declare section */

#line 1 "foo.pgc"

 int index;
 int result;
/* exec sql end declare section */
...
ECPGdo(__LINE__, NULL, "SELECT res FROM mytable WHERE index = ?     ",
        ECPGt_int,&amp;(index),1L,1L,sizeof(int),
        ECPGt_NO_INDICATOR, NULL , 0L, 0L, 0L, ECPGt_EOIT,
        ECPGt_int,&amp;(result),1L,1L,sizeof(int),
        ECPGt_NO_INDICATOR, NULL , 0L, 0L, 0L, ECPGt_EORT);
#line 147 "foo.pgc"</pre><p>
ここで可読性のためにインデントを付けています。
プリプロセッサが行ったものではありません。
   </p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ecpg-informix-compat.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ecpg.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="information-schema.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">35.15. <span class="productname">Informix</span>互換モード </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 36. 情報スキーマ</td></tr></table></div></body></html>