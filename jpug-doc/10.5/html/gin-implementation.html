<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>64.4. 実装</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="gin-extensibility.html" title="64.3. 拡張性" /><link rel="next" href="gin-tips.html" title="64.5. GINの小技" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">64.4. 実装</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="gin-extensibility.html" title="64.3. 拡張性">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="gin.html" title="Chapter 64. GINインデックス">Up</a></td><th width="60%" align="center">Chapter 64. GINインデックス</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="gin-tips.html" title="64.5. GINの小技">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="GIN-IMPLEMENTATION"><div class="titlepage"><div><div><h2 class="title" style="clear: both">64.4. 実装</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="gin-implementation.html#GIN-FAST-UPDATE">64.4.1. GIN高速更新手法</a></span></dt><dt><span class="sect2"><a href="gin-implementation.html#GIN-PARTIAL-MATCH">64.4.2. 部分一致アルゴリズム</a></span></dt></dl></div><p><acronym class="acronym">GIN</acronym>インデックスはキー全体に対するB-treeインデックスを持ちます。
そのキーはそれぞれインデックス対象項目の要素（例えば配列のメンバ）であり、リーフページ内のタプルはそれぞれ、ヒープポインタのB-treeへのポインタ（<span class="quote">“<span class="quote">ポスティングツリー</span>”</span>）か、もしリストがキー値と共に単一インデックスタプルに合う程度十分に小さければヒープポインタの単純なリスト（<span class="quote">“<span class="quote">ポスティングリスト</span>”</span>）です。
 </p><p><span class="productname">PostgreSQL</span> 9.1からNULLキー値をインデックスに含められるようになりました。
またプレースホルダとしてのNULLが、NULLまたは<code class="function">extractValue</code>によるとキーを含まないインデックス対象項目についてインデックスに含められます。
これにより空の項目を見つけ出すための検索を行うことができます。
 </p><p>複数列に対する<acronym class="acronym">GIN</acronym>インデックスは複合型の値（列番号、キー値）全体について単一のB-treeを構築することで実装されます。
異なる列に対するキー値は別の型となるかもしれません。
 </p><div class="sect2" id="GIN-FAST-UPDATE"><div class="titlepage"><div><div><h3 class="title">64.4.1. GIN高速更新手法</h3></div></div></div><p>1つのヒープ行の挿入または更新によりインデックスへの挿入が多く発生するという、転置インデックスの本質的な性質のため<acronym class="acronym">GIN</acronym>インデックスの更新は低速になりがちです。
（各キー用のヒープ行はインデックス付けされた項目から取り出されます。）
<span class="productname">PostgreSQL</span> 8.4から<acronym class="acronym">GIN</acronym>は、新しいタプルを一時的なソートされていない、待機中の項目リストに挿入することにより、この作業の大部分を遅延させることができるようになりました。
テーブルがバキュームまたは自動解析された時、<code class="function">gin_clean_pending_list</code>関数が呼ばれたとき、または、待機中のリストが<a class="xref" href="runtime-config-client.html#GUC-GIN-PENDING-LIST-LIMIT">gin_pending_list_limit</a>よりも大きくなった時、初期のインデックス作成の際に使用されるものと同様の一括挿入技法を使用して、項目は主<acronym class="acronym">GIN</acronym>データ構造に移動されます。
これは、バキュームのオーバーヘッドが追加されることを考慮したとしても、<acronym class="acronym">GIN</acronym>インデックスの更新速度を著しく向上します。
さらに、フォアグラウンドの問い合わせ処理ではなくバックグラウンド処理でこのオーバーヘッド作業を実行することができます。
  </p><p>この手法の大きな欠点は、検索時に通常のインデックス検索に加え待機中の項目リストのスキャンを行わなければならない点です。
このため、待機中の項目リストが大きくなると検索が顕著に遅くなります。
他の欠点は、ほとんどの更新は高速ですが、待機中の項目リストが<span class="quote">“<span class="quote">大きくなりすぎる</span>”</span>きっかけとなった更新は即時の整理処理を招くことになり、他の更新に比べ大きく低速になります。
自動バキュームを適切に使用することで、これらの両方の問題を最小化することができます。
  </p><p>一貫した応答時間が更新速度より重要な場合、<acronym class="acronym">GIN</acronym>インデックスに対する<code class="literal">fastupdate</code>格納パラメータを無効にすることにより、待機中の項目の使用を無効にすることができます。
詳細は<a class="xref" href="sql-createindex.html" title="CREATE INDEX"><span class="refentrytitle">CREATE INDEX</span></a>を参照してください。
  </p></div><div class="sect2" id="GIN-PARTIAL-MATCH"><div class="titlepage"><div><div><h3 class="title">64.4.2. 部分一致アルゴリズム</h3></div></div></div><p>GINは<span class="quote">“<span class="quote">部分一致</span>”</span>問い合わせをサポートすることができます。
この問い合わせは１つ以上のキーに正確に一致することは決定しませんが、キー値の合理的に狭い（<code class="function">compare</code>サポートメソッドで決まるキーのソート順に従った）範囲内に一致する可能性があります。
<code class="function">extractQuery</code>は、正確に一致したキー値を返す代わりに、検索される範囲の下限となるキー値を返し、<code class="literal">pmatch</code>フラグを真に設定します。
そしてキー範囲を<code class="function">comparePartial</code>メソッドを使用して検索します。
<code class="function">comparePartial</code>は一致するインデックスキーではゼロを、一致しないが検索すべき範囲内にあればゼロ未満の値を、インデックスキーが一致可能な範囲を超えた場合はゼロより大きな値を返さなければなりません。
  </p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="gin-extensibility.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="gin.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="gin-tips.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">64.3. 拡張性 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 64.5. GINの小技</td></tr></table></div></body></html>