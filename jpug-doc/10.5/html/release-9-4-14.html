<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>E.38. リリース9.4.14</title><link rel="stylesheet" type="text/css" href="stylesheet.css" /><link rev="made" href="pgsql-docs@postgresql.org" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="prev" href="release-9-4-15.html" title="E.37. リリース9.4.15" /><link rel="next" href="release-9-4-13.html" title="E.39. リリース9.4.13" /></head><body><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="5" align="center">E.38. リリース9.4.14</th></tr><tr><td width="10%" align="left"><a accesskey="p" href="release-9-4-15.html" title="E.37. リリース9.4.15">Prev</a> </td><td width="10%" align="left"><a accesskey="u" href="release.html" title="Appendix E. リリースノート">Up</a></td><th width="60%" align="center">Appendix E. リリースノート</th><td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 10.5文書">Home</a></td><td width="10%" align="right"> <a accesskey="n" href="release-9-4-13.html" title="E.39. リリース9.4.13">Next</a></td></tr></table><hr></hr></div><div class="sect1" id="RELEASE-9-4-14"><div class="titlepage"><div><div><h2 class="title" style="clear: both">E.38. リリース9.4.14</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="sect2"><a href="release-9-4-14.html#id-1.11.6.42.4">E.38.1. バージョン9.4.14への移行</a></span></dt><dt><span class="sect2"><a href="release-9-4-14.html#id-1.11.6.42.5">E.38.2. 変更点</a></span></dt></dl></div><p><strong>リリース日: </strong>2017-08-31</p><p>このリリースは9.4.13に対し、少数の不具合を修正したものです。
9.4メジャーリリースにおける新機能については、<a class="xref" href="release-9-4.html" title="E.52. リリース9.4">Section E.52</a>を参照してください。
  </p><div class="sect2" id="id-1.11.6.42.4"><div class="titlepage"><div><div><h3 class="title">E.38.1. バージョン9.4.14への移行</h3></div></div></div><p>9.4.Xからの移行ではダンプ/リストアは不要です。
   </p><p>しかしながら、9.4.13よりも前のリリースからアップグレードする場合は、<a class="xref" href="release-9-4-13.html" title="E.39. リリース9.4.13">Section E.39</a>を参照して下さい。
   </p></div><div class="sect2" id="id-1.11.6.42.5"><div class="titlepage"><div><div><h3 class="title">E.38.2. 変更点</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>walsenderプロセスがシャットダウンシグナルに反応するのに失敗するのを修正しました。
(Marco Nenciarini)
     </p><p>フラグの更新忘れのため、即時シャットダウンモード以外では、walsenderはスタンバイサーバが接続されている限り動作し続け、プライマリサーバがシャットダウンできませんでした。
     </p></li><li class="listitem"><p><code class="structname">information_schema</code>.<code class="structname">table_privileges</code>ビューで外部テーブルを表示するようになりました。
(Peter Eisentraut)
     </p><p>全ての他の関連する<code class="structname">information_schema</code>ビューは外部テーブルを含んでいますが、このビューは外部テーブルを無視していました。
     </p><p>このビュー定義は<span class="application">initdb</span>で導入されるため、アップグレードするだけでは問題は修正されません。
既存のインストレーションで修正する必要がある場合、スーパーユーザーとして<span class="application">psql</span>で以下を実行してください。
</p><pre class="programlisting">SET search_path TO information_schema;
CREATE OR REPLACE VIEW table_privileges AS
    SELECT CAST(u_grantor.rolname AS sql_identifier) AS grantor,
           CAST(grantee.rolname AS sql_identifier) AS grantee,
           CAST(current_database() AS sql_identifier) AS table_catalog,
           CAST(nc.nspname AS sql_identifier) AS table_schema,
           CAST(c.relname AS sql_identifier) AS table_name,
           CAST(c.prtype AS character_data) AS privilege_type,
           CAST(
             CASE WHEN
                  -- object owner always has grant options
                  pg_has_role(grantee.oid, c.relowner, 'USAGE')
                  OR c.grantable
                  THEN 'YES' ELSE 'NO' END AS yes_or_no) AS is_grantable,
           CAST(CASE WHEN c.prtype = 'SELECT' THEN 'YES' ELSE 'NO' END AS yes_or_no) AS with_hierarchy

    FROM (
            SELECT oid, relname, relnamespace, relkind, relowner, (aclexplode(coalesce(relacl, acldefault('r', relowner)))).* FROM pg_class
         ) AS c (oid, relname, relnamespace, relkind, relowner, grantor, grantee, prtype, grantable),
         pg_namespace nc,
         pg_authid u_grantor,
         (
           SELECT oid, rolname FROM pg_authid
           UNION ALL
           SELECT 0::oid, 'PUBLIC'
         ) AS grantee (oid, rolname)

    WHERE c.relnamespace = nc.oid
          AND c.relkind IN ('r', 'v', 'f')
          AND c.grantee = grantee.oid
          AND c.grantor = u_grantor.oid
          AND c.prtype IN ('INSERT', 'SELECT', 'UPDATE', 'DELETE', 'TRUNCATE', 'REFERENCES', 'TRIGGER')
          AND (pg_has_role(u_grantor.oid, 'USAGE')
               OR pg_has_role(grantee.oid, 'USAGE')
               OR grantee.rolname = 'PUBLIC');</pre><p>
これは、<code class="literal">template0</code>を含む、修正すべき各データベースで繰り返さなくてはなりません。
     </p></li><li class="listitem"><p>失敗したトランザクションの<code class="command">ROLLBACK</code>実行を試みている間に生じた、致命的な（例えば<span class="systemitem">SIGTERM</span>を受けとったことによる）終了の処理を整理しました。
(Tom Lane)
     </p><p>この状況はアサート失敗に至るかもしれません。
実運用ビルドでもこのような終了は起きますが、この場合は<span class="quote">“<span class="quote">cannot drop active portal(アクティブポータルを削除できません)</span>”</span>といった予期せぬメッセージがログ出力されます。
     </p></li><li class="listitem"><p>致命的な終了の間に駆動するかもしれないアサートを削除しました。
(Tom Lane)
     </p></li><li class="listitem"><p>検索されている、複合型またはドメイン型の上の、範囲型またはドメイン型の列を正確に識別するようにしました。
(Tom Lane)
     </p><p>複合型またはドメイン型の定義を変更する、ある種の<code class="command">ALTER</code>コマンドはデータベース中にその型の格納された値が1つでもあるときはエラーになるはずでした。なぜなら、そのような値を更新または検査するのに必要な基盤が欠けているためです。
これまでは、これらの検査は範囲型またはドメイン型の内側にラップされた関連する値を見過ごすかもしれず、データベースが不整合になるのを許すおそれがありました。
     </p></li><li class="listitem"><p><span class="application">pg_restore</span>における、パラレルモードを使っていてリストアする部分要素を選択するのにリストファイルを使っているときのクラッシュを修正しました。
(Fabrízio de Royes Mello)
     </p></li><li class="listitem"><p><span class="application">ecpg</span>のパーサを、C変数の割り当て無しの<code class="literal">RETURNING</code>句が使えるように変更しました。
(Michael Meskes)
     </p><p>これにより<code class="literal">RETURNING</code>をクライアントに返される値を定義するためではなく内部的に（例えばCTE内に）使ったSQL構文を<span class="application">ecpg</span>プログラムに含むことができます。
     </p></li><li class="listitem"><p>Windows上のPL/Perlに対するコンパイラフラグの選択を改善しました。
(Tom Lane)
     </p><p>本修正は<code class="type">time_t</code>値の幅についての一貫性のない仮定のために起こりうるPL/Perlのクラッシュを回避します。
拡張の開発者に見えるかもしれない副作用は、<code class="literal">_USE_32BIT_TIME_T</code>が<span class="productname">PostgreSQL</span>のWindowsビルドではもはやグローバルに定義されないことです。
<code class="type">time_t</code>はいかなる<span class="productname">PostgreSQL</span> API定義でも使われないため、これは問題をひき起こさないと予想されます。
     </p></li></ul></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="release-9-4-15.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="release.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="release-9-4-13.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">E.37. リリース9.4.15 </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> E.39. リリース9.4.13</td></tr></table></div></body></html>